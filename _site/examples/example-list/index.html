<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.12.2 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Mozzi</title>
<meta name="description" content="audio synthesis library for Arduino">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_GB">
<meta property="og:site_name" content="Mozzi">
<meta property="og:title" content="Mozzi">
<meta property="og:url" content="http://localhost:4000/Mozzi/examples/example-list/">


  <meta property="og:description" content="audio synthesis library for Arduino">



  <meta property="og:image" content="http://localhost:4000/Mozzi/assets/images/mozzi-square.png">









  

  


<link rel="canonical" href="http://localhost:4000/Mozzi/examples/example-list/">







  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Tim Barrass",
      "url": "http://localhost:4000/Mozzi",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/Mozzi/feed.xml" type="application/atom+xml" rel="alternate" title="Mozzi Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/Mozzi/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--page">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/Mozzi/">Mozzi</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/Mozzi/download/" >download</a>
            </li><li class="masthead__menu-item">
              <a href="/Mozzi/gallery/" >gallery</a>
            </li><li class="masthead__menu-item">
              <a href="/Mozzi/examples/" >examples</a>
            </li><li class="masthead__menu-item">
              <a href="/Mozzi/learn/" >learn</a>
            </li><li class="masthead__menu-item">
              <a href="https://groups.google.com/forum/?utm_medium=email&utm_source=footer#!forum/mozzi-users" >forum</a>
            </li><li class="masthead__menu-item">
              <a href="/Mozzi/blog/" >blog</a>
            </li><li class="masthead__menu-item">
              <a href="/Mozzi/doc/html/" >api</a>
            </li><li class="masthead__menu-item">
              <a href="https://github.com/sensorium/Mozzi" >github</a>
            </li><li class="masthead__menu-item">
              <a href="/Mozzi/shop/" >shop</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  











<div class="page__hero--overlay"
  style=" background-image: url('/Mozzi/assets/images/mozzi-square.png');"
>
  
    <div class="wrapper">
      <h1 class="page__title" itemprop="headline">
        
          Mozzi

        
      </h1>
      
        <p class="page__lead">audio synthesis library for Arduino
</p>
      
      
      
    </div>
  
  
</div>





<div id="main" role="main">
  

  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    
    <meta itemprop="description" content="audio synthesis library for Arduino">
    
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        
        <h2 id="01.Basics"> 01.Basics </h2>
<p>Control_Gain</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Control_Gain/Control_Gain.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Control_Gain/Control_Gain.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Control_Gainexpand" onclick="javascript:toggleDisplay(Control_Gain, Control_Gainexpand, Control_Gaincollapse)">show sketch</button>
<button id="Control_Gaincollapse" style="display:none" onclick="javascript:toggleDisplay(Control_Gain, Control_Gainexpand, Control_Gaincollapse)">hide sketch</button></p>
<div id="Control_Gain" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example changing the gain of a sinewave,
    using Mozzi sonification library.
  
    Demonstrates the use of a control variable to influence an
    audio signal.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>

<span class="c1">// control variable, use the smallest data size you can for anything used in audio
</span><span class="n">byte</span> <span class="n">gain</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// start with default control rate of 64
</span>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">3320</span><span class="p">);</span> <span class="c1">// set the frequency
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// as byte, this will automatically roll around to 255 when it passes 0
</span>  <span class="n">gain</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">-</span> <span class="mi">3</span> <span class="p">;</span> 
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span> <span class="n">gain</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// shift back to STANDARD audio range, like /256 but faster
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Sinewave</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Sinewave/Sinewave.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Sinewave/Sinewave.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Sinewaveexpand" onclick="javascript:toggleDisplay(Sinewave, Sinewaveexpand, Sinewavecollapse)">show sketch</button>
<button id="Sinewavecollapse" style="display:none" onclick="javascript:toggleDisplay(Sinewave, Sinewaveexpand, Sinewavecollapse)">hide sketch</button></p>
<div id="Sinewave" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example playing a sinewave at a set frequency,
    using Mozzi sonification library.
  
    Demonstrates the use of Oscil to play a wavetable.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>

<span class="c1">// use #define for CONTROL_RATE, not a constant
</span><span class="cp">#define CONTROL_RATE 64 // powers of 2 please
</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// set a control rate of 64 (powers of 2 please)
</span>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span> <span class="c1">// set the frequency
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// put changing controls in here
</span><span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// return an int signal centred around 0
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Sinewave_HIFI</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Sinewave_HIFI/Sinewave_HIFI.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Sinewave_HIFI/Sinewave_HIFI.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Sinewave_HIFIexpand" onclick="javascript:toggleDisplay(Sinewave_HIFI, Sinewave_HIFIexpand, Sinewave_HIFIcollapse)">show sketch</button>
<button id="Sinewave_HIFIcollapse" style="display:none" onclick="javascript:toggleDisplay(Sinewave_HIFI, Sinewave_HIFIexpand, Sinewave_HIFIcollapse)">hide sketch</button></p>
<div id="Sinewave_HIFI" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example playing a sinewave at a set frequency,
    using Mozzi sonification library.
  
    Demonstrates the use of Oscil to play a wavetable.
  
    This sketch using HIFI mode is not for Teensy 3.1.
        
    IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be
    be changed from STANDARD mode to HIFI.
    In Mozz/mozzi_config.h, change
    #define AUDIO_MODE STANDARD
    //#define AUDIO_MODE HIFI
    to
    //#define AUDIO_MODE STANDARD
    #define AUDIO_MODE HIFI
  
    Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),
    Check the Mozzi core module documentation for others and more detail
  
                     3.9k 
     pin 9  ---WWWW-----|-----output
                    499k           |
     pin 10 ---WWWW---- |
                                       |
                             4.7n  ==
                                       |
                                   ground
  
    Resistors are ±0.5%  Measure and choose the most precise 
    from a batch of whatever you can get.  Use two 1M resistors
    in parallel if you can't find 499k.
    Alternatively using 39 ohm, 4.99k and 470nF components will 
    work directly with headphones.
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012-13, CC by-nc-sa.
*/</span>
 
<span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// uses the default control rate of 64, defined in mozzi_config.h
</span>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span> <span class="c1">// set the frequency
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="c1">// this would make more sense with a higher resolution signal
</span>  <span class="c1">// but still benefits from using HIFI to avoid the 16kHz pwm noise
</span>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="c1">// 8 bits scaled up to 14 bits
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Skeleton
…(no recording of this one)</p>

<p><button type="button" id="Skeletonexpand" onclick="javascript:toggleDisplay(Skeleton, Skeletonexpand, Skeletoncollapse)">show sketch</button>
<button id="Skeletoncollapse" style="display:none" onclick="javascript:toggleDisplay(Skeleton, Skeletonexpand, Skeletoncollapse)">hide sketch</button></p>
<div id="Skeleton" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;        // at the top of your sketch
#define CONTROL_RATE 64   // or some other power of 2
</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">updateControl</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// your control code
</span><span class="p">}</span>

<span class="kt">int</span> <span class="nf">updateAudio</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// your audio code which returns an int between -244 and 243
</span>  <span class="c1">// actually, a char is fine
</span>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// fills the audio buffer
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Table_Resolution</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Table_Resolution/Table_Resolution.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Table_Resolution/Table_Resolution.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Table_Resolutionexpand" onclick="javascript:toggleDisplay(Table_Resolution, Table_Resolutionexpand, Table_Resolutioncollapse)">show sketch</button>
<button id="Table_Resolutioncollapse" style="display:none" onclick="javascript:toggleDisplay(Table_Resolution, Table_Resolutionexpand, Table_Resolutioncollapse)">hide sketch</button></p>
<div id="Table_Resolution" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/* Example playing sine tables of different sizes
	 with Mozzi sonification library.
	 
	 Demonstrates the audible quality of different length tables
	 played with Oscil and scheduling with EventDelay.
	 
	 Circuit: Audio output on digital pin 9 on a Uno or similar, or
	 DAC/A14 on Teensy 3.1, or 
	 check the README or https://sensorium.github.com/Mozzi/
	 
	 Mozzi help/discussion/announcements:
	 https://groups.google.com/forum/#!forum/mozzi-users
	 
	 Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/sin256_int8.h&gt;
#include &lt;tables/sin512_int8.h&gt;
#include &lt;tables/sin1024_int8.h&gt;
#include &lt;tables/sin2048_int8.h&gt;
#include &lt;tables/sin4096_int8.h&gt;
#include &lt;tables/sin8192_int8.h&gt;
#include &lt;EventDelay.h&gt; // for scheduling events
#include &lt;Line.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 64
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN256_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin0</span><span class="p">(</span><span class="n">SIN256_DATA</span><span class="p">);</span> <span class="c1">// can hear significant aliasing noise
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin1</span><span class="p">(</span><span class="n">SIN512_DATA</span><span class="p">);</span> <span class="c1">// noise still there but less noticeable
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN1024_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin2</span><span class="p">(</span><span class="n">SIN1024_DATA</span><span class="p">);</span> <span class="c1">// borderline, hardly there if at all
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin3</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// no audible improvement from here on
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN4096_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin4</span><span class="p">(</span><span class="n">SIN4096_DATA</span><span class="p">);</span> <span class="c1">// for 45 year old loud sound damaged ears
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin5</span><span class="p">(</span><span class="n">SIN8192_DATA</span><span class="p">);</span>

<span class="n">EventDelay</span> <span class="n">kWhoseTurnDelay</span><span class="p">;</span>

<span class="k">const</span> <span class="n">byte</span> <span class="n">NUM_OSCILS</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="n">byte</span> <span class="n">whose_turn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// which oscil to listen to
</span>
<span class="c1">// Line to sweep frequency at control rate
</span><span class="n">Line</span> <span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">kSweep</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">MILLIS_PER_SWEEP</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">MILLIS_PER_CONTROL</span> <span class="o">=</span> <span class="mi">1000u</span> <span class="o">/</span> <span class="n">CONTROL_RATE</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">CONTROL_STEPS_PER_SWEEP</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">MILLIS_PER_SWEEP</span> <span class="o">/</span> <span class="n">MILLIS_PER_CONTROL</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
  <span class="n">kWhoseTurnDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">MILLIS_PER_SWEEP</span><span class="p">);</span>
  <span class="n">kSweep</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mf">0.</span><span class="n">f</span><span class="p">,</span> <span class="mf">8192.</span><span class="n">f</span><span class="p">,</span> <span class="n">CONTROL_STEPS_PER_SWEEP</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>

  <span class="k">if</span><span class="p">(</span><span class="n">kWhoseTurnDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">whose_turn</span> <span class="o">&gt;=</span> <span class="n">NUM_OSCILS</span><span class="p">)</span> <span class="n">whose_turn</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">kWhoseTurnDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
    <span class="n">kSweep</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0UL</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kt">float</span> <span class="n">f</span> <span class="o">=</span> <span class="n">kSweep</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>

  <span class="k">switch</span> <span class="p">(</span><span class="n">whose_turn</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">aSin0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">aSin2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">aSin3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">4</span><span class="p">:</span>
    <span class="n">aSin4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">5</span><span class="p">:</span>
    <span class="n">aSin5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">asig</span><span class="p">;</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">whose_turn</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">asig</span> <span class="o">=</span> <span class="n">aSin0</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">asig</span> <span class="o">=</span> <span class="n">aSin1</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">asig</span> <span class="o">=</span> <span class="n">aSin2</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">asig</span> <span class="o">=</span> <span class="n">aSin3</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">4</span><span class="p">:</span>
    <span class="n">asig</span> <span class="o">=</span> <span class="n">aSin4</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">5</span><span class="p">:</span>
    <span class="n">asig</span> <span class="o">=</span> <span class="n">aSin5</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">asig</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Vibrato</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Vibrato/Vibrato.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Vibrato/Vibrato.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Vibratoexpand" onclick="javascript:toggleDisplay(Vibrato, Vibratoexpand, Vibratocollapse)">show sketch</button>
<button id="Vibratocollapse" style="display:none" onclick="javascript:toggleDisplay(Vibrato, Vibratoexpand, Vibratocollapse)">hide sketch</button></p>
<div id="Vibrato" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example playing a sinewave with vibrato,
    using Mozzi sonification library.
  
    Demonstrates simple FM using phase modulation.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/cos2048_int8.h&gt; // table for Oscils to play
#include &lt;mozzi_midi.h&gt; // for mtof
#include &lt;mozzi_fixmath.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 64 // powers of 2 please
</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aVibrato</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>

<span class="k">const</span> <span class="n">byte</span> <span class="n">intensity</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
  <span class="n">aCos</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">84.</span><span class="n">f</span><span class="p">));</span>
  <span class="n">aVibrato</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">15.</span><span class="n">f</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
    <span class="n">Q15n16</span> <span class="n">vibrato</span> <span class="o">=</span> <span class="p">(</span><span class="n">Q15n16</span><span class="p">)</span> <span class="n">intensity</span> <span class="o">*</span> <span class="n">aVibrato</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">aCos</span><span class="p">.</span><span class="n">phMod</span><span class="p">(</span><span class="n">vibrato</span><span class="p">);</span> <span class="c1">// phase modulation to modulate frequency
</span><span class="p">}</span>

<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<h2 id="02.Control"> 02.Control </h2>
<p>Control_Echo_Theremin</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Echo_Theremin/Control_Echo_Theremin.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Echo_Theremin/Control_Echo_Theremin.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Control_Echo_Thereminexpand" onclick="javascript:toggleDisplay(Control_Echo_Theremin, Control_Echo_Thereminexpand, Control_Echo_Theremincollapse)">show sketch</button>
<button id="Control_Echo_Theremincollapse" style="display:none" onclick="javascript:toggleDisplay(Control_Echo_Theremin, Control_Echo_Thereminexpand, Control_Echo_Theremincollapse)">hide sketch</button></p>
<div id="Control_Echo_Theremin" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of a simple light-sensing theremin-like
		instrument with long echoes,
		using Mozzi sonification library.
	
		Demonstrates ControlDelay() for echoing control values,
		and smoothing an analog input from a sensor
		signal with RollingAverage().
	
		The circuit: 
	 
			 Audio output on digital pin 9 on a Uno or similar, or
			DAC/A14 on Teensy 3.1, or 
			 check the README or https://sensorium.github.com/Mozzi/
	
		Light dependent resistor (LDR) and 5.1k resistor on analog pin 1:
			 LDR from analog pin to +5V (3.3V on Teensy 3.1)
			 5.1k resistor from analog pin to ground
		
		Mozzi help/discussion/announcements:
		https://groups.google.com/forum/#!forum/mozzi-users
	
		Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
#include &lt;RollingAverage.h&gt;
#include &lt;ControlDelay.h&gt;
</span>
<span class="cp">#define INPUT_PIN 0 // analog control input
</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">echo_cells_1</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">echo_cells_2</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">echo_cells_3</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>

<span class="cp">#define CONTROL_RATE 64
</span><span class="n">ControlDelay</span> <span class="o">&lt;</span><span class="mi">128</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">kDelay</span><span class="p">;</span> <span class="c1">// 2seconds
</span>
<span class="c1">// oscils to compare bumpy to averaged control input
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin0</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin1</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin2</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin3</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>

<span class="c1">// use: RollingAverage &lt;number_type, how_many_to_average&gt; myThing
</span><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverage</span><span class="p">;</span> <span class="c1">// how_many_to_average has to be power of 2
</span><span class="kt">int</span> <span class="n">averaged</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">kDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">echo_cells_1</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">bumpy_input</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">INPUT_PIN</span><span class="p">);</span>
  <span class="n">averaged</span> <span class="o">=</span> <span class="n">kAverage</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">bumpy_input</span><span class="p">);</span>
  <span class="n">aSin0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">averaged</span><span class="p">);</span>
  <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">kDelay</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">averaged</span><span class="p">));</span>
  <span class="n">aSin2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">kDelay</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">echo_cells_2</span><span class="p">));</span>
  <span class="n">aSin3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">kDelay</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">echo_cells_3</span><span class="p">));</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="mi">3</span><span class="o">*</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aSin0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span><span class="n">aSin1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span><span class="p">(</span><span class="n">aSin2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">+</span><span class="p">(</span><span class="n">aSin3</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">))</span> <span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Control_Oscil_Wash</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Oscil_Wash/Control_Oscil_Wash.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Oscil_Wash/Control_Oscil_Wash.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Control_Oscil_Washexpand" onclick="javascript:toggleDisplay(Control_Oscil_Wash, Control_Oscil_Washexpand, Control_Oscil_Washcollapse)">show sketch</button>
<button id="Control_Oscil_Washcollapse" style="display:none" onclick="javascript:toggleDisplay(Control_Oscil_Wash, Control_Oscil_Washexpand, Control_Oscil_Washcollapse)">hide sketch</button></p>
<div id="Control_Oscil_Wash" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Plays a fluctuating ambient wash,
    using Mozzi sonification library.
  
    Demonstrates audio and control rate updates.
    There are 8 oscillators updated at control rate to set
    the volume of 8 audio oscillators.  Updating the volume
    at control rate saves processor time, incrementing the
    Oscils only 128 times per second rather than at the
    audio rate of 16384 Hz.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/cos8192_int8.h&gt;
#include &lt;mozzi_midi.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 128
</span>
<span class="c1">// harmonics
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos3</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos4</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos5</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos6</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos7</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos8</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>

<span class="c1">// volume controls
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol3</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol4</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol5</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol6</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol7</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol8</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>

<span class="c1">// audio volumes updated each control interrupt and reused in audio till next control
</span><span class="kt">char</span> <span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="n">v5</span><span class="p">,</span><span class="n">v6</span><span class="p">,</span><span class="n">v7</span><span class="p">,</span><span class="n">v8</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>

  <span class="c1">// set harmonic frequencies
</span>  <span class="n">aCos1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mi">60</span><span class="p">));</span>
  <span class="n">aCos2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mi">74</span><span class="p">));</span>
  <span class="n">aCos3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mi">64</span><span class="p">));</span>
  <span class="n">aCos4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mi">77</span><span class="p">));</span>
  <span class="n">aCos5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mi">67</span><span class="p">));</span>
  <span class="n">aCos6</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mi">81</span><span class="p">));</span>
  <span class="n">aCos7</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mi">60</span><span class="p">));</span>
  <span class="n">aCos8</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mi">84</span><span class="p">));</span>

<span class="c1">// set volume change frequencies
</span>  <span class="n">kVol1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">4.43</span><span class="n">f</span><span class="p">);</span> <span class="c1">// more of a pulse
</span>  <span class="n">kVol2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.0245</span><span class="n">f</span><span class="p">);</span>
  <span class="n">kVol3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.019</span><span class="n">f</span><span class="p">);</span>
  <span class="n">kVol4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.07</span><span class="n">f</span><span class="p">);</span>
  <span class="n">kVol5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.047</span><span class="n">f</span><span class="p">);</span>
  <span class="n">kVol6</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.031</span><span class="n">f</span><span class="p">);</span>
  <span class="n">kVol7</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.0717</span><span class="n">f</span><span class="p">);</span>
  <span class="n">kVol8</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.041</span><span class="n">f</span><span class="p">);</span>

  <span class="n">v1</span><span class="o">=</span><span class="n">v2</span><span class="o">=</span><span class="n">v3</span><span class="o">=</span><span class="n">v4</span><span class="o">=</span><span class="n">v5</span><span class="o">=</span><span class="n">v6</span><span class="o">=</span><span class="n">v7</span><span class="o">=</span><span class="n">v8</span><span class="o">=</span><span class="mi">127</span><span class="p">;</span>
  
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
   <span class="n">v1</span> <span class="o">=</span> <span class="n">kVol1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// going at a higher freq, this creates zipper noise, so reduce the gain
</span>   <span class="n">v2</span> <span class="o">=</span> <span class="n">kVol2</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
   <span class="n">v3</span> <span class="o">=</span> <span class="n">kVol3</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
   <span class="n">v4</span> <span class="o">=</span> <span class="n">kVol4</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
   <span class="n">v5</span> <span class="o">=</span> <span class="n">kVol5</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
   <span class="n">v6</span> <span class="o">=</span> <span class="n">kVol6</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
   <span class="n">v7</span> <span class="o">=</span> <span class="n">kVol7</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
   <span class="n">v8</span> <span class="o">=</span> <span class="n">kVol8</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">long</span> <span class="n">asig</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span>
    <span class="n">aCos1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v1</span> <span class="o">+</span>
    <span class="n">aCos2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v2</span> <span class="o">+</span>
    <span class="n">aCos3</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v3</span> <span class="o">+</span>
    <span class="n">aCos4</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v4</span> <span class="o">+</span>
    <span class="n">aCos5</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v5</span> <span class="o">+</span>
    <span class="n">aCos6</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v6</span> <span class="o">+</span>
    <span class="n">aCos7</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v7</span> <span class="o">+</span>
    <span class="n">aCos8</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v8</span><span class="p">;</span>
  <span class="n">asig</span> <span class="o">&gt;&gt;=</span> <span class="mi">9</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">asig</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Control_Tremelo</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Tremelo/Control_Tremelo.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Tremelo/Control_Tremelo.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Control_Tremeloexpand" onclick="javascript:toggleDisplay(Control_Tremelo, Control_Tremeloexpand, Control_Tremelocollapse)">show sketch</button>
<button id="Control_Tremelocollapse" style="display:none" onclick="javascript:toggleDisplay(Control_Tremelo, Control_Tremeloexpand, Control_Tremelocollapse)">hide sketch</button></p>
<div id="Control_Tremelo" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of amplitude modulation (as tremelo),
    using Mozzi sonification library.
  
    Demonstrates audio and control rate updates.
    The tremelo oscillator is updated at control rate,
    and a Line is used to interpolate the control updates
    at audio rate, to remove zipper noise.
    A bit contrived and probably less efficient than just 
    using an audio-rate tremelo oscillator, but hey it's a demo!
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/triangle_valve_2048_int8.h&gt;
#include &lt;tables/sin2048_int8.h&gt;
#include &lt;Line.h&gt;
#include &lt;mozzi_midi.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 64 // powers of 2 please
</span>
<span class="c1">// audio oscillator
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_VALVE_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSig</span><span class="p">(</span><span class="n">TRIANGLE_VALVE_2048_DATA</span><span class="p">);</span>
<span class="c1">// control oscillator for tremelo
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kTremelo</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
<span class="c1">// a line to interpolate control tremolo at audio rate
</span><span class="n">Line</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">aGain</span><span class="p">;</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">aSig</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">65.</span><span class="n">f</span><span class="p">));</span>
  <span class="n">kTremelo</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">5.5</span><span class="n">f</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// gain shifted up to give enough range for line's internal steps
</span>   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gain</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128u</span><span class="o">+</span><span class="n">kTremelo</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">;</span>
   <span class="n">aGain</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">gain</span><span class="p">,</span> <span class="n">AUDIO_RATE</span> <span class="o">/</span> <span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// divide of literals should get optimised away
</span><span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="c1">// cast to long before multiply to give room for intermediate result, 
</span>  <span class="c1">// and also before shift,
</span>  <span class="c1">// to give consistent results for both 8 and 32 bit processors.
</span>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((</span><span class="kt">long</span><span class="p">)((</span><span class="kt">long</span><span class="p">)</span> <span class="n">aSig</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aGain</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span> <span class="c1">// shifted back to audio range after multiply
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>EventDelay</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/EventDelay/EventDelay.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/EventDelay/EventDelay.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="EventDelayexpand" onclick="javascript:toggleDisplay(EventDelay, EventDelayexpand, EventDelaycollapse)">show sketch</button>
<button id="EventDelaycollapse" style="display:none" onclick="javascript:toggleDisplay(EventDelay, EventDelayexpand, EventDelaycollapse)">hide sketch</button></p>
<div id="EventDelay" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of a sound being toggled on an off,
    using Mozzi sonification library.
  
    Demonstrates scheduling with EventDelay.
    EventDelay is a way to make non-blocking
    time delays for events.  Use this instead of
    the Arduino delay() function, which doesn't
    work with Mozzi.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/sin8192_int8.h&gt; // sine table for oscillator
#include &lt;EventDelay.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 64
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN8192_DATA</span><span class="p">);</span>

<span class="c1">// for scheduling audio gain changes
</span><span class="n">EventDelay</span> <span class="n">kGainChangeDelay</span><span class="p">;</span>

<span class="kt">char</span> <span class="n">gain</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">330</span><span class="p">);</span> <span class="c1">// set the frequency
</span>  <span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// 1 second countdown, within resolution of CONTROL_RATE
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="n">gain</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">gain</span><span class="p">;</span> <span class="c1">// flip 0/1
</span>    <span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gain</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Line_Gliss</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Line_Gliss/Line_Gliss.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Line_Gliss/Line_Gliss.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Line_Glissexpand" onclick="javascript:toggleDisplay(Line_Gliss, Line_Glissexpand, Line_Glisscollapse)">show sketch</button>
<button id="Line_Glisscollapse" style="display:none" onclick="javascript:toggleDisplay(Line_Gliss, Line_Glissexpand, Line_Glisscollapse)">hide sketch</button></p>
<div id="Line_Gliss" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of sliding smoothly
    between oscillator frequencies,
    using Mozzi sonification library.
  
    Demonstrates using a Line to efficiently change the
    frequency of an oscillator at audio rate.   Calculating
    a new frequency for every step of a slide is a lot to
    do for every single sample, so instead this sketch works out the 
    start and end frequencies for each control period and
    the phase increments (size of the steps through the sound table)
    required for the audio oscillator to generate those frequencies.
    Then, a computationally cheap Line() is used to slide between the
    different phase increments smoothly at audio rate.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Line.h&gt; // for smooth transitions
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/triangle_warm8192_int8.h&gt; // triangle table for oscillator
#include &lt;mozzi_midi.h&gt;
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">TRIANGLE_WARM8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle</span><span class="p">(</span><span class="n">TRIANGLE_WARM8192_DATA</span><span class="p">);</span>

<span class="c1">// use: Line &lt;type&gt; lineName
</span><span class="n">Line</span> <span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">aGliss</span><span class="p">;</span>

<span class="cp">#define CONTROL_RATE 64 // powers of 2 please
</span>
<span class="n">byte</span> <span class="n">lo_note</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span> <span class="c1">// midi note numbers
</span><span class="n">byte</span> <span class="n">hi_note</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>

<span class="kt">long</span> <span class="n">audio_steps_per_gliss</span> <span class="o">=</span> <span class="n">AUDIO_RATE</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// ie. 4 glisses per second
</span><span class="kt">long</span> <span class="n">control_steps_per_gliss</span> <span class="o">=</span> <span class="n">CONTROL_RATE</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>

<span class="c1">// stuff for changing starting positions, probably just confusing really
</span><span class="kt">int</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">byte</span> <span class="n">gliss_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">byte</span> <span class="n">gliss_offset_step</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">byte</span>  <span class="n">gliss_offset_max</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">counter</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">){</span>
    
    <span class="c1">// start at a new note
</span>    <span class="n">gliss_offset</span> <span class="o">+=</span> <span class="n">gliss_offset_step</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">gliss_offset</span> <span class="o">&gt;=</span> <span class="n">gliss_offset_max</span><span class="p">)</span> <span class="n">gliss_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
    
    <span class="c1">// only need to calculate frequencies once each control update
</span>    <span class="kt">int</span> <span class="n">start_freq</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="n">lo_note</span><span class="o">+</span><span class="n">gliss_offset</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">end_freq</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="n">hi_note</span><span class="o">+</span><span class="n">gliss_offset</span><span class="p">);</span>
    
    <span class="c1">// find the phase increments (step sizes) through the audio table for those freqs
</span>    <span class="c1">// they are big ugly numbers which the oscillator understands but you don't really want to know
</span>    <span class="kt">long</span> <span class="n">gliss_start</span> <span class="o">=</span> <span class="n">aTriangle</span><span class="p">.</span><span class="n">phaseIncFromFreq</span><span class="p">(</span><span class="n">start_freq</span><span class="p">);</span>
    <span class="kt">long</span> <span class="n">gliss_end</span> <span class="o">=</span> <span class="n">aTriangle</span><span class="p">.</span><span class="n">phaseIncFromFreq</span><span class="p">(</span><span class="n">end_freq</span><span class="p">);</span>
    
    <span class="c1">// set the audio rate line to transition between the different step sizes
</span>    <span class="n">aGliss</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">gliss_start</span><span class="p">,</span> <span class="n">gliss_end</span><span class="p">,</span> <span class="n">audio_steps_per_gliss</span><span class="p">);</span>
    
    <span class="n">counter</span> <span class="o">=</span> <span class="n">control_steps_per_gliss</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="n">aTriangle</span><span class="p">.</span><span class="n">setPhaseInc</span><span class="p">(</span><span class="n">aGliss</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
  <span class="k">return</span> <span class="n">aTriangle</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Line_Gliss_Double_32k_HIFI</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Line_Gliss_Double_32k_HIFI/Line_Gliss_Double_32k_HIFI.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Line_Gliss_Double_32k_HIFI/Line_Gliss_Double_32k_HIFI.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Line_Gliss_Double_32k_HIFIexpand" onclick="javascript:toggleDisplay(Line_Gliss_Double_32k_HIFI, Line_Gliss_Double_32k_HIFIexpand, Line_Gliss_Double_32k_HIFIcollapse)">show sketch</button>
<button id="Line_Gliss_Double_32k_HIFIcollapse" style="display:none" onclick="javascript:toggleDisplay(Line_Gliss_Double_32k_HIFI, Line_Gliss_Double_32k_HIFIexpand, Line_Gliss_Double_32k_HIFIcollapse)">hide sketch</button></p>
<div id="Line_Gliss_Double_32k_HIFI" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of a pair of detuned oscillators 
    sliding smoothly between frequencies,
    using Mozzi sonification library.
  
    Demonstrates using Lines to efficiently change the
    frequency of each oscillator at audio rate.   Calculating
    a new frequency for every step of a slide is a lot to
    do for every single sample, so instead this sketch works out the 
    start and end frequencies for each control period and
    the phase increments (size of the steps through the sound table)
    required for the audio oscillators to generate those frequencies.
    Then, computationally cheap Lines are used to slide between the
    different phase increments smoothly at audio rate.
    Also shows how to use random offsets between the oscillators'
    frequencies to produce a chorusing/doubling effect.
    
    This sketch using HIFI mode is not for Teensy 3.1.
  
    IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be
    be changed from STANDARD mode to HIFI.
    In Mozz/mozzi_config.h, change
    #define AUDIO_MODE STANDARD
    //#define AUDIO_MODE STANDARD_PLUS
    //#define AUDIO_MODE HIFI
    to
    //#define AUDIO_MODE STANDARD
    //#define AUDIO_MODE STANDARD_PLUS
    #define AUDIO_MODE HIFI
  
    Also, AUDIO_RATE can be changed from 16384 to 32768 in mozzi_config.h,
    to try out the higher sample rate.
  
    Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),
    Check the Mozzi core module documentation for others and more detail
  
                     3.9k 
     pin 9  ---WWWW-----|-----output
                    499k           |
     pin 10 ---WWWW---- |
                                       |
                             4.7n  ==
                                       |
                                   ground
  
    Resistors are ±0.5%  Measure and choose the most precise 
    from a batch of whatever you can get.  Use two 1M resistors
    in parallel if you can't find 499k.
    Alternatively using 39 ohm, 4.99k and 470nF components will 
    work directly with headphones.

    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Line.h&gt; // for smooth transitions
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/saw8192_int8.h&gt; // saw table for oscillator
#include &lt;mozzi_rand.h&gt;
#include &lt;mozzi_midi.h&gt;
#include &lt;mozzi_fixmath.h&gt;
</span>

<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SAW8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSaw1</span><span class="p">(</span><span class="n">SAW8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SAW8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSaw2</span><span class="p">(</span><span class="n">SAW8192_DATA</span><span class="p">);</span>


<span class="c1">// use: Line &lt;type&gt; lineName
</span><span class="n">Line</span> <span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">aGliss1</span><span class="p">;</span>
<span class="n">Line</span> <span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">aGliss2</span><span class="p">;</span>

<span class="n">byte</span> <span class="n">lo_note</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span> <span class="c1">// midi note numbers
</span><span class="n">byte</span> <span class="n">hi_note</span> <span class="o">=</span> <span class="mi">46</span><span class="p">;</span>

<span class="kt">long</span> <span class="n">audio_steps_per_gliss</span> <span class="o">=</span> <span class="n">AUDIO_RATE</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// ie. 4 glisses per second
</span><span class="kt">long</span> <span class="n">control_steps_per_gliss</span> <span class="o">=</span> <span class="n">CONTROL_RATE</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>

<span class="c1">// stuff for changing starting positions, probably just confusing really
</span><span class="kt">int</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">byte</span> <span class="n">gliss_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">byte</span> <span class="n">gliss_offset_step</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">byte</span>  <span class="n">gliss_offset_max</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>


<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//randSeed();
</span>  <span class="c1">//pinMode(0,OUTPUT); // without this, updateControl() gets interrupted ........??
</span>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// uses default 64 control rate
</span><span class="p">}</span>


<span class="c1">// variation between oscillator's phase increments
// looks like a big number, but they are high precision 
// and this is just a fractional part
</span><span class="kt">long</span> <span class="n">variation</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">rand</span><span class="p">(</span><span class="mi">16383</span><span class="p">);</span> 
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span> <span class="c1">// 900 us floats vs 160 fixed
</span>  <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">counter</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">){</span>
    
    <span class="c1">// start at a new note
</span>    <span class="n">gliss_offset</span> <span class="o">+=</span> <span class="n">gliss_offset_step</span><span class="p">;</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">gliss_offset</span> <span class="o">&gt;=</span> <span class="n">gliss_offset_max</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">gliss_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
      
      <span class="c1">// this is just confusing, you should ignore it!
</span>      <span class="c1">// alternate between 2 and 3 steps per start note each time a new "run" starts
</span>      <span class="k">if</span><span class="p">(</span><span class="n">gliss_offset_step</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">){</span>
        <span class="n">gliss_offset_step</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span><span class="p">{</span>
        <span class="n">gliss_offset_step</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">// only need to calculate frequencies once each control update
</span>    <span class="kt">int</span> <span class="n">start_freq</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="n">lo_note</span><span class="o">+</span><span class="n">gliss_offset</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">end_freq</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="n">hi_note</span><span class="o">+</span><span class="n">gliss_offset</span><span class="p">);</span>
    
    <span class="c1">// find the phase increments (step sizes) through the audio table for those freqs
</span>    <span class="c1">// they are big ugly numbers which the oscillator understands but you don't really want to know
</span>    <span class="kt">long</span> <span class="n">gliss_start</span> <span class="o">=</span> <span class="n">aSaw1</span><span class="p">.</span><span class="n">phaseIncFromFreq</span><span class="p">(</span><span class="n">start_freq</span><span class="p">);</span>
    <span class="kt">long</span> <span class="n">gliss_end</span> <span class="o">=</span> <span class="n">aSaw1</span><span class="p">.</span><span class="n">phaseIncFromFreq</span><span class="p">(</span><span class="n">end_freq</span><span class="p">);</span>
    
    <span class="n">aGliss1</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">gliss_start</span><span class="p">,</span> <span class="n">gliss_end</span><span class="p">,</span> <span class="n">audio_steps_per_gliss</span><span class="p">);</span>
    <span class="c1">// aGliss2 is an octave up and detuned
</span>    <span class="n">aGliss2</span><span class="p">.</span><span class="n">set</span><span class="p">((</span><span class="n">gliss_start</span><span class="o">+</span><span class="p">(</span><span class="n">variation</span><span class="p">()</span><span class="o">*</span><span class="n">gliss_offset</span><span class="p">))</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">gliss_end</span><span class="o">+</span><span class="p">(</span><span class="n">variation</span><span class="p">()</span><span class="o">*</span><span class="n">gliss_offset</span><span class="p">))</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">audio_steps_per_gliss</span><span class="p">);</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="n">control_steps_per_gliss</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="n">aSaw1</span><span class="p">.</span><span class="n">setPhaseInc</span><span class="p">(</span><span class="n">aGliss1</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
  <span class="n">aSaw2</span><span class="p">.</span><span class="n">setPhaseInc</span><span class="p">(</span><span class="n">aGliss2</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
  <span class="k">return</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aSaw1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span><span class="n">aSaw2</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Metronome_SampleHuffman</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Metronome_SampleHuffman/Metronome_SampleHuffman.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Metronome_SampleHuffman/Metronome_SampleHuffman.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Metronome_SampleHuffmanexpand" onclick="javascript:toggleDisplay(Metronome_SampleHuffman, Metronome_SampleHuffmanexpand, Metronome_SampleHuffmancollapse)">show sketch</button>
<button id="Metronome_SampleHuffmancollapse" style="display:none" onclick="javascript:toggleDisplay(Metronome_SampleHuffman, Metronome_SampleHuffmanexpand, Metronome_SampleHuffmancollapse)">hide sketch</button></p>
<div id="Metronome_SampleHuffman" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example using Metronome to playing samples encoded with Huffman compression.
	
		Demonstrates Metronome start, stop and ready, and the the SampleHuffman class.
		
		Circuit:
		Audio output on digital pin 9 on a Uno or similar, or
		DAC/A14 on Teensy 3.1, or 
		check the README or https://sensorium.github.com/Mozzi/
		
		Mozzi help/discussion/announcements:
		https://groups.google.com/forum/#!forum/mozzi-users
		
		Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Metronome.h&gt;
#include &lt;SampleHuffman.h&gt;
#include &lt;mozzi_rand.h&gt;
</span>
<span class="cp">#include &lt;samples/thumbpiano_huffman/thumbpiano0.h&gt;
#include &lt;samples/thumbpiano_huffman/thumbpiano1.h&gt;
#include &lt;samples/thumbpiano_huffman/thumbpiano2.h&gt;
#include &lt;samples/thumbpiano_huffman/thumbpiano3.h&gt;
#include &lt;samples/thumbpiano_huffman/thumbpiano4.h&gt;
</span>
<span class="n">SampleHuffman</span> <span class="n">thumb0</span><span class="p">(</span><span class="n">THUMB0_SOUNDDATA</span><span class="p">,</span><span class="n">THUMB0_HUFFMAN</span><span class="p">,</span><span class="n">THUMB0_SOUNDDATA_BITS</span><span class="p">);</span>
<span class="n">SampleHuffman</span>  <span class="n">thumb1</span><span class="p">(</span><span class="n">THUMB1_SOUNDDATA</span><span class="p">,</span><span class="n">THUMB1_HUFFMAN</span><span class="p">,</span><span class="n">THUMB1_SOUNDDATA_BITS</span><span class="p">);</span>
<span class="n">SampleHuffman</span> <span class="n">thumb2</span><span class="p">(</span><span class="n">THUMB2_SOUNDDATA</span><span class="p">,</span><span class="n">THUMB2_HUFFMAN</span><span class="p">,</span><span class="n">THUMB2_SOUNDDATA_BITS</span><span class="p">);</span>
<span class="n">SampleHuffman</span> <span class="n">thumb3</span><span class="p">(</span><span class="n">THUMB3_SOUNDDATA</span><span class="p">,</span><span class="n">THUMB3_HUFFMAN</span><span class="p">,</span><span class="n">THUMB3_SOUNDDATA_BITS</span><span class="p">);</span>
<span class="n">SampleHuffman</span> <span class="n">thumb4</span><span class="p">(</span><span class="n">THUMB4_SOUNDDATA</span><span class="p">,</span><span class="n">THUMB4_HUFFMAN</span><span class="p">,</span><span class="n">THUMB4_SOUNDDATA_BITS</span><span class="p">);</span>

<span class="k">const</span> <span class="kt">char</span> <span class="n">NUM_SAMPLES</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

<span class="n">Metronome</span> <span class="n">kMetro</span><span class="p">(</span><span class="mi">800</span><span class="p">);</span> <span class="c1">// enough delay so samples don't overlap, because the load would be too much
</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>



<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">counter</span><span class="p">;</span>
  <span class="n">counter</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">counter</span><span class="o">==</span><span class="mi">177</span><span class="p">)</span><span class="n">kMetro</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="n">counter</span><span class="o">==</span><span class="mi">203</span><span class="p">){</span><span class="n">kMetro</span><span class="p">.</span><span class="n">start</span><span class="p">();</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;}</span>
  <span class="k">if</span><span class="p">(</span><span class="n">kMetro</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="k">switch</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="n">NUM_SAMPLES</span><span class="p">)){</span>
      <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">thumb0</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
      <span class="k">break</span><span class="p">;</span>
      
      <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">thumb1</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
      <span class="k">break</span><span class="p">;</span>
      
      <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">thumb2</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
      <span class="k">break</span><span class="p">;</span>
      
      <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
      <span class="n">thumb3</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
      <span class="k">break</span><span class="p">;</span>
      
      <span class="k">case</span> <span class="mi">4</span><span class="p">:</span>
      <span class="n">thumb4</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span> 
  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span>
  <span class="n">thumb0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
  <span class="n">thumb1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
  <span class="n">thumb2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
  <span class="n">thumb3</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
  <span class="n">thumb4</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">asig</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Pause</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Pause/Pause.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Pause/Pause.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Pauseexpand" onclick="javascript:toggleDisplay(Pause, Pauseexpand, Pausecollapse)">show sketch</button>
<button id="Pausecollapse" style="display:none" onclick="javascript:toggleDisplay(Pause, Pauseexpand, Pausecollapse)">hide sketch</button></p>
<div id="Pause" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example pausing Mozzi, restoring timers to previous states,
    during which Arduino delay() works, then resuming Mozzi again.
    
    This may be useful when using sensors or other libraries which need to use
    the same timers as Mozzi.  (Atmel Timer 0, Timer 1, and in HIFI mode, Timer 2).
  
    Circuit:
    Pushbutton on digital pin D4
       button from the digital pin to +5V (3.3V on Teensy 3.1)
       10K resistor from the digital pin to ground
    Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
    
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/brownnoise8192_int8.h&gt; // recorded audio wavetable
#include &lt;mozzi_rand.h&gt;
</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">BROWNNOISE8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aNoise</span><span class="p">(</span><span class="n">BROWNNOISE8192_DATA</span><span class="p">);</span>

<span class="cp">#define STOP_PIN 4
</span>
<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">STOP_PIN</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>
  <span class="n">aNoise</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.</span><span class="n">f</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">static</span> <span class="kt">int</span> <span class="n">previous</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">current</span> <span class="o">=</span> <span class="n">digitalRead</span><span class="p">(</span><span class="n">STOP_PIN</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">previous</span><span class="o">==</span><span class="n">LOW</span> <span class="o">&amp;&amp;</span> <span class="n">current</span><span class="o">==</span><span class="n">HIGH</span><span class="p">){</span>
    <span class="n">pauseMozzi</span><span class="p">();</span>
  <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">previous</span><span class="o">==</span><span class="n">HIGH</span> <span class="o">&amp;&amp;</span> <span class="n">current</span><span class="o">==</span><span class="n">LOW</span><span class="p">){</span>
    <span class="n">unPauseMozzi</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">previous</span><span class="o">=</span><span class="n">current</span><span class="p">;</span>
  <span class="c1">// jump to a new spot in the noise table to stop it sounding like it repeats
</span>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setPhase</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="n">BROWNNOISE8192_NUM_CELLS</span><span class="p">));</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">aNoise</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<h2 id="03.Sensors"> 03.Sensors </h2>
<p>Knob_LDR_x2_WavePacket</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LDR_x2_WavePacket/Knob_LDR_x2_WavePacket.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LDR_x2_WavePacket/Knob_LDR_x2_WavePacket.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Knob_LDR_x2_WavePacketexpand" onclick="javascript:toggleDisplay(Knob_LDR_x2_WavePacket, Knob_LDR_x2_WavePacketexpand, Knob_LDR_x2_WavePacketcollapse)">show sketch</button>
<button id="Knob_LDR_x2_WavePacketcollapse" style="display:none" onclick="javascript:toggleDisplay(Knob_LDR_x2_WavePacket, Knob_LDR_x2_WavePacketexpand, Knob_LDR_x2_WavePacketcollapse)">hide sketch</button></p>
<div id="Knob_LDR_x2_WavePacket" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  
  Example of Wavepacket synthesis, using analog
  inputs to change the fundamental frequency, 
  bandwidth and centre frequency,
  using Mozzi sonification library.

  Demonstrates WavePacket, mozziAnalogRead(), and smoothing
  control signals with RollingAverage.
  Also demonstrates AutoMap, which maps unpredictable inputs to a set range.
  
  This example goes with a tutorial on the Mozzi site:
  https://sensorium.github.io/Mozzi/learn/introductory-tutorial/
  
  The circuit:
     Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
     check the README or https://sensorium.github.com/Mozzi/

     Potentiometer connected to analog pin 0.
       Center pin of the potentiometer goes to the analog pin.
       Side pins of the potentiometer go to +5V and ground
  
     Light dependent resistor (LDR) and 5.1k resistor on analog pin 1:
       LDR from analog pin to +5V (3.3V on Teensy 3.1)
       5.1k resistor from analog pin to ground
     
     Light dependent resistor (LDR) and 5.1k resistor on analog pin 2:
       LDR from analog pin to +5V (3.3V on Teensy 3.1)
       5.1k resistor from analog pin to ground
  
  Mozzi help/discussion/announcements:
  https://groups.google.com/forum/#!forum/mozzi-users

  Tim Barrass 2013, CC by-nc-sa.
*/</span>
 

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;WavePacket.h&gt;
#include &lt;RollingAverage.h&gt;
#include &lt;AutoMap.h&gt;
</span> 
<span class="k">const</span> <span class="kt">int</span> <span class="n">KNOB_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// set the input for the knob to analog pin 0
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">LDR1_PIN</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// set the analog input for fm_intensity to pin 1
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">LDR2_PIN</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span> <span class="c1">// set the analog input for mod rate to pin 2
</span>
<span class="c1">// min and max values of synth parameters to map AutoRanged analog inputs to
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_F</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_F</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_BW</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_BW</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_CF</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_CF</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span>


<span class="c1">// for smoothing the control signals
// use: RollingAverage &lt;number_type, how_many_to_average&gt; myThing
</span><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">16</span><span class="o">&gt;</span> <span class="n">kAverageF</span><span class="p">;</span>
<span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">16</span><span class="o">&gt;</span> <span class="n">kAverageBw</span><span class="p">;</span>
<span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">16</span><span class="o">&gt;</span> <span class="n">kAverageCf</span><span class="p">;</span>
<span class="n">AutoMap</span> <span class="n">kMapF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_F</span><span class="p">,</span><span class="n">MAX_F</span><span class="p">);</span>
<span class="n">AutoMap</span> <span class="n">kMapBw</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_BW</span><span class="p">,</span><span class="n">MAX_BW</span><span class="p">);</span>
<span class="n">AutoMap</span> <span class="n">kMapCf</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_CF</span><span class="p">,</span><span class="n">MAX_CF</span><span class="p">);</span>

<span class="n">WavePacket</span> <span class="o">&lt;</span><span class="n">DOUBLE</span><span class="o">&gt;</span> <span class="n">wavey</span><span class="p">;</span> <span class="c1">// DOUBLE selects 2 overlapping streams
</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="c1">// wait before starting Mozzi to receive analog reads, so AutoRange will not get 0
</span>  <span class="n">delay</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">fundamental</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">fundamental</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"  "</span><span class="p">);</span>
  <span class="n">fundamental</span> <span class="o">=</span> <span class="n">kMapF</span><span class="p">(</span><span class="n">fundamental</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">fundamental</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
  
  <span class="kt">int</span> <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">LDR1_PIN</span><span class="p">);</span>
  <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">kMapBw</span><span class="p">(</span><span class="n">bandwidth</span><span class="p">);</span>
  
  <span class="kt">int</span> <span class="n">centre_freq</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">LDR2_PIN</span><span class="p">);</span>
  <span class="n">centre_freq</span> <span class="o">=</span> <span class="n">kMapCf</span><span class="p">(</span><span class="n">centre_freq</span><span class="p">);</span>

  
  <span class="n">wavey</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">fundamental</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">centre_freq</span><span class="p">);</span>
<span class="p">}</span>



<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">wavey</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// &gt;&gt;8 for AUDIO_MODE STANDARD
</span><span class="p">}</span>



<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Knob_LightLevel_FMsynth</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LightLevel_FMsynth/Knob_LightLevel_FMsynth.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LightLevel_FMsynth/Knob_LightLevel_FMsynth.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Knob_LightLevel_FMsynthexpand" onclick="javascript:toggleDisplay(Knob_LightLevel_FMsynth, Knob_LightLevel_FMsynthexpand, Knob_LightLevel_FMsynthcollapse)">show sketch</button>
<button id="Knob_LightLevel_FMsynthcollapse" style="display:none" onclick="javascript:toggleDisplay(Knob_LightLevel_FMsynth, Knob_LightLevel_FMsynthexpand, Knob_LightLevel_FMsynthcollapse)">hide sketch</button></p>
<div id="Knob_LightLevel_FMsynth" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/* 
  Example using a light dependent resistor (LDR) to change 
  an FM synthesis parameter, and a knob for fundamental frequency,
  using Mozzi sonification library.

  Demonstrates analog input, audio oscillators, and phase modulation.
  Also demonstrates AutoMap, which maps unpredictable inputs to a set range.
  There might be clicks in the audio from rapid control changes, which
  could be smoothed with Line or Smooth objects.
    
  This example goes with a tutorial on the Mozzi site:
  https://sensorium.github.io/Mozzi/learn/introductory-tutorial/
  
  The circuit:
     Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
     check the README or https://sensorium.github.com/Mozzi/

     Potentiometer connected to analog pin 0.
       Center pin of the potentiometer goes to the analog pin.
       Side pins of the potentiometer go to +5V and ground
  
     Light dependent resistor (LDR) and 5.1k resistor on analog pin 1:
       LDR from analog pin to +5V (3.3V on Teensy 3.1)
       5.1k resistor from analog pin to ground
  
  Mozzi help/discussion/announcements:
  https://groups.google.com/forum/#!forum/mozzi-users

  Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator 
#include &lt;tables/cos2048_int8.h&gt; // table for Oscils to play
#include &lt;AutoMap.h&gt; // maps unpredictable inputs to a range
</span> 
<span class="c1">// desired carrier frequency max and min, for AutoMap
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_CARRIER_FREQ</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_CARRIER_FREQ</span> <span class="o">=</span> <span class="mi">440</span><span class="p">;</span>

<span class="c1">// desired intensity max and min, for AutoMap, note they're inverted for reverse dynamics
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_INTENSITY</span> <span class="o">=</span> <span class="mi">700</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_INTENSITY</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="n">AutoMap</span> <span class="n">kMapCarrierFreq</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_CARRIER_FREQ</span><span class="p">,</span><span class="n">MAX_CARRIER_FREQ</span><span class="p">);</span>
<span class="n">AutoMap</span> <span class="n">kMapIntensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_INTENSITY</span><span class="p">,</span><span class="n">MAX_INTENSITY</span><span class="p">);</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">KNOB_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// set the input for the knob to analog pin 0
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">LDR_PIN</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// set the input for the LDR to analog pin 1
</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mod_ratio</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// harmonics
</span><span class="kt">long</span> <span class="n">fm_intensity</span><span class="p">;</span> <span class="c1">// carries control info from updateControl() to updateAudio()
</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values // set up the Serial output for debugging
</span>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// read the knob
</span>  <span class="kt">int</span> <span class="n">knob_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023
</span>
  <span class="c1">// map the knob to carrier frequency
</span>  <span class="kt">int</span> <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">kMapCarrierFreq</span><span class="p">(</span><span class="n">knob_value</span><span class="p">);</span>
  
  <span class="c1">//calculate the modulation frequency to stay in ratio
</span>  <span class="kt">int</span> <span class="n">mod_freq</span> <span class="o">=</span> <span class="n">carrier_freq</span> <span class="o">*</span> <span class="n">mod_ratio</span><span class="p">;</span>
  
  <span class="c1">// set the FM oscillator frequencies to the calculated values
</span>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span> 
  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>
  
  <span class="c1">// read the light dependent resistor on the Analog input pin
</span>  <span class="kt">int</span> <span class="n">light_level</span><span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">LDR_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023
</span>  
  <span class="c1">// print the value to the Serial monitor for debugging
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"light_level = "</span><span class="p">);</span> 
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">light_level</span><span class="p">);</span> 
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">);</span> <span class="c1">// prints a tab
</span>  
  <span class="n">fm_intensity</span> <span class="o">=</span> <span class="n">kMapIntensity</span><span class="p">(</span><span class="n">light_level</span><span class="p">);</span>
  
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"fm_intensity = "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">fm_intensity</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// print a carraige return for the next line of debugging info
</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">long</span> <span class="n">modulation</span> <span class="o">=</span> <span class="n">fm_intensity</span> <span class="o">*</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> 
  <span class="k">return</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">(</span><span class="n">modulation</span><span class="p">);</span> <span class="c1">// phMod does the FM
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Knob_LightLevel_x2_FMsynth</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LightLevel_x2_FMsynth/Knob_LightLevel_x2_FMsynth.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LightLevel_x2_FMsynth/Knob_LightLevel_x2_FMsynth.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Knob_LightLevel_x2_FMsynthexpand" onclick="javascript:toggleDisplay(Knob_LightLevel_x2_FMsynth, Knob_LightLevel_x2_FMsynthexpand, Knob_LightLevel_x2_FMsynthcollapse)">show sketch</button>
<button id="Knob_LightLevel_x2_FMsynthcollapse" style="display:none" onclick="javascript:toggleDisplay(Knob_LightLevel_x2_FMsynth, Knob_LightLevel_x2_FMsynthexpand, Knob_LightLevel_x2_FMsynthcollapse)">hide sketch</button></p>
<div id="Knob_LightLevel_x2_FMsynth" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/* 
  Example using 2 light dependent resistors (LDRs) to change 
  FM synthesis parameters, and a knob for fundamental frequency,
  using Mozzi sonification library.

  Demonstrates analog input, audio and control oscillators, phase modulation
  and smoothing a control signal at audio rate to avoid clicks.
  Also demonstrates AutoMap, which maps unpredictable inputs to a set range.
  
  This example goes with a tutorial on the Mozzi site:
  https://sensorium.github.io/Mozzi/learn/introductory-tutorial/
  
  The circuit:
     Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
     check the README or https://sensorium.github.com/Mozzi/

     Potentiometer connected to analog pin 0.
       Center pin of the potentiometer goes to the analog pin.
       Side pins of the potentiometer go to +5V and ground
  
     Light dependent resistor (LDR) and 5.1k resistor on analog pin 1:
       LDR from analog pin to +5V (3.3V on Teensy 3.1)
       5.1k resistor from analog pin to ground
     
     Light dependent resistor (LDR) and 5.1k resistor on analog pin 2:
       LDR from analog pin to +5V (3.3V on Teensy 3.1)
       5.1k resistor from analog pin to ground
  
  Mozzi help/discussion/announcements:
  https://groups.google.com/forum/#!forum/mozzi-users

  Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator 
#include &lt;tables/cos2048_int8.h&gt; // table for Oscils to play
#include &lt;Smooth.h&gt;
#include &lt;AutoMap.h&gt; // maps unpredictable inputs to a range
</span> 
<span class="c1">// desired carrier frequency max and min, for AutoMap
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_CARRIER_FREQ</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_CARRIER_FREQ</span> <span class="o">=</span> <span class="mi">440</span><span class="p">;</span>

<span class="c1">// desired intensity max and min, for AutoMap, note they're inverted for reverse dynamics
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_INTENSITY</span> <span class="o">=</span> <span class="mi">700</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_INTENSITY</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="c1">// desired mod speed max and min, for AutoMap, note they're inverted for reverse dynamics
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_MOD_SPEED</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_MOD_SPEED</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="n">AutoMap</span> <span class="n">kMapCarrierFreq</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_CARRIER_FREQ</span><span class="p">,</span><span class="n">MAX_CARRIER_FREQ</span><span class="p">);</span>
<span class="n">AutoMap</span> <span class="n">kMapIntensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_INTENSITY</span><span class="p">,</span><span class="n">MAX_INTENSITY</span><span class="p">);</span>
<span class="n">AutoMap</span> <span class="n">kMapModSpeed</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_MOD_SPEED</span><span class="p">,</span><span class="n">MAX_MOD_SPEED</span><span class="p">);</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">KNOB_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// set the input for the knob to analog pin 0
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">LDR1_PIN</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// set the analog input for fm_intensity to pin 1
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">LDR2_PIN</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span> <span class="c1">// set the analog input for mod rate to pin 2
</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kIntensityMod</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mod_ratio</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// brightness (harmonics)
</span><span class="kt">long</span> <span class="n">fm_intensity</span><span class="p">;</span> <span class="c1">// carries control info from updateControl to updateAudio
</span>
<span class="c1">// smoothing for intensity to remove clicks on transitions
</span><span class="kt">float</span> <span class="n">smoothness</span> <span class="o">=</span> <span class="mf">0.95</span><span class="n">f</span><span class="p">;</span>
<span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">aSmoothIntensity</span><span class="p">(</span><span class="n">smoothness</span><span class="p">);</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values // set up the Serial output so we can look at the light level
</span>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// read the knob
</span>  <span class="kt">int</span> <span class="n">knob_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023
</span>  
  <span class="c1">// map the knob to carrier frequency
</span>  <span class="kt">int</span> <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">kMapCarrierFreq</span><span class="p">(</span><span class="n">knob_value</span><span class="p">);</span>
  
  <span class="c1">//calculate the modulation frequency to stay in ratio
</span>  <span class="kt">int</span> <span class="n">mod_freq</span> <span class="o">=</span> <span class="n">carrier_freq</span> <span class="o">*</span> <span class="n">mod_ratio</span><span class="p">;</span>
  
  <span class="c1">// set the FM oscillator frequencies
</span>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span> 
  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>
  
  <span class="c1">// read the light dependent resistor on the width Analog input pin
</span>  <span class="kt">int</span> <span class="n">LDR1_value</span><span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">LDR1_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023
</span>  <span class="c1">// print the value to the Serial monitor for debugging
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"LDR1 = "</span><span class="p">);</span> 
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">LDR1_value</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">);</span> <span class="c1">// prints a tab
</span>
  <span class="kt">int</span> <span class="n">LDR1_calibrated</span> <span class="o">=</span> <span class="n">kMapIntensity</span><span class="p">(</span><span class="n">LDR1_value</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"LDR1_calibrated = "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">LDR1_calibrated</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">);</span> <span class="c1">// prints a tab
</span>  
 <span class="c1">// calculate the fm_intensity
</span>  <span class="n">fm_intensity</span> <span class="o">=</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">LDR1_calibrated</span> <span class="o">*</span> <span class="p">(</span><span class="n">kIntensityMod</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span><span class="mi">128</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// shift back to range after 8 bit multiply
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"fm_intensity = "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">fm_intensity</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">);</span> <span class="c1">// prints a tab
</span>  
  <span class="c1">// read the light dependent resistor on the speed Analog input pin
</span>  <span class="kt">int</span> <span class="n">LDR2_value</span><span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">LDR2_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"LDR2 = "</span><span class="p">);</span> 
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">LDR2_value</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">);</span> <span class="c1">// prints a tab
</span>  
  <span class="c1">// use a float here for low frequencies
</span>  <span class="kt">float</span> <span class="n">mod_speed</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">kMapModSpeed</span><span class="p">(</span><span class="n">LDR2_value</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">;</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"   mod_speed = "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">mod_speed</span><span class="p">);</span>
  <span class="n">kIntensityMod</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mod_speed</span><span class="p">);</span>
  
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// finally, print a carraige return for the next line of debugging info
</span><span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">long</span> <span class="n">modulation</span> <span class="o">=</span> <span class="n">aSmoothIntensity</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">fm_intensity</span><span class="p">)</span> <span class="o">*</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">(</span><span class="n">modulation</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Light_Temperature_Detuned</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Light_Temperature_Detuned/Light_Temperature_Detuned.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Light_Temperature_Detuned/Light_Temperature_Detuned.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Light_Temperature_Detunedexpand" onclick="javascript:toggleDisplay(Light_Temperature_Detuned, Light_Temperature_Detunedexpand, Light_Temperature_Detunedcollapse)">show sketch</button>
<button id="Light_Temperature_Detunedcollapse" style="display:none" onclick="javascript:toggleDisplay(Light_Temperature_Detuned, Light_Temperature_Detunedexpand, Light_Temperature_Detunedcollapse)">hide sketch</button></p>
<div id="Light_Temperature_Detuned" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  
  Plays a fluctuating ambient wash in response to light and temperature sensors.

  Pairs of audio oscillators are detuned in response to light on an LDR and
  the base frequencies are offset depending on the temperature.
  
  It's a pretty dumb sonification, but at this stage 
  it's just to demonstrate the possibility of reading sensors while
  lots of audio oscillators are running.
  
  Circuit:
    Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
    
    Temperature dependent resistor (Thermistor) and 5.1k resistor on analog pin 1:
      Thermistor from analog pin to +5V (3.3V on Teensy 3.1)
      5.1k resistor from analog pin to ground
    
    Light dependent resistor (LDR) and 5.1k resistor on analog pin 2:
      LDR from analog pin to +5V (3.3V on Teensy 3.1)
      5.1k resistor from analog pin to ground
      
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/cos8192_int8.h&gt;
#include &lt;mozzi_rand.h&gt;
#include &lt;mozzi_midi.h&gt;
</span>
<span class="cp">#define THERMISTOR_PIN 1
#define LDR_PIN 2
</span>
<span class="c1">// harmonics
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos3</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos4</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos5</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos6</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos0</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>

<span class="c1">// duplicates but slightly off frequency for adding to originals
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos1b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos2b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos3b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos4b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos5b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos6b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos0b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>

<span class="c1">// base pitch frequencies
</span><span class="kt">float</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">f3</span><span class="p">,</span><span class="n">f4</span><span class="p">,</span><span class="n">f5</span><span class="p">,</span><span class="n">f6</span><span class="p">;</span>

<span class="c1">// to map light input to frequency divergence of the b oscillators
</span><span class="k">const</span> <span class="kt">float</span> <span class="n">DIVERGENCE_SCALE</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span> <span class="c1">// 0.01*1023 = 10.23 Hz max divergence
</span>
<span class="c1">// to map temperature to base freq drift
</span><span class="k">const</span> <span class="kt">float</span> <span class="n">OFFSET_SCALE</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="c1">// 0.1*1023 = 102.3 Hz max drift
</span>
<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">();</span>
  
  <span class="c1">// select base frequencies using mtof
</span>  <span class="c1">// C F♯ B♭ E A D the "Promethean chord"
</span>  <span class="n">f0</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">36.</span><span class="n">f</span><span class="p">);</span> <span class="c1">// a spare C !
</span>  <span class="n">f1</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">48.</span><span class="n">f</span><span class="p">);</span>
  <span class="n">f2</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">54.</span><span class="n">f</span><span class="p">);</span>
  <span class="n">f3</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">58.</span><span class="n">f</span><span class="p">);</span>
  <span class="n">f4</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">64.</span><span class="n">f</span><span class="p">);</span>
  <span class="n">f5</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">69.</span><span class="n">f</span><span class="p">);</span>
  <span class="n">f6</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">74.</span><span class="n">f</span><span class="p">);</span>


  <span class="c1">// set Oscils with chosen frequencies
</span>  <span class="n">aCos0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f0</span><span class="p">);</span>
  <span class="n">aCos1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f1</span><span class="p">);</span>
  <span class="n">aCos2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f2</span><span class="p">);</span>
  <span class="n">aCos3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f3</span><span class="p">);</span>
  <span class="n">aCos4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f4</span><span class="p">);</span>
  <span class="n">aCos5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f5</span><span class="p">);</span>
  <span class="n">aCos6</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f6</span><span class="p">);</span>

  <span class="c1">// set frequencies of duplicate oscillators
</span>  <span class="n">aCos6b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f6</span><span class="p">);</span>
  <span class="n">aCos0b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f0</span><span class="p">);</span>
  <span class="n">aCos1b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f1</span><span class="p">);</span>
  <span class="n">aCos2b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f2</span><span class="p">);</span>
  <span class="n">aCos3b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f3</span><span class="p">);</span>
  <span class="n">aCos4b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f4</span><span class="p">);</span>
  <span class="n">aCos5b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f5</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// read analog inputs
</span>  <span class="kt">int</span> <span class="n">temperature</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">THERMISTOR_PIN</span><span class="p">);</span> <span class="c1">// not calibrated to degrees!
</span>  <span class="kt">int</span> <span class="n">light_input</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">LDR_PIN</span><span class="p">);</span>

  <span class="kt">float</span> <span class="n">base_freq_offset</span> <span class="o">=</span> <span class="n">OFFSET_SCALE</span><span class="o">*</span><span class="n">temperature</span><span class="p">;</span>
  <span class="kt">float</span> <span class="n">divergence</span> <span class="o">=</span> <span class="n">DIVERGENCE_SCALE</span><span class="o">*</span><span class="n">light_input</span><span class="p">;</span>
  
  <span class="kt">float</span> <span class="n">freq</span><span class="p">;</span>
  
  <span class="c1">// change frequencies of the oscillators, randomly choosing one pair each time to change
</span>  <span class="k">switch</span> <span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">7</span><span class="p">)){</span> 

    <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">freq</span> <span class="o">=</span> <span class="n">f0</span><span class="o">+</span><span class="n">base_freq_offset</span><span class="p">;</span>
      <span class="n">aCos0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
      <span class="n">aCos0b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="n">divergence</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">freq</span> <span class="o">=</span> <span class="n">f1</span><span class="o">+</span><span class="n">base_freq_offset</span><span class="p">;</span>
      <span class="n">aCos1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
      <span class="n">aCos1b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="n">divergence</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">freq</span> <span class="o">=</span> <span class="n">f2</span><span class="o">+</span><span class="n">base_freq_offset</span><span class="p">;</span>
      <span class="n">aCos2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
      <span class="n">aCos2b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="n">divergence</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
      <span class="n">freq</span> <span class="o">=</span> <span class="n">f3</span><span class="o">+</span><span class="n">base_freq_offset</span><span class="p">;</span>
      <span class="n">aCos3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
      <span class="n">aCos3b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="n">divergence</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">4</span><span class="p">:</span>
      <span class="n">freq</span> <span class="o">=</span> <span class="n">f4</span><span class="o">+</span><span class="n">base_freq_offset</span><span class="p">;</span>
      <span class="n">aCos4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
      <span class="n">aCos4b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="n">divergence</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">5</span><span class="p">:</span>
      <span class="n">freq</span> <span class="o">=</span> <span class="n">f5</span><span class="o">+</span><span class="n">base_freq_offset</span><span class="p">;</span>
      <span class="n">aCos5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
      <span class="n">aCos5b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="n">divergence</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">6</span><span class="p">:</span>
      <span class="n">freq</span> <span class="o">=</span> <span class="n">f6</span><span class="o">+</span><span class="n">base_freq_offset</span><span class="p">;</span>
      <span class="n">aCos6</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
      <span class="n">aCos6b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="n">divergence</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>

  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span>
    <span class="n">aCos0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos0b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">aCos1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos1b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">aCos2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos2b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">aCos3</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos3b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">aCos4</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos4b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">aCos5</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos5b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">aCos6</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos6b</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>

  <span class="k">return</span> <span class="n">asig</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Light_Temperature_Multi_Oscil</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Light_Temperature_Multi_Oscil/Light_Temperature_Multi_Oscil.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Light_Temperature_Multi_Oscil/Light_Temperature_Multi_Oscil.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Light_Temperature_Multi_Oscilexpand" onclick="javascript:toggleDisplay(Light_Temperature_Multi_Oscil, Light_Temperature_Multi_Oscilexpand, Light_Temperature_Multi_Oscilcollapse)">show sketch</button>
<button id="Light_Temperature_Multi_Oscilcollapse" style="display:none" onclick="javascript:toggleDisplay(Light_Temperature_Multi_Oscil, Light_Temperature_Multi_Oscilexpand, Light_Temperature_Multi_Oscilcollapse)">hide sketch</button></p>
<div id="Light_Temperature_Multi_Oscil" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  
  Plays a fluctuating ambient wash in response to light and temperature sensors,
  using Mozzi sonification library.
  
  8 control rate oscillators are used to set the volume of 8 audio oscillators.
  Temperature readings from a thermistor are used to set the notes
  being played, and light readings from a light dependent resistor are
  mapped to the pulse rates of the volume control oscillators.
  
  Circuit:
    Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
    
    Temperature dependent resistor (Thermistor) and 5.1k resistor on analog pin 1:
      Thermistor from analog pin to +5V (3.3V on Teensy 3.1)
      5.1k resistor from analog pin to ground
    
    Light dependent resistor (LDR) and 5.1k resistor on analog pin 2:
      LDR from analog pin to +5V (3.3V on Teensy 3.1)
      5.1k resistor from analog pin to ground
  
  Mozzi help/discussion/announcements:
  https://groups.google.com/forum/#!forum/mozzi-users
  
  Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/cos8192_int8.h&gt;
#include &lt;mozzi_midi.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 256
</span>
<span class="cp">#define THERMISTOR_PIN 1
#define LDR_PIN 2
#define NUM_VOICES 8
#define THRESHOLD 10
</span>
<span class="c1">// harmonics
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos3</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos4</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos5</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos6</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos7</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos0</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>

<span class="c1">// volume controls
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol3</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol4</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol5</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol6</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol7</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol0</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>

<span class="c1">// audio volumes updated each control interrupt and reused in audio till next control
</span><span class="kt">char</span> <span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="n">v5</span><span class="p">,</span><span class="n">v6</span><span class="p">,</span><span class="n">v7</span><span class="p">,</span><span class="n">v0</span><span class="p">;</span>

<span class="c1">// notes to play depending on whether temperature reading increases or decreases
</span><span class="kt">float</span> <span class="n">upnotes</span><span class="p">[</span><span class="n">NUM_VOICES</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">mtof</span><span class="p">(</span><span class="mf">62.</span><span class="n">f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">64.</span><span class="n">f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">70.</span><span class="n">f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">72.</span><span class="n">f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">79.</span><span class="n">f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">81.</span><span class="n">f</span><span class="p">),</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">86.</span><span class="n">f</span><span class="p">),</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">88.</span><span class="n">f</span><span class="p">)};</span>

<span class="kt">float</span> <span class="n">downnotes</span><span class="p">[</span><span class="n">NUM_VOICES</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">mtof</span><span class="p">(</span><span class="mf">64.</span><span class="n">f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">65.</span><span class="n">f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">88.</span><span class="n">f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">72.</span><span class="n">f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">79.</span><span class="n">f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">84.</span><span class="n">f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">86.</span><span class="n">f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">89.</span><span class="n">f</span><span class="p">)};</span>
  

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>


<span class="c1">// returns freq
</span><span class="kt">int</span> <span class="n">temperatureToFreq</span><span class="p">(</span><span class="kt">char</span> <span class="n">oscil_num</span><span class="p">,</span> <span class="kt">int</span> <span class="n">temperature</span><span class="p">){</span>
  <span class="k">static</span> <span class="kt">int</span> <span class="n">previous_temperature</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">freq</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span><span class="o">&gt;</span><span class="n">previous_temperature</span><span class="p">){</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="n">upnotes</span><span class="p">[</span><span class="n">oscil_num</span><span class="p">];</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
     <span class="n">freq</span> <span class="o">=</span> <span class="n">downnotes</span><span class="p">[</span><span class="n">oscil_num</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="n">previous_temperature</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">freq</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">static</span> <span class="kt">float</span> <span class="n">previous_pulse_freq</span><span class="p">;</span>
    
  <span class="c1">// read analog inputs
</span>  <span class="kt">int</span> <span class="n">temperature</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">THERMISTOR_PIN</span><span class="p">);</span> <span class="c1">// not calibrated to degrees!
</span>  <span class="kt">int</span> <span class="n">light</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">LDR_PIN</span><span class="p">);</span>

  <span class="c1">// map light reading to volume pulse frequency
</span>  <span class="kt">float</span> <span class="n">pulse_freq</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">light</span><span class="o">/</span><span class="mi">256</span><span class="p">;</span>
  <span class="n">previous_pulse_freq</span> <span class="o">=</span> <span class="n">pulse_freq</span><span class="p">;</span>

  <span class="n">v0</span> <span class="o">=</span> <span class="n">kVol0</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  <span class="n">v1</span> <span class="o">=</span> <span class="n">kVol1</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  <span class="n">v2</span> <span class="o">=</span> <span class="n">kVol2</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  <span class="n">v3</span> <span class="o">=</span> <span class="n">kVol3</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  <span class="n">v4</span> <span class="o">=</span> <span class="n">kVol4</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  <span class="n">v5</span> <span class="o">=</span> <span class="n">kVol5</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  <span class="n">v6</span> <span class="o">=</span> <span class="n">kVol6</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  <span class="n">v7</span> <span class="o">=</span> <span class="n">kVol7</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  
  <span class="c1">// set one note oscillator frequency each time (if it's volume is close to 0)
</span>  <span class="k">static</span> <span class="kt">char</span> <span class="n">whoseTurn</span><span class="p">;</span>
  <span class="k">switch</span><span class="p">(</span><span class="n">whoseTurn</span><span class="p">){</span>  
  <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">kVol0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pulse_freq</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span><span class="o">&lt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">aCos0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">temperatureToFreq</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">temperature</span><span class="p">));</span>
    <span class="k">break</span><span class="p">;</span>

  <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">kVol1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pulse_freq</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span><span class="o">&lt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">aCos1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">temperatureToFreq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">temperature</span><span class="p">));</span>
    <span class="k">break</span><span class="p">;</span>

  <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">kVol2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pulse_freq</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span><span class="o">&lt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">aCos2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">temperatureToFreq</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">temperature</span><span class="p">));</span>
    <span class="k">break</span><span class="p">;</span>

  <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">kVol3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pulse_freq</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span><span class="o">&lt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">aCos3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">temperatureToFreq</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">temperature</span><span class="p">));</span>
    <span class="k">break</span><span class="p">;</span>

  <span class="k">case</span> <span class="mi">4</span><span class="p">:</span>
    <span class="n">kVol4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pulse_freq</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span><span class="o">&lt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">aCos4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">temperatureToFreq</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">temperature</span><span class="p">));</span>
    <span class="k">break</span><span class="p">;</span>

  <span class="k">case</span> <span class="mi">5</span><span class="p">:</span>
    <span class="n">kVol5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pulse_freq</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v5</span><span class="p">)</span><span class="o">&lt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">aCos5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">temperatureToFreq</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="n">temperature</span><span class="p">));</span>
    <span class="k">break</span><span class="p">;</span>

  <span class="k">case</span> <span class="mi">6</span><span class="p">:</span>
    <span class="n">kVol6</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pulse_freq</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v6</span><span class="p">)</span><span class="o">&lt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">aCos6</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">temperatureToFreq</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="n">temperature</span><span class="p">));</span>
    <span class="k">break</span><span class="p">;</span>

  <span class="k">case</span> <span class="mi">7</span><span class="p">:</span>
    <span class="n">kVol7</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pulse_freq</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v7</span><span class="p">)</span><span class="o">&lt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">aCos7</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">temperatureToFreq</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="n">temperature</span><span class="p">));</span>
    <span class="k">break</span><span class="p">;</span>

  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="o">++</span><span class="n">whoseTurn</span><span class="o">&gt;=</span><span class="n">NUM_VOICES</span><span class="p">)</span> <span class="n">whoseTurn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>



<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">long</span> <span class="n">asig</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span>
    <span class="n">aCos0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v0</span> <span class="o">+</span>
      <span class="n">aCos1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v1</span> <span class="o">+</span>
      <span class="n">aCos2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v2</span> <span class="o">+</span>
      <span class="n">aCos3</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v3</span> <span class="o">+</span>
      <span class="n">aCos4</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v4</span> <span class="o">+</span>
      <span class="n">aCos5</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v5</span> <span class="o">+</span>
      <span class="n">aCos6</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v6</span> <span class="o">+</span>
      <span class="n">aCos7</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v7</span><span class="p">;</span>
  <span class="n">asig</span> <span class="o">&gt;&gt;=</span> <span class="mi">9</span><span class="p">;</span> <span class="c1">// shift back to audio output range
</span>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">asig</span><span class="p">;</span>
<span class="p">}</span>



<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Piezo_Frequency</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_Frequency/Piezo_Frequency.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_Frequency/Piezo_Frequency.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Piezo_Frequencyexpand" onclick="javascript:toggleDisplay(Piezo_Frequency, Piezo_Frequencyexpand, Piezo_Frequencycollapse)">show sketch</button>
<button id="Piezo_Frequencycollapse" style="display:none" onclick="javascript:toggleDisplay(Piezo_Frequency, Piezo_Frequencyexpand, Piezo_Frequencycollapse)">hide sketch</button></p>
<div id="Piezo_Frequency" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*
   Example using a piezo to change the frequency of a sinewave
   with Mozzi sonification library.
   
   Demonstrates the use of Oscil to play a wavetable, and analog input for control.
   
   This example goes with a tutorial on the Mozzi site:
   https://sensorium.github.io/Mozzi/learn/introductory-tutorial/
   
   The circuit:
     Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
     check the README or https://sensorium.github.com/Mozzi/
   
     Piezo on analog pin 3:
       + connection of the piezo attached to the analog pin
       - connection of the piezo attached to ground
       1-megohm resistor between the analog pin and ground
   
   Mozzi help/discussion/announcements:
   https://groups.google.com/forum/#!forum/mozzi-users
   
   Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator 
#include &lt;tables/sin2048_int8.h&gt; // table for Oscils to play
#include &lt;Smooth.h&gt;
</span>
<span class="c1">// increase the rate of updateControl from the default of 64, to catch the piezo's rapid transients
</span><span class="cp">#define CONTROL_RATE 128 
</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">PIEZO_PIN</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">// set the analog input pin for the piezo 
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values // set up the Serial output so we can look at the piezo values
</span>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// :)) use the control rate defined above
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// read the piezo
</span>  <span class="kt">int</span> <span class="n">piezo_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">PIEZO_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023
</span>
  <span class="c1">// print the value to the Serial monitor for debugging
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"piezo_value = "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">piezo_value</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s"> </span><span class="se">\t</span><span class="s">"</span><span class="p">);</span> <span class="c1">// prints 2 tabs
</span>  
  <span class="kt">int</span> <span class="n">frequency</span> <span class="o">=</span> <span class="n">piezo_value</span><span class="o">*</span><span class="mi">3</span><span class="p">;</span> <span class="c1">// calibrate
</span>  
  <span class="c1">// print the frequency to the Serial monitor for debugging
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"frequency = "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">frequency</span><span class="p">);</span>
  
  <span class="c1">// set the frequency
</span>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">frequency</span><span class="p">);</span>
  
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// next line
</span><span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Piezo_SampleScrubber</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_SampleScrubber/Piezo_SampleScrubber.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_SampleScrubber/Piezo_SampleScrubber.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Piezo_SampleScrubberexpand" onclick="javascript:toggleDisplay(Piezo_SampleScrubber, Piezo_SampleScrubberexpand, Piezo_SampleScrubbercollapse)">show sketch</button>
<button id="Piezo_SampleScrubbercollapse" style="display:none" onclick="javascript:toggleDisplay(Piezo_SampleScrubber, Piezo_SampleScrubberexpand, Piezo_SampleScrubbercollapse)">hide sketch</button></p>
<div id="Piezo_SampleScrubber" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*
  Example of simple "scrubbing" through a sampled sound with a knob
  using Mozzi sonification library.
 
  Demonstrates getting audio samples from a table using a Line to
  slide between different indexes.
  Also demonstrates mozziAnalogRead(pin), a non-blocking replacement for mozziAnalogRead
 
  This example goes with a tutorial on the Mozzi site:
  https://sensorium.github.io/Mozzi/learn/introductory-tutorial/
  
  The circuit:
    Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
 
  Piezo on analog pin A3:
    + connection of the piezo attached to the analog pin
    - connection of the piezo attached to ground
    1-megOhm resistor attached from the analog pin to ground
 
  Mozzi help/discussion/announcements:
  https://groups.google.com/forum/#!forum/mozzi-users
 
  Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Sample.h&gt; // Sample template
#include "blahblah4b_int8.h"
#include &lt;Line.h&gt;
#include &lt;Smooth.h&gt;
</span>

<span class="c1">// use this smooth out the wandering/jumping rate of scrubbing, gives more convincing reverses
</span><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothOffset</span><span class="p">(</span><span class="mf">0.85</span><span class="n">f</span><span class="p">);</span>


<span class="c1">// use: Sample &lt;table_size, update_rate, interpolation &gt; SampleName (wavetable)
</span><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BLAHBLAH4B_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="p">,</span> <span class="n">INTERP_LINEAR</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">BLAHBLAH4B_DATA</span><span class="p">);</span>

<span class="c1">//Line to scrub through sample at audio rate, Line target is set at control rate
</span><span class="n">Line</span> <span class="o">&lt;</span><span class="n">Q16n16</span><span class="o">&gt;</span> <span class="n">scrub</span><span class="p">;</span> <span class="c1">// Q16n16 fixed point for high precision
</span>
<span class="c1">// the number of audio steps the line has to take to reach the next offset
</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">AUDIO_STEPS_PER_CONTROL</span> <span class="o">=</span> <span class="n">AUDIO_RATE</span> <span class="o">/</span> <span class="n">CONTROL_RATE</span><span class="p">;</span>


<span class="cp">#define INPUT_PIN 3 
</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">aSample</span><span class="p">.</span><span class="n">setLoopingOn</span><span class="p">();</span>
  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>

  <span class="c1">// read the pot
</span>  <span class="kt">int</span> <span class="n">sensor_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">INPUT_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023
</span>
  <span class="c1">// map it to an 8 bit range for efficient calculations in updateAudio
</span>  <span class="kt">int</span> <span class="n">target</span> <span class="o">=</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span> <span class="n">sensor_value</span> <span class="o">*</span> <span class="n">BLAHBLAH4B_NUM_CELLS</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// &gt;&gt; 10 is / 1024
</span>  <span class="kt">int</span> <span class="n">smooth_offset</span> <span class="o">=</span> <span class="n">kSmoothOffset</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target</span><span class="p">);</span>

  <span class="c1">// set new target for interpolating line to scrub to
</span>  <span class="n">scrub</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="n">smooth_offset</span><span class="p">),</span> <span class="n">AUDIO_STEPS_PER_CONTROL</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">aSample</span><span class="p">.</span><span class="n">atIndex</span><span class="p">(</span><span class="n">Q16n16_to_Q16n0</span><span class="p">(</span><span class="n">scrub</span><span class="p">.</span><span class="n">next</span><span class="p">()));</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Piezo_SampleTrigger</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_SampleTrigger/Piezo_SampleTrigger.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_SampleTrigger/Piezo_SampleTrigger.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Piezo_SampleTriggerexpand" onclick="javascript:toggleDisplay(Piezo_SampleTrigger, Piezo_SampleTriggerexpand, Piezo_SampleTriggercollapse)">show sketch</button>
<button id="Piezo_SampleTriggercollapse" style="display:none" onclick="javascript:toggleDisplay(Piezo_SampleTrigger, Piezo_SampleTriggerexpand, Piezo_SampleTriggercollapse)">hide sketch</button></p>
<div id="Piezo_SampleTrigger" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*
   Example using a piezo to trigger an audio sample to play,
   and a knob to set the playback pitch,
   with Mozzi sonification library.
 
   Demonstrates one-shot samples and analog input for control.
   
   This example goes with a tutorial on the Mozzi site:
   https://sensorium.github.io/Mozzi/learn/introductory-tutorial/
  
   The circuit:
     Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
     check the README or https://sensorium.github.com/Mozzi/

     Potentiometer connected to analog pin 0.
       Center pin of the potentiometer goes to the analog pin.
       Side pins of the potentiometer go to +5V and ground
 
     Piezo on analog pin 3:
       + connection of the piezo attached to the analog pin
       - connection of the piezo attached to ground
       1-megohm resistor between the analog pin and ground
 
   Mozzi help/discussion/announcements:
   https://groups.google.com/forum/#!forum/mozzi-users
 
   Tim Barrass 2013.
   CC by-nc-sa
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Sample.h&gt; // Sample template
#include &lt;samples/burroughs1_18649_int8.h&gt; // a converted audio sample included in the Mozzi download
</span>
<span class="k">const</span> <span class="kt">char</span> <span class="n">KNOB_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// set the analog input pin for the knob
</span><span class="k">const</span> <span class="kt">char</span> <span class="n">PIEZO_PIN</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">// set the analog input pin for the piezo 
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>  <span class="c1">// threshold value to decide when the detected signal is a knock or not
</span>
<span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)
</span><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">BURROUGHS1_18649_DATA</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">recorded_pitch</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">;</span>

<span class="n">boolean</span> <span class="n">triggered</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values // set up the Serial output so we can look at the piezo values
</span>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// read the knob
</span>  <span class="kt">int</span> <span class="n">knob_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023
</span>  
  <span class="c1">// map it to values between 0.1 and about double the recorded pitch
</span>  <span class="kt">float</span> <span class="n">pitch</span> <span class="o">=</span> <span class="p">(</span><span class="n">recorded_pitch</span> <span class="o">*</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">knob_value</span> <span class="o">/</span> <span class="mf">512.</span><span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="n">f</span><span class="p">;</span> 
  
  <span class="c1">// set the sample playback frequency
</span>  <span class="n">aSample</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pitch</span><span class="p">);</span>
  
  <span class="c1">// read the piezo
</span>  <span class="kt">int</span> <span class="n">piezo_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">PIEZO_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023
</span>
  <span class="c1">// print the value to the Serial monitor for debugging
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"piezo value = "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">piezo_value</span><span class="p">);</span>

<span class="c1">// only trigger once each time the piezo goes over the threshold
</span>  <span class="k">if</span> <span class="p">(</span><span class="n">piezo_value</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">triggered</span><span class="p">){</span>
      <span class="n">aSample</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
      <span class="n">triggered</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="n">triggered</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
 
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// next line
</span><span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">aSample</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Piezo_Switch_Pitch</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_Switch_Pitch/Piezo_Switch_Pitch.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_Switch_Pitch/Piezo_Switch_Pitch.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Piezo_Switch_Pitchexpand" onclick="javascript:toggleDisplay(Piezo_Switch_Pitch, Piezo_Switch_Pitchexpand, Piezo_Switch_Pitchcollapse)">show sketch</button>
<button id="Piezo_Switch_Pitchcollapse" style="display:none" onclick="javascript:toggleDisplay(Piezo_Switch_Pitch, Piezo_Switch_Pitchexpand, Piezo_Switch_Pitchcollapse)">hide sketch</button></p>
<div id="Piezo_Switch_Pitch" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*
  Example using a piezo to trigger an audio sample 
  and a switch to change the playback pitch.
  using Mozzi sonification library.
  
  Demonstrates one-shot samples, analog input for triggering,
  and digital input for switching.
  
  This example goes with a tutorial on the Mozzi site:
  https://sensorium.github.io/Mozzi/learn/introductory-tutorial/
  
  The circuit:
    Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Piezo on analog pin A3:
      + connection of the piezo attached to the analog pin
      - connection of the piezo attached to ground
      1-megOhm resistor attached from the analog pin to ground
    
    Pushbutton on digital pin D4
      button between the digital pin and +5V
      10K resistor from the digital pin to ground
  
  Mozzi help/discussion/announcements:
  https://groups.google.com/forum/#!forum/mozzi-users
  
  Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Sample.h&gt; // Sample template
#include &lt;samples/burroughs1_18649_int8.h&gt; // a converted audio sample included in the Mozzi download
</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">PIEZO_PIN</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">// set the analog input pin for the piezo 
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>  <span class="c1">// threshold value to decide when the detected signal is a knock or not
</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">BUTTON_PIN</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="c1">// set the digital input pin for the button
</span>
<span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)
</span><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">BURROUGHS1_18649_DATA</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">recorded_pitch</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">;</span>

<span class="kt">char</span> <span class="n">button_state</span><span class="p">,</span> <span class="n">previous_button_state</span><span class="p">;</span> <span class="c1">// variable for reading the pushbutton status       
</span><span class="kt">char</span> <span class="n">latest_button_change</span><span class="p">;</span>
<span class="n">boolean</span> <span class="n">triggered</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">pitch_change</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values // set up the Serial output so we can look at the piezo values
</span>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">buttonChangePitch</span><span class="p">(){</span>
  <span class="c1">// read the state of the pushbutton value:
</span>  <span class="n">button_state</span> <span class="o">=</span> <span class="n">digitalRead</span><span class="p">(</span><span class="n">BUTTON_PIN</span><span class="p">);</span>

  <span class="c1">// has the button state changed?
</span>  <span class="k">if</span><span class="p">(</span><span class="n">button_state</span> <span class="o">!=</span> <span class="n">previous_button_state</span><span class="p">){</span>

    <span class="c1">// if the latest change was a press, pitch up, else pitch down
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">button_state</span> <span class="o">==</span> <span class="n">HIGH</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">pitch</span> <span class="o">=</span> <span class="mf">2.</span><span class="n">f</span> <span class="o">*</span> <span class="n">recorded_pitch</span><span class="p">;</span>
    <span class="p">}</span> 
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">pitch</span> <span class="o">=</span> <span class="mf">0.5</span><span class="n">f</span> <span class="o">*</span> <span class="n">recorded_pitch</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">previous_button_state</span> <span class="o">=</span> <span class="n">button_state</span><span class="p">;</span>
<span class="p">}</span>



<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// read the piezo
</span>  <span class="kt">int</span> <span class="n">piezo_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">PIEZO_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023
</span>
  <span class="c1">// print the value to the Serial monitor for debugging
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"piezo value = "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">piezo_value</span><span class="p">);</span>

  <span class="c1">// only trigger once each time the piezo goes over the threshold
</span>  <span class="k">if</span> <span class="p">(</span><span class="n">piezo_value</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">triggered</span><span class="p">){</span>
      <span class="n">pitch</span> <span class="o">=</span> <span class="n">recorded_pitch</span><span class="p">;</span>
      <span class="n">aSample</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
      <span class="n">triggered</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="n">triggered</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">buttonChangePitch</span><span class="p">();</span>
  <span class="n">aSample</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pitch</span><span class="p">);</span>

  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// next line
</span><span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">aSample</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>RCpoll</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/RCpoll/RCpoll.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/RCpoll/RCpoll.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="RCpollexpand" onclick="javascript:toggleDisplay(RCpoll, RCpollexpand, RCpollcollapse)">show sketch</button>
<button id="RCpollcollapse" style="display:none" onclick="javascript:toggleDisplay(RCpoll, RCpollexpand, RCpollcollapse)">hide sketch</button></p>
<div id="RCpoll" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Sets the frequency of an oscillator with a resistive sensor on a digital pin,
 *  using Mozzi sonification library.
 *
 *  Demonstrates RCpoll to read a resistive sensor on a digital pin,
 *  without blocking audio output. 
 *  
 *  Control circuit: https://arduino.cc/en/Tutorial/RCtime
 *  Values for components which work with this sketch are:
 *  Sensing Capacitor .1uf (104)
 *  Variable resistor 1 MegaOhm
 *  Input resistor 470 Ohms
 *
                           +5V
                            |
                            |
                           ___
                           ___    Sensing Cap
                            |      .1 uf
                            |
sPin ---\/\/\/-----.
       220 - 1K       |
                            |
                            \   
                            /     Variable Resistive Sensor
                            \     Photocell, phototransistor, FSR etc.
                            /
                            |
                            |
                          _____ 
                           ___
                            _

 *  Mozzi help/discussion/announcements:
 *  https://groups.google.com/forum/#!forum/mozzi-users
 
 */</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
#include &lt;RCpoll.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 128 // powers of 2 please
#define SENSOR_PIN 4            // digital pin for sensor input
</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
<span class="n">RCpoll</span> <span class="o">&lt;</span><span class="n">SENSOR_PIN</span><span class="o">&gt;</span> <span class="n">sensor</span><span class="p">;</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>



<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">freq</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="n">sensor</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// sensor ranges about 0 to 13
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Sinewave_Pinchange_Interrupt</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Sinewave_Pinchange_Interrupt/Sinewave_Pinchange_Interrupt.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Sinewave_Pinchange_Interrupt/Sinewave_Pinchange_Interrupt.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Sinewave_Pinchange_Interruptexpand" onclick="javascript:toggleDisplay(Sinewave_Pinchange_Interrupt, Sinewave_Pinchange_Interruptexpand, Sinewave_Pinchange_Interruptcollapse)">show sketch</button>
<button id="Sinewave_Pinchange_Interruptcollapse" style="display:none" onclick="javascript:toggleDisplay(Sinewave_Pinchange_Interrupt, Sinewave_Pinchange_Interruptexpand, Sinewave_Pinchange_Interruptcollapse)">hide sketch</button></p>
<div id="Sinewave_Pinchange_Interrupt" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  
  Example of changing a sound in response to pin changes detected 
  in the background with an interrupt, using PinChangeInt library
  with Mozzi sonification library.
  
  Demonstrates using Mozzi with PinChangeInt library from:
  https://code.google.com/p/arduino-pinchangeint/
  (Not for Teensy 3.1)
  
  Circuit:
  
    Audio output on digital pin 9 on a Uno or similar, or 
    check the README or https://sensorium.github.com/Mozzi/
    
    Pushbutton on digital pin D4
      button from the digital pin to +5V
      10K resistor from the digital pin to ground
      6.8nf capacitor from the digital pin to ground
     
     
  Mozzi help/discussion/announcements:
  https://groups.google.com/forum/#!forum/mozzi-users
  
  Tim Barrass 2013, CC by-nc-sa.
 */</span>

<span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
#include &lt;PinChangeInt.h&gt;
</span>
<span class="cp">#define PIN 4  // the pin we are interested in
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">PIN</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>     <span class="c1">//set the pin to input
</span>  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">PIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span> <span class="c1">//use the internal pullup resistor
</span>  <span class="n">PCintPort</span><span class="o">::</span><span class="n">attachInterrupt</span><span class="p">(</span><span class="n">PIN</span><span class="p">,</span> <span class="n">changeFreq</span><span class="p">,</span><span class="n">RISING</span><span class="p">);</span> <span class="c1">// attach a PinChange Interrupt to our pin on the rising edge
</span>  <span class="c1">// (RISING, FALLING and CHANGE all work with this library)
</span>  <span class="c1">// and execute the function changeFreq when that pin changes
</span>  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>



<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// everything is done by the pinchange interrupt
</span><span class="p">}</span>



<span class="kt">void</span> <span class="n">changeFreq</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="kt">int</span> <span class="n">freq</span> <span class="o">=</span> <span class="mi">220</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">freq</span><span class="o">==</span><span class="mi">220</span><span class="p">){</span>
    <span class="n">freq</span><span class="o">=</span><span class="mi">330</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="n">freq</span><span class="o">=</span><span class="mi">220</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span> <span class="c1">// set the frequency
</span><span class="p">}</span>



<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// return an int signal centred around 0
</span><span class="p">}</span>



<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Volume_Knob</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Volume_Knob/Volume_Knob.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Volume_Knob/Volume_Knob.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Volume_Knobexpand" onclick="javascript:toggleDisplay(Volume_Knob, Volume_Knobexpand, Volume_Knobcollapse)">show sketch</button>
<button id="Volume_Knobcollapse" style="display:none" onclick="javascript:toggleDisplay(Volume_Knob, Volume_Knobexpand, Volume_Knobcollapse)">hide sketch</button></p>
<div id="Volume_Knob" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  
  Example using a potentiometer to control the amplitude of a sinewave
  with Mozzi sonification library.

  Demonstrates the use of Oscil to play a wavetable, and analog input for control.

  This example goes with a tutorial on the Mozzi site:
  https://sensorium.github.io/Mozzi/learn/introductory-tutorial/
  
  The circuit:
    Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/

  Potentiometer connected to analog pin 0:
     Center pin of the potentiometer goes to the analog pin.
     Side pins of the potentiometer go to +5V and ground

 +5V ---|
              /    
  A0 ----\  potentiometer 
              /    
 GND ---|

  Mozzi help/discussion/announcements:
  https://groups.google.com/forum/#!forum/mozzi-users

  Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>

<span class="k">const</span> <span class="kt">char</span> <span class="n">INPUT_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// set the input for the knob to analog pin 0
</span>
<span class="c1">// to convey the volume level from updateControl() to updateAudio()
</span><span class="n">byte</span> <span class="n">volume</span><span class="p">;</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values // set up the Serial output so we can look at the input values
</span>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// read the variable resistor for volume
</span>  <span class="kt">int</span> <span class="n">sensor_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">INPUT_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023
</span>  
  <span class="c1">// map it to an 8 bit range for efficient calculations in updateAudio
</span>  <span class="n">volume</span> <span class="o">=</span> <span class="n">map</span><span class="p">(</span><span class="n">sensor_value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1023</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>  
  
  <span class="c1">// print the value to the Serial monitor for debugging
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"volume = "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">volume</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">volume</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// shift back into range after multiplying by 8 bit value
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Volume_Knob_LightLevel_Frequency</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Volume_Knob_LightLevel_Frequency/Volume_Knob_LightLevel_Frequency.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Volume_Knob_LightLevel_Frequency/Volume_Knob_LightLevel_Frequency.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Volume_Knob_LightLevel_Frequencyexpand" onclick="javascript:toggleDisplay(Volume_Knob_LightLevel_Frequency, Volume_Knob_LightLevel_Frequencyexpand, Volume_Knob_LightLevel_Frequencycollapse)">show sketch</button>
<button id="Volume_Knob_LightLevel_Frequencycollapse" style="display:none" onclick="javascript:toggleDisplay(Volume_Knob_LightLevel_Frequency, Volume_Knob_LightLevel_Frequencyexpand, Volume_Knob_LightLevel_Frequencycollapse)">hide sketch</button></p>
<div id="Volume_Knob_LightLevel_Frequency" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  
  Example using a potentiometer to change the amplitude of a sinewave
  and a light dependent resister (LDR) to change the frequency.
  with Mozzi sonification library.

  Demonstrates the use of Oscil to play a wavetable, and analog input for control.

  This example goes with a tutorial on the Mozzi site:
  https://sensorium.github.io/Mozzi/learn/introductory-tutorial/
  
  The circuit:
     Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
     check the README or https://sensorium.github.com/Mozzi/

  Potentiometer connected to analog pin 0:
     Center pin of the potentiometer goes to the analog pin.
     Side pins of the potentiometer go to +5V and ground

 +5V ---|
              /    
  A0 ----\  potentiometer 
              /    
 GND ---|
 
  Light dependent resistor (LDR) and 5.1k resistor on analog pin 1:
    LDR from analog pin to +5V (3.3V on Teensy 3.1)
    5.1k resistor from analog pin to ground
 
  Mozzi help/discussion/announcements:
  https://groups.google.com/forum/#!forum/mozzi-users

  Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
</span>
<span class="k">const</span> <span class="kt">char</span> <span class="n">KNOB_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// set the input for the knob to analog pin 0
</span><span class="k">const</span> <span class="kt">char</span> <span class="n">LDR_PIN</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// set the input for the LDR to analog pin 1
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>

<span class="n">byte</span> <span class="n">volume</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values // set up the Serial output so we can look at the analog levels
</span>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// read the potentiometer
</span>  <span class="kt">int</span> <span class="n">knob_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023
</span>  
  <span class="c1">// map it to an 8 bit volume range for efficient calculations in updateAudio
</span>  <span class="n">volume</span> <span class="o">=</span> <span class="n">knob_value</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span>  <span class="c1">// 10 bits (0-&gt;1023) shifted right by 2 bits to give 8 bits (0-&gt;255)
</span>  
  <span class="c1">// print the value to the Serial monitor for debugging
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"volume = "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">volume</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">);</span> <span class="c1">// prints a tab
</span>  
  <span class="c1">// read the light dependent resistor
</span>  <span class="kt">int</span> <span class="n">light_level</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">LDR_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023
</span>  
  <span class="c1">// print the value to the Serial monitor for debugging
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"light level = "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">light_level</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">);</span> <span class="c1">// prints a tab
</span>
  <span class="c1">// set the frequency
</span>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">light_level</span><span class="p">);</span>
  
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// next line
</span><span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="c1">// cast char output from aSin.next() to int to make room for multiplication
</span>  <span class="k">return</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">volume</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span> <span class="c1">// shift back into range after multiplying by 8 bit value
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<h2 id="04.Audio_Input"> 04.Audio_Input </h2>
<p>Audio_Input
…(no recording of this one)</p>

<p><button type="button" id="Audio_Inputexpand" onclick="javascript:toggleDisplay(Audio_Input, Audio_Inputexpand, Audio_Inputcollapse)">show sketch</button>
<button id="Audio_Inputcollapse" style="display:none" onclick="javascript:toggleDisplay(Audio_Input, Audio_Inputexpand, Audio_Inputcollapse)">hide sketch</button></p>
<div id="Audio_Input" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Test of audio input using Mozzi sonification library.
 
 An audio input using the range between 0 to 5V on analog pin A0
 is sampled and output on digital pin 9.
 
  Configuration: requires these lines in the Mozzi/mozzi_config.h file:
  #define USE_AUDIO_INPUT true
  #define AUDIO_INPUT_PIN 0
 
 Circuit: 
 Audio cable centre wire on pin A0, outer shielding to Arduino Ground.
 Audio output on DAC/A14 on Teensy 3.0, 3.1, or digital pin 9 on a Uno or similar, or
 check the README or https://sensorium.github.com/Mozzi/
 
 Mozzi help/discussion/announcements:
  https://groups.google.com/forum/#!forum/mozzi-users

  Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
</span>
<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">getAudioInput</span><span class="p">();</span> <span class="c1">// range 0-1023
</span>  <span class="n">asig</span> <span class="o">=</span> <span class="n">asig</span> <span class="o">-</span> <span class="mi">512</span><span class="p">;</span> <span class="c1">// now range is -512 to 511
</span>  <span class="c1">// output range in STANDARD mode is -244 to 243, 
</span>  <span class="c1">// so you might need to adjust your signal to suit
</span>  <span class="k">return</span> <span class="n">asig</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Audio_Input_with_Knob_Filter</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/04.Audio_Input/Audio_Input_with_Knob_Filter/Audio_Input_with_Knob_Filter.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/04.Audio_Input/Audio_Input_with_Knob_Filter/Audio_Input_with_Knob_Filter.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Audio_Input_with_Knob_Filterexpand" onclick="javascript:toggleDisplay(Audio_Input_with_Knob_Filter, Audio_Input_with_Knob_Filterexpand, Audio_Input_with_Knob_Filtercollapse)">show sketch</button>
<button id="Audio_Input_with_Knob_Filtercollapse" style="display:none" onclick="javascript:toggleDisplay(Audio_Input_with_Knob_Filter, Audio_Input_with_Knob_Filterexpand, Audio_Input_with_Knob_Filtercollapse)">hide sketch</button></p>
<div id="Audio_Input_with_Knob_Filter" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  
  Test of audio input and processing with control input,
  using Mozzi sonification library.

  Configuration: requires these lines in the Mozzi/mozzi_config.h file:
  #define USE_AUDIO_INPUT true
  #define AUDIO_INPUT_PIN 0

  Circuit: 
    Audio input on pin analog 0
    Output on DAC/A14 on Teensy 3.0, 3.1, or digital pin 9 on a Uno or similar, or
    check the README or https://sensorium.github.com/Mozzi/

     Potentiometer connected to analog pin A1.
     Center pin of the potentiometer goes to the analog pin.
     Side pins of the potentiometer go to +5V and ground

  Mozzi help/discussion/announcements:
  https://groups.google.com/forum/#!forum/mozzi-users

*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;LowPassFilter.h&gt;
</span>
<span class="cp">#define KNOB_PIN 1
</span>
<span class="n">LowPassFilter</span> <span class="n">lpf</span><span class="p">;</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">lpf</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">220</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">knob</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">);</span> 
  <span class="n">byte</span> <span class="n">cutoff_freq</span> <span class="o">=</span> <span class="n">knob</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">;</span> <span class="c1">// range 0-255
</span>  <span class="n">lpf</span><span class="p">.</span><span class="n">setCutoffFreq</span><span class="p">(</span><span class="n">cutoff_freq</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="c1">// subtracting 512 moves the unsigned audio data into 0-centred, 
</span>  <span class="c1">// signed range required by all Mozzi units
</span>  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">getAudioInput</span><span class="p">()</span><span class="o">-</span><span class="mi">512</span><span class="p">;</span>
  <span class="n">asig</span> <span class="o">=</span> <span class="n">lpf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">asig</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Audio_and_Control_Input
…(no recording of this one)</p>

<p><button type="button" id="Audio_and_Control_Inputexpand" onclick="javascript:toggleDisplay(Audio_and_Control_Input, Audio_and_Control_Inputexpand, Audio_and_Control_Inputcollapse)">show sketch</button>
<button id="Audio_and_Control_Inputcollapse" style="display:none" onclick="javascript:toggleDisplay(Audio_and_Control_Input, Audio_and_Control_Inputexpand, Audio_and_Control_Inputcollapse)">hide sketch</button></p>
<div id="Audio_and_Control_Input" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Test of audio and control rate analog input using Mozzi sonification library.
 
  An audio input using the range between 0 to 5V on analog pin A0
  is sampled and output on digital pin 9.  
  All the other analog channels are sampled at control rate and printed to Serial.
  
  Demonstrates mozziAnalogRead(pin), which reads analog inputs in the background,
  and getAudioInput(), which samples audio on AUDIO_INPUT_PIN, configured in mozzi_config.h.
  
  Configuration: requires these lines in the Mozzi/mozzi_config.h file:
  #define USE_AUDIO_INPUT true
  #define AUDIO_INPUT_PIN 0
 
 
  Circuit: 
  Audio cable centre wire on pin A0, outer shielding to Arduino Ground.
  Audio output on DAC/A14 on Teensy 3.0, 3.1, or digital pin 9 on a Uno or similar, or
  check the README or https://sensorium.github.com/Mozzi/
  Analog sensor inputs on any other analog input pins.
  The serial printing might cause glitches, so try commenting 
  them out to test if this is a problem.
 
  Mozzi help/discussion/announcements:
  https://groups.google.com/forum/#!forum/mozzi-users

  Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"num_analog_inputs = "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">NUM_ANALOG_INPUTS</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_ANALOG_INPUTS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// analog 0 is configured for audio
</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">i</span><span class="p">));</span> <span class="c1">// mozziAnalogRead is better than mozziAnalogRead
</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">);</span> <span class="c1">// tab
</span>  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">getAudioInput</span><span class="p">();</span> <span class="c1">// range 0-1023
</span>  <span class="n">asig</span> <span class="o">=</span> <span class="n">asig</span> <span class="o">-</span> <span class="mi">512</span><span class="p">;</span> <span class="c1">// now range is -512 to 511
</span>  <span class="n">asig</span> <span class="o">&gt;&gt;=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// now it's -128 to 127, within audio output range
</span>  <span class="k">return</span> <span class="n">asig</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<h2 id="05.Control_Filters"> 05.Control_Filters </h2>
<p>DCfilter
…(no recording of this one)</p>

<p><button type="button" id="DCfilterexpand" onclick="javascript:toggleDisplay(DCfilter, DCfilterexpand, DCfiltercollapse)">show sketch</button>
<button id="DCfiltercollapse" style="display:none" onclick="javascript:toggleDisplay(DCfilter, DCfilterexpand, DCfiltercollapse)">hide sketch</button></p>
<div id="DCfilter" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/* Example of filtering an analog input to remove DC bias,
    using Mozzi sonification library.
    
    Demonstrates DCfilter(), DC-blocking filter useful for 
    highlighting changes in control signals.
    The output of the filter settles to 0 if the incoming signal stays constant.
    If the input changes, the filter output swings to track the change and 
    eventually settles back to 0.
     
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2013, CC by-nc-sa.
     
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;DCfilter.h&gt;
</span>
<span class="kt">int</span> <span class="n">sensorPin</span> <span class="o">=</span> <span class="n">A0</span><span class="p">;</span> 

<span class="n">DCfilter</span> <span class="n">dcFiltered</span><span class="p">(</span><span class="mf">0.9</span><span class="p">);</span> <span class="c1">// parameter sets how long the filter takes to settle
</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// read the value from the sensor:
</span>  <span class="kt">int</span> <span class="n">sensorValue</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">sensorPin</span><span class="p">);</span> 
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">sensorValue</span><span class="p">);</span> 
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"  Filtered = "</span><span class="p">);</span> 
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">dcFiltered</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">sensorValue</span><span class="p">));</span>              
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Line_vs_Smooth</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Line_vs_Smooth/Line_vs_Smooth.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Line_vs_Smooth/Line_vs_Smooth.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Line_vs_Smoothexpand" onclick="javascript:toggleDisplay(Line_vs_Smooth, Line_vs_Smoothexpand, Line_vs_Smoothcollapse)">show sketch</button>
<button id="Line_vs_Smoothcollapse" style="display:none" onclick="javascript:toggleDisplay(Line_vs_Smooth, Line_vs_Smoothexpand, Line_vs_Smoothcollapse)">hide sketch</button></p>
<div id="Line_vs_Smooth" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of 2 different ways to smooth analog inputs,
    using Mozzi sonification library.  The inputs are used 
    to control the frequencies of two oscillators.
  
    Demonstrates how to read analog inputs asynchronously, so values are
    updated in the background while audio generation continues,
    and the most recent readings can be read anytime from an array.
    Also demonstrates linear interpolation with Line(),
    filtering with Smooth(), and fixed point numbers.
    
    Circuit: Audio output on digital pin 9 
    (for standard output on a Uno or similar), or 
    check the README or https://sensorium.github.com/Mozzi/
    Your choice of analog sesnsors, or
    2 10k Potentiometers with wipers (middle terminals) 
    connected to analog pins 0, 1 and 2, and
    outside leads to ground and +5V.  
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
#include &lt;mozzi_fixmath.h&gt;
#include &lt;Line.h&gt;
#include &lt;Smooth.h&gt;
#include &lt;mozzi_analog.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 64 // powers of 2 please
</span>
<span class="c1">// 2 oscillators to compare linear interpolated vs smoothed control
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin0</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin1</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>


<span class="c1">// Line to interpolate frequency for aSin0.
// Q16n16 is basically (yourNumber &lt;&lt; 16)
// Line needs the small analog input integer values of 0-1023 
// to be scaled up if the time (the number of steps) is big 
// enough that distance/time gives a step-size of 0.  
// Then you need floats (which are sometimes too slow and create glitches), 
// or fixed point.  Q16n16: ugly but good.
</span><span class="n">Line</span> <span class="o">&lt;</span><span class="n">Q16n16</span><span class="o">&gt;</span> <span class="n">aInterpolate</span><span class="p">;</span>

<span class="c1">// the number of audio steps the line has to take to reach the next control value
</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">AUDIO_STEPS_PER_CONTROL</span> <span class="o">=</span> <span class="n">AUDIO_RATE</span> <span class="o">/</span> <span class="n">CONTROL_RATE</span><span class="p">;</span>

<span class="c1">// Smoothing unit for aSin1
// This might be better with Q24n8 numbers for more precision, 
// but we'll keep it simpler for the demo.
</span><span class="kt">float</span> <span class="n">smoothness</span> <span class="o">=</span> <span class="mf">0.995</span><span class="n">f</span><span class="p">;</span>
<span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">aSmooth</span><span class="p">(</span><span class="n">smoothness</span><span class="p">);</span> <span class="c1">// to smooth frequency for aSin1
</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">aSin0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">660.</span><span class="n">f</span><span class="p">);</span>
  <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">220.</span><span class="n">f</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>


<span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">freq1</span><span class="p">;</span>  <span class="c1">// global so it can be used in updateAudio, volatile to stop it getting changed while being used
</span>
<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="n">Q16n16</span> <span class="n">freq0</span> <span class="o">=</span> <span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span> <span class="c1">// 0 to 1023, scaled up to Q16n16 format
</span>  <span class="n">freq1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 0 to 1023
</span>   <span class="n">aInterpolate</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">freq0</span><span class="p">,</span> <span class="n">AUDIO_STEPS_PER_CONTROL</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="n">Q16n16</span> <span class="n">interpolatedFreq</span> <span class="o">=</span> <span class="n">aInterpolate</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// get the next linear interpolated freq
</span>  <span class="n">aSin0</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">interpolatedFreq</span><span class="p">);</span> 

  <span class="kt">int</span> <span class="n">smoothedFreq</span> <span class="o">=</span> <span class="n">aSmooth</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">freq1</span><span class="p">);</span> <span class="c1">// get the next filtered frequency
</span>  <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">smoothedFreq</span><span class="p">);</span>
  
  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">aSin0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aSin1</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// &gt;&gt;1 is like /2 but faster (the compiler doesn't seem to optimise it automatically)
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>MIDI_portamento</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/MIDI_portamento/MIDI_portamento.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/MIDI_portamento/MIDI_portamento.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="MIDI_portamentoexpand" onclick="javascript:toggleDisplay(MIDI_portamento, MIDI_portamentoexpand, MIDI_portamentocollapse)">show sketch</button>
<button id="MIDI_portamentocollapse" style="display:none" onclick="javascript:toggleDisplay(MIDI_portamento, MIDI_portamentoexpand, MIDI_portamentocollapse)">hide sketch</button></p>
<div id="MIDI_portamento" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of a sound being triggered by MIDI input, with portamento.
  
    Demonstrates playing notes with Mozzi in response to MIDI input.
    Also demonstrates Portamento(), a traditional portamento with a 
    duration which can be set.
  
    Uses Arduino MIDI library v4.2 
    (https://github.com/FortySevenEffects/arduino_midi_library/releases/tag/4.2)
    
    Circuit: 
      MIDI input circuit as per https://arduino.cc/en/Tutorial/Midi
      (midi has to be disconnected from rx for sketch to upload)
      Audio output on digital pin 9 on a Uno or similar.
      
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="cp">#include &lt;MIDI.h&gt;
</span><span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;Line.h&gt; // for envelope
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
#include &lt;mozzi_midi.h&gt;
#include &lt;ADSR.h&gt;
#include &lt;mozzi_fixmath.h&gt;
#include &lt;Portamento.h&gt;
</span>
<span class="n">MIDI_CREATE_DEFAULT_INSTANCE</span><span class="p">();</span>

<span class="c1">// use #define for CONTROL_RATE, not a constant
</span><span class="cp">#define CONTROL_RATE 128 // powers of 2 please
</span>
<span class="c1">// audio sinewave oscillator
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>

<span class="c1">// envelope generator
</span><span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">envelope</span><span class="p">;</span>

<span class="n">Portamento</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span><span class="n">aPortamento</span><span class="p">;</span>

<span class="cp">#define LED 13
</span>

<span class="kt">void</span> <span class="nf">HandleNoteOn</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">note</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">aPortamento</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">note</span><span class="p">);</span>
  <span class="n">envelope</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span><span class="n">HIGH</span><span class="p">);</span>
<span class="p">}</span>



<span class="kt">void</span> <span class="nf">HandleNoteOff</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">note</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">)</span> <span class="p">{</span> 
  <span class="n">envelope</span><span class="p">.</span><span class="n">noteOff</span><span class="p">();</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
<span class="p">}</span>



<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>

  <span class="c1">// Initiate MIDI communications, listen to all channels
</span>  <span class="n">MIDI</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">MIDI_CHANNEL_OMNI</span><span class="p">);</span>    

  <span class="c1">// Connect the HandleNoteOn function to the library, so it is called upon reception of a NoteOn.
</span>  <span class="n">MIDI</span><span class="p">.</span><span class="n">setHandleNoteOn</span><span class="p">(</span><span class="n">HandleNoteOn</span><span class="p">);</span>  <span class="c1">// Put only the name of the function
</span>  <span class="n">MIDI</span><span class="p">.</span><span class="n">setHandleNoteOff</span><span class="p">(</span><span class="n">HandleNoteOff</span><span class="p">);</span>  <span class="c1">// Put only the name of the function
</span>
  <span class="n">envelope</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">64</span><span class="p">);</span>
  <span class="n">envelope</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">300</span><span class="p">);</span> <span class="c1">// 10000 is so the note will sustain 10 seconds unless a noteOff comes
</span>
  <span class="n">aPortamento</span><span class="p">.</span><span class="n">setTime</span><span class="p">(</span><span class="mi">300u</span><span class="p">);</span>

  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> 
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="n">MIDI</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
  <span class="n">envelope</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">aPortamento</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">envelope</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span> </code></pre></figure>

</div>
<hr />
<p>RollingAverage</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/RollingAverage/RollingAverage.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/RollingAverage/RollingAverage.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="RollingAverageexpand" onclick="javascript:toggleDisplay(RollingAverage, RollingAverageexpand, RollingAveragecollapse)">show sketch</button>
<button id="RollingAveragecollapse" style="display:none" onclick="javascript:toggleDisplay(RollingAverage, RollingAverageexpand, RollingAveragecollapse)">hide sketch</button></p>
<div id="RollingAverage" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example changing the frequency of 2 sinewaves with 1 analog input,
    using RollingAverage() to filter one of the control signals 
    and the other one unfiltered,
    using Mozzi sonification library.
  
    Demonstrates the difference between a raw control
    signal and one smoothed with RollingAverage().
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
#include &lt;RollingAverage.h&gt;
</span>
<span class="cp">#define INPUT_PIN 0 // analog control input
</span>
<span class="c1">// oscils to compare bumpy to averaged control input
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin0</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin1</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>

<span class="c1">// use: RollingAverage &lt;number_type, how_many_to_average&gt; myThing
</span><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverage</span><span class="p">;</span> <span class="c1">// how_many_to_average has to be power of 2
</span><span class="kt">int</span> <span class="n">averaged</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">bumpy_input</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">INPUT_PIN</span><span class="p">);</span>
  <span class="n">averaged</span> <span class="o">=</span> <span class="n">kAverage</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">bumpy_input</span><span class="p">);</span>

  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"bumpy </span><span class="se">\t</span><span class="s">"</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">bumpy_input</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s"> averaged </span><span class="se">\t</span><span class="s">"</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">averaged</span><span class="p">);</span>

  <span class="n">aSin0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">bumpy_input</span><span class="p">);</span>
  <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">averaged</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">aSin0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span><span class="n">aSin1</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Smooth</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Smooth/Smooth.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Smooth/Smooth.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Smoothexpand" onclick="javascript:toggleDisplay(Smooth, Smoothexpand, Smoothcollapse)">show sketch</button>
<button id="Smoothcollapse" style="display:none" onclick="javascript:toggleDisplay(Smooth, Smoothexpand, Smoothcollapse)">hide sketch</button></p>
<div id="Smooth" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of a sound changing volume with and without
    smoothing of the control signal to remove obvious clicks,
    using Mozzi sonification library.
  
    Demonstrates using Smooth to filter a control signal at audio rate,
    EventDelay to schedule changes and rand() to choose random volumes.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    your board check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
#include &lt;EventDelay.h&gt;
#include &lt;Smooth.h&gt;
#include &lt;mozzi_rand.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 128
</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>

<span class="c1">// for scheduling audio gain changes
</span><span class="n">EventDelay</span> <span class="n">kGainChangeDelay</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gainChangeMsec</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>

<span class="c1">//  for scheduling turning smoothing on and off
</span><span class="n">EventDelay</span> <span class="n">kSmoothOnOff</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">smoothOnOffMsec</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span>

<span class="kt">float</span> <span class="n">smoothness</span> <span class="o">=</span> <span class="mf">0.9975</span><span class="n">f</span><span class="p">;</span>
<span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">aSmoothGain</span><span class="p">(</span><span class="n">smoothness</span><span class="p">);</span>
<span class="n">boolean</span> <span class="n">smoothIsOn</span><span class="o">=</span><span class="nb">true</span><span class="p">;</span>
<span class="kt">long</span> <span class="n">target_gain</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">330</span><span class="p">);</span> <span class="c1">// set the frequency
</span>  <span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">gainChangeMsec</span><span class="p">);</span>
  <span class="n">kSmoothOnOff</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">smoothOnOffMsec</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// switch smoothing on and off to show the difference
</span>  <span class="k">if</span><span class="p">(</span><span class="n">kSmoothOnOff</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">smoothIsOn</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">aSmoothGain</span><span class="p">.</span><span class="n">setSmoothness</span><span class="p">(</span><span class="mf">0.</span><span class="n">f</span><span class="p">);</span>
      <span class="n">smoothIsOn</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
      <span class="n">aSmoothGain</span><span class="p">.</span><span class="n">setSmoothness</span><span class="p">(</span><span class="n">smoothness</span><span class="p">);</span>
      <span class="n">smoothIsOn</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">kSmoothOnOff</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// random volume changes
</span>  <span class="k">if</span><span class="p">(</span><span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="n">target_gain</span> <span class="o">=</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span> <span class="mi">255</span><span class="p">);</span>
    <span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>

<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">aSmoothGain</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target_gain</span><span class="p">)</span> <span class="o">*</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span> <span class="c1">// shift back to char precision after multiply
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Smooth_Frequency</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Smooth_Frequency/Smooth_Frequency.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Smooth_Frequency/Smooth_Frequency.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Smooth_Frequencyexpand" onclick="javascript:toggleDisplay(Smooth_Frequency, Smooth_Frequencyexpand, Smooth_Frequencycollapse)">show sketch</button>
<button id="Smooth_Frequencycollapse" style="display:none" onclick="javascript:toggleDisplay(Smooth_Frequency, Smooth_Frequencyexpand, Smooth_Frequencycollapse)">hide sketch</button></p>
<div id="Smooth_Frequency" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example sliding between frequencies,
    using Mozzi sonification library.
  
    Demonstrates using Smooth to filter a control signal.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
#include &lt;EventDelay.h&gt;
#include &lt;Smooth.h&gt;
#include &lt;mozzi_midi.h&gt;
</span>
<span class="c1">// this is a high value to avoid zipper noise
</span><span class="cp">#define CONTROL_RATE 1024 
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>

<span class="c1">// for scheduling freq changes
</span><span class="n">EventDelay</span> <span class="n">kFreqChangeDelay</span><span class="p">;</span>

<span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothFreq</span><span class="p">(</span><span class="mf">0.975</span><span class="n">f</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">target_freq</span><span class="p">,</span> <span class="n">target_freq1</span><span class="p">,</span> <span class="n">target_freq2</span><span class="p">;</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">target_freq1</span> <span class="o">=</span> <span class="mi">441</span><span class="p">;</span>
  <span class="n">target_freq2</span> <span class="o">=</span> <span class="mi">330</span><span class="p">;</span>
  <span class="n">kFreqChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// 1000ms countdown, within resolution of CONTROL_RATE
</span>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">kFreqChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">target_freq</span> <span class="o">==</span> <span class="n">target_freq1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">target_freq</span> <span class="o">=</span> <span class="n">target_freq2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
      <span class="n">target_freq</span> <span class="o">=</span> <span class="n">target_freq1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">kFreqChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kt">int</span> <span class="n">smoothed_freq</span> <span class="o">=</span> <span class="n">kSmoothFreq</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target_freq</span><span class="p">);</span>
  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">smoothed_freq</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Thermistor_OverSample</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Thermistor_OverSample/Thermistor_OverSample.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Thermistor_OverSample/Thermistor_OverSample.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Thermistor_OverSampleexpand" onclick="javascript:toggleDisplay(Thermistor_OverSample, Thermistor_OverSampleexpand, Thermistor_OverSamplecollapse)">show sketch</button>
<button id="Thermistor_OverSamplecollapse" style="display:none" onclick="javascript:toggleDisplay(Thermistor_OverSample, Thermistor_OverSampleexpand, Thermistor_OverSamplecollapse)">hide sketch</button></p>
<div id="Thermistor_OverSample" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*    
  Example of oversampling analog input from a thermistor
  for increased resolution.  It's a basic attempt at a biofeedback
  device used as an ineffective treatment for migraines.  The idea
  is that if you can focus on making your hands warm, increased blood
  flow to the extremities is associated with a reduced stress response.
  Anyway, the bleeps sweep up if the temperature increases, down for decrease,
  and level for no change.  The tremelo rate increases with the temperature.
  Using Mozzi sonification library.

  Demonstrates OverSample object.

  The circuit:
     Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
     check the README or https://sensorium.github.com/Mozzi/

  Temperature dependent resistor (Thermistor) and 5.1k resistor on analog pin 1:
    Thermistor from analog pin to +5V (3.3V on Teensy 3.1)
    5.1k resistor from analog pin to ground
    
  Mozzi help/discussion/announcements:
  https://groups.google.com/forum/#!forum/mozzi-users

  Tim Barrass 2013, CC by-nc-sa.
 */</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;Line.h&gt;
#include &lt;tables/sin2048_int8.h&gt; // SINe table for oscillator
#include &lt;OverSample.h&gt;
#include &lt;ControlDelay.h&gt;
</span>

<span class="c1">//#define CONTROL_RATE 256 
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTremelo</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> 
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aEnvelope</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> 

<span class="n">Line</span> <span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">freqLine</span><span class="p">;</span>

<span class="n">OverSample</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;</span> <span class="n">overSampler</span><span class="p">;</span> <span class="c1">// will give 10+3=13 bits resolution, 0-&gt;8191, using 128 bytes
</span>
<span class="k">const</span> <span class="n">byte</span> <span class="n">INPUT_PIN</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="kt">float</span> <span class="n">ENVELOPE_DURATION</span> <span class="o">=</span> <span class="mf">1.</span><span class="n">f</span><span class="p">;</span>

<span class="k">const</span> <span class="n">byte</span> <span class="n">LINE_LENGTH</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte</span><span class="p">)((</span><span class="kt">float</span><span class="p">)</span><span class="n">CONTROL_RATE</span><span class="o">*</span><span class="n">ENVELOPE_DURATION</span><span class="o">*</span><span class="mf">0.5</span><span class="p">);</span> <span class="c1">// 0.5 seconds per line
</span>
<span class="c1">// adjustments to get tremelo in useful range from oversampled temperature input
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">TREMOLO_OFFSET</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">float</span> <span class="n">TREMOLO_SCALE</span> <span class="o">=</span> <span class="mf">0.002</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">INPUT_PIN</span><span class="p">,</span><span class="n">INPUT</span><span class="p">);</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">aEnvelope</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">ENVELOPE_DURATION</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">();</span> 
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="kt">float</span> <span class="n">start_freq</span><span class="p">,</span> <span class="n">end_freq</span><span class="p">;</span>
  <span class="k">static</span> <span class="kt">int</span> <span class="n">counter</span><span class="p">,</span> <span class="n">old_oversampled</span><span class="p">;</span>
  
  <span class="c1">// read the variable resistor
</span>  <span class="kt">int</span> <span class="n">sensor_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">INPUT_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023
</span>  
  <span class="c1">// get the next oversampled sensor value
</span>  <span class="kt">int</span> <span class="n">oversampled</span> <span class="o">=</span> <span class="n">overSampler</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">sensor_value</span><span class="p">);</span>
  
  <span class="c1">// modulate the amplitude of the sound in proportion to the magnitude of the oversampled sensor
</span>  <span class="kt">float</span> <span class="n">tremeloRate</span> <span class="o">=</span> <span class="n">TREMOLO_SCALE</span><span class="o">*</span><span class="p">(</span><span class="n">oversampled</span><span class="o">-</span><span class="n">TREMOLO_OFFSET</span><span class="p">);</span>
  <span class="n">tremeloRate</span> <span class="o">=</span> <span class="n">tremeloRate</span><span class="o">*</span><span class="n">tremeloRate</span><span class="o">*</span><span class="n">tremeloRate</span><span class="o">*</span><span class="n">tremeloRate</span><span class="o">*</span><span class="n">tremeloRate</span><span class="p">;</span>
  <span class="n">aTremelo</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">tremeloRate</span><span class="p">);</span>
  
  <span class="c1">// every half second
</span>   <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">counter</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">){</span>
   
    <span class="k">if</span> <span class="p">(</span><span class="n">oversampled</span><span class="o">&gt;</span><span class="n">old_oversampled</span><span class="p">){</span> <span class="c1">// high tweet up if temp rose
</span>      <span class="n">start_freq</span> <span class="o">=</span> <span class="mf">550.</span><span class="n">f</span><span class="p">;</span>
      <span class="n">end_freq</span> <span class="o">=</span> <span class="mf">660.</span><span class="n">f</span><span class="p">;</span>
    <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">oversampled</span><span class="o">&lt;</span><span class="n">old_oversampled</span><span class="p">){</span> <span class="c1">// low tweet down if temp fell
</span>      <span class="n">start_freq</span> <span class="o">=</span> <span class="mf">330.</span><span class="n">f</span><span class="p">;</span>
      <span class="n">end_freq</span> <span class="o">=</span> <span class="mf">220.</span><span class="n">f</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// flat beep if no change
</span>      <span class="n">start_freq</span> <span class="o">=</span> <span class="mf">440.</span><span class="n">f</span><span class="p">;</span>
      <span class="n">end_freq</span> <span class="o">=</span> <span class="mf">440.</span><span class="n">f</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">old_oversampled</span> <span class="o">=</span> <span class="n">oversampled</span><span class="p">;</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="n">LINE_LENGTH</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// reset counter
</span>    
    <span class="c1">// set the line to change the main frequency
</span>    <span class="n">freqLine</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">start_freq</span><span class="p">,</span><span class="n">end_freq</span><span class="p">,</span><span class="n">LINE_LENGTH</span><span class="p">);</span>
    
    <span class="c1">// print out for debugging
</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">oversampled</span><span class="p">);</span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">);</span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">start_freq</span><span class="p">);</span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s">"</span><span class="p">);</span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">end_freq</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// update the main frequency of the sound
</span>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freqLine</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>

<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">((((</span><span class="kt">int</span><span class="p">)</span><span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mi">128</span><span class="o">+</span><span class="n">aTremelo</span><span class="p">.</span><span class="n">next</span><span class="p">()))</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span><span class="o">*</span><span class="n">aEnvelope</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> 
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<h2 id="06.Synthesis"> 06.Synthesis </h2>
<p>AMsynth</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/AMsynth/AMsynth.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/AMsynth/AMsynth.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="AMsynthexpand" onclick="javascript:toggleDisplay(AMsynth, AMsynthexpand, AMsynthcollapse)">show sketch</button>
<button id="AMsynthcollapse" style="display:none" onclick="javascript:toggleDisplay(AMsynth, AMsynthexpand, AMsynthcollapse)">hide sketch</button></p>
<div id="AMsynth" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of Amplitude Modulation synthesis
    using Mozzi sonification library.
  
    Demonstrates modulating the gain of one oscillator
    by the instantaneous amplitude of another,
    shows the use of fixed-point numbers to express fractional
    values, random numbers with rand(), and EventDelay()
    for scheduling.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/cos2048_int8.h&gt; // table for Oscils to play
</span><span class="c1">//#include &lt;mozzi_utils.h&gt;
</span><span class="cp">#include &lt;mozzi_fixmath.h&gt;
#include &lt;EventDelay.h&gt;
#include &lt;mozzi_rand.h&gt;
#include &lt;mozzi_midi.h&gt;
</span>

<span class="cp">#define CONTROL_RATE 64 // powers of 2 please
</span>
<span class="c1">// audio oscils
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModDepth</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>

<span class="c1">// for scheduling note changes in updateControl()
</span><span class="n">EventDelay</span>  <span class="n">kNoteChangeDelay</span><span class="p">;</span>

<span class="c1">// synthesis parameters in fixed point formats
</span><span class="n">Q8n8</span> <span class="n">ratio</span><span class="p">;</span> <span class="c1">// unsigned int with 8 integer bits and 8 fractional bits
</span><span class="n">Q24n8</span> <span class="n">carrier_freq</span><span class="p">;</span> <span class="c1">// unsigned long with 24 integer bits and 8 fractional bits
</span><span class="n">Q24n8</span> <span class="n">mod_freq</span><span class="p">;</span> <span class="c1">// unsigned long with 24 integer bits and 8 fractional bits
</span>
<span class="c1">// for random notes
</span><span class="n">Q8n0</span> <span class="n">octave_start_note</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">ratio</span> <span class="o">=</span> <span class="n">float_to_Q8n8</span><span class="p">(</span><span class="mf">3.0</span><span class="n">f</span><span class="p">);</span>   <span class="c1">// define modulation ratio in float and convert to fixed-point
</span>  <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span> <span class="c1">// note duration ms, within resolution of CONTROL_RATE
</span>  <span class="n">aModDepth</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">13.</span><span class="n">f</span><span class="p">);</span>     <span class="c1">// vary mod depth to highlight am effects
</span>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// reseed the random generator for different results each time the sketch runs
</span>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">static</span> <span class="n">Q16n16</span> <span class="n">last_note</span> <span class="o">=</span> <span class="n">octave_start_note</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>

    <span class="c1">// change octave now and then
</span>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
      <span class="n">last_note</span> <span class="o">=</span> <span class="mi">36</span><span class="o">+</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// change step up or down a semitone occasionally
</span>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">13</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
      <span class="n">last_note</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">-</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">3</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// change modulation ratio now and then
</span>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
      <span class="n">ratio</span> <span class="o">=</span> <span class="p">((</span><span class="n">Q8n8</span><span class="p">)</span> <span class="mi">1</span><span class="o">+</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">))</span> <span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// sometimes add a fractionto the ratio
</span>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
      <span class="n">ratio</span> <span class="o">+=</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">255</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// step up or down 3 semitones (or 0)
</span>    <span class="n">last_note</span> <span class="o">+=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">3</span><span class="p">));</span>

    <span class="c1">// convert midi to frequency
</span>    <span class="n">Q16n16</span> <span class="n">midi_note</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="n">last_note</span><span class="p">);</span> 
    <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">Q16n16_to_Q24n8</span><span class="p">(</span><span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span>

    <span class="c1">// calculate modulation frequency to stay in ratio with carrier
</span>    <span class="n">mod_freq</span> <span class="o">=</span> <span class="p">(</span><span class="n">carrier_freq</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// (Q24n8   Q8n8) &gt;&gt; 8 = Q24n8
</span>
      <span class="c1">// set frequencies of the oscillators
</span>    <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq_Q24n8</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span>
    <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq_Q24n8</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>

    <span class="c1">// reset the note scheduler
</span>    <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>


<span class="p">}</span>

<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">long</span> <span class="n">mod</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128u</span><span class="o">+</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="o">*</span> <span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span> <span class="n">aModDepth</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
  <span class="kt">int</span> <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">mod</span> <span class="o">*</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>AMsynth_HIFI</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/AMsynth_HIFI/AMsynth_HIFI.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/AMsynth_HIFI/AMsynth_HIFI.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="AMsynth_HIFIexpand" onclick="javascript:toggleDisplay(AMsynth_HIFI, AMsynth_HIFIexpand, AMsynth_HIFIcollapse)">show sketch</button>
<button id="AMsynth_HIFIcollapse" style="display:none" onclick="javascript:toggleDisplay(AMsynth_HIFI, AMsynth_HIFIexpand, AMsynth_HIFIcollapse)">hide sketch</button></p>
<div id="AMsynth_HIFI" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of Amplitude Modulation synthesis
    using Mozzi sonification library.
  
    Demonstrates modulating the gain of one oscillator
    by the instantaneous amplitude of another,
    shows the use of fixed-point numbers to express fractional
    values, random numbers with rand(), and EventDelay()
    for scheduling.
  
    This sketch using HIFI mode is not for Teensy 3.1.
        
    IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be
    be changed from STANDARD mode to HIFI.
    In Mozz/mozzi_config.h, change
    #define AUDIO_MODE STANDARD
    //#define AUDIO_MODE HIFI
    to
    //#define AUDIO_MODE STANDARD
    #define AUDIO_MODE HIFI
  
  
    Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),
    Check the Mozzi core module documentation for others and more detail
  
                     3.9k 
     pin 9  ---WWWW-----|-----output
                    499k           |
     pin 10 ---WWWW---- |
                                       |
                             4.7n  ==
                                       |
                                   ground
  
    Resistors are ±0.5%  Measure and choose the most precise 
    from a batch of whatever you can get.  Use two 1M resistors
    in parallel if you can't find 499k.
    Alternatively using 39 ohm, 4.99k and 470nF components will 
    work directly with headphones.

    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012-13, CC by-nc-sa.
*/</span>

<span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/cos2048_int8.h&gt; // table for Oscils to play
#include &lt;mozzi_fixmath.h&gt;
#include &lt;EventDelay.h&gt;
#include &lt;mozzi_rand.h&gt;
#include &lt;mozzi_midi.h&gt;
</span>

<span class="c1">// audio oscils
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModDepth</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>

<span class="c1">// for scheduling note changes in updateControl()
</span><span class="n">EventDelay</span>  <span class="n">kNoteChangeDelay</span><span class="p">;</span>

<span class="c1">// synthesis parameters in fixed point formats
</span><span class="n">Q8n8</span> <span class="n">ratio</span><span class="p">;</span> <span class="c1">// unsigned int with 8 integer bits and 8 fractional bits
</span><span class="n">Q24n8</span> <span class="n">carrier_freq</span><span class="p">;</span> <span class="c1">// unsigned long with 24 integer bits and 8 fractional bits
</span><span class="n">Q24n8</span> <span class="n">mod_freq</span><span class="p">;</span> <span class="c1">// unsigned long with 24 integer bits and 8 fractional bits
</span>
<span class="c1">// for random notes
</span><span class="n">Q8n0</span> <span class="n">octave_start_note</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>



<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">ratio</span> <span class="o">=</span> <span class="n">float_to_Q8n8</span><span class="p">(</span><span class="mf">3.0</span><span class="n">f</span><span class="p">);</span>   <span class="c1">// define modulation ratio in float and convert to fixed-point
</span>  <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span> <span class="c1">// note duration ms, within resolution of CONTROL_RATE
</span>  <span class="n">aModDepth</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">13.</span><span class="n">f</span><span class="p">);</span>     <span class="c1">// vary mod depth to highlight am effects
</span>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// reseed the random generator for different results each time the sketch runs
</span>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// use default CONTROL_RATE 64
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">static</span> <span class="n">Q16n16</span> <span class="n">last_note</span> <span class="o">=</span> <span class="n">octave_start_note</span><span class="p">;</span>

  <span class="k">if</span><span class="p">(</span><span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>

    <span class="c1">// change octave now and then
</span>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
      <span class="n">last_note</span> <span class="o">=</span> <span class="mi">36</span><span class="o">+</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// change step up or down a semitone occasionally
</span>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">13</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
      <span class="n">last_note</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">-</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">3</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// change modulation ratio now and then
</span>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
      <span class="n">ratio</span> <span class="o">=</span> <span class="p">((</span><span class="n">Q8n8</span><span class="p">)</span> <span class="mi">1</span><span class="o">+</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">))</span> <span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// sometimes add a fraction to the ratio
</span>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
      <span class="n">ratio</span> <span class="o">+=</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">255</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// step up or down 3 semitones (or 0)
</span>    <span class="n">last_note</span> <span class="o">+=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">3</span><span class="p">));</span>

    <span class="c1">// convert midi to frequency
</span>    <span class="n">Q16n16</span> <span class="n">midi_note</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="n">last_note</span><span class="p">);</span> 
    <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">Q16n16_to_Q24n8</span><span class="p">(</span><span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span>

    <span class="c1">// calculate modulation frequency to stay in ratio with carrier
</span>    <span class="n">mod_freq</span> <span class="o">=</span> <span class="p">(</span><span class="n">carrier_freq</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// (Q24n8   Q8n8) &gt;&gt; 8 = Q24n8
</span>
    <span class="c1">// set frequencies of the oscillators
</span>    <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq_Q24n8</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span>
    <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq_Q24n8</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>

    <span class="c1">// reset the note scheduler
</span>    <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mod</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128u</span><span class="o">+</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="o">*</span> <span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span> <span class="n">aModDepth</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
  <span class="kt">int</span> <span class="n">out</span> <span class="o">=</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">mod</span> <span class="o">*</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">10</span><span class="p">;</span> <span class="c1">// 16 bit   8 bit = 24 bit, then &gt;&gt;10 = 14 bit
</span>  <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Detuned_Beats_Wash</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Detuned_Beats_Wash/Detuned_Beats_Wash.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Detuned_Beats_Wash/Detuned_Beats_Wash.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Detuned_Beats_Washexpand" onclick="javascript:toggleDisplay(Detuned_Beats_Wash, Detuned_Beats_Washexpand, Detuned_Beats_Washcollapse)">show sketch</button>
<button id="Detuned_Beats_Washcollapse" style="display:none" onclick="javascript:toggleDisplay(Detuned_Beats_Wash, Detuned_Beats_Washexpand, Detuned_Beats_Washcollapse)">hide sketch</button></p>
<div id="Detuned_Beats_Wash" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Plays a fluctuating ambient wash using pairs
    of slightly detuned oscillators, following an example
    from Miller Puckette's Pure Data manual.
  
    The detune frequencies are modified by chance in
    updateControl(), and the outputs of 14 audio
    oscillators are summed in updateAudio().
  
    Demonstrates the use of fixed-point Q16n16
    format numbers, mtof() for converting midi note
    values to frequency, and xorshift96() for random numbers.
    
    For this sketch to run smoothly on 16MHz Ateml boards, you need to edit
    platform.txt (on OSX you can find it by searching in /Users/your_name/Library/Arduino15).
    Search and replace -Os with -O2.  Save.  
    This tells the compiler to optimise for speed, instead of size.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/cos8192_int8.h&gt;
#include &lt;mozzi_rand.h&gt;
#include &lt;mozzi_midi.h&gt;
#include &lt;mozzi_fixmath.h&gt; // for Q16n16 fixed-point fractional number type
</span>
<span class="c1">// harmonics
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos3</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos4</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos5</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos6</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos7</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>

<span class="c1">// duplicates but slightly off frequency for adding to originals
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos1b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos2b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos3b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos4b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos5b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos6b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos7b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>

<span class="c1">// base pitch frequencies in 24n8 fixed int format (for speed later)
</span><span class="n">Q16n16</span> <span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">f3</span><span class="p">,</span><span class="n">f4</span><span class="p">,</span><span class="n">f5</span><span class="p">,</span><span class="n">f6</span><span class="p">,</span><span class="n">f7</span><span class="p">;</span>


<span class="n">Q16n16</span> <span class="nf">variation</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// 32 random bits &amp; with 524287 (b111 1111 1111 1111 1111)
</span>  <span class="c1">// gives between 0-8 in Q16n16 format
</span>  <span class="k">return</span>  <span class="p">(</span><span class="n">Q16n16</span><span class="p">)</span> <span class="p">(</span><span class="n">xorshift96</span><span class="p">()</span> <span class="o">&amp;</span> <span class="mi">524287UL</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="mi">64</span><span class="p">);</span> <span class="c1">// a literal control rate here
</span>
  <span class="c1">// select base frequencies using mtof (midi to freq) and fixed-point numbers
</span>  <span class="n">f1</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">48</span><span class="p">));</span>
  <span class="n">f2</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">74</span><span class="p">));</span>
  <span class="n">f3</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">64</span><span class="p">));</span>
  <span class="n">f4</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">77</span><span class="p">));</span>
  <span class="n">f5</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">67</span><span class="p">));</span>
  <span class="n">f6</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">57</span><span class="p">));</span>
  <span class="n">f7</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">60</span><span class="p">));</span>

  <span class="c1">// set Oscils with chosen frequencies
</span>  <span class="n">aCos1</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f1</span><span class="p">);</span>
  <span class="n">aCos2</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f2</span><span class="p">);</span>
  <span class="n">aCos3</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f3</span><span class="p">);</span>
  <span class="n">aCos4</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f4</span><span class="p">);</span>
  <span class="n">aCos5</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f5</span><span class="p">);</span>
  <span class="n">aCos6</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f6</span><span class="p">);</span>
  <span class="n">aCos7</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f7</span><span class="p">);</span>

  <span class="c1">// set frequencies of duplicate oscillators
</span>  <span class="n">aCos1b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f1</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
  <span class="n">aCos2b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f2</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
  <span class="n">aCos3b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f3</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
  <span class="n">aCos4b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f4</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
  <span class="n">aCos5b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f5</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
  <span class="n">aCos6b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f6</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
  <span class="n">aCos7b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f7</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// todo: choose a nice scale or progression and make a table for it
</span>  <span class="c1">// or add a very slow gliss for f1-f7, like shephard tones
</span>
  <span class="c1">// change frequencies of the b oscillators
</span>  <span class="k">switch</span> <span class="p">(</span><span class="n">lowByte</span><span class="p">(</span><span class="n">xorshift96</span><span class="p">())</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">){</span> <span class="c1">// 7 is 0111
</span>
    <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">aCos1b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f1</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
    <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
       <span class="n">aCos2b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f2</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
    <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
       <span class="n">aCos3b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f3</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
    <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
       <span class="n">aCos4b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f4</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
    <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">4</span><span class="p">:</span>
       <span class="n">aCos5b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f5</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
    <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">5</span><span class="p">:</span>
       <span class="n">aCos6b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f6</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
    <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">6</span><span class="p">:</span>
       <span class="n">aCos7b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f7</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>

  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span>
    <span class="n">aCos1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos1b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">aCos2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos2b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">aCos3</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos3b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">aCos4</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos4b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">aCos5</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos5b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">aCos6</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos6b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
    <span class="n">aCos7</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos7b</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>

  <span class="k">return</span> <span class="n">asig</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>FMsynth</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/FMsynth/FMsynth.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/FMsynth/FMsynth.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="FMsynthexpand" onclick="javascript:toggleDisplay(FMsynth, FMsynthexpand, FMsynthcollapse)">show sketch</button>
<button id="FMsynthcollapse" style="display:none" onclick="javascript:toggleDisplay(FMsynth, FMsynthexpand, FMsynthcollapse)">hide sketch</button></p>
<div id="FMsynth" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of simple FM with the phase modulation technique,
    using Mozzi sonification library.
  
    Demonstrates Oscil::phMod() for phase modulation, 
    Smooth() for smoothing control signals, 
    and Mozzi's fixed point number types for fractional frequencies.
  
    Also shows the limitations of Mozzi's 16384Hz Sample rate,
    as aliasing audibly intrudes as the sound gets brighter around 
    midi note 48.
    
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/cos2048_int8.h&gt; // table for Oscils to play
#include &lt;mozzi_midi.h&gt;
#include &lt;mozzi_fixmath.h&gt;
#include &lt;EventDelay.h&gt;
#include &lt;Smooth.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 256 // powers of 2 please
</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModIndex</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>

<span class="c1">// The ratio of deviation to modulation frequency is called the "index of modulation". ( I = d / Fm )
// It will vary according to the frequency that is modulating the carrier and the amount of deviation.
// so deviation d = I   Fm
// haven't quite worked this out properly yet...
</span>
<span class="n">Q8n8</span> <span class="n">mod_index</span><span class="p">;</span><span class="c1">// = float_to_Q8n8(2.0f); // constant version
</span><span class="n">Q16n16</span> <span class="n">deviation</span><span class="p">;</span>

<span class="n">Q16n16</span> <span class="n">carrier_freq</span><span class="p">,</span> <span class="n">mod_freq</span><span class="p">;</span>

<span class="c1">// FM ratio between oscillator frequencies, stays the same through note range
</span><span class="n">Q8n8</span> <span class="n">mod_to_carrier_ratio</span> <span class="o">=</span> <span class="n">float_to_Q8n8</span><span class="p">(</span><span class="mf">3.</span><span class="n">f</span><span class="p">);</span>

<span class="n">EventDelay</span> <span class="n">kNoteChangeDelay</span><span class="p">;</span>

<span class="c1">// for note changes
</span><span class="n">Q7n8</span> <span class="n">target_note</span><span class="p">,</span> <span class="n">note0</span><span class="p">,</span> <span class="n">note1</span><span class="p">,</span> <span class="n">note_upper_limit</span><span class="p">,</span> <span class="n">note_lower_limit</span><span class="p">,</span> <span class="n">note_change_step</span><span class="p">,</span> <span class="n">smoothed_note</span><span class="p">;</span>

<span class="c1">// using Smooth on midi notes rather than frequency, 
// because fractional frequencies need larger types than Smooth can handle
// Inefficient, but...until there is a better Smooth....
</span><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothNote</span><span class="p">(</span><span class="mf">0.95</span><span class="n">f</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">768</span><span class="p">);</span> <span class="c1">// ms countdown, taylored to resolution of CONTROL_RATE
</span>  <span class="n">kModIndex</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.768</span><span class="n">f</span><span class="p">);</span> <span class="c1">// sync with kNoteChangeDelay
</span>  <span class="n">target_note</span> <span class="o">=</span> <span class="n">note0</span><span class="p">;</span>
  <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="n">note_upper_limit</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
  <span class="n">note_lower_limit</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
  <span class="n">note0</span> <span class="o">=</span> <span class="n">note_lower_limit</span><span class="p">;</span>
  <span class="n">note1</span> <span class="o">=</span> <span class="n">note_lower_limit</span> <span class="o">+</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">setFreqs</span><span class="p">(</span><span class="n">Q8n8</span> <span class="n">midi_note</span><span class="p">){</span>
  <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q8n8_to_Q16n16</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span> <span class="c1">// convert midi note to fractional frequency
</span>  <span class="n">mod_freq</span> <span class="o">=</span> <span class="p">((</span><span class="n">carrier_freq</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="n">mod_to_carrier_ratio</span><span class="p">)</span>  <span class="p">;</span> <span class="c1">// (Q16n16&gt;&gt;8)   Q8n8 = Q16n16, beware of overflow
</span>  <span class="n">deviation</span> <span class="o">=</span> <span class="p">((</span><span class="n">mod_freq</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">*</span> <span class="n">mod_index</span><span class="p">);</span> <span class="c1">// (Q16n16&gt;&gt;16)   Q8n8 = Q24n8, beware of overflow
</span>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span>
  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// change note
</span>  <span class="k">if</span><span class="p">(</span><span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">target_note</span><span class="o">==</span><span class="n">note0</span><span class="p">){</span>
      <span class="n">note1</span> <span class="o">+=</span> <span class="n">note_change_step</span><span class="p">;</span>
      <span class="n">target_note</span><span class="o">=</span><span class="n">note1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span> 
      <span class="n">note0</span> <span class="o">+=</span> <span class="n">note_change_step</span><span class="p">;</span>
      <span class="n">target_note</span><span class="o">=</span><span class="n">note0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// change direction
</span>    <span class="k">if</span><span class="p">(</span><span class="n">note0</span><span class="o">&gt;</span><span class="n">note_upper_limit</span><span class="p">)</span> <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">note0</span><span class="o">&lt;</span><span class="n">note_lower_limit</span><span class="p">)</span> <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    
    <span class="c1">// reset eventdelay
</span>    <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>
  
  <span class="c1">// vary the modulation index
</span>  <span class="n">mod_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">Q8n8</span><span class="p">)</span><span class="mi">350</span><span class="o">+</span><span class="n">kModIndex</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  
  <span class="c1">// here's where the smoothing happens
</span>  <span class="n">smoothed_note</span> <span class="o">=</span> <span class="n">kSmoothNote</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target_note</span><span class="p">);</span>
  <span class="n">setFreqs</span><span class="p">(</span><span class="n">smoothed_note</span><span class="p">);</span>

<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="n">Q15n16</span> <span class="n">modulation</span> <span class="o">=</span> <span class="n">deviation</span> <span class="o">*</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">(</span><span class="n">modulation</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>FMsynth_32k_HIFI</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/FMsynth_32k_HIFI/FMsynth_32k_HIFI.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/FMsynth_32k_HIFI/FMsynth_32k_HIFI.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="FMsynth_32k_HIFIexpand" onclick="javascript:toggleDisplay(FMsynth_32k_HIFI, FMsynth_32k_HIFIexpand, FMsynth_32k_HIFIcollapse)">show sketch</button>
<button id="FMsynth_32k_HIFIcollapse" style="display:none" onclick="javascript:toggleDisplay(FMsynth_32k_HIFI, FMsynth_32k_HIFIexpand, FMsynth_32k_HIFIcollapse)">hide sketch</button></p>
<div id="FMsynth_32k_HIFI" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of simple FM with the phase modulation technique,
    using Mozzi sonification library.
  
    Demonstrates Oscil::phMod() for phase modulation, 
    Smooth() for smoothing control signals, 
    and Mozzi's fixed point number types for fractional frequencies.
    
    This sketch using HIFI mode is not for Teensy 3.1.
    
    IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be
    be changed from STANDARD mode to HIFI.
    In Mozz/mozzi_config.h, change
    //#define AUDIO_MODE STANDARD
    #define AUDIO_MODE STANDARD_PLUS
    //#define AUDIO_MODE HIFI
    to
    //#define AUDIO_MODE STANDARD
    //#define AUDIO_MODE STANDARD_PLUS
    #define AUDIO_MODE HIFI
  
  The sketch also sounds better with a faster sample rate, for less aliasing
  #define AUDIO_RATE 32768
  in mozzi_config.
  
    Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),
    Check the Mozzi core module documentation for others and more detail
  
                     3.9k 
     pin 9  ---WWWW-----|-----output
                    499k           |
     pin 10 ---WWWW---- |
                                       |
                             4.7n  ==
                                       |
                                   ground
  
    Resistors are ±0.5%  Measure and choose the most precise 
    from a batch of whatever you can get.  Use two 1M resistors
    in parallel if you can't find 499k.
    Alternatively using 39 ohm, 4.99k and 470nF components will 
    work directly with headphones.
    
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012-13, CC by-nc-sa.
*/</span>

<span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/cos2048_int8.h&gt; // table for Oscils to play
#include &lt;mozzi_midi.h&gt;
#include &lt;mozzi_fixmath.h&gt;
#include &lt;EventDelay.h&gt;
#include &lt;Smooth.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 256 // powers of 2 please
</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModIndex</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>

<span class="c1">// The ratio of deviation to modulation frequency is called the "index of modulation". ( I = d / Fm )
// It will vary according to the frequency that is modulating the carrier and the amount of deviation.
// so deviation d = I   Fm
// haven't quite worked this out properly yet...
</span>
<span class="n">Q8n8</span> <span class="n">mod_index</span><span class="p">;</span><span class="c1">// = float_to_Q8n8(2.0f); // constant version
</span><span class="n">Q16n16</span> <span class="n">deviation</span><span class="p">;</span>

<span class="n">Q16n16</span> <span class="n">carrier_freq</span><span class="p">,</span> <span class="n">mod_freq</span><span class="p">;</span>

<span class="c1">// FM ratio between oscillator frequencies, stays the same through note range
</span><span class="n">Q8n8</span> <span class="n">mod_to_carrier_ratio</span> <span class="o">=</span> <span class="n">float_to_Q8n8</span><span class="p">(</span><span class="mf">3.</span><span class="n">f</span><span class="p">);</span>

<span class="n">EventDelay</span> <span class="n">kNoteChangeDelay</span><span class="p">;</span>

<span class="c1">// for note changes
</span><span class="n">Q7n8</span> <span class="n">target_note</span><span class="p">,</span> <span class="n">note0</span><span class="p">,</span> <span class="n">note1</span><span class="p">,</span> <span class="n">note_upper_limit</span><span class="p">,</span> <span class="n">note_lower_limit</span><span class="p">,</span> <span class="n">note_change_step</span><span class="p">,</span> <span class="n">smoothed_note</span><span class="p">;</span>

<span class="c1">// using Smooth on midi notes rather than frequency, 
// because fractional frequencies need larger types than Smooth can handle
// Inefficient, but...until there is a better Smooth....
</span><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothNote</span><span class="p">(</span><span class="mf">0.95</span><span class="n">f</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">768</span><span class="p">);</span> <span class="c1">// ms countdown, taylored to resolution of CONTROL_RATE
</span>  <span class="n">kModIndex</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.768</span><span class="n">f</span><span class="p">);</span> <span class="c1">// sync with kNoteChangeDelay
</span>  <span class="n">target_note</span> <span class="o">=</span> <span class="n">note0</span><span class="p">;</span>
  <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="n">note_upper_limit</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
  <span class="n">note_lower_limit</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
  <span class="n">note0</span> <span class="o">=</span> <span class="n">note_lower_limit</span><span class="p">;</span>
  <span class="n">note1</span> <span class="o">=</span> <span class="n">note_lower_limit</span> <span class="o">+</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">setFreqs</span><span class="p">(</span><span class="n">Q8n8</span> <span class="n">midi_note</span><span class="p">){</span>
  <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q8n8_to_Q16n16</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span> <span class="c1">// convert midi note to fractional frequency
</span>  <span class="n">mod_freq</span> <span class="o">=</span> <span class="p">((</span><span class="n">carrier_freq</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="n">mod_to_carrier_ratio</span><span class="p">)</span>  <span class="p">;</span> <span class="c1">// (Q16n16&gt;&gt;8)   Q8n8 = Q16n16, beware of overflow
</span>  <span class="n">deviation</span> <span class="o">=</span> <span class="p">((</span><span class="n">mod_freq</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">*</span> <span class="n">mod_index</span><span class="p">);</span> <span class="c1">// (Q16n16&gt;&gt;16)   Q8n8 = Q24n8, beware of overflow
</span>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span>
  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// change note
</span>  <span class="k">if</span><span class="p">(</span><span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">target_note</span><span class="o">==</span><span class="n">note0</span><span class="p">){</span>
      <span class="n">note1</span> <span class="o">+=</span> <span class="n">note_change_step</span><span class="p">;</span>
      <span class="n">target_note</span><span class="o">=</span><span class="n">note1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span> 
      <span class="n">note0</span> <span class="o">+=</span> <span class="n">note_change_step</span><span class="p">;</span>
      <span class="n">target_note</span><span class="o">=</span><span class="n">note0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// change direction
</span>    <span class="k">if</span><span class="p">(</span><span class="n">note0</span><span class="o">&gt;</span><span class="n">note_upper_limit</span><span class="p">)</span> <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">note0</span><span class="o">&lt;</span><span class="n">note_lower_limit</span><span class="p">)</span> <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    
    <span class="c1">// reset eventdelay
</span>    <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>
  
  <span class="c1">// vary the modulation index
</span>  <span class="n">mod_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">Q8n8</span><span class="p">)</span><span class="mi">350</span><span class="o">+</span><span class="n">kModIndex</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  
  <span class="c1">// here's where the smoothing happens
</span>  <span class="n">smoothed_note</span> <span class="o">=</span> <span class="n">kSmoothNote</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target_note</span><span class="p">);</span>
  <span class="n">setFreqs</span><span class="p">(</span><span class="n">smoothed_note</span><span class="p">);</span>

<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="n">Q15n16</span> <span class="n">modulation</span> <span class="o">=</span> <span class="n">deviation</span> <span class="o">*</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">(</span><span class="n">modulation</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="c1">// aCarrier is still only an 8 bit wave so shift up to 14 bits
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>PDresonant</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/PDresonant/PDresonant.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/PDresonant/PDresonant.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="PDresonantexpand" onclick="javascript:toggleDisplay(PDresonant, PDresonantexpand, PDresonantcollapse)">show sketch</button>
<button id="PDresonantcollapse" style="display:none" onclick="javascript:toggleDisplay(PDresonant, PDresonantexpand, PDresonantcollapse)">hide sketch</button></p>
<div id="PDresonant" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/* Phase distortion used to simulate resonant filter, based on
    https://en.wikipedia.org/wiki/Phase_distortion_synthesis
    
    Demonstrates PDResonant, a class which can be used as a
    simple midi instrument.  The class shows how the Mozzi Phasor class
    can be used to generate an index into a wavetable, and an ADSR
    is used to modulate the effect by modifying the Phasor frequency and sync.
    More complex phase distortion effects could be developed by using
    precalculated tables, or calcuating tables on the fly using a double buffer,
    or a line-breakpoint model, a sort of hybridPhasor-Line object.
    
    This version can only play a single voice at a time, it might 
    be possible to optimise it enough for more simultaneous voices.
    
    Circuit: 
      MIDI input circuit as per https://arduino.cc/en/Tutorial/Midi
      (midi has to be disconnected from rx for sketch to upload)
      Audio output on digital pin 9 on a Uno or similar.
    
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2013-14, CC by-nc-sa.
 */</span>



<span class="cp">#include &lt;MIDI.h&gt;
</span><span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
</span>
<span class="c1">// for fake midi
</span><span class="cp">#include &lt;EventDelay.h&gt;
#include &lt;mozzi_rand.h&gt;
</span>
<span class="cp">#include &lt;mozzi_midi.h&gt;
#include &lt;mozzi_analog.h&gt;
#include &lt;IntMap.h&gt;
</span>
<span class="cp">#include "PDResonant.h"
</span><span class="c1">// wavetable for oscillator:
</span><span class="cp">#include &lt;tables/sin2048_int8.h&gt;
</span>
<span class="c1">// MIDI_CREATE_DEFAULT_INSTANCE(); // if really using midi
</span>
<span class="c1">// analog joystick for controlling speed of modulation: assigned to attack, decay times and sustain level
</span><span class="cp">#define X A0
#define Y A1
</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x_axis</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span> <span class="c1">// give a static value for test without midi
</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">y_axis</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
<span class="k">const</span> <span class="n">IntMap</span> <span class="n">kmapX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1023</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span> <span class="c1">// A
</span><span class="k">const</span> <span class="n">IntMap</span> <span class="n">kmapY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1023</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3000</span><span class="p">);</span> <span class="c1">//D
</span>
<span class="n">PDResonant</span> <span class="n">voice</span><span class="p">;</span>

<span class="c1">// for fake midi
</span><span class="n">EventDelay</span> <span class="n">startNote</span><span class="p">;</span> 
<span class="n">EventDelay</span> <span class="n">endNote</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// fresh random for fake midi
</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span> <span class="c1">// for midi feedback
</span>  <span class="c1">// initialize midi channel:
</span>  <span class="c1">//MIDI.begin(MIDI_CHANNEL_OMNI);
</span>
  <span class="c1">//MIDI.setHandleNoteOn(HandleNoteOn);
</span>  <span class="c1">//MIDI.setHandleNoteOff(HandleNoteOff);
</span>
  <span class="c1">// open MOZZI (: 
</span>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>

<span class="p">}</span>


<span class="kt">void</span> <span class="n">HandleNoteOn</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">){</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">velocity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">voice</span><span class="p">.</span><span class="n">noteOn</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">velocity</span><span class="p">);</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">attack</span> <span class="o">=</span> <span class="n">kmapX</span><span class="p">(</span><span class="n">x_axis</span><span class="p">);</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">decay</span> <span class="o">=</span> <span class="n">kmapY</span><span class="p">(</span><span class="n">y_axis</span><span class="p">);</span>
    <span class="n">voice</span><span class="p">.</span><span class="n">setPDEnv</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span><span class="n">decay</span><span class="p">);</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="n">HIGH</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="n">stopNote</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span>  <span class="n">pitch</span><span class="p">,</span>  <span class="n">velocity</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">HandleNoteOff</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">){</span>
  <span class="n">stopNote</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span>  <span class="n">pitch</span><span class="p">,</span>  <span class="n">velocity</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">stopNote</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">){</span>
  <span class="n">voice</span><span class="p">.</span><span class="n">noteOff</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">velocity</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">fakeMidiRead</span><span class="p">(){</span>
  <span class="k">static</span> <span class="kt">char</span> <span class="n">curr_note</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">startNote</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="n">curr_note</span> <span class="o">=</span> <span class="mi">20</span><span class="o">+</span><span class="n">rand</span><span class="p">(</span><span class="mi">40</span><span class="p">);</span>
    <span class="n">HandleNoteOn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">curr_note</span><span class="p">,</span><span class="mi">127</span><span class="p">);</span>
    <span class="n">startNote</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
    <span class="n">startNote</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
    <span class="n">endNote</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
    <span class="n">endNote</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="n">endNote</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="n">HandleNoteOff</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">curr_note</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// check MIDI : 
</span>  <span class="c1">//MIDI.read();
</span>
  <span class="c1">// analog joystick for controlling speed of modulation: assigned to attack, decay times and sustain level
</span>  <span class="c1">//x_axis = mozziAnalogRead(X);
</span>  <span class="c1">//y_axis = mozziAnalogRead(Y);
</span>
  <span class="c1">// for testing/demo without external input
</span>  <span class="n">fakeMidiRead</span><span class="p">();</span>
  <span class="n">x_axis</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span> <span class="c1">//mozziAnalogRead(X);
</span>  <span class="n">y_axis</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span> <span class="c1">// mozziAnalogRead(Y);
</span>
  <span class="n">voice</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">voice</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>PWM_Phasing</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/PWM_Phasing/PWM_Phasing.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/PWM_Phasing/PWM_Phasing.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="PWM_Phasingexpand" onclick="javascript:toggleDisplay(PWM_Phasing, PWM_Phasingexpand, PWM_Phasingcollapse)">show sketch</button>
<button id="PWM_Phasingcollapse" style="display:none" onclick="javascript:toggleDisplay(PWM_Phasing, PWM_Phasingexpand, PWM_Phasingcollapse)">hide sketch</button></p>
<div id="PWM_Phasing" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of pulse width modulation,
    using Mozzi sonification library.
     
    Based Miller Puckette's j03.pulse.width.mod example 
    in the Pure Data documentation, subtracting 2 sawtooth 
    waves with slightly different tunings to produce a 
    varying phase difference.
  
    Demonstrates Phasor().
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Phasor.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 64 // powers of 2 please
</span>
<span class="n">Phasor</span> <span class="o">&lt;</span><span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aPhasor1</span><span class="p">;</span>
<span class="n">Phasor</span> <span class="o">&lt;</span><span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aPhasor2</span><span class="p">;</span>

<span class="kt">float</span> <span class="n">freq</span> <span class="o">=</span> <span class="mf">55.</span><span class="n">f</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">aPhasor1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
  <span class="n">aPhasor2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="mf">0.2</span><span class="n">f</span><span class="p">);</span>  
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// set a control rate of 64 (powers of 2 please)
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">char</span> <span class="n">asig1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)(</span><span class="n">aPhasor1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">24</span><span class="p">);</span>
  <span class="kt">char</span> <span class="n">asig2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)(</span><span class="n">aPhasor2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">24</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">asig1</span><span class="o">-</span><span class="n">asig2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>WavePacket_Double</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Double/WavePacket_Double.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Double/WavePacket_Double.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="WavePacket_Doubleexpand" onclick="javascript:toggleDisplay(WavePacket_Double, WavePacket_Doubleexpand, WavePacket_Doublecollapse)">show sketch</button>
<button id="WavePacket_Doublecollapse" style="display:none" onclick="javascript:toggleDisplay(WavePacket_Double, WavePacket_Doubleexpand, WavePacket_Doublecollapse)">hide sketch</button></p>
<div id="WavePacket_Double" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of Wavepacket synthesis, using Mozzi sonification library.
    This sketch draws on Miller Puckette's 
    Pure Data example, F14.wave.packet.pd, with
    two overlapping streams of wave packets.
  
    Circuit:
    	Audio output on DAC/A14 on Teensy 3.0, 3.1, 
    	or digital pin 9 on a Uno or similar, or 
    	check the README or https://sensorium.github.com/Mozzi/
    	
    	Potentiometer connected to analog pin 0.
      Center pin of the potentiometer goes to the analog pin.
      Side pins of the potentiometer go to +5V and ground

      Potentiometer connected to analog pin 1.
      Center pin of the potentiometer goes to the analog pin.
      Side pins of the potentiometer go to +5V and ground

      Potentiometer connected to analog pin 2.
      Center pin of the potentiometer goes to the analog pin.
      Side pins of the potentiometer go to +5V and ground
      
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2013, CC by-nc-sa.
*/</span>
 
<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;mozzi_analog.h&gt;
#include &lt;WavePacket.h&gt;
#include &lt;RollingAverage.h&gt;
</span> 
<span class="cp">#define FUNDAMENTAL_PIN 0
#define BANDWIDTH_PIN 1
#define CENTREFREQ_PIN 2
</span>
<span class="c1">// for smoothing the control signals
// use: RollingAverage &lt;number_type, how_many_to_average&gt; myThing
</span><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageF</span><span class="p">;</span>
<span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageBw</span><span class="p">;</span>
<span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageCf</span><span class="p">;</span>

<span class="n">WavePacket</span> <span class="o">&lt;</span><span class="n">DOUBLE</span><span class="o">&gt;</span> <span class="n">wavey</span><span class="p">;</span> <span class="c1">// DOUBLE selects 2 overlapping streams
</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="n">wavey</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">kAverageF</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">FUNDAMENTAL_PIN</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> 
    <span class="n">kAverageBw</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">BANDWIDTH_PIN</span><span class="p">)),</span> 
    <span class="n">kAverageCf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">CENTREFREQ_PIN</span><span class="p">)));</span>
<span class="p">}</span>



<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">wavey</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// &gt;&gt;8 for AUDIO_MODE STANDARD
</span><span class="p">}</span>



<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>WavePacket_Sample</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Sample/WavePacket_Sample.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Sample/WavePacket_Sample.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="WavePacket_Sampleexpand" onclick="javascript:toggleDisplay(WavePacket_Sample, WavePacket_Sampleexpand, WavePacket_Samplecollapse)">show sketch</button>
<button id="WavePacket_Samplecollapse" style="display:none" onclick="javascript:toggleDisplay(WavePacket_Sample, WavePacket_Sampleexpand, WavePacket_Samplecollapse)">hide sketch</button></p>
<div id="WavePacket_Sample" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of Wavepacket synthesis, using Mozzi sonification library.
    This sketch draws on Miller Puckette's 
    Pure Data example, F14.wave.packet.pd, with
    two overlapping streams of wave packets.
    
    Demonstrates the WavePacketSample object, which enables a
    custom sound table to be used as the audio source for wavepackets.
  
    Circuit:
    	Audio output on DAC/A14 on Teensy 3.0, 3.1, 
    	or digital pin 9 on a Uno or similar, or 
    	check the README or https://sensorium.github.com/Mozzi/
    	
    	Potentiometer connected to analog pin 0.
      Center pin of the potentiometer goes to the analog pin.
      Side pins of the potentiometer go to +5V and ground

      Potentiometer connected to analog pin 1.
      Center pin of the potentiometer goes to the analog pin.
      Side pins of the potentiometer go to +5V and ground

      Potentiometer connected to analog pin 2.
      Center pin of the potentiometer goes to the analog pin.
      Side pins of the potentiometer go to +5V and ground
      
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;mozzi_analog.h&gt;
#include &lt;WavePacketSample.h&gt;
#include &lt;RollingAverage.h&gt;
#include &lt;samples/raven_arh_int8.h&gt;
</span>
<span class="cp">#define FUNDAMENTAL_PIN 0
#define BANDWIDTH_PIN 1
#define CENTREFREQ_PIN 2
</span>
<span class="c1">// for smoothing the control signals
// use: RollingAverage &lt;number_type, how_many_to_average&gt; myThing
</span><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageF</span><span class="p">;</span>
<span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageBw</span><span class="p">;</span>
<span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageCf</span><span class="p">;</span>

<span class="n">WavePacketSample</span> <span class="o">&lt;</span><span class="n">DOUBLE</span><span class="o">&gt;</span> <span class="n">wavey</span><span class="p">;</span> <span class="c1">// DOUBLE selects 2 overlapping streams
</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">wavey</span><span class="p">.</span><span class="n">setTable</span><span class="p">(</span><span class="n">RAVEN_ARH_DATA</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="n">kAverageF</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">FUNDAMENTAL_PIN</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">kAverageBw</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">BANDWIDTH_PIN</span><span class="p">));</span>
  <span class="kt">int</span> <span class="n">cf</span> <span class="o">=</span> <span class="n">kAverageCf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">CENTREFREQ_PIN</span><span class="p">));</span>
  <span class="n">wavey</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">cf</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">wavey</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// &gt;&gt;8 for AUDIO_MODE STANDARD
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>WavePacket_Single</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Single/WavePacket_Single.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Single/WavePacket_Single.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="WavePacket_Singleexpand" onclick="javascript:toggleDisplay(WavePacket_Single, WavePacket_Singleexpand, WavePacket_Singlecollapse)">show sketch</button>
<button id="WavePacket_Singlecollapse" style="display:none" onclick="javascript:toggleDisplay(WavePacket_Single, WavePacket_Singleexpand, WavePacket_Singlecollapse)">hide sketch</button></p>
<div id="WavePacket_Single" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of Wavepacket synthesis, using Mozzi sonification library.
    This sketch draws on Miller Puckette's 
    Pure Data example, F14.wave.packet.pd, with
    one non-overlapping stream of wave packets.
  
    Circuit:
    	Audio output on DAC/A14 on Teensy 3.0, 3.1, 
    	or digital pin 9 on a Uno or similar, or 
    	check the README or https://sensorium.github.com/Mozzi/
    	
    	Potentiometer connected to analog pin 0.
      Center pin of the potentiometer goes to the analog pin.
      Side pins of the potentiometer go to +5V and ground

      Potentiometer connected to analog pin 1.
      Center pin of the potentiometer goes to the analog pin.
      Side pins of the potentiometer go to +5V and ground

      Potentiometer connected to analog pin 2.
      Center pin of the potentiometer goes to the analog pin.
      Side pins of the potentiometer go to +5V and ground
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2013, CC by-nc-sa.
*/</span>
 
<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;mozzi_analog.h&gt;
#include &lt;WavePacket.h&gt;
#include &lt;RollingAverage.h&gt;
</span> 
<span class="cp">#define FUNDAMENTAL_PIN 0
#define BANDWIDTH_PIN 1
#define CENTREFREQ_PIN 2
</span>
<span class="c1">// for smoothing the control signals
// use: RollingAverage &lt;number_type, how_many_to_average&gt; myThing
</span><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageF</span><span class="p">;</span>
<span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageBw</span><span class="p">;</span>
<span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageCf</span><span class="p">;</span>

<span class="n">WavePacket</span> <span class="o">&lt;</span><span class="n">SINGLE</span><span class="o">&gt;</span> <span class="n">wavey</span><span class="p">;</span> <span class="c1">// SINGLE selects 1 non-overlapping stream
</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="n">wavey</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">kAverageF</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">FUNDAMENTAL_PIN</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> 
    <span class="n">kAverageBw</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">BANDWIDTH_PIN</span><span class="p">)),</span> 
    <span class="n">kAverageCf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">CENTREFREQ_PIN</span><span class="p">)));</span>
<span class="p">}</span>



<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">wavey</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// &gt;&gt;8 for AUDIO_MODE STANDARD
</span><span class="p">}</span>



<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Waveshaper</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Waveshaper/Waveshaper.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Waveshaper/Waveshaper.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Waveshaperexpand" onclick="javascript:toggleDisplay(Waveshaper, Waveshaperexpand, Waveshapercollapse)">show sketch</button>
<button id="Waveshapercollapse" style="display:none" onclick="javascript:toggleDisplay(Waveshaper, Waveshaperexpand, Waveshapercollapse)">hide sketch</button></p>
<div id="Waveshaper" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example using waveshaping to modify the spectrum of an audio signal
    using Mozzi sonification library.
  
    Demonstrates the use of WaveShaper(), EventDelay(), Smooth(),
    rand(), and fixed-point numbers.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;WaveShaper.h&gt;
#include &lt;EventDelay.h&gt;
#include &lt;mozzi_rand.h&gt;
#include &lt;mozzi_midi.h&gt;
#include &lt;Smooth.h&gt;
#include &lt;tables/sin2048_int8.h&gt;
#include &lt;tables/waveshape_chebyshev_3rd_256_int8.h&gt;
#include &lt;tables/waveshape_chebyshev_6th_256_int8.h&gt;
#include &lt;tables/waveshape_compress_512_to_488_int16.h&gt;
</span>

<span class="c1">// use #define for CONTROL_RATE, not a constant
</span><span class="cp">#define CONTROL_RATE 64 // powers of 2 please
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// sine wave sound source
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aGain1</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// to fade sine wave in and out before waveshaping
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aGain2</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// to fade sine wave in and out before waveshaping
</span>
<span class="c1">// Chebyshev polynomial curves, The nth curve produces the n+2th harmonic component.
</span><span class="n">WaveShaper</span> <span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">aCheby3rd</span><span class="p">(</span><span class="n">CHEBYSHEV_3RD_256_DATA</span><span class="p">);</span> <span class="c1">// 5th harmonic
</span><span class="n">WaveShaper</span> <span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">aCheby6th</span><span class="p">(</span><span class="n">CHEBYSHEV_6TH_256_DATA</span><span class="p">);</span> <span class="c1">// 8th harmonic
</span><span class="n">WaveShaper</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">aCompress</span><span class="p">(</span><span class="n">WAVESHAPE_COMPRESS_512_TO_488_DATA</span><span class="p">);</span> <span class="c1">// to compress instead of dividing by 2 after adding signals
</span>
<span class="c1">// for scheduling note changes
</span><span class="n">EventDelay</span> <span class="n">kChangeNoteDelay</span><span class="p">;</span>

<span class="c1">// for random notes
</span><span class="n">Q8n0</span> <span class="n">octave_start_note</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="n">Q24n8</span> <span class="n">carrier_freq</span><span class="p">;</span> <span class="c1">// unsigned long with 24 integer bits and 8 fractional bits
</span>
<span class="c1">// smooth transitions between notes
</span><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothFreq</span><span class="p">(</span><span class="mf">0.85</span><span class="n">f</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">target_freq</span><span class="p">,</span> <span class="n">smoothed_freq</span><span class="p">;</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// set a control rate of 64 (powers of 2 please)
</span>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// reseed the random generator for different results each time the sketch runs
</span>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">110</span><span class="p">);</span> <span class="c1">// set the frequency
</span>  <span class="n">aGain1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.</span><span class="n">f</span><span class="p">);</span> <span class="c1">// use a float for low frequencies, in setup it doesn't need to be fast
</span>  <span class="n">aGain2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.4</span><span class="n">f</span><span class="p">);</span>
  <span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">4000</span><span class="p">);</span> <span class="c1">// note duration ms, within resolution of CONTROL_RATE
</span><span class="p">}</span>

<span class="n">byte</span> <span class="n">rndPentatonic</span><span class="p">(){</span>
  <span class="n">byte</span> <span class="n">note</span> <span class="o">=</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">);</span>
  <span class="k">switch</span><span class="p">(</span><span class="n">note</span><span class="p">){</span>
  <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">note</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">note</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">note</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">note</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="mi">4</span><span class="p">:</span>
    <span class="n">note</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">note</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span> <span class="c1">// about 1 in 5 or so
</span>      <span class="c1">// change octave to midi 24 or any of 3 octaves above
</span>      <span class="n">octave_start_note</span> <span class="o">=</span> <span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span><span class="o">+</span><span class="mi">36</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Q16n16</span> <span class="n">midi_note</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="n">octave_start_note</span><span class="o">+</span><span class="n">rndPentatonic</span><span class="p">());</span>
    <span class="n">target_freq</span> <span class="o">=</span> <span class="n">Q16n16_to_Q16n0</span><span class="p">(</span><span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span> <span class="c1">// has to be 16 bits for Smooth
</span>    <span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">smoothed_freq</span> <span class="o">=</span> <span class="n">kSmoothFreq</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target_freq</span><span class="o">*</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// temporarily scale up target_freq to get better int smoothing at low values
</span>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">smoothed_freq</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// then scale it back down after it's smoothed
</span><span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">char</span> <span class="n">asig0</span> <span class="o">=</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// sine wave source
</span>  <span class="c1">// make 2 signals fading in and out to show effect of amplitude when waveshaping with Chebyshev polynomial curves
</span>  <span class="c1">// offset the signals by 128 to fit in the 0-255 range for the waveshaping table lookups
</span>  <span class="n">byte</span> <span class="n">asig1</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span><span class="p">((</span><span class="n">asig0</span><span class="o">*</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span><span class="n">aGain1</span><span class="p">.</span><span class="n">next</span><span class="p">()))</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">);</span>
  <span class="n">byte</span> <span class="n">asig2</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span><span class="p">((</span><span class="n">asig0</span><span class="o">*</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span><span class="n">aGain2</span><span class="p">.</span><span class="n">next</span><span class="p">()))</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">);</span>
  <span class="c1">// get the waveshaped signals
</span>  <span class="kt">char</span> <span class="n">awaveshaped1</span> <span class="o">=</span> <span class="n">aCheby3rd</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig1</span><span class="p">);</span>
  <span class="kt">char</span> <span class="n">awaveshaped2</span> <span class="o">=</span> <span class="n">aCheby6th</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig2</span><span class="p">);</span>
  <span class="c1">// use a waveshaping table to squeeze 2 summed 8 bit signals into the range -244 to 243
</span>  <span class="kt">int</span> <span class="n">awaveshaped3</span> <span class="o">=</span> <span class="n">aCompress</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="mi">256u</span> <span class="o">+</span> <span class="n">awaveshaped1</span> <span class="o">+</span> <span class="n">awaveshaped2</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">awaveshaped3</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Waveshaper_Difference_Tone</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Waveshaper_Difference_Tone/Waveshaper_Difference_Tone.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Waveshaper_Difference_Tone/Waveshaper_Difference_Tone.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Waveshaper_Difference_Toneexpand" onclick="javascript:toggleDisplay(Waveshaper_Difference_Tone, Waveshaper_Difference_Toneexpand, Waveshaper_Difference_Tonecollapse)">show sketch</button>
<button id="Waveshaper_Difference_Tonecollapse" style="display:none" onclick="javascript:toggleDisplay(Waveshaper_Difference_Tone, Waveshaper_Difference_Toneexpand, Waveshaper_Difference_Tonecollapse)">hide sketch</button></p>
<div id="Waveshaper_Difference_Tone" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example using waveshaping to modify the spectrum of an audio signal
    using Mozzi sonification library.
  
    Demonstrates the use of WaveShaper(), EventDelay(), Smooth(),
    rand(), and fixed-point numbers.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;WaveShaper.h&gt;
#include &lt;EventDelay.h&gt;
#include &lt;mozzi_rand.h&gt;
#include &lt;mozzi_midi.h&gt;
#include &lt;Smooth.h&gt;
#include &lt;tables/sin2048_int8.h&gt;
</span>

<span class="c1">// use #define for CONTROL_RATE, not a constant
</span><span class="cp">#define CONTROL_RATE 64 // powers of 2 please
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin1</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// sine wave sound source
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin2</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// sine wave sound source
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aGain</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// to fade audio signal in and out before waveshaping
</span>
<span class="c1">// for scheduling note changes
</span><span class="n">EventDelay</span> <span class="n">kChangeNoteDelay</span><span class="p">;</span>

<span class="c1">// audio frequency as Q16n16 fractional number
</span><span class="n">Q16n16</span> <span class="n">freq1</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span> 

<span class="c1">// smooth transitions between notes
</span><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothFreq</span><span class="p">(</span><span class="mf">0.85</span><span class="n">f</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">target_freq</span><span class="p">,</span> <span class="n">smoothed_freq</span><span class="p">;</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// set a control rate of 64 (powers of 2 please)
</span>  <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">freq1</span><span class="p">);</span> <span class="c1">// set the frequency with a Q16n16 fractional number
</span>  <span class="n">aGain</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.2</span><span class="n">f</span><span class="p">);</span> <span class="c1">// use a float for low frequencies, in setup it doesn't need to be fast
</span>  <span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span> <span class="c1">// note duration ms, within resolution of CONTROL_RATE
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="c1">// change proportional frequency of second tone
</span>    <span class="n">byte</span> <span class="n">harmonic</span> <span class="o">=</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">12</span><span class="p">);</span>
    <span class="n">byte</span> <span class="n">shimmer</span> <span class="o">=</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">255</span><span class="p">);</span>
    <span class="n">Q16n16</span> <span class="n">harmonic_step</span> <span class="o">=</span> <span class="n">freq1</span><span class="o">/</span><span class="mi">12</span><span class="p">;</span>
    <span class="n">Q16n16</span> <span class="n">freq2difference</span> <span class="o">=</span> <span class="n">harmonic</span><span class="o">*</span><span class="n">harmonic_step</span><span class="p">;</span>
    <span class="n">freq2difference</span> <span class="o">+=</span> <span class="p">(</span><span class="n">harmonic_step</span><span class="o">*</span><span class="n">shimmer</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">11</span><span class="p">;</span>
    <span class="n">Q16n16</span> <span class="n">freq2</span> <span class="o">=</span> <span class="n">freq1</span><span class="o">-</span><span class="n">freq2difference</span><span class="p">;</span>
    <span class="n">aSin2</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">freq2</span><span class="p">);</span> <span class="c1">// set the frequency with a Q16n16 fractional number
</span>    <span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">aSin1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span> <span class="n">aSin2</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">*</span><span class="p">(</span><span class="mi">200u</span><span class="o">+</span><span class="n">aGain</span><span class="p">.</span><span class="n">next</span><span class="p">()))</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">clipped</span> <span class="o">=</span> <span class="n">constrain</span><span class="p">(</span><span class="n">asig</span><span class="p">,</span><span class="o">-</span><span class="mi">244</span><span class="p">,</span><span class="mi">243</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">clipped</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<h2 id="07.Envelopes"> 07.Envelopes </h2>
<p>ADSR_Audio_Rate_Envelope</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/ADSR_Audio_Rate_Envelope/ADSR_Audio_Rate_Envelope.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/ADSR_Audio_Rate_Envelope/ADSR_Audio_Rate_Envelope.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="ADSR_Audio_Rate_Envelopeexpand" onclick="javascript:toggleDisplay(ADSR_Audio_Rate_Envelope, ADSR_Audio_Rate_Envelopeexpand, ADSR_Audio_Rate_Envelopecollapse)">show sketch</button>
<button id="ADSR_Audio_Rate_Envelopecollapse" style="display:none" onclick="javascript:toggleDisplay(ADSR_Audio_Rate_Envelope, ADSR_Audio_Rate_Envelopeexpand, ADSR_Audio_Rate_Envelopecollapse)">hide sketch</button></p>
<div id="ADSR_Audio_Rate_Envelope" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example applying an ADSR envelope to an audio signal
    with Mozzi sonification library.  This shows 
    internal updates at CONTROL_RATE, using update() in updateControl(),
    with interpolation and output using next() at AUDIO_RATE in updateAudio().
    This is the "ordinary" way to use ADSR for smooth amplitude transitions while
    maintaining reasonable efficiency by updating internal states in updateControl().
    
    Demonstrates a simple ADSR object being controlled with
    noteOn() and noteOff() instructions.
  
    Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;EventDelay.h&gt;
#include &lt;ADSR.h&gt;
#include &lt;tables/sin8192_int8.h&gt; 
#include &lt;mozzi_rand.h&gt;
#include &lt;mozzi_midi.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 64
</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="mi">8192</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aOscil</span><span class="p">(</span><span class="n">SIN8192_DATA</span><span class="p">);;</span> 

<span class="c1">// for triggering the envelope
</span><span class="n">EventDelay</span> <span class="n">noteDelay</span><span class="p">;</span>

<span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">envelope</span><span class="p">;</span>

<span class="n">boolean</span> <span class="n">note_is_on</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// fresh random
</span>  <span class="n">noteDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span> <span class="c1">// 2 second countdown
</span>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">duration</span><span class="p">,</span> <span class="n">attack</span><span class="p">,</span> <span class="n">decay</span><span class="p">,</span> <span class="n">sustain</span><span class="p">,</span> <span class="n">release_ms</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">noteDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    
      <span class="c1">// choose envelope levels
</span>      <span class="n">byte</span> <span class="n">attack_level</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="o">+</span><span class="mi">127</span><span class="p">;</span>
      <span class="n">byte</span> <span class="n">decay_level</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
      <span class="n">envelope</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="n">attack_level</span><span class="p">,</span><span class="n">decay_level</span><span class="p">);</span>

    <span class="c1">// generate a random new adsr time parameter value in milliseconds
</span>     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">new_value</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span> <span class="o">+</span><span class="mi">100</span><span class="p">;</span>
     <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">new_value</span><span class="p">);</span>
     <span class="c1">// randomly choose one of the adsr parameters and set the new value
</span>     <span class="k">switch</span> <span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">)){</span>
       <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
       <span class="n">attack</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
       <span class="k">break</span><span class="p">;</span>
       
       <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
       <span class="n">decay</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
       <span class="k">break</span><span class="p">;</span>
       
       <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
       <span class="n">sustain</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
       <span class="k">break</span><span class="p">;</span>
       
       <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
       <span class="n">release_ms</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
       <span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="n">envelope</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span><span class="n">decay</span><span class="p">,</span><span class="n">sustain</span><span class="p">,</span><span class="n">release_ms</span><span class="p">);</span>    
     <span class="n">envelope</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>

     <span class="n">byte</span> <span class="n">midi_note</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">107</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">;</span>
     <span class="n">aOscil</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">mtof</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span>
    
<span class="cm">/*
     // print to screen
     Serial.print("midi_note\t"); Serial.println(midi_note);
     Serial.print("attack_level\t"); Serial.println(attack_level);
     Serial.print("decay_level\t"); Serial.println(decay_level);
     Serial.print("attack\t\t"); Serial.println(attack);
     Serial.print("decay\t\t"); Serial.println(decay);
     Serial.print("sustain\t\t"); Serial.println(sustain);
     Serial.print("release\t\t"); Serial.println(release_ms);
     Serial.println();
*/</span>
     <span class="n">noteDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">attack</span><span class="o">+</span><span class="n">decay</span><span class="o">+</span><span class="n">sustain</span><span class="o">+</span><span class="n">release_ms</span><span class="p">);</span>
     
   <span class="p">}</span>
  <span class="n">envelope</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
<span class="p">}</span> 


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">envelope</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aOscil</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>ADSR_Audio_Rate_Envelope_x2</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/ADSR_Audio_Rate_Envelope_x2/ADSR_Audio_Rate_Envelope_x2.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/ADSR_Audio_Rate_Envelope_x2/ADSR_Audio_Rate_Envelope_x2.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="ADSR_Audio_Rate_Envelope_x2expand" onclick="javascript:toggleDisplay(ADSR_Audio_Rate_Envelope_x2, ADSR_Audio_Rate_Envelope_x2expand, ADSR_Audio_Rate_Envelope_x2collapse)">show sketch</button>
<button id="ADSR_Audio_Rate_Envelope_x2collapse" style="display:none" onclick="javascript:toggleDisplay(ADSR_Audio_Rate_Envelope_x2, ADSR_Audio_Rate_Envelope_x2expand, ADSR_Audio_Rate_Envelope_x2collapse)">hide sketch</button></p>
<div id="ADSR_Audio_Rate_Envelope_x2" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example applying ADSR envelopes to 2 audio oscillators
     with Mozzi sonification library.

     Demonstrates ADSR, EventDelay and rand().

     Tim Barrass 2013, CC by-nc-sa.
 */</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;EventDelay.h&gt;
#include &lt;ADSR.h&gt;
#include &lt;tables/sin8192_int8.h&gt; 
#include &lt;mozzi_rand.h&gt;
#include &lt;mozzi_midi.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 64
</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="mi">8192</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aOscil0</span><span class="p">(</span><span class="n">SIN8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="mi">8192</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aOscil1</span><span class="p">(</span><span class="n">SIN8192_DATA</span><span class="p">);</span>

<span class="c1">// for triggering the envelope
</span><span class="n">EventDelay</span> <span class="n">noteDelay</span><span class="p">;</span>

<span class="c1">// ADSR update_rate, interpolation_rte
</span><span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="p">,</span><span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">envelope0</span><span class="p">;</span>
<span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="p">,</span><span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">envelope1</span><span class="p">;</span>

<span class="n">boolean</span> <span class="n">note_is_on</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="c1">//Serial.begin(115200);
</span>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// fresh random
</span>  <span class="n">envelope0</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span><span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span><span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span><span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">));</span>  
  <span class="n">envelope1</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span><span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span><span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span><span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">));</span>  
  <span class="n">noteDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span> <span class="c1">// 2 second countdown
</span>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">attack0</span><span class="p">,</span> <span class="n">decay0</span><span class="p">,</span> <span class="n">sustain0</span><span class="p">,</span> <span class="n">release_ms0</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">attack1</span><span class="p">,</span> <span class="n">decay1</span><span class="p">,</span> <span class="n">sustain1</span><span class="p">,</span> <span class="n">release_ms1</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">noteDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>

    <span class="c1">// change adsr 0
</span>
    <span class="c1">// choose envelope levels
</span>    <span class="n">byte</span> <span class="n">attack0_level</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="o">+</span><span class="mi">127</span><span class="p">;</span>
    <span class="n">byte</span> <span class="n">decay0_level</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
    <span class="n">envelope0</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="n">attack0_level</span><span class="p">,</span><span class="n">decay0_level</span><span class="p">);</span>

    <span class="c1">// generate a random new adsr time parameter value in milliseconds
</span>     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">new_value</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span> <span class="o">+</span><span class="mi">100</span><span class="p">;</span>

    <span class="c1">// randomly choose one of the adsr parameters and set the new value
</span>    <span class="k">switch</span> <span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">)){</span>
    <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">attack0</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">decay0</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">sustain0</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
      <span class="n">release_ms0</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">envelope0</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="n">attack0</span><span class="p">,</span><span class="n">decay0</span><span class="p">,</span><span class="n">sustain0</span><span class="p">,</span><span class="n">release_ms0</span><span class="p">);</span>    
    <span class="n">envelope0</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>



    <span class="c1">// change adsr 1 
</span>
    <span class="c1">// choose envelope levels
</span>    <span class="n">byte</span> <span class="n">attack1_level</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="o">+</span><span class="mi">127</span><span class="p">;</span>
    <span class="n">byte</span> <span class="n">decay1_level</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
    <span class="n">envelope1</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="n">attack1_level</span><span class="p">,</span><span class="n">decay1_level</span><span class="p">);</span>

    <span class="c1">// generate a random new adsr time parameter value in milliseconds
</span>     <span class="n">new_value</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span> <span class="o">+</span><span class="mi">100</span><span class="p">;</span>

    <span class="c1">// randomly choose one of the adsr parameters and set the new value
</span>    <span class="k">switch</span> <span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">)){</span>
    <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">attack1</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">decay1</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">sustain1</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
      <span class="n">release_ms1</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">envelope1</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="n">attack1</span><span class="p">,</span><span class="n">decay1</span><span class="p">,</span><span class="n">sustain1</span><span class="p">,</span><span class="n">release_ms1</span><span class="p">);</span>    
    <span class="n">envelope1</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>

    <span class="c1">// change the pitch
</span>    <span class="n">byte</span> <span class="n">midi_note</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">107</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">freq</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">mtof</span><span class="p">(</span><span class="n">midi_note</span><span class="p">);</span>
    <span class="n">aOscil0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
    <span class="n">aOscil1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="mi">2</span><span class="p">);</span>   

<span class="cm">/*
    // print to screen
    Serial.print("midi_note\t"); 
    Serial.println(midi_note);
    Serial.print("attack0_level\t"); 
    Serial.print(attack0_level);
    Serial.print("\t attack1_level\t"); 
    Serial.println(attack1_level);
    Serial.print("decay0_level\t"); 
    Serial.print(decay0_level);
    Serial.print("\t decay1_level\t"); 
    Serial.println(decay1_level);
    Serial.print("attack0\t\t"); 
    Serial.print(attack0);
    Serial.print("\t attack1\t"); 
    Serial.println(attack1);
    Serial.print("decay0\t\t"); 
    Serial.print(decay0);
    Serial.print("\t decay1\t\t"); 
    Serial.println(decay1);
    Serial.print("sustain0\t"); 
    Serial.print(sustain0);
    Serial.print("\t sustain1\t"); 
    Serial.println(sustain1);
    Serial.print("release0\t"); 
    Serial.print(release_ms0);
    Serial.print("\t release1\t"); 
    Serial.println(release_ms1);
    Serial.println();
*/</span>

    <span class="c1">// set duration to longest adsr of the 2
</span>    <span class="kt">int</span> <span class="n">dur0</span> <span class="o">=</span> <span class="n">attack0</span><span class="o">+</span><span class="n">decay0</span><span class="o">+</span><span class="n">sustain0</span><span class="o">+</span><span class="n">release_ms0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">dur1</span> <span class="o">=</span> <span class="n">attack1</span><span class="o">+</span><span class="n">decay1</span><span class="o">+</span><span class="n">sustain1</span><span class="o">+</span><span class="n">release_ms1</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">dur0</span><span class="o">&gt;</span><span class="n">dur1</span><span class="p">){</span>
      <span class="n">noteDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">dur0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
      <span class="n">noteDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">dur1</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="p">}</span>
  <span class="n">envelope0</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
  <span class="n">envelope1</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
<span class="p">}</span> 


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">envelope0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aOscil0</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="o">+</span>
    <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">envelope1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aOscil1</span><span class="p">.</span><span class="n">next</span><span class="p">())</span>
    <span class="o">&gt;&gt;</span><span class="mi">9</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>ADSR_Control_Rate_Envelope</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/ADSR_Control_Rate_Envelope/ADSR_Control_Rate_Envelope.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/ADSR_Control_Rate_Envelope/ADSR_Control_Rate_Envelope.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="ADSR_Control_Rate_Envelopeexpand" onclick="javascript:toggleDisplay(ADSR_Control_Rate_Envelope, ADSR_Control_Rate_Envelopeexpand, ADSR_Control_Rate_Envelopecollapse)">show sketch</button>
<button id="ADSR_Control_Rate_Envelopecollapse" style="display:none" onclick="javascript:toggleDisplay(ADSR_Control_Rate_Envelope, ADSR_Control_Rate_Envelopeexpand, ADSR_Control_Rate_Envelopecollapse)">hide sketch</button></p>
<div id="ADSR_Control_Rate_Envelope" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example applying an ADSR envelope to an audio signal
    with Mozzi sonification library.  This shows 
    internal updates as well as interpolation at CONTROL_RATE, using both
    update() and next()  in updateControl().
    This is less computationally intensive than doing interpolation with
    next() in updateAudio(), but can be less smooth, especially with fast envelopes.
    
    Demonstrates a simple ADSR object being controlled with
    noteOn() and noteOff() instructions.
  
    Tim Barrass 2013-14, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;EventDelay.h&gt;
#include &lt;ADSR.h&gt;
#include &lt;tables/sin8192_int8.h&gt; 
#include &lt;mozzi_rand.h&gt;
#include &lt;mozzi_midi.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 128 // faster than usual to help smooth CONTROL_RATE adsr interpolation (next())
</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="mi">8192</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aOscil</span><span class="p">(</span><span class="n">SIN8192_DATA</span><span class="p">);;</span> 

<span class="c1">// for triggering the envelope
</span><span class="n">EventDelay</span> <span class="n">noteDelay</span><span class="p">;</span>

<span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">envelope</span><span class="p">;</span>

<span class="n">boolean</span> <span class="n">note_is_on</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="n">byte</span> <span class="n">gain</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// fresh random
</span>  <span class="n">noteDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span> <span class="c1">// 2 second countdown
</span>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">duration</span><span class="p">,</span> <span class="n">attack</span><span class="p">,</span> <span class="n">decay</span><span class="p">,</span> <span class="n">sustain</span><span class="p">,</span> <span class="n">release_ms</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">noteDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    
      <span class="c1">// choose envelope levels
</span>      <span class="n">byte</span> <span class="n">attack_level</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="o">+</span><span class="mi">127</span><span class="p">;</span>
      <span class="n">byte</span> <span class="n">decay_level</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
      <span class="n">envelope</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="n">attack_level</span><span class="p">,</span><span class="n">decay_level</span><span class="p">);</span>

      <span class="c1">// generate a random new adsr parameter value in milliseconds
</span>      <span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="o">-</span><span class="n">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">new_value</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
      
     <span class="c1">// randomly choose one of the adsr parameters and set the new value
</span>     <span class="k">switch</span> <span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">)){</span>
       <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
       <span class="n">attack</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
       <span class="k">break</span><span class="p">;</span>
       
       <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
       <span class="n">decay</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
       <span class="k">break</span><span class="p">;</span>
       
       <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
       <span class="n">sustain</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
       <span class="k">break</span><span class="p">;</span>
       
       <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
       <span class="n">release_ms</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
       <span class="k">break</span><span class="p">;</span>
     <span class="p">}</span>
     <span class="n">envelope</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span><span class="n">decay</span><span class="p">,</span><span class="n">sustain</span><span class="p">,</span><span class="n">release_ms</span><span class="p">);</span>    
     <span class="n">envelope</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>

     <span class="n">byte</span> <span class="n">midi_note</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">107</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">;</span>
     <span class="n">aOscil</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">mtof</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span>
    

     <span class="c1">// print to screen
</span>     <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"midi_note</span><span class="se">\t</span><span class="s">"</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">midi_note</span><span class="p">);</span>
     <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"attack_level</span><span class="se">\t</span><span class="s">"</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">attack_level</span><span class="p">);</span>
     <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"decay_level</span><span class="se">\t</span><span class="s">"</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">decay_level</span><span class="p">);</span>
     <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"attack</span><span class="se">\t\t</span><span class="s">"</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">attack</span><span class="p">);</span>
     <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"decay</span><span class="se">\t\t</span><span class="s">"</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">decay</span><span class="p">);</span>
     <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"sustain</span><span class="se">\t\t</span><span class="s">"</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">sustain</span><span class="p">);</span>
     <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"release</span><span class="se">\t\t</span><span class="s">"</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">release_ms</span><span class="p">);</span>
     <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>

     <span class="n">noteDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">attack</span><span class="o">+</span><span class="n">decay</span><span class="o">+</span><span class="n">sustain</span><span class="o">+</span><span class="n">release_ms</span><span class="p">);</span>
     
   <span class="p">}</span>
  <span class="n">envelope</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
  <span class="n">gain</span> <span class="o">=</span> <span class="n">envelope</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// this is where it's different to an audio rate envelope
</span><span class="p">}</span> 


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">gain</span> <span class="o">*</span> <span class="n">aOscil</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Ead_Envelope</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/Ead_Envelope/Ead_Envelope.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/Ead_Envelope/Ead_Envelope.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Ead_Envelopeexpand" onclick="javascript:toggleDisplay(Ead_Envelope, Ead_Envelopeexpand, Ead_Envelopecollapse)">show sketch</button>
<button id="Ead_Envelopecollapse" style="display:none" onclick="javascript:toggleDisplay(Ead_Envelope, Ead_Envelopeexpand, Ead_Envelopecollapse)">hide sketch</button></p>
<div id="Ead_Envelope" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example playing an enveloped noise source
		using Mozzi sonification library.
	
		Demonstrates Ead (exponential attack decay).
	
		Circuit: Audio output on digital pin 9 on a Uno or similar, or
		DAC/A14 on Teensy 3.1, or 
		check the README or https://sensorium.github.com/Mozzi/
	
		Mozzi help/discussion/announcements:
		https://groups.google.com/forum/#!forum/mozzi-users
	
		Tim Barrass 2012, CC by-nc-sa
 */</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/brownnoise8192_int8.h&gt; // recorded audio wavetable
#include &lt;Ead.h&gt; // exponential attack decay
#include &lt;EventDelay.h&gt;
#include &lt;mozzi_rand.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 256 // powers of 2 please
</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">BROWNNOISE8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aNoise</span><span class="p">(</span><span class="n">BROWNNOISE8192_DATA</span><span class="p">);</span>
<span class="n">EventDelay</span> <span class="n">kDelay</span><span class="p">;</span> <span class="c1">// for triggering envelope start
</span><span class="n">Ead</span> <span class="n">kEnvelope</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// resolution will be CONTROL_RATE
</span>
<span class="kt">int</span> <span class="n">gain</span><span class="p">;</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">// use float to set freq because it will be small and fractional
</span>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">AUDIO_RATE</span><span class="o">/</span><span class="n">BROWNNOISE8192_SAMPLERATE</span><span class="p">);</span>
  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// fresh random, MUST be called before startMozzi - wierd bug
</span>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
  <span class="n">kDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// jump around in audio noise table to disrupt obvious looping
</span>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setPhase</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">BROWNNOISE8192_NUM_CELLS</span><span class="p">));</span>

  <span class="k">if</span><span class="p">(</span><span class="n">kDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="c1">// set random parameters
</span>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">500u</span><span class="p">)</span><span class="o">+</span><span class="mi">200</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">attack</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">75</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">;</span> <span class="c1">// +5 so the internal step size is more likely to be &gt;0
</span>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">decay</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">-</span> <span class="n">attack</span><span class="p">;</span>
    <span class="n">kEnvelope</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span><span class="n">decay</span><span class="p">);</span>
    <span class="n">kDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">duration</span><span class="o">+</span><span class="mi">500</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">gain</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">kEnvelope</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">gain</span><span class="o">*</span><span class="n">aNoise</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Phasemod_Envelope</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/Phasemod_Envelope/Phasemod_Envelope.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/Phasemod_Envelope/Phasemod_Envelope.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Phasemod_Envelopeexpand" onclick="javascript:toggleDisplay(Phasemod_Envelope, Phasemod_Envelopeexpand, Phasemod_Envelopecollapse)">show sketch</button>
<button id="Phasemod_Envelopecollapse" style="display:none" onclick="javascript:toggleDisplay(Phasemod_Envelope, Phasemod_Envelopeexpand, Phasemod_Envelopecollapse)">hide sketch</button></p>
<div id="Phasemod_Envelope" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of a modulating timbre with a rhythmic
    volume envelope, using Mozzi sonification library.
  
  
    Demonstrates phase modulation and modifying
    the volume of a sound with an envelope setd in a table.
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/cos8192_int8.h&gt;
#include &lt;tables/envelop2048_uint8.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 512 // quite fast, keeps modulation smooth
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModWidth</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModFreq1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModFreq2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">ENVELOP2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aEnvelop</span><span class="p">(</span><span class="n">ENVELOP2048_DATA</span><span class="p">);</span>


<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">220</span><span class="p">);</span>
  <span class="n">kModFreq1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.78</span><span class="n">f</span><span class="p">);</span>
  <span class="n">kModFreq2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.1757</span><span class="n">f</span><span class="p">);</span>
  <span class="n">aModWidth</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.1434</span><span class="n">f</span><span class="p">);</span>
  <span class="n">aEnvelop</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">9.0</span><span class="n">f</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">updateControl</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">277.0</span><span class="n">f</span> <span class="o">+</span> <span class="mf">0.4313</span><span class="n">f</span><span class="o">*</span><span class="n">kModFreq1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">kModFreq2</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mi">260u</span><span class="o">+</span><span class="n">aModWidth</span><span class="p">.</span><span class="n">next</span><span class="p">()));</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">asig</span><span class="o">*</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span><span class="n">aEnvelop</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<h2 id="08.Samples"> 08.Samples </h2>
<p>Sample</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample/Sample.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample/Sample.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Sampleexpand" onclick="javascript:toggleDisplay(Sample, Sampleexpand, Samplecollapse)">show sketch</button>
<button id="Samplecollapse" style="display:none" onclick="javascript:toggleDisplay(Sample, Sampleexpand, Samplecollapse)">hide sketch</button></p>
<div id="Sample" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of playing a sampled sound,
    using Mozzi sonification library.
  
    Demonstrates one-shot samples scheduled
    with EventDelay.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Sample.h&gt; // Sample template
#include &lt;samples/burroughs1_18649_int8.h&gt;
#include &lt;EventDelay.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 64
</span>
<span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)
</span><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">BURROUGHS1_18649_DATA</span><span class="p">);</span>

<span class="c1">// for scheduling sample start
</span><span class="n">EventDelay</span> <span class="n">kTriggerDelay</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
  <span class="n">aSample</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">);</span> <span class="c1">// play at the speed it was recorded
</span>  <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1500</span><span class="p">);</span> <span class="c1">// 1500 msec countdown, within resolution of CONTROL_RATE
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="n">aSample</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
    <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">aSample</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>SampleHuffman_Umpah</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/SampleHuffman_Umpah/SampleHuffman_Umpah.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/SampleHuffman_Umpah/SampleHuffman_Umpah.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="SampleHuffman_Umpahexpand" onclick="javascript:toggleDisplay(SampleHuffman_Umpah, SampleHuffman_Umpahexpand, SampleHuffman_Umpahcollapse)">show sketch</button>
<button id="SampleHuffman_Umpahcollapse" style="display:none" onclick="javascript:toggleDisplay(SampleHuffman_Umpah, SampleHuffman_Umpahexpand, SampleHuffman_Umpahcollapse)">hide sketch</button></p>
<div id="SampleHuffman_Umpah" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*
 Example playing samples encoded with Huffman compression.
 
 Demonstrates the SampleHuffman class.
 SampleHuffman, most of this explanation, and the audio2huff.py script are adapted from "audioout",
 an Arduino sketch by Thomas Grill, 2011 http//grrrr.org.
 
 Huffman decoding is used on sample differentials,
 saving 50-70% of space for 8 bit data, depending on the sample rate.
 
 This implementation just plays back one sample each time next() is called, with no
 speed or other adjustments.  It's slow, so it's likely you will only be able to play one sound at a time.

 Audio data, Huffman decoder table, sample rate and bit depth are defined
 in a sounddata.h header file.  This file can be generated for a sound file with the 
 accompanying Python script audio2huff.py, in Mozzi/extras/python/

 Invoke with:
 python audio2huff.py --sndfile=arduinosnd.wav --hdrfile=sounddata.h --bits=8 --name=soundtablename

 You can resample and dither your audio file with SOX, 
 e.g. to 8 bits depth @ Mozzi's 16384 Hz  sample rate:
 sox fullglory.wav -b 8 -r 16384 arduinosnd.wav

 Alternatively you can export a sound from Audacity, which seems to have less noticeable or no dithering, 
 using Project Rate 16384 Hz and these output options:
 Other uncompressed files, Header: WAV(Microsoft), Encoding: Unsigned 8 bit PCM

 The header file contains two lengthy arrays:
 One is "SOUNDDATA" which must fit into Flash RAM (available in total: 32k for ATMega328)
 The other is "HUFFMAN" which must also fit into Flash RAM

 Circuit:
  Audio output on digital pin 9 on a Uno or similar, or
  DAC/A14 on Teensy 3.1, or 
  check the README or https://sensorium.github.com/Mozzi/

 Mozzi help/discussion/announcements:
 https://groups.google.com/forum/#!forum/mozzi-users
 
 Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;SampleHuffman.h&gt;
#include "umpah_huff.h"
</span>

<span class="n">SampleHuffman</span> <span class="n">umpah</span><span class="p">(</span><span class="n">UMPAH_SOUNDDATA</span><span class="p">,</span><span class="n">UMPAH_HUFFMAN</span><span class="p">,</span><span class="n">UMPAH_SOUNDDATA_BITS</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">umpah</span><span class="p">.</span><span class="n">setLoopingOn</span><span class="p">();</span>
  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span> 
  <span class="k">return</span> <span class="n">umpah</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Sample_Loop_Points</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample_Loop_Points/Sample_Loop_Points.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample_Loop_Points/Sample_Loop_Points.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Sample_Loop_Pointsexpand" onclick="javascript:toggleDisplay(Sample_Loop_Points, Sample_Loop_Pointsexpand, Sample_Loop_Pointscollapse)">show sketch</button>
<button id="Sample_Loop_Pointscollapse" style="display:none" onclick="javascript:toggleDisplay(Sample_Loop_Points, Sample_Loop_Pointsexpand, Sample_Loop_Pointscollapse)">hide sketch</button></p>
<div id="Sample_Loop_Points" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example playing a looped sampled sound while 
    changing the start end end loop points, 
    and sliding the frequency around,
    using Mozzi sonification library.
  
    Demonstrates Sample(), looping with random 
    changes to loop and frequency parameters
    scheduled with EventDelay.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Sample.h&gt; // Sample template
#include &lt;samples/abomb16384_int8.h&gt; // table for Sample
#include &lt;EventDelay.h&gt;
#include &lt;mozzi_rand.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 128
</span>
<span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)
</span><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">ABOMB_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">ABOMB_DATA</span><span class="p">);</span>

<span class="c1">// for scheduling changes
</span><span class="n">EventDelay</span>  <span class="n">kTriggerDelay</span><span class="p">;</span>


<span class="k">const</span> <span class="kt">float</span> <span class="n">playspeed</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">playspeedmod</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">speedchange</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">full</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="mf">1000.</span><span class="n">f</span><span class="o">/</span><span class="n">playspeed</span><span class="p">)</span> <span class="o">-</span> <span class="mi">23</span><span class="p">;</span> <span class="c1">// adjustment approx for CONTROL_RATE difference
</span>
<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// reseed the random generator for different results each time the sketch runs
</span>  <span class="n">aSample</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">playspeed</span><span class="o">*</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">ABOMB_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">ABOMB_NUM_CELLS</span><span class="p">));</span>
  <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">full</span><span class="p">);</span> 
  <span class="n">aSample</span><span class="p">.</span><span class="n">setLoopingOn</span><span class="p">();</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">chooseStart</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">ABOMB_NUM_CELLS</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">chooseEnd</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">startpos</span><span class="p">){</span>
  <span class="k">return</span> <span class="n">rand</span><span class="p">(</span><span class="n">startpos</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">ABOMB_NUM_CELLS</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">chooseSpeedMod</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
    <span class="n">speedchange</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">rand</span><span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="o">-</span><span class="mi">100</span><span class="p">,(</span><span class="kt">char</span><span class="p">)</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="mi">8000</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">startspeed</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">rand</span><span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="o">-</span><span class="mi">100</span><span class="p">,(</span><span class="kt">char</span><span class="p">)</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">;</span>
    <span class="n">playspeedmod</span> <span class="o">=</span> <span class="n">playspeed</span> <span class="o">+</span> <span class="n">startspeed</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="n">speedchange</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">playspeedmod</span> <span class="o">=</span> <span class="n">playspeed</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">chooseStartEnd</span><span class="p">(){</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">chooseStart</span><span class="p">();</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">chooseEnd</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">ABOMB_NUM_CELLS</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">aSample</span><span class="p">.</span><span class="n">setStart</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
  <span class="n">aSample</span><span class="p">.</span><span class="n">setEnd</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="n">chooseStartEnd</span><span class="p">();</span>
    <span class="n">chooseSpeedMod</span><span class="p">();</span>
    <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">playspeedmod</span> <span class="o">+=</span> <span class="n">speedchange</span><span class="p">;</span>
  <span class="n">aSample</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">playspeedmod</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">aSample</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Sample_Scrub</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample_Scrub/Sample_Scrub.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample_Scrub/Sample_Scrub.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Sample_Scrubexpand" onclick="javascript:toggleDisplay(Sample_Scrub, Sample_Scrubexpand, Sample_Scrubcollapse)">show sketch</button>
<button id="Sample_Scrubcollapse" style="display:none" onclick="javascript:toggleDisplay(Sample_Scrub, Sample_Scrubexpand, Sample_Scrubcollapse)">hide sketch</button></p>
<div id="Sample_Scrub" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of simple "scrubbing" through a sampled sound
     using Mozzi sonification library.

    Demonstrates getting audio samples from a table using a Line to
    slide between different offsets.

   Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
   check the README or https://sensorium.github.com/Mozzi/
 
   Mozzi help/discussion/announcements:
   https://groups.google.com/forum/#!forum/mozzi-users

   Tim Barrass 2012-13.
   CC by-nc-sa
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Sample.h&gt; // Sample template
#include &lt;samples/burroughs1_18649_int8.h&gt;
#include &lt;mozzi_rand.h&gt;
#include &lt;Line.h&gt;
#include &lt;Smooth.h&gt;
</span>
<span class="c1">// use: Sample &lt;table_size, update_rate, interpolation &gt; SampleName (wavetable)
</span><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="p">,</span> <span class="n">INTERP_LINEAR</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">BURROUGHS1_18649_DATA</span><span class="p">);</span>

<span class="c1">//Line to scrub through sample at audio rate, Line target is set at control rate
</span><span class="n">Line</span> <span class="o">&lt;</span><span class="n">Q16n16</span><span class="o">&gt;</span> <span class="n">scrub</span><span class="p">;</span> <span class="c1">// Q16n16 fixed point for high precision
</span>
<span class="c1">// the number of audio steps the line has to take to reach the next offset
</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">AUDIO_STEPS_PER_CONTROL</span> <span class="o">=</span> <span class="n">AUDIO_RATE</span> <span class="o">/</span> <span class="n">CONTROL_RATE</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">offset_advance</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span> <span class="c1">// just a guess
</span>
<span class="c1">// use this smooth out the wandering/jumping rate of scrubbing, gives more convincing reverses
</span><span class="kt">float</span> <span class="n">smoothness</span> <span class="o">=</span> <span class="mf">0.9</span><span class="n">f</span><span class="p">;</span>
<span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothOffsetAdvance</span><span class="p">(</span><span class="n">smoothness</span><span class="p">);</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// fresh randomness
</span>  <span class="n">aSample</span><span class="p">.</span><span class="n">setLoopingOn</span><span class="p">();</span>
  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  
  <span class="c1">// wandering advance rate
</span>  <span class="n">offset_advance</span> <span class="o">+=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">rand</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">-</span><span class="n">rand</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rand</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">))</span> <span class="n">offset_advance</span> <span class="o">=</span> <span class="o">-</span><span class="n">offset_advance</span><span class="p">;</span> <span class="c1">// reverse sometimes
</span>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rand</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">))</span> <span class="n">offset_advance</span> <span class="o">=</span> <span class="mi">500</span><span class="o">-</span><span class="n">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// jump speed sometimes
</span> 
  <span class="kt">int</span> <span class="n">smooth_offset_advance</span> <span class="o">=</span> <span class="n">kSmoothOffsetAdvance</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">offset_advance</span><span class="p">);</span>
  
  <span class="n">offset</span> <span class="o">+=</span> <span class="n">smooth_offset_advance</span><span class="p">;</span>
  
  <span class="c1">// keep offset in range
</span>  <span class="k">if</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&gt;=</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">)</span> <span class="n">offset</span> <span class="o">-=</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">offset</span> <span class="o">+=</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">;</span>

  <span class="c1">// set new target for interpolating line to scrub to
</span>  <span class="n">scrub</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="n">offset</span><span class="p">),</span> <span class="n">AUDIO_STEPS_PER_CONTROL</span><span class="p">);</span>
  
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Q16n16_to_Q16n0</span><span class="p">(</span><span class="n">scrub</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
  <span class="k">return</span> <span class="n">aSample</span><span class="p">.</span><span class="n">atIndex</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Samples</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Samples/Samples.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Samples/Samples.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Samplesexpand" onclick="javascript:toggleDisplay(Samples, Samplesexpand, Samplescollapse)">show sketch</button>
<button id="Samplescollapse" style="display:none" onclick="javascript:toggleDisplay(Samples, Samplesexpand, Samplescollapse)">hide sketch</button></p>
<div id="Samples" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of playing sampled sounds,
    using Mozzi sonification library.
  
    Demonstrates one-shot samples scheduled
    with EventDelay(), and fast random numbers with 
    xorshift96() and rand(), a more friendly wrapper for xorshift96().
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Sample.h&gt; // Sample template
#include &lt;samples/bamboo/bamboo_00_2048_int8.h&gt; // wavetable data
#include &lt;samples/bamboo/bamboo_01_2048_int8.h&gt; // wavetable data
#include &lt;samples/bamboo/bamboo_02_2048_int8.h&gt; // wavetable data
#include &lt;EventDelay.h&gt;
#include &lt;mozzi_rand.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 64
</span>
<span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)
</span><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_00_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span><span class="n">aBamboo0</span><span class="p">(</span><span class="n">BAMBOO_00_2048_DATA</span><span class="p">);</span>
<span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_01_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span><span class="n">aBamboo1</span><span class="p">(</span><span class="n">BAMBOO_01_2048_DATA</span><span class="p">);</span>
<span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_02_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span><span class="n">aBamboo2</span><span class="p">(</span><span class="n">BAMBOO_02_2048_DATA</span><span class="p">);</span>

<span class="c1">// for scheduling audio gain changes
</span><span class="n">EventDelay</span> <span class="n">kTriggerDelay</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
  <span class="n">aBamboo0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_00_2048_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_00_2048_NUM_CELLS</span><span class="p">);</span> <span class="c1">// play at the speed it was recorded at
</span>  <span class="n">aBamboo1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_01_2048_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_01_2048_NUM_CELLS</span><span class="p">);</span>
  <span class="n">aBamboo2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_02_2048_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_02_2048_NUM_CELLS</span><span class="p">);</span>
  <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">111</span><span class="p">);</span> <span class="c1">// countdown ms, within resolution of CONTROL_RATE
</span><span class="p">}</span>


<span class="n">byte</span> <span class="n">randomGain</span><span class="p">(){</span>
  <span class="c1">//return lowByte(xorshift96())&lt;&lt;1;
</span>  <span class="k">return</span> <span class="n">rand</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="o">+</span> <span class="mi">55</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// referencing members from a struct is meant to be a bit faster than seperately
// ....haven't actually tested it here...
</span><span class="k">struct</span> <span class="n">gainstruct</span><span class="p">{</span>
  <span class="n">byte</span> <span class="n">gain0</span><span class="p">;</span>
  <span class="n">byte</span> <span class="n">gain1</span><span class="p">;</span>
  <span class="n">byte</span> <span class="n">gain2</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">gains</span><span class="p">;</span>


<span class="kt">void</span> <span class="nf">updateControl</span><span class="p">(){</span>
  <span class="k">if</span><span class="p">(</span><span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="k">switch</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">gains</span><span class="p">.</span><span class="n">gain0</span> <span class="o">=</span> <span class="n">randomGain</span><span class="p">();</span>
      <span class="n">aBamboo0</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">gains</span><span class="p">.</span><span class="n">gain1</span> <span class="o">=</span> <span class="n">randomGain</span><span class="p">();</span>
      <span class="n">aBamboo1</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">gains</span><span class="p">.</span><span class="n">gain2</span> <span class="o">=</span> <span class="n">randomGain</span><span class="p">();</span>
      <span class="n">aBamboo2</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">asig</span><span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> 
    <span class="p">((</span><span class="kt">long</span><span class="p">)</span> <span class="n">aBamboo0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gains</span><span class="p">.</span><span class="n">gain0</span> <span class="o">+</span>
      <span class="n">aBamboo1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gains</span><span class="p">.</span><span class="n">gain1</span> <span class="o">+</span>
      <span class="n">aBamboo2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gains</span><span class="p">.</span><span class="n">gain2</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">;</span>
  <span class="c1">//clip to keep audio loud but still in range
</span>  <span class="k">if</span> <span class="p">(</span><span class="n">asig</span> <span class="o">&gt;</span> <span class="mi">243</span><span class="p">)</span> <span class="n">asig</span> <span class="o">=</span> <span class="mi">243</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">asig</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">244</span><span class="p">)</span> <span class="n">asig</span> <span class="o">=</span> <span class="o">-</span><span class="mi">244</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">asig</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Samples_Tables_Arrays</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Samples_Tables_Arrays/Samples_Tables_Arrays.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Samples_Tables_Arrays/Samples_Tables_Arrays.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Samples_Tables_Arraysexpand" onclick="javascript:toggleDisplay(Samples_Tables_Arrays, Samples_Tables_Arraysexpand, Samples_Tables_Arrayscollapse)">show sketch</button>
<button id="Samples_Tables_Arrayscollapse" style="display:none" onclick="javascript:toggleDisplay(Samples_Tables_Arrays, Samples_Tables_Arraysexpand, Samples_Tables_Arrayscollapse)">hide sketch</button></p>
<div id="Samples_Tables_Arrays" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of a polyphonic sketch in which 
    11 sound tables are shared between 3 voices,
    using Mozzi sonification library.
  
    Demonstrates use of Sample() objects as players, 
    using setTable() to share many sound tables between 
    a few players, to minimise processing in updateAudio().
    Shows how to use Samples and sound tables in arrays,
    EventDelay() for scheduling, and rand() to select 
    sound tables and vary the gain of each player.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Sample.h&gt;
#include &lt;EventDelay.h&gt;
#include &lt;mozzi_rand.h&gt; // for rand()
#include &lt;samples/bamboo/bamboo_00_2048_int8.h&gt; // wavetable data
#include &lt;samples/bamboo/bamboo_01_2048_int8.h&gt; // wavetable data
#include &lt;samples/bamboo/bamboo_02_2048_int8.h&gt; // wavetable data
#include &lt;samples/bamboo/bamboo_03_2048_int8.h&gt; // wavetable data
#include &lt;samples/bamboo/bamboo_04_2048_int8.h&gt; // wavetable data
#include &lt;samples/bamboo/bamboo_05_2048_int8.h&gt; // wavetable data
#include &lt;samples/bamboo/bamboo_06_2048_int8.h&gt; // wavetable data
#include &lt;samples/bamboo/bamboo_07_2048_int8.h&gt; // wavetable data
#include &lt;samples/bamboo/bamboo_08_2048_int8.h&gt; // wavetable data
#include &lt;samples/bamboo/bamboo_09_2048_int8.h&gt; // wavetable data
#include &lt;samples/bamboo/bamboo_10_2048_int8.h&gt; // wavetable data
</span>

<span class="cp">#define CONTROL_RATE 64
</span>
<span class="c1">// for scheduling samples to play
</span><span class="n">EventDelay</span> <span class="n">kTriggerDelay</span><span class="p">;</span>
<span class="n">EventDelay</span> <span class="n">kTriggerSlowDelay</span><span class="p">;</span>

<span class="n">byte</span> <span class="n">ms_per_note</span> <span class="o">=</span> <span class="mi">111</span><span class="p">;</span> <span class="c1">// subject to CONTROL_RATE
</span>
<span class="k">const</span> <span class="n">byte</span> <span class="n">NUM_PLAYERS</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// 3 seems to be enough
</span><span class="k">const</span> <span class="n">byte</span> <span class="n">NUM_TABLES</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>

<span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_00_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">[</span><span class="n">NUM_PLAYERS</span><span class="p">]</span> <span class="o">=</span><span class="p">{</span>
  <span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_00_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">BAMBOO_00_2048_DATA</span><span class="p">),</span>
  <span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_01_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">BAMBOO_01_2048_DATA</span><span class="p">),</span>
  <span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_02_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">BAMBOO_02_2048_DATA</span><span class="p">),</span>
<span class="p">};</span>

<span class="c1">// watch out - tables are const (but you can choose which ones you reference)
</span><span class="k">const</span> <span class="kt">int8_t</span> <span class="o">*</span> <span class="n">tables</span><span class="p">[</span><span class="n">NUM_TABLES</span><span class="p">]</span> <span class="o">=</span><span class="p">{</span>
  <span class="n">BAMBOO_00_2048_DATA</span><span class="p">,</span>
  <span class="n">BAMBOO_01_2048_DATA</span><span class="p">,</span>
  <span class="n">BAMBOO_02_2048_DATA</span><span class="p">,</span>
  <span class="n">BAMBOO_03_2048_DATA</span><span class="p">,</span>
  <span class="n">BAMBOO_04_2048_DATA</span><span class="p">,</span>
  <span class="n">BAMBOO_05_2048_DATA</span><span class="p">,</span>
  <span class="n">BAMBOO_06_2048_DATA</span><span class="p">,</span>
  <span class="n">BAMBOO_07_2048_DATA</span><span class="p">,</span>
  <span class="n">BAMBOO_08_2048_DATA</span><span class="p">,</span>
  <span class="n">BAMBOO_09_2048_DATA</span><span class="p">,</span>
  <span class="n">BAMBOO_10_2048_DATA</span>
<span class="p">};</span>

<span class="c1">// gains for each sample player
</span><span class="n">byte</span> <span class="n">gain</span><span class="p">[</span><span class="n">NUM_PLAYERS</span><span class="p">];</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_PLAYERS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>  <span class="c1">// play at the speed they're sampled at
</span>    <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_00_2048_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_00_2048_NUM_CELLS</span><span class="p">);</span>   
  <span class="p">}</span>
  <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">ms_per_note</span><span class="p">);</span> <span class="c1">// countdown ms, within resolution of CONTROL_RATE
</span>  <span class="n">kTriggerSlowDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">ms_per_note</span><span class="o">*</span><span class="mi">6</span><span class="p">);</span> <span class="c1">// resolution-dependent inaccuracy leads to polyrhythm :)
</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>


<span class="n">byte</span> <span class="n">randomGain</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">80</span><span class="p">,(</span><span class="n">byte</span><span class="p">)</span><span class="mi">255</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">static</span> <span class="n">byte</span> <span class="n">player</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  
  <span class="k">if</span><span class="p">(</span><span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="n">gain</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="o">=</span> <span class="n">randomGain</span><span class="p">();</span>
    <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">player</span><span class="p">]).</span><span class="n">setTable</span><span class="p">(</span><span class="n">tables</span><span class="p">[</span><span class="n">rand</span><span class="p">(</span><span class="n">NUM_TABLES</span><span class="p">)]);</span>
    <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">player</span><span class="p">]).</span><span class="n">start</span><span class="p">();</span>
    <span class="n">player</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">player</span><span class="o">==</span><span class="n">NUM_PLAYERS</span><span class="p">)</span> <span class="n">player</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">kTriggerSlowDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="n">gain</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="o">=</span> <span class="n">randomGain</span><span class="p">();</span>
    <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">player</span><span class="p">]).</span><span class="n">setTable</span><span class="p">(</span><span class="n">tables</span><span class="p">[</span><span class="n">rand</span><span class="p">(</span><span class="n">NUM_TABLES</span><span class="p">)]);</span>
    <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">player</span><span class="p">]).</span><span class="n">start</span><span class="p">();</span>
    <span class="n">player</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">player</span><span class="o">==</span><span class="n">NUM_PLAYERS</span><span class="p">)</span> <span class="n">player</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">kTriggerSlowDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">long</span> <span class="n">asig</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">byte</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_PLAYERS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
    <span class="n">asig</span> <span class="o">+=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">gain</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="n">asig</span> <span class="o">&gt;&gt;=</span> <span class="mi">6</span><span class="p">;</span> <span class="c1">// shift into usable range
</span>  <span class="c1">//clip any stray peaks to max output range
</span>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">constrain</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">asig</span><span class="p">,</span><span class="o">-</span><span class="mi">244</span><span class="p">,</span><span class="mi">243</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Wavetable_Swap</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Wavetable_Swap/Wavetable_Swap.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Wavetable_Swap/Wavetable_Swap.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Wavetable_Swapexpand" onclick="javascript:toggleDisplay(Wavetable_Swap, Wavetable_Swapexpand, Wavetable_Swapcollapse)">show sketch</button>
<button id="Wavetable_Swapcollapse" style="display:none" onclick="javascript:toggleDisplay(Wavetable_Swap, Wavetable_Swapexpand, Wavetable_Swapcollapse)">hide sketch</button></p>
<div id="Wavetable_Swap" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example swapping between sounds played by a single Oscil
    with Mozzi sonification library.
  
    Demonstrates declaring an Oscil without a table,
    and Oscil::setTable() method.
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;EventDelay.h&gt;
</span>
<span class="c1">// tables need to be the same size
</span><span class="cp">#include &lt;tables/sin512_int8.h&gt; 
#include &lt;tables/saw_analogue512_int8.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 64
</span>
<span class="c1">// declare with or without a wavetable, and use setTable() later
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="mi">512</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aOscil</span><span class="p">;</span> 

<span class="c1">// for scheduling table swaps
</span><span class="n">EventDelay</span> <span class="n">kSwapTablesDelay</span><span class="p">;</span>

<span class="n">boolean</span> <span class="n">using_sin</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
  <span class="n">kSwapTablesDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// 1 second countdown, within resolution of CONTROL_RATE
</span>  <span class="n">aOscil</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">440.</span><span class="n">f</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">kSwapTablesDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">using_sin</span><span class="p">){</span>
        <span class="n">aOscil</span><span class="p">.</span><span class="n">setTable</span><span class="p">(</span><span class="n">SAW_ANALOGUE512_DATA</span><span class="p">);</span>
        <span class="n">using_sin</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
         <span class="n">aOscil</span><span class="p">.</span><span class="n">setTable</span><span class="p">(</span><span class="n">SIN512_DATA</span><span class="p">);</span>
         <span class="n">using_sin</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">kSwapTablesDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span> 


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">aOscil</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<h2 id="09.Delays"> 09.Delays </h2>
<p>AudioDelay</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelay/AudioDelay.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelay/AudioDelay.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="AudioDelayexpand" onclick="javascript:toggleDisplay(AudioDelay, AudioDelayexpand, AudioDelaycollapse)">show sketch</button>
<button id="AudioDelaycollapse" style="display:none" onclick="javascript:toggleDisplay(AudioDelay, AudioDelayexpand, AudioDelaycollapse)">hide sketch</button></p>
<div id="AudioDelay" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of modulating a signal by using a variable delay,
    using Mozzi sonification library.
  
    Demonstrates AudioDelay.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/triangle_analogue512_int8.h&gt; // wavetable
#include &lt;tables/cos2048_int8.h&gt; // wavetable
#include &lt;AudioDelay.h&gt;
#include &lt;mozzi_midi.h&gt; // for mtof
</span>
<span class="cp">#define CONTROL_RATE 256 // powers of 2 please
</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_ANALOGUE512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle</span><span class="p">(</span><span class="n">TRIANGLE_ANALOGUE512_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFreq</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>

<span class="n">AudioDelay</span> <span class="o">&lt;</span><span class="mi">256</span><span class="o">&gt;</span> <span class="n">aDel</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">del_samps</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">aTriangle</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">60.</span><span class="n">f</span><span class="p">));</span>
  <span class="n">kFreq</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.63</span><span class="n">f</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="n">del_samps</span> <span class="o">=</span> <span class="mi">128</span><span class="o">+</span><span class="n">kFreq</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">char</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">aDel</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aTriangle</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span> <span class="n">del_samps</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">asig</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>AudioDelayFeedback</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedback/AudioDelayFeedback.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedback/AudioDelayFeedback.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="AudioDelayFeedbackexpand" onclick="javascript:toggleDisplay(AudioDelayFeedback, AudioDelayFeedbackexpand, AudioDelayFeedbackcollapse)">show sketch</button>
<button id="AudioDelayFeedbackcollapse" style="display:none" onclick="javascript:toggleDisplay(AudioDelayFeedback, AudioDelayFeedbackexpand, AudioDelayFeedbackcollapse)">hide sketch</button></p>
<div id="AudioDelayFeedback" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of flanging,
    using Mozzi sonification library.
  
    Demonstrates AudioDelayFeedback.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012-13, CC by-nc-sa.
*/</span>


<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/triangle_analogue512_int8.h&gt; // wavetable
#include &lt;tables/triangle512_int8.h&gt; // wavetable
#include &lt;AudioDelayFeedback.h&gt;
#include &lt;mozzi_midi.h&gt; // for mtof
</span>
<span class="cp">#define CONTROL_RATE 128 // powers of 2 please
</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_ANALOGUE512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle</span><span class="p">(</span><span class="n">TRIANGLE_ANALOGUE512_DATA</span><span class="p">);</span> <span class="c1">// audio oscillator
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kDelSamps</span><span class="p">(</span><span class="n">TRIANGLE512_DATA</span><span class="p">);</span> <span class="c1">// for modulating delay time, measured in audio samples
</span>
<span class="n">AudioDelayFeedback</span> <span class="o">&lt;</span><span class="mi">128</span><span class="o">&gt;</span> <span class="n">aDel</span><span class="p">;</span>

<span class="c1">// the delay time, measured in samples, updated in updateControl, and used in updateAudio 
</span><span class="n">byte</span> <span class="n">del_samps</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
  <span class="n">aTriangle</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">48.</span><span class="n">f</span><span class="p">));</span>
  <span class="n">kDelSamps</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.163</span><span class="n">f</span><span class="p">);</span> <span class="c1">// set the delay time modulation frequency (ie. the sweep frequency)
</span>  <span class="n">aDel</span><span class="p">.</span><span class="n">setFeedbackLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">111</span><span class="p">);</span> <span class="c1">// can be -128 to 127
</span><span class="p">}</span>


<span class="n">Q16n16</span> <span class="n">deltime</span><span class="p">;</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// delay time range from 0 to 127 samples, @ 16384 samps per sec = 0 to 7 milliseconds
</span>  <span class="c1">//del_samps = 64+kDelSamps.next();
</span>  
  <span class="c1">// delay time range from 1 to 33 samples, @ 16384 samps per sec = 0 to 2 milliseconds
</span>  <span class="c1">//del_samps = 17+kDelSamps.next()/8;
</span>  
  <span class="n">deltime</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">kDelSamps</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">12</span><span class="p">);</span> 
  
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">char</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">aTriangle</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// get this so it can be used twice without calling next() again
</span>  <span class="c1">//return asig/8 + aDel.next(asig, del_samps); // mix some straight signal with the delayed signal
</span>  <span class="c1">//return aDel.next(aTriangle.next(), del_samps); // instead of the previous 2 lines for only the delayed signal
</span>  <span class="k">return</span> <span class="n">asig</span><span class="o">/</span><span class="mi">8</span> <span class="o">+</span> <span class="n">aDel</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig</span><span class="p">,</span> <span class="n">deltime</span><span class="p">);</span> <span class="c1">// mix some straight signal with the delayed signal
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>AudioDelayFeedbackAllpass</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedbackAllpass/AudioDelayFeedbackAllpass.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedbackAllpass/AudioDelayFeedbackAllpass.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="AudioDelayFeedbackAllpassexpand" onclick="javascript:toggleDisplay(AudioDelayFeedbackAllpass, AudioDelayFeedbackAllpassexpand, AudioDelayFeedbackAllpasscollapse)">show sketch</button>
<button id="AudioDelayFeedbackAllpasscollapse" style="display:none" onclick="javascript:toggleDisplay(AudioDelayFeedbackAllpass, AudioDelayFeedbackAllpassexpand, AudioDelayFeedbackAllpasscollapse)">hide sketch</button></p>
<div id="AudioDelayFeedbackAllpass" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of allpass interpolation for fractional delays,
    using Mozzi sonification library.
  
    Demonstrates AudioDelayFeedback with allpass interpolation,
    random delaytimes and feedback levels on a 
    (random) percussive adsr whitenoise sound.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012-13, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;AudioDelayFeedback.h&gt;
#include &lt;Ead.h&gt; // exponential attack decay
#include &lt;EventDelay.h&gt;
#include &lt;mozzi_rand.h&gt;
#include &lt;tables/whitenoise8192_int8.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 128 // powers of 2 please
</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">WHITENOISE8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aNoise</span><span class="p">(</span><span class="n">WHITENOISE8192_DATA</span><span class="p">);</span> <span class="c1">// audio noise
</span><span class="n">EventDelay</span> <span class="n">kDelay</span><span class="p">;</span> <span class="c1">// for triggering envelope start
</span><span class="n">Ead</span> <span class="n">kEnvelope</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// resolution will be CONTROL_RATE
</span>
<span class="n">AudioDelayFeedback</span> <span class="o">&lt;</span><span class="mi">256</span><span class="p">,</span> <span class="n">ALLPASS</span><span class="o">&gt;</span> <span class="n">aDel</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">gain</span><span class="p">;</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">//Serial.begin(9600);
</span>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> 
  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// reseed the random generator for different results each time the sketch runs
</span>  <span class="c1">// use float to set freq because it will be small and fractional
</span>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">AUDIO_RATE</span><span class="o">/</span><span class="n">WHITENOISE8192_SAMPLERATE</span><span class="p">);</span>
  <span class="n">kDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// jump around in audio noise table to disrupt obvious looping
</span>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setPhase</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">WHITENOISE8192_NUM_CELLS</span><span class="p">));</span>

  <span class="k">if</span><span class="p">(</span><span class="n">kDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
    <span class="c1">// set random adsr parameters
</span>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">500u</span><span class="p">)</span><span class="o">+</span><span class="mi">200</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">attack</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">75</span><span class="p">);</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">decay</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">-</span> <span class="n">attack</span><span class="p">;</span>
    <span class="n">kEnvelope</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span><span class="n">decay</span><span class="p">);</span>
    
    <span class="c1">// set random delay parameters
</span>    <span class="kt">float</span> <span class="n">del_cells</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">rand</span><span class="p">(</span><span class="mi">65535u</span><span class="p">)</span><span class="o">/</span><span class="mi">256</span><span class="p">;</span>
    <span class="n">aDel</span><span class="p">.</span><span class="n">setDelayTimeCells</span><span class="p">(</span><span class="n">del_cells</span><span class="p">);</span> <span class="c1">// Allpass interpolation for fractional delay time
</span>    <span class="kt">char</span> <span class="n">fb</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">);</span>
    <span class="n">aDel</span><span class="p">.</span><span class="n">setFeedbackLevel</span><span class="p">(</span><span class="n">fb</span><span class="p">);</span>
    <span class="n">kDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">duration</span><span class="o">+</span><span class="mi">500</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">gain</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">kEnvelope</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">aDel</span><span class="p">.</span><span class="n">next</span><span class="p">((</span><span class="n">gain</span><span class="o">*</span><span class="n">aNoise</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>AudioDelayFeedbackX2</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedbackX2/AudioDelayFeedbackX2.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedbackX2/AudioDelayFeedbackX2.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="AudioDelayFeedbackX2expand" onclick="javascript:toggleDisplay(AudioDelayFeedbackX2, AudioDelayFeedbackX2expand, AudioDelayFeedbackX2collapse)">show sketch</button>
<button id="AudioDelayFeedbackX2collapse" style="display:none" onclick="javascript:toggleDisplay(AudioDelayFeedbackX2, AudioDelayFeedbackX2expand, AudioDelayFeedbackX2collapse)">hide sketch</button></p>
<div id="AudioDelayFeedbackX2" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of flanging,
    using Mozzi sonification library.
  
    Demonstrates 2 oscillators going through 2 AudioDelayFeedback units,
    with straight signal mixed in.
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012-13, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/triangle_analogue512_int8.h&gt; // wavetable for audio
#include &lt;tables/triangle512_int8.h&gt; // wavetable for delay sweep
#include &lt;AudioDelayFeedback.h&gt;
#include &lt;mozzi_midi.h&gt; // for mtof
</span>
<span class="cp">#define CONTROL_RATE 128 // powers of 2 please
</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_ANALOGUE512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle1</span><span class="p">(</span><span class="n">TRIANGLE_ANALOGUE512_DATA</span><span class="p">);</span> <span class="c1">// audio oscillator
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_ANALOGUE512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle2</span><span class="p">(</span><span class="n">TRIANGLE_ANALOGUE512_DATA</span><span class="p">);</span> <span class="c1">// audio oscillator
</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kDelSamps1</span><span class="p">(</span><span class="n">TRIANGLE512_DATA</span><span class="p">);</span> <span class="c1">// for modulating delay time, measured in audio samples
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kDelSamps2</span><span class="p">(</span><span class="n">TRIANGLE512_DATA</span><span class="p">);</span> <span class="c1">// for modulating delay time, measured in audio samples
</span>
<span class="n">AudioDelayFeedback</span> <span class="o">&lt;</span><span class="mi">128</span><span class="o">&gt;</span> <span class="n">aDel1</span><span class="p">;</span>
<span class="n">AudioDelayFeedback</span> <span class="o">&lt;</span><span class="mi">128</span><span class="o">&gt;</span> <span class="n">aDel2</span><span class="p">;</span>

<span class="c1">// the delay time, measured in samples, updated in updateControl, and used in updateAudio 
</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">del_samps1</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">del_samps2</span><span class="p">;</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">aTriangle1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">48.</span><span class="n">f</span><span class="p">));</span>
  <span class="n">kDelSamps1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.163</span><span class="n">f</span><span class="p">);</span> <span class="c1">// set the delay time modulation frequency (ie. the sweep frequency)
</span>  <span class="n">aDel1</span><span class="p">.</span><span class="n">setFeedbackLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">111</span><span class="p">);</span> <span class="c1">// can be -128 to 127
</span>
  <span class="n">aTriangle2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">52.</span><span class="n">f</span><span class="p">));</span>
  <span class="n">kDelSamps2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.43</span><span class="n">f</span><span class="p">);</span> <span class="c1">// set the delay time modulation frequency (ie. the sweep frequency)
</span>  <span class="n">aDel2</span><span class="p">.</span><span class="n">setFeedbackLevel</span><span class="p">(</span><span class="mi">109</span><span class="p">);</span> <span class="c1">// can be -128 to 127
</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// delay time range from 0 to 127 samples, @ 16384 samps per sec = 0 to 7 milliseconds
</span>  <span class="n">del_samps1</span> <span class="o">=</span> <span class="mi">64</span><span class="o">+</span><span class="n">kDelSamps1</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>

  <span class="c1">// delay time range from 1 to 33 samples, @ 16384 samps per sec = 0 to 2 milliseconds
</span>  <span class="n">del_samps2</span> <span class="o">=</span> <span class="mi">17</span><span class="o">+</span><span class="n">kDelSamps2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">/</span><span class="mi">8</span><span class="p">;</span> 
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">char</span> <span class="n">asig1</span> <span class="o">=</span> <span class="n">aTriangle1</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// get this so it can be used twice without calling next() again
</span>  <span class="kt">int</span> <span class="n">aflange1</span> <span class="o">=</span> <span class="p">(</span><span class="n">asig1</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">aDel1</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig1</span><span class="p">,</span> <span class="n">del_samps1</span><span class="p">);</span> <span class="c1">// mix some straignt signal with the delayed signal
</span>
  <span class="kt">char</span> <span class="n">asig2</span> <span class="o">=</span> <span class="n">aTriangle2</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// get this so it can be used twice without calling next() again
</span>  <span class="kt">int</span> <span class="n">aflange2</span> <span class="o">=</span> <span class="p">(</span><span class="n">asig2</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">aDel2</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig2</span><span class="p">,</span> <span class="n">del_samps2</span><span class="p">);</span> <span class="c1">// mix some straignt signal with the delayed signal
</span>  <span class="k">return</span> <span class="p">(</span><span class="n">aflange1</span> <span class="o">+</span> <span class="n">aflange2</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>AudioDelayFeedback_HIFI</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedback_HIFI/AudioDelayFeedback_HIFI.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedback_HIFI/AudioDelayFeedback_HIFI.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="AudioDelayFeedback_HIFIexpand" onclick="javascript:toggleDisplay(AudioDelayFeedback_HIFI, AudioDelayFeedback_HIFIexpand, AudioDelayFeedback_HIFIcollapse)">show sketch</button>
<button id="AudioDelayFeedback_HIFIcollapse" style="display:none" onclick="javascript:toggleDisplay(AudioDelayFeedback_HIFI, AudioDelayFeedback_HIFIexpand, AudioDelayFeedback_HIFIcollapse)">hide sketch</button></p>
<div id="AudioDelayFeedback_HIFI" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of flanging,
    using Mozzi sonification library.
  
    Demonstrates AudioDelayFeedback.
  
    This sketch using HIFI mode is not for Teensy 3.1.
    
    IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be
    be changed from STANDARD mode to HIFI.
    In Mozz/mozzi_config.h, change
    //#define AUDIO_MODE STANDARD
    #define AUDIO_MODE STANDARD_PLUS
    //#define AUDIO_MODE HIFI
    to
    //#define AUDIO_MODE STANDARD
    //#define AUDIO_MODE STANDARD_PLUS
    #define AUDIO_MODE HIFI
  
  The sketch also sounds better with a faster sample rate, for less aliasing
  #define AUDIO_RATE 32768
  in mozzi_config.
  
    Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),
    Check the Mozzi core module documentation for others and more detail
  
                     3.9k 
     pin 9  ---WWWW-----|-----output
                    499k           |
     pin 10 ---WWWW---- |
                                       |
                             4.7n  ==
                                       |
                                   ground
  
    Resistors are ±0.5%  Measure and choose the most precise 
    from a batch of whatever you can get.  Use two 1M resistors
    in parallel if you can't find 499k.
    Alternatively using 39 ohm, 4.99k and 470nF components will 
    work directly with headphones.
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012-13, CC by-nc-sa.
*/</span>



<span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/triangle_analogue512_int8.h&gt; // wavetable
#include &lt;tables/triangle512_int8.h&gt; // wavetable
#include &lt;AudioDelayFeedback.h&gt;
#include &lt;mozzi_midi.h&gt; // for mtof
</span>
<span class="cp">#define CONTROL_RATE 128 // powers of 2 please
</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_ANALOGUE512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle</span><span class="p">(</span><span class="n">TRIANGLE_ANALOGUE512_DATA</span><span class="p">);</span> <span class="c1">// audio oscillator
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kDelSamps</span><span class="p">(</span><span class="n">TRIANGLE512_DATA</span><span class="p">);</span> <span class="c1">// for modulating delay time, measured in audio samples
</span>
<span class="n">AudioDelayFeedback</span> <span class="o">&lt;</span><span class="mi">128</span><span class="o">&gt;</span> <span class="n">aDel</span><span class="p">;</span>

<span class="c1">// the delay time, measured in samples, updated in updateControl, and used in updateAudio 
</span><span class="n">byte</span> <span class="n">del_samps</span><span class="p">;</span>
<span class="n">Q16n16</span> <span class="n">del_samps_fractional</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
  <span class="n">aTriangle</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">48.</span><span class="n">f</span><span class="p">));</span>
  <span class="n">kDelSamps</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.163</span><span class="n">f</span><span class="p">);</span> <span class="c1">// set the delay time modulation frequency (ie. the sweep frequency)
</span>  <span class="n">aDel</span><span class="p">.</span><span class="n">setFeedbackLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">111</span><span class="p">);</span> <span class="c1">// can be -128 to 127
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// delay time range from 0 to 127 samples, @ 16384 samps per sec = 0 to 7 milliseconds
</span>  <span class="c1">//del_samps = 64+kDelSamps.next();
</span>  
  <span class="c1">// delay time range from 1 to 33 samples, @ 16384 samps per sec = 0 to 2 milliseconds
</span>  <span class="c1">//del_samps = 17+kDelSamps.next()/8;
</span>  
  <span class="n">del_samps_fractional</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">kDelSamps</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">12</span><span class="p">);</span> 
  
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">char</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">aTriangle</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// get this so it can be used twice without calling next() again
</span>  <span class="c1">//return asig/8 + aDel.next(asig, del_samps); // mix some straight signal with the delayed signal
</span>  <span class="c1">//return aDel.next(aTriangle.next(), del_samps); // instead of the previous 2 lines for only the delayed signal
</span>  <span class="k">return</span> <span class="p">(</span><span class="n">asig</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">aDel</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig</span><span class="p">,</span> <span class="n">del_samps_fractional</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">);</span> <span class="c1">// mix some straight signal with the delayed signal
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>ReverbTank_STANDARD</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/ReverbTank_STANDARD/ReverbTank_STANDARD.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/ReverbTank_STANDARD/ReverbTank_STANDARD.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="ReverbTank_STANDARDexpand" onclick="javascript:toggleDisplay(ReverbTank_STANDARD, ReverbTank_STANDARDexpand, ReverbTank_STANDARDcollapse)">show sketch</button>
<button id="ReverbTank_STANDARDcollapse" style="display:none" onclick="javascript:toggleDisplay(ReverbTank_STANDARD, ReverbTank_STANDARDexpand, ReverbTank_STANDARDcollapse)">hide sketch</button></p>
<div id="ReverbTank_STANDARD" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of reverb on a synthesised sound
    using Mozzi sonification library.
  
    Demonstrates ReverbTank, a reverb small enough to fit on
    the Arduino Nano, which for some reason wasn't able to fit a larger version
    which did fit on other 328 based boards.
    It's a pretty horrible reverb which sounds like the inside of a tin can.
    For simplicity, ReverbTank has hardcoded maximum delay sizes
    but also has default delay times which can be changed in the constructor
    or by setting during run time to allow live tweaking.
    The synthesised sound comes from the phasemod synth example.
  
    Circuit: Audio output on digital pin 9 for STANDARD output on a Uno or similar, or
    see the readme.md file for others.
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;ReverbTank.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/cos8192_int8.h&gt;
#include &lt;tables/envelop2048_uint8.h&gt;
</span>

<span class="n">ReverbTank</span> <span class="n">reverb</span><span class="p">;</span>

<span class="cp">#define CONTROL_RATE 512 // quite fast, keeps modulation smooth
</span>
<span class="c1">// Synth from PhaseMod_Envelope example
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModWidth</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModFreq1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModFreq2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">ENVELOP2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aEnvelop</span><span class="p">(</span><span class="n">ENVELOP2048_DATA</span><span class="p">);</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">// synth params
</span>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">55</span><span class="p">);</span>
  <span class="n">kModFreq1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">3.98</span><span class="n">f</span><span class="p">);</span>
  <span class="n">kModFreq2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">3.31757</span><span class="n">f</span><span class="p">);</span>
  <span class="n">aModWidth</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.52434</span><span class="n">f</span><span class="p">);</span>
  <span class="n">aEnvelop</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">9.0</span><span class="n">f</span><span class="p">);</span>

  <span class="n">startMozzi</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// synth control
</span>  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">277.0</span><span class="n">f</span> <span class="o">+</span> <span class="mf">0.4313</span><span class="n">f</span><span class="o">*</span><span class="n">kModFreq1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">kModFreq2</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">synth</span> <span class="o">=</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mi">150u</span><span class="o">+</span><span class="n">aModWidth</span><span class="p">.</span><span class="n">next</span><span class="p">()));</span>
  <span class="n">synth</span> <span class="o">*=</span> <span class="p">(</span><span class="n">byte</span><span class="p">)</span><span class="n">aEnvelop</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  <span class="n">synth</span> <span class="o">&gt;&gt;=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="c1">// here's the reverb
</span>  <span class="kt">int</span> <span class="n">arev</span> <span class="o">=</span> <span class="n">reverb</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">synth</span><span class="p">);</span>
  <span class="c1">// add the dry and wet signals
</span>  <span class="k">return</span> <span class="n">synth</span> <span class="o">+</span> <span class="p">(</span><span class="n">arev</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<h2 id="10.Audio_Filters"> 10.Audio_Filters </h2>
<p>LowPassFilter</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/LowPassFilter/LowPassFilter.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/LowPassFilter/LowPassFilter.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="LowPassFilterexpand" onclick="javascript:toggleDisplay(LowPassFilter, LowPassFilterexpand, LowPassFiltercollapse)">show sketch</button>
<button id="LowPassFiltercollapse" style="display:none" onclick="javascript:toggleDisplay(LowPassFilter, LowPassFilterexpand, LowPassFiltercollapse)">hide sketch</button></p>
<div id="LowPassFilter" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of filtering a wave,
    using Mozzi sonification library.
  
    Demonstrates LowPassFilter().
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/chum9_int8.h&gt; // recorded audio wavetable
#include &lt;tables/cos2048_int8.h&gt; // for filter modulation
#include &lt;LowPassFilter.h&gt;
#include &lt;mozzi_rand.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 64 // powers of 2 please
</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">CHUM9_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCrunchySound</span><span class="p">(</span><span class="n">CHUM9_DATA</span><span class="p">);</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFilterMod</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>

<span class="n">LowPassFilter</span> <span class="n">lpf</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
  <span class="n">aCrunchySound</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.</span><span class="n">f</span><span class="p">);</span>
  <span class="n">kFilterMod</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.3</span><span class="n">f</span><span class="p">);</span>
  <span class="n">lpf</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span> <span class="c1">// about once every half second
</span>    <span class="n">kFilterMod</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">rand</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="o">/</span><span class="mi">64</span><span class="p">);</span>  <span class="c1">// choose a new modulation frequency
</span>  <span class="p">}</span>
  <span class="c1">// map the modulation into the filter range (0-255)
</span>  <span class="n">byte</span> <span class="n">cutoff_freq</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">kFilterMod</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
  <span class="n">lpf</span><span class="p">.</span><span class="n">setCutoffFreq</span><span class="p">(</span><span class="n">cutoff_freq</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">char</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">lpf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aCrunchySound</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">asig</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>LowPassFilterX2</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/LowPassFilterX2/LowPassFilterX2.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/LowPassFilterX2/LowPassFilterX2.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="LowPassFilterX2expand" onclick="javascript:toggleDisplay(LowPassFilterX2, LowPassFilterX2expand, LowPassFilterX2collapse)">show sketch</button>
<button id="LowPassFilterX2collapse" style="display:none" onclick="javascript:toggleDisplay(LowPassFilterX2, LowPassFilterX2expand, LowPassFilterX2collapse)">hide sketch</button></p>
<div id="LowPassFilterX2" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of filtering 2 waves with different filter settings,
    using Mozzi sonification library.
  
    Demonstrates 2 Oscillators, each with a LowPassFilter().
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/chum9_int8.h&gt; // recorded audio wavetable
#include &lt;tables/cos512_int8.h&gt; // for filter modulation
#include &lt;LowPassFilter.h&gt;
#include &lt;mozzi_rand.h&gt; // for rand()
</span>
<span class="cp">#define CONTROL_RATE 64 // powers of 2 please
</span>
<span class="n">Oscil</span><span class="o">&lt;</span><span class="n">CHUM9_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCrunchySound1</span><span class="p">(</span><span class="n">CHUM9_DATA</span><span class="p">);</span> <span class="c1">//audio oscillator
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">CHUM9_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCrunchySound2</span><span class="p">(</span><span class="n">CHUM9_DATA</span><span class="p">);</span> <span class="c1">//audio oscillator
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFilterMod1</span><span class="p">(</span><span class="n">COS512_DATA</span><span class="p">);</span> <span class="c1">// to modulate filter frequency
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFilterMod2</span><span class="p">(</span><span class="n">COS512_DATA</span><span class="p">);</span> <span class="c1">// to modulate filter frequency
</span>
<span class="n">LowPassFilter</span> <span class="n">lpf1</span><span class="p">;</span>
<span class="n">LowPassFilter</span> <span class="n">lpf2</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
  <span class="n">aCrunchySound1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.</span><span class="n">f</span><span class="p">);</span>
  <span class="n">aCrunchySound2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">6.</span><span class="n">f</span><span class="p">);</span>
  <span class="n">kFilterMod1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.3</span><span class="n">f</span><span class="p">);</span>
  <span class="n">kFilterMod2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.1</span><span class="n">f</span><span class="p">);</span>
  <span class="n">lpf1</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">180</span><span class="p">);</span>
  <span class="n">lpf2</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">220</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// map the modulation depth into the filter range, 0-255 to represent 0-8192 Hz
</span>  <span class="n">byte</span> <span class="n">cutoff_freq1</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">kFilterMod1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="c1">// 100 ± 63
</span>  <span class="n">lpf1</span><span class="p">.</span><span class="n">setCutoffFreq</span><span class="p">(</span><span class="n">cutoff_freq1</span><span class="p">);</span>
  <span class="c1">// also update lpf2 cutoff
</span>  <span class="n">byte</span> <span class="n">cutoff_freq2</span> <span class="o">=</span> <span class="mi">70</span> <span class="o">+</span> <span class="n">kFilterMod2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span> <span class="c1">// 70 ± 31
</span>  <span class="n">lpf2</span><span class="p">.</span><span class="n">setCutoffFreq</span><span class="p">(</span><span class="n">cutoff_freq2</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(((</span><span class="kt">char</span><span class="p">)</span><span class="n">lpf1</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aCrunchySound1</span><span class="p">.</span><span class="n">next</span><span class="p">()))</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">lpf2</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aCrunchySound2</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>StateVariableFilter</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/StateVariableFilter/StateVariableFilter.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/StateVariableFilter/StateVariableFilter.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="StateVariableFilterexpand" onclick="javascript:toggleDisplay(StateVariableFilter, StateVariableFilterexpand, StateVariableFiltercollapse)">show sketch</button>
<button id="StateVariableFiltercollapse" style="display:none" onclick="javascript:toggleDisplay(StateVariableFilter, StateVariableFilterexpand, StateVariableFiltercollapse)">hide sketch</button></p>
<div id="StateVariableFilter" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of filtering a wave,
    using Mozzi sonification library.
  
    Demonstrates StateVariable().
  
    Circuit: Audio output on digital pin 9 on a Uno or similar, or
    DAC/A14 on Teensy 3.1, or 
    check the README or https://sensorium.github.com/Mozzi/
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/whitenoise8192_int8.h&gt;
#include &lt;tables/cos2048_int8.h&gt; // for filter modulation
#include &lt;StateVariable.h&gt;
#include &lt;mozzi_rand.h&gt; // for rand()
</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">WHITENOISE8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aNoise</span><span class="p">(</span><span class="n">WHITENOISE8192_DATA</span><span class="p">);</span> <span class="c1">// audio noise
</span><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFilterMod</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>

<span class="n">StateVariable</span> <span class="o">&lt;</span><span class="n">NOTCH</span><span class="o">&gt;</span> <span class="n">svf</span><span class="p">;</span> <span class="c1">// can be LOWPASS, BANDPASS, HIGHPASS or NOTCH
</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">();</span>
  <span class="c1">// cast to float because the resulting freq will be small and fractional
</span>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">AUDIO_RATE</span><span class="o">/</span><span class="n">WHITENOISE8192_SAMPLERATE</span><span class="p">);</span>
  <span class="n">kFilterMod</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.3</span><span class="n">f</span><span class="p">);</span>
  <span class="n">svf</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span>
  <span class="n">svf</span><span class="p">.</span><span class="n">setCentreFreq</span><span class="p">(</span><span class="mi">1200</span><span class="p">);</span>
<span class="p">}</span>



<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span> <span class="c1">// about once every half second
</span>    <span class="n">kFilterMod</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">rand</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="o">/</span><span class="mi">64</span><span class="p">);</span>  <span class="c1">// choose a new modulation frequency
</span>  <span class="p">}</span>
  <span class="kt">int</span> <span class="n">cutoff_freq</span> <span class="o">=</span> <span class="mi">2200</span> <span class="o">+</span> <span class="n">kFilterMod</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="p">;</span>
  <span class="n">svf</span><span class="p">.</span><span class="n">setCentreFreq</span><span class="p">(</span><span class="n">cutoff_freq</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="c1">// watch output levels, they can distort if too high
</span>  <span class="c1">// also, at very resonant settings, the input signal may need attenuating
</span>  <span class="k">return</span> <span class="n">svf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aNoise</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>StateVariableFilter_HIFI</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/StateVariableFilter_HIFI/StateVariableFilter_HIFI.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/StateVariableFilter_HIFI/StateVariableFilter_HIFI.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="StateVariableFilter_HIFIexpand" onclick="javascript:toggleDisplay(StateVariableFilter_HIFI, StateVariableFilter_HIFIexpand, StateVariableFilter_HIFIcollapse)">show sketch</button>
<button id="StateVariableFilter_HIFIcollapse" style="display:none" onclick="javascript:toggleDisplay(StateVariableFilter_HIFI, StateVariableFilter_HIFIexpand, StateVariableFilter_HIFIcollapse)">hide sketch</button></p>
<div id="StateVariableFilter_HIFI" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of filtering audio noise with a resonant filter,
    using Mozzi sonification library.
  
    Demonstrates StateVariable() with acute resonance,
    which in this case requires the input signal level to be reduced 
    to avoid distortion which can occur with sharp resonance settings.
  
    This sketch using HIFI mode is not for Teensy 3.1.
        
    IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be
    be changed from STANDARD mode to HIFI.
    In Mozz/mozzi_config.h, change
    #define AUDIO_MODE STANDARD
    //#define AUDIO_MODE HIFI
    to
    //#define AUDIO_MODE STANDARD
    #define AUDIO_MODE HIFI
  
    Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),
    Check the Mozzi core module documentation for others and more detail
  
                     3.9k 
     pin 9  ---WWWW-----|-----output
                    499k           |
     pin 10 ---WWWW---- |
                                       |
                             4.7n  ==
                                       |
                                   ground
  
    Resistors are ±0.5%  Measure and choose the most precise 
    from a batch of whatever you can get.  Use two 1M resistors
    in parallel if you can't find 499k.
    Alternatively using 39 ohm, 4.99k and 470nF components will 
    work directly with headphones.
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt;
#include &lt;tables/whitenoise8192_int8.h&gt;
#include &lt;StateVariable.h&gt;
</span>


<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">WHITENOISE8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aNoise</span><span class="p">(</span><span class="n">WHITENOISE8192_DATA</span><span class="p">);</span> <span class="c1">// audio noise
</span><span class="n">StateVariable</span> <span class="o">&lt;</span><span class="n">BANDPASS</span><span class="o">&gt;</span> <span class="n">svf</span><span class="p">;</span> <span class="c1">// can be LOWPASS, BANDPASS, HIGHPASS or NOTCH
</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">startMozzi</span><span class="p">();</span>
  <span class="n">aNoise</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.27</span><span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">AUDIO_RATE</span><span class="o">/</span><span class="n">WHITENOISE8192_SAMPLERATE</span><span class="p">);</span>   <span class="c1">// * by an oddish number (1.27) to avoid exact repeating of noise oscil
</span>  <span class="n">svf</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 0 to 255, 0 is the "sharp" end
</span>  <span class="n">svf</span><span class="p">.</span><span class="n">setCentreFreq</span><span class="p">(</span><span class="mi">3500</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">input</span> <span class="o">=</span> <span class="n">aNoise</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// shift down (ie. fast /) to avoid distortion with extreme resonant filter setting
</span>  <span class="kt">int</span> <span class="n">output</span> <span class="o">=</span> <span class="n">svf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">output</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">;</span> <span class="c1">// shift up for HIFI resolution
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<h2 id="11.Communication"> 11.Communication </h2>
<p>Mozzi_MIDI_Input
…(no recording of this one)</p>

<p><button type="button" id="Mozzi_MIDI_Inputexpand" onclick="javascript:toggleDisplay(Mozzi_MIDI_Input, Mozzi_MIDI_Inputexpand, Mozzi_MIDI_Inputcollapse)">show sketch</button>
<button id="Mozzi_MIDI_Inputcollapse" style="display:none" onclick="javascript:toggleDisplay(Mozzi_MIDI_Input, Mozzi_MIDI_Inputexpand, Mozzi_MIDI_Inputcollapse)">hide sketch</button></p>
<div id="Mozzi_MIDI_Input" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of a sound being triggered by MIDI input.
  
    Demonstrates playing notes with Mozzi in response to MIDI input,
    using  Arduino MIDI library v4.2 
    (https://github.com/FortySevenEffects/arduino_midi_library/releases/tag/4.2)
  
    Circuit: 
      MIDI input circuit as per https://arduino.cc/en/Tutorial/Midi
      Note: midi input on rx pin, not tx as in the illustration on the above page.
      Midi has to be disconnected from rx for sketch to upload.
      Audio output on digital pin 9 on a Uno or similar.
    
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2013-14, CC by-nc-sa.
*/</span>


<span class="cp">#include &lt;MIDI.h&gt;
</span>
<span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
#include &lt;mozzi_midi.h&gt;
#include &lt;ADSR.h&gt;
</span>

<span class="n">MIDI_CREATE_DEFAULT_INSTANCE</span><span class="p">();</span>

<span class="c1">// use #define for CONTROL_RATE, not a constant
</span><span class="cp">#define CONTROL_RATE 128 // powers of 2 please
</span>
<span class="c1">// audio sinewave oscillator
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>

<span class="c1">// envelope generator
</span><span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">envelope</span><span class="p">;</span>

<span class="cp">#define LED 13 // shows if MIDI is being recieved
</span>
<span class="kt">void</span> <span class="nf">HandleNoteOn</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">note</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">)</span> <span class="p">{</span> 
  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">note</span><span class="p">)));</span>
  <span class="n">envelope</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span><span class="n">HIGH</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HandleNoteOff</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">note</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">)</span> <span class="p">{</span> 
  <span class="n">envelope</span><span class="p">.</span><span class="n">noteOff</span><span class="p">();</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>  

  <span class="c1">// Connect the HandleNoteOn function to the library, so it is called upon reception of a NoteOn.
</span>  <span class="n">MIDI</span><span class="p">.</span><span class="n">setHandleNoteOn</span><span class="p">(</span><span class="n">HandleNoteOn</span><span class="p">);</span>  <span class="c1">// Put only the name of the function
</span>  <span class="n">MIDI</span><span class="p">.</span><span class="n">setHandleNoteOff</span><span class="p">(</span><span class="n">HandleNoteOff</span><span class="p">);</span>  <span class="c1">// Put only the name of the function
</span>  <span class="c1">// Initiate MIDI communications, listen to all channels (not needed with Teensy usbMIDI)
</span>  <span class="n">MIDI</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">MIDI_CHANNEL_OMNI</span><span class="p">);</span>  
    
  <span class="n">envelope</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">64</span><span class="p">);</span>
  <span class="n">envelope</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span> <span class="c1">// 10000 is so the note will sustain 10 seconds unless a noteOff comes
</span>
  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span> <span class="c1">// default frequency
</span>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> 
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="n">MIDI</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
  <span class="n">envelope</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">envelope</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span> </code></pre></figure>

</div>
<hr />
<p>Mozzi_Processing_Serial
…(no recording of this one)</p>

<p><button type="button" id="Mozzi_Processing_Serialexpand" onclick="javascript:toggleDisplay(Mozzi_Processing_Serial, Mozzi_Processing_Serialexpand, Mozzi_Processing_Serialcollapse)">show sketch</button>
<button id="Mozzi_Processing_Serialcollapse" style="display:none" onclick="javascript:toggleDisplay(Mozzi_Processing_Serial, Mozzi_Processing_Serialexpand, Mozzi_Processing_Serialcollapse)">hide sketch</button></p>
<div id="Mozzi_Processing_Serial" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*
  Modified from Arduino &gt; Examples &gt; Communication &gt; Dimmer
 
 Demonstrates the sending data from the computer to the Arduino board,
 in this case to control the frequency of an oscillator.  The data is sent
 in individual bytes, each of which ranges from 0 to 255.  Arduino
 reads these bytes and uses them to set the frequency of the oscillator.
 
 Circuit: Audio output on digital pin 9. (STANDARD_PLUS mode in mozzi_config.h)
 Serial connection to Processing, Max/MSP, or another serial application
 
 Dimmer example created 2006
 by David A. Mellis
 modified 30 Aug 2011
 by Tom Igoe and Scott Fitzgerald
 This example code is in the public domain.
 
 https://www.arduino.cc/en/Tutorial/Dimmer
 
*/</span>



<span class="cp">#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// uses default control rate of 64
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="c1">// check if data has been sent from the computer:
</span>  <span class="k">if</span> <span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">available</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// read the most recent byte (which will be from 0 to 255):
</span>    <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="n">Serial</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
    <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">val</span><span class="o">+</span><span class="mi">100</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// return an int signal centred around 0
</span><span class="p">}</span>

<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span>

<span class="cm">/* Processing code for this example
 // Dimmer - sends bytes over a serial port
 // by David A. Mellis
 // This code is in the Public Domain.
 
 import processing.serial.*;
 Serial port;
 
 void setup() {
 size(256, 150);
 
 println("Available serial ports:");
 println(Serial.list());
 
 // Uses the first port in this list (number 0).  Change this to
 // select the port corresponding to your Arduino board.  The last
 // parameter (e.g. 9600) is the speed of the communication.  It
 // has to correspond to the value passed to Serial.begin() in your
 // Arduino sketch.
 port = new Serial(this, Serial.list()[0], 9600);  
 
 // If you know the name of the port used by the Arduino board, you
 // can specify it directly like this.
 //port = new Serial(this, "COM1", 9600);
 }
 
 void draw() {
 // draw a gradient from black to white
 for (int i = 0; i &lt; 256; i++) {
 stroke(i);
 line(i, 0, i, 150);
 }
 
 // write the current X-position of the mouse to the serial port as
 // a single byte
 port.write(mouseX);
 }
*/</span>

<span class="cm">/* Max/MSP v5 patch for this example
 
----------begin_max5_patcher----------
1008.3ocuXszaiaCD9r8uhA5rqAeHIa0aAMaAVf1S6hdoYQAsDiL6JQZHQ2M
YWr+2KeX4vjnjXKKkKhhiGQ9MeyCNz+X9rnMp63sQvuB+MLa1OlOalSjUvrC
ymEUytKuh05TKJWUWyk5nE9eSyuS6jesvHu4F4MxOuUzB6X57sPKWVzBLXiP
xZtGj6q2vafaaT0.BzJfjj.p8ZPukazsQvpfcpFs8mXR3plh8BoBxURIOWyK
rxspZ0YI.eTCEh5Vqp+wGtFXZMKe6CZc3yWZwTdCmYW.BBkdiby8v0r+ST.W
sD9SdUkn8FYspPbqvnBNFtZWiUyLmleJWo0vuKzeuj2vpJLaWA7YiE7wREui
FpDFDp1KcbAFcP5sJoVxp4NB5Jq40ougIDxJt1wo3GDZHiNocKhiIExx+owv
AdOEAksDs.RRrOoww1Arc.9RvN2J9tamwjkcqknvAE0l+8WnjHqreNet8whK
z6mukIK4d+Xknv3jstvJs8EirMMhxsZIusET25jXbX8xczIl5xPVxhPcTGFu
xNDu9rXtUCg37g9Q8Yc+EuofIYmg8QdkPCrOnXsaHwYs3rWx9PGsO+pqueG2
uNQBqWFh1X7qQG+3.VHcHrfO1nyR2TlqpTM9MDsLKNCQVz6KO.+Sfc5j1Ykj
jzkn2jwNDRP7LVb3d9LtoWBAOnvB92Le6yRmZ4UF7YpQhiFi7A5Ka8zXhKdA
4r9TRGG7V4COiSbAJKdXrWNhhF0hNUh7uBa4Mba0l7JUK+omjDMwkSn95Izr
TOwkdp7W.oPRmNRQsiKeu4j3CkfVgt.NYPEYqMGvvJ48vIlPiyzrIuZskWIS
xGJPcmPiWOfLodybH3wjPbMYwlbFIMNHPHFOtLBNaLSa9sGk1TxMzCX5KTa6
WIH2ocxSdngM0QPqFRxyPHFsprrhGc9Gy9xoBjz0NWdR2yW9DUa2F85jG2v9
FgTO4Q8qiC7fzzQNpmNpsY3BrYPVJBMJQ1uVmoItRhw9NrVGO3NMNzYZ+zS7
3WTvTOnUydG5kHMKLqAOjTe7fN2bGSxOZDkMrBrGQ9J1gONBEy0k4gVo8qHc
cxmfxVihWz6a3yqY9NazzUYkua9UnynadOtogW.JfsVGRVNEbWF8I+eHtcwJ
+wLXqZeSdWLo+FQF6731Tva0BISKTx.cLwmgJsUTTvkg1YsnXmxDge.CDR7x
D6YmX6fMznaF7kdczmJXwm.XSOOrdoHhNA7GMiZYLZZR.+4lconMaJP6JOZ8
ftCs1YWHZI3o.sIXezX5ihMSuXzZtk3ai1mXRSczoCS32hAydeyXNEu5SHyS
xqZqbd3ZLdera1iPqYxOm++v7SUSz
-----------end_max5_patcher-----------
*/</span></code></pre></figure>

</div>
<hr />
<p><a id="Sinewave_PWM_leds_HIFI top"></a>
Sinewave_PWM_leds_HIFI
…(no recording of this one)</p>

<p><button type="button" id="Sinewave_PWM_leds_HIFIexpand" onclick="javascript:toggleDisplay(Sinewave_PWM_leds_HIFI, Sinewave_PWM_leds_HIFIexpand, Sinewave_PWM_leds_HIFIcollapse)">show sketch</button>
<button id="Sinewave_PWM_leds_HIFIcollapse" style="display:none" onclick="javascript:toggleDisplay(Sinewave_PWM_leds_HIFI, Sinewave_PWM_leds_HIFIexpand, Sinewave_PWM_leds_HIFIcollapse)">hide sketch</button></p>
<div id="Sinewave_PWM_leds_HIFI" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example playing a sinewave 
    and changing the brightness of 3 leds
    using Mozzi sonification library.
  
    Demonstrates the use of Oscil for audio and control,
    and a way to do PWM on digital pins without disrupting audio.
    Control oscillators are used here to modulate the brightness of the leds
    between 0-255.
    The technique is explained here:
     https://playground.arduino.cc/Main/PWMallPins
    With AUDIO_RATE at 16384 Hz, this gives a 64 Hz pwm duty cycle for the LEDs.
    If there is visible flicker, the resolution of the pwm could be made lower,
    or the AUDIO_RATE could be increased to 32768 Hz, if the
    cpu isn't too busy.
  
    HIFI mode is not for Teensy 3.1, but the PWM led part should work.
    
    IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be
    be changed from STANDARD mode to HIFI.
    In Mozz/mozzi_config.h, change
    #define AUDIO_MODE STANDARD
    //#define AUDIO_MODE HIFI
    to
    //#define AUDIO_MODE STANDARD
    #define AUDIO_MODE HIFI
  
  
    Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),
    Check the Mozzi core module documentation for others and more detail
  
                     3.9k 
     pin 9  ---WWWW-----|-----output
                    499k           |
     pin 10 ---WWWW---- |
                                       |
                             4.7n  ==
                                       |
                                   ground
  
    Resistors are ±0.5%  Measure and choose the most precise 
    from a batch of whatever you can get.  Use two 1M resistors
    in parallel if you can't find 499k.
    Alternatively using 39 ohm, 4.99k and 470nF components will 
    work directly with headphones.

    LEDs:
    Red led from pin 3 through a 1.5k resistor to ground
    Green led from pin 4 through a 1.5k resistor to ground
    Blue led from pin 5 through a 1.5k resistor to ground
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2012-13, CC by-nc-sa.
*/</span>


<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
</span>
<span class="c1">// LED pins, use 0-7 for PORTD, otherwise change to PORTB in updateRGB
</span><span class="k">const</span> <span class="n">byte</span> <span class="n">RED_PIN</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">const</span> <span class="n">byte</span> <span class="n">GREEN_PIN</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="k">const</span> <span class="n">byte</span> <span class="n">BLUE_PIN</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>

<span class="n">byte</span> <span class="n">red_brightness</span><span class="p">,</span> <span class="n">green_brightness</span><span class="p">,</span> <span class="n">blue_brightness</span><span class="p">;</span>

<span class="c1">// control oscillators using sinewaves to modulate LED brightness
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kRed</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kGreen</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
<span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kBlue</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>

<span class="c1">// audio oscillator
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>


<span class="kt">void</span> <span class="n">updateRGB</span><span class="p">(</span><span class="n">byte</span> <span class="n">r</span><span class="p">,</span> <span class="n">byte</span> <span class="n">g</span><span class="p">,</span> <span class="n">byte</span> <span class="n">b</span><span class="p">){</span>
  <span class="c1">// stagger pwm counter starts to try to reduce combined flicker
</span>  <span class="k">static</span> <span class="n">byte</span> <span class="n">red_count</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="k">static</span> <span class="n">byte</span> <span class="n">green_count</span><span class="o">=</span><span class="mi">85</span><span class="p">;</span>
  <span class="k">static</span> <span class="n">byte</span> <span class="n">blue_count</span><span class="o">=</span><span class="mi">170</span><span class="p">;</span>
<span class="c1">// PORTD maps to Arduino digital pins 0 to 7
// https://playground.arduino.cc/Learning/PortManipulation
</span>  <span class="p">(</span><span class="n">red_count</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="n">r</span><span class="p">)</span> <span class="o">?</span> <span class="n">PORTD</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">RED_PIN</span><span class="p">)</span> <span class="o">:</span> <span class="n">PORTD</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">RED_PIN</span><span class="p">);</span>
  <span class="p">(</span><span class="n">green_count</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="n">g</span><span class="p">)</span> <span class="o">?</span> <span class="n">PORTD</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">GREEN_PIN</span><span class="p">)</span> <span class="o">:</span> <span class="n">PORTD</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">GREEN_PIN</span><span class="p">);</span>
  <span class="p">(</span><span class="n">blue_count</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">)</span> <span class="o">?</span> <span class="n">PORTD</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">BLUE_PIN</span><span class="p">)</span> <span class="o">:</span> <span class="n">PORTD</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">BLUE_PIN</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">RED_PIN</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">GREEN_PIN</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">BLUE_PIN</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
  <span class="c1">// set led brightness modulation frequencies
</span>  <span class="n">kRed</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.21</span><span class="n">f</span><span class="p">);</span>
  <span class="n">kGreen</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.3</span><span class="n">f</span><span class="p">);</span>
  <span class="n">kBlue</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.27</span><span class="n">f</span><span class="p">);</span>
  <span class="c1">// set audio oscil frequency
</span>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span> 
  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// uses the default control rate of 64, defined in mozzi_config.h
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="n">red_brightness</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="n">kRed</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  <span class="n">green_brightness</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="n">kGreen</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  <span class="n">blue_brightness</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="n">kBlue</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="n">updateRGB</span><span class="p">(</span><span class="n">red_brightness</span><span class="p">,</span> <span class="n">green_brightness</span><span class="p">,</span> <span class="n">blue_brightness</span><span class="p">);</span>
  <span class="c1">// this would make more sense with a higher resolution signal
</span>  <span class="c1">// but still benefits from using HIFI to avoid the 16kHz pwm noise
</span>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="c1">// 8 bits scaled up to 14 bits
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Teensy_USB_MIDI_Input</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/11.Communication/Teensy_USB_MIDI_Input/Teensy_USB_MIDI_Input.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/11.Communication/Teensy_USB_MIDI_Input/Teensy_USB_MIDI_Input.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Teensy_USB_MIDI_Inputexpand" onclick="javascript:toggleDisplay(Teensy_USB_MIDI_Input, Teensy_USB_MIDI_Inputexpand, Teensy_USB_MIDI_Inputcollapse)">show sketch</button>
<button id="Teensy_USB_MIDI_Inputcollapse" style="display:none" onclick="javascript:toggleDisplay(Teensy_USB_MIDI_Input, Teensy_USB_MIDI_Inputexpand, Teensy_USB_MIDI_Inputcollapse)">hide sketch</button></p>
<div id="Teensy_USB_MIDI_Input" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example of a sound being triggered by MIDI input.
  
    Demonstrates playing notes with Mozzi in response to MIDI input,
    using the version of the Arduino MIDI library which
    works with Teensy boards (https://www.pjrc.com/teensy/td_midi.html).  
    Tested on a Teensy2++, which can be used as a MIDI device 
    without any extra parts.  
    The sketch would be almost the same with the mainstream
    MIDI library (using MIDI as a prefix to calls instead of usbMIDI).
    This sketch won't compile on the Teensy2++ if you also 
    have the mainstream MIDI library installed.
  
    Circuit: On the Teensy2++, audio output is on pin B5.  Midi input on usb.
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Tim Barrass 2013, CC by-nc-sa.
*/</span>

<span class="cp">#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
#include &lt;MIDI.h&gt;
</span>
<span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
#include &lt;mozzi_midi.h&gt;
#include &lt;ADSR.h&gt;
</span>

<span class="c1">// use #define for CONTROL_RATE, not a constant
</span><span class="cp">#define CONTROL_RATE 128 // powers of 2 please
</span>
<span class="c1">// audio sinewave oscillator
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>

<span class="c1">// envelope generator
</span><span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">envelope</span><span class="p">;</span>

<span class="cp">#define LED 6 // 6 on Teensy++ 2.0, 11 on Teensy 2.0, to see if MIDI is being recieved
</span>
<span class="kt">void</span> <span class="nf">HandleNoteOn</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">note</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">)</span> <span class="p">{</span> 
  <span class="c1">//aSin.setFreq(mtof(note)); // simple but less accurate frequency
</span>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="n">note</span><span class="p">)));</span> <span class="c1">// accurate frequency
</span>  <span class="n">envelope</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span><span class="n">HIGH</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HandleNoteOff</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">note</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">)</span> <span class="p">{</span> 
  <span class="n">envelope</span><span class="p">.</span><span class="n">noteOff</span><span class="p">();</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>   

  <span class="c1">// Connect the HandleNoteOn function to the library, so it is called upon reception of a NoteOn.
</span>  <span class="n">usbMIDI</span><span class="p">.</span><span class="n">setHandleNoteOn</span><span class="p">(</span><span class="n">HandleNoteOn</span><span class="p">);</span>  <span class="c1">// Put only the name of the function
</span>  <span class="n">usbMIDI</span><span class="p">.</span><span class="n">setHandleNoteOff</span><span class="p">(</span><span class="n">HandleNoteOff</span><span class="p">);</span>  <span class="c1">// Put only the name of the function
</span>
  <span class="n">envelope</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">64</span><span class="p">);</span>
  <span class="n">envelope</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span> <span class="c1">// 10000 is so the note will sustain 10 seconds unless a noteOff comes
</span>
  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span> <span class="c1">// default frequency
</span>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> 
<span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="n">usbMIDI</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
  <span class="n">envelope</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">envelope</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span> </code></pre></figure>

</div>
<hr />
<p>TwoWire_Read_ADXL345
…(no recording of this one)</p>

<p><button type="button" id="TwoWire_Read_ADXL345expand" onclick="javascript:toggleDisplay(TwoWire_Read_ADXL345, TwoWire_Read_ADXL345expand, TwoWire_Read_ADXL345collapse)">show sketch</button>
<button id="TwoWire_Read_ADXL345collapse" style="display:none" onclick="javascript:toggleDisplay(TwoWire_Read_ADXL345, TwoWire_Read_ADXL345expand, TwoWire_Read_ADXL345collapse)">hide sketch</button></p>
<div id="TwoWire_Read_ADXL345" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example reading an ADXL345 accelerometer
    using I2C communication without blocking audio synthesis,
    using Mozzi sonification library.
  
    Demonstrates use of twi_nonblock functions
    to replace processor-blocking Wire methods.
    
    Note: The twi_nonblock code is not compatible with Teesy 3.1.
    
    Circuit: Audio output on digital pin 9.
  
    Mozzi help/discussion/announcements:
    https://groups.google.com/forum/#!forum/mozzi-users
  
    Marije Baalman 2012.
    Small modifications by TIm Barrass to retain Mozzi compatibility.
    This example code is in the public domain.
*/</span>

<span class="cp">#include &lt;MozziGuts.h&gt;
#include &lt;Oscil.h&gt; // oscillator template
#include &lt;Ead.h&gt; // exponential attack decay
#include &lt;tables/sin2048_int8.h&gt; // sine table for oscillator
#include &lt;twi_nonblock.h&gt;
</span>
<span class="cp">#define CONTROL_RATE 128 // powers of 2 please
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
<span class="n">Ead</span> <span class="n">kEnvelope</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// resolution will be CONTROL_RATE
</span>
<span class="kt">int</span> <span class="n">gain</span><span class="p">;</span>


<span class="cp">#define ADXL345_DEVICE (0x53)    // ADXL345 device address
</span>
<span class="cp">#define ADXL345_POWER_CTL 0x2d
#define ADXL345_DATA_FORMAT 0x31
#define ADXL345_DATAX0 0x32
</span>
<span class="cp">#define ADXL345_THRESH_INACT 0x25
#define ADXL345_TIME_INACT 0x26
#define ADXL345_ACT_INACT_CTL 0x27
</span>

<span class="k">static</span> <span class="k">volatile</span> <span class="n">byte</span> <span class="n">acc_status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#define ACC_IDLE 0
#define ACC_READING 1
#define ACC_WRITING 2
</span>
<span class="n">byte</span> <span class="n">accbytedata</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>

<span class="kt">void</span> <span class="n">setup_accelero</span><span class="p">(){</span>
  <span class="n">initialize_twi_nonblock</span><span class="p">();</span>

  <span class="n">acc_writeTo</span><span class="p">(</span><span class="n">ADXL345_POWER_CTL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>  <span class="c1">// all registers off
</span>  <span class="n">acc_writeTo</span><span class="p">(</span><span class="n">ADXL345_POWER_CTL</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span> <span class="c1">// auto sleep on
</span>
  <span class="c1">//   ADXL345_DATA_FORMAT : (self test)(spi)(int_invert)(0)(fullres)(justify)(range..)
</span>  <span class="c1">//   11 //= B00001011
</span>  <span class="n">acc_writeTo</span><span class="p">(</span> <span class="n">ADXL345_DATA_FORMAT</span><span class="p">,</span> <span class="mi">11</span> <span class="p">);</span>

  <span class="c1">// set the threshold for inactivity
</span>  <span class="c1">//   acc_writeTo( ADXL345_THRESH_INACT, inactivityThreshold );
</span>  <span class="c1">//   acc_writeTo( ADXL345_TIME_INACT, inactivityTime );
</span>  <span class="c1">// 0B10001111
</span>  <span class="c1">//   acc_writeTo( ADXL345_ACT_INACT_CTL, B10001111 ); 
</span>  <span class="c1">//   acc_writeTo(ADXL345_POWER_CTL, B00111000); 
</span>
  <span class="n">acc_writeTo</span><span class="p">(</span><span class="n">ADXL345_POWER_CTL</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>  <span class="c1">// auto sleep off, measure on
</span>
  <span class="n">acc_status</span> <span class="o">=</span> <span class="n">ACC_IDLE</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">/// ---------- non-blocking version ----------
</span><span class="kt">void</span> <span class="n">initiate_read_accelero</span><span class="p">(){</span>
  <span class="c1">// Reads num bytes starting from address register on device in to _buff array
</span>  <span class="c1">// indicate that we are transmitting
</span>  <span class="c1">//   transmitting = 1;
</span>  <span class="c1">// set address of targeted slave
</span>  <span class="n">txAddress</span> <span class="o">=</span> <span class="n">ADXL345_DEVICE</span><span class="p">;</span>
  <span class="c1">// reset tx buffer iterator vars
</span>  <span class="n">txBufferIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">txBufferLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  

  <span class="c1">// put byte in tx buffer
</span>  <span class="n">txBuffer</span><span class="p">[</span><span class="n">txBufferIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">ADXL345_DATAX0</span><span class="p">;</span>
  <span class="o">++</span><span class="n">txBufferIndex</span><span class="p">;</span>
  <span class="c1">// update amount in buffer   
</span>  <span class="n">txBufferLength</span> <span class="o">=</span> <span class="n">txBufferIndex</span><span class="p">;</span>

  <span class="n">twi_initiateWriteTo</span><span class="p">(</span><span class="n">txAddress</span><span class="p">,</span> <span class="n">txBuffer</span><span class="p">,</span> <span class="n">txBufferLength</span><span class="p">);</span>
  <span class="n">acc_status</span> <span class="o">=</span> <span class="n">ACC_WRITING</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">initiate_request_accelero</span><span class="p">(){</span>
  <span class="c1">// reset tx buffer iterator vars
</span>  <span class="n">txBufferIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">txBufferLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="c1">// indicate that we are done transmitting
</span>  <span class="c1">//   transmitting = 0;
</span>
  <span class="n">byte</span> <span class="n">read</span> <span class="o">=</span> <span class="n">twi_initiateReadFrom</span><span class="p">(</span><span class="n">ADXL345_DEVICE</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
  <span class="n">acc_status</span> <span class="o">=</span> <span class="n">ACC_READING</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">finalise_request_accelero</span><span class="p">(){</span>
  <span class="n">byte</span> <span class="n">read</span> <span class="o">=</span> <span class="n">twi_readMasterBuffer</span><span class="p">(</span> <span class="n">rxBuffer</span><span class="p">,</span> <span class="mi">6</span> <span class="p">);</span>
  <span class="c1">// set rx buffer iterator vars
</span>  <span class="n">rxBufferIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">rxBufferLength</span> <span class="o">=</span> <span class="n">read</span><span class="p">;</span>

  <span class="n">byte</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span> <span class="n">rxBufferLength</span> <span class="o">-</span> <span class="n">rxBufferIndex</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>         <span class="c1">// device may send less than requested (abnormal)
</span>  <span class="p">{</span> 
    <span class="n">accbytedata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rxBuffer</span><span class="p">[</span><span class="n">rxBufferIndex</span><span class="p">];</span>
    <span class="o">++</span><span class="n">rxBufferIndex</span><span class="p">;</span>
    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">acc_status</span> <span class="o">=</span> <span class="n">ACC_IDLE</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">/// ----end------ non-blocking version ----------
</span>
<span class="c1">// Writes val to address register on device
</span><span class="kt">void</span> <span class="n">acc_writeTo</span><span class="p">(</span><span class="n">byte</span> <span class="n">address</span><span class="p">,</span> <span class="n">byte</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">//   Wire.beginTransmission(ADXL345_DEVICE); // start transmission to device   
</span>  <span class="n">twowire_beginTransmission</span><span class="p">(</span><span class="n">ADXL345_DEVICE</span><span class="p">);</span> <span class="c1">// start transmission to device   
</span>  <span class="c1">//   Wire.send(address);             // send register address
</span>  <span class="n">twowire_send</span><span class="p">(</span> <span class="n">address</span> <span class="p">);</span>
  <span class="c1">//   Wire.send(val);                 // send value to write
</span>  <span class="n">twowire_send</span><span class="p">(</span> <span class="n">val</span> <span class="p">);</span>  
  <span class="c1">//   Wire.endTransmission();         // end transmission
</span>  <span class="n">twowire_endTransmission</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">setup_accelero</span><span class="p">();</span>
  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">800</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">attack</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">decay</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>
  <span class="n">kEnvelope</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span><span class="n">decay</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">accx</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">accy</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">accz</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">envgain</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>  
  <span class="n">envgain</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">kEnvelope</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span> <span class="n">envgain</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">accx</span> <span class="o">&gt;</span> <span class="mi">512</span><span class="p">){</span>
      <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span> <span class="mi">400</span> <span class="p">);</span>
      <span class="n">kEnvelope</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
    <span class="p">}</span> 
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">accy</span> <span class="o">&gt;</span> <span class="mi">512</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span> <span class="mi">800</span> <span class="p">);</span>
      <span class="n">kEnvelope</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
    <span class="p">}</span> 
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">accz</span> <span class="o">&gt;</span> <span class="mi">512</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span> <span class="mi">1200</span> <span class="p">);</span>
      <span class="n">kEnvelope</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">switch</span><span class="p">(</span> <span class="n">acc_status</span> <span class="p">){</span>
  <span class="k">case</span> <span class="n">ACC_IDLE</span><span class="p">:</span>
    <span class="n">accx</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">accbytedata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">256</span> <span class="o">+</span> <span class="n">accbytedata</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// accelerometer x reading
</span>    <span class="n">accy</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">accbytedata</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mi">256</span> <span class="o">+</span> <span class="n">accbytedata</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span> <span class="c1">// accelerometer y reading
</span>    <span class="n">accz</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">accbytedata</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="mi">256</span> <span class="o">+</span> <span class="n">accbytedata</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span> <span class="c1">// accelerometer z reading
</span>    <span class="n">initiate_read_accelero</span><span class="p">();</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">ACC_WRITING</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">TWI_MTX</span> <span class="o">!=</span> <span class="n">twi_state</span> <span class="p">){</span>
      <span class="n">initiate_request_accelero</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">ACC_READING</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">TWI_MRX</span> <span class="o">!=</span> <span class="n">twi_state</span> <span class="p">){</span>
      <span class="n">finalise_request_accelero</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">gain</span> <span class="o">=</span> <span class="n">envgain</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gain</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />
<h2 id="12.Misc"> 12.Misc </h2>
<p>IntMap_test
…(no recording of this one)</p>

<p><button type="button" id="IntMap_testexpand" onclick="javascript:toggleDisplay(IntMap_test, IntMap_testexpand, IntMap_testcollapse)">show sketch</button>
<button id="IntMap_testcollapse" style="display:none" onclick="javascript:toggleDisplay(IntMap_test, IntMap_testexpand, IntMap_testcollapse)">hide sketch</button></p>
<div id="IntMap_test" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/* Maps a range of input numbers to an output range, comparing
	 the results of Mozzi's IntMap object with Arduino map().
	
	 Demonstrates IntMap, a fast integer replacement for map().
	 
	 Circuit: not required
	
	 Mozzi help/discussion/announcements:
	 https://groups.google.com/forum/#!forum/mozzi-users
	
	 Tim Barrass 2014, CC by-nc-sa.
*/</span>

<span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install https://github.com/pedvide/ADC
</span><span class="cp">#include &lt;IntMap.h&gt;
</span>
<span class="k">const</span> <span class="n">IntMap</span> <span class="n">testIntMap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1000</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>

  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2000</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5000</span><span class="p">){</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">testIntMap</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"testIntMap: </span><span class="se">\t</span><span class="s">"</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">DEC</span><span class="p">);</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">map</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1000</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"</span><span class="se">\t</span><span class="s"> map: </span><span class="se">\t</span><span class="s">"</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">DEC</span><span class="p">);</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">7</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
<span class="p">}</span></code></pre></figure>

</div>
<hr />
<p>Stereo_Hack</p>

<audio controls="">
<source type="audio/ogg" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/12.Misc/Stereo_Hack/Stereo_Hack.ogg?raw=true" preload="auto" />&lt;/source&gt;
<source type="audio/mp3" src="https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/12.Misc/Stereo_Hack/Stereo_Hack.mp3?raw=true" preload="auto" />&lt;/source&gt;
Your browser does not support the audio element.</audio>

<p><button type="button" id="Stereo_Hackexpand" onclick="javascript:toggleDisplay(Stereo_Hack, Stereo_Hackexpand, Stereo_Hackcollapse)">show sketch</button>
<button id="Stereo_Hackcollapse" style="display:none" onclick="javascript:toggleDisplay(Stereo_Hack, Stereo_Hackexpand, Stereo_Hackcollapse)">hide sketch</button></p>
<div id="Stereo_Hack" style="display:none">

<figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cm">/*  Example crudely panning noise to test stereo output hack,
 *  using Mozzi sonification library.
 *
 *  Tests stereo output hack.  This requires #define STEREO_HACK true in mozzi_config.h
 *
 *  Circuit: Audio outputs on digital pins 9 and 10.
 *
 *  Mozzi help/discussion/announcements:
 *  https://groups.google.com/forum/#!forum/mozzi-users
 *
 *  Tim Barrass 2012.
 *  This example code is in the public domain.
 */</span>

<span class="cp">#include &lt;MozziGutsStereo.h&gt;
#include &lt;Phasor.h&gt; // for controlling panning position
#include &lt;Oscil.h&gt; // oscil for audio sig
#include &lt;tables/pinknoise8192_int8.h&gt; // table for oscillator
</span>

<span class="c1">// use #define for CONTROL_RATE, not a constant
</span><span class="cp">#define CONTROL_RATE 64 // powers of 2 please
</span>
<span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)
</span><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">PINKNOISE8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aNoise</span><span class="p">(</span><span class="n">PINKNOISE8192_DATA</span><span class="p">);</span>

<span class="c1">//Phasor for panning
</span><span class="n">Phasor</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kPan</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pan</span><span class="p">;</span> <span class="c1">// convey pan from updateControl() to updateAudioStereo();
</span>

<span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
  <span class="n">aNoise</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.111</span><span class="n">f</span><span class="p">);</span> <span class="c1">// set the frequency with an unsigned int or a float
</span>  <span class="n">kPan</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.25</span><span class="n">f</span><span class="p">);</span> <span class="c1">// take 4 seconds to move left-right
</span>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// set a control rate of 64 (powers of 2 please)
</span><span class="p">}</span>


<span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
  <span class="n">pan</span> <span class="o">=</span> <span class="n">kPan</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="n">audio_signal_1</span><span class="p">,</span> <span class="n">audio_signal_2</span><span class="p">;</span> <span class="c1">// required for the stereo hack
</span>
<span class="kt">void</span> <span class="n">updateAudioStereo</span><span class="p">(){</span>
  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">aNoise</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
  <span class="n">audio_signal_1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(((</span><span class="kt">long</span><span class="p">)</span><span class="n">pan</span><span class="o">*</span><span class="n">asig</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">);</span>
  <span class="n">audio_signal_2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((((</span><span class="kt">long</span><span class="p">)</span><span class="mi">65535</span><span class="o">-</span><span class="n">pan</span><span class="p">)</span><span class="o">*</span><span class="n">asig</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here
</span><span class="p">}</span></code></pre></figure>

</div>
<hr />


        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      
    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
    
    
    <li><a href="/Mozzi/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 Tim Barrass. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/Mozzi/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"></script>








  </body>
</html>