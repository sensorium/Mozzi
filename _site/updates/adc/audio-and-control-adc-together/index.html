<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.14.1 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Audio and Control ADC together - Mozzi</title>
<meta name="description" content="Version 2013-07-29-18:09 enables audio and control rate analog inputs to work at the same time.Audio input is on analog pin A0.  Each time an audio sample is output, the audio input is sampled.For each audio input sample, one control input is also converted, by changing the input channel andtriggering two conversions in a row using the ADC interrupt, keeping the second reading because the firstis unreliable, then switching the channel back to 0 again for audio input and starting another audio conversion, whichis also discarded.  Then the cycle goes again with the next audio output triggering a second, usable, audio input sample.Each time, one control input is stored, until the list of analog channels waiting to be sampled is empty.The audio samples continue alone until the next control interrupt, when a sketch has adcReadAllChannels() in updateControl().">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_GB">
<meta property="og:site_name" content="Mozzi">
<meta property="og:title" content="Audio and Control ADC together">
<meta property="og:url" content="http://localhost:4000/Mozzi/updates/adc/audio-and-control-adc-together/">


  <meta property="og:description" content="Version 2013-07-29-18:09 enables audio and control rate analog inputs to work at the same time.Audio input is on analog pin A0.  Each time an audio sample is output, the audio input is sampled.For each audio input sample, one control input is also converted, by changing the input channel andtriggering two conversions in a row using the ADC interrupt, keeping the second reading because the firstis unreliable, then switching the channel back to 0 again for audio input and starting another audio conversion, whichis also discarded.  Then the cycle goes again with the next audio output triggering a second, usable, audio input sample.Each time, one control input is stored, until the list of analog channels waiting to be sampled is empty.The audio samples continue alone until the next control interrupt, when a sketch has adcReadAllChannels() in updateControl().">



  <meta property="og:image" content="http://localhost:4000/Mozzi/assets/images/mozzi-square.png">





  <meta property="article:published_time" content="2013-07-29T18:24:00+10:00">





  

  


<link rel="canonical" href="http://localhost:4000/Mozzi/updates/adc/audio-and-control-adc-together/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Tim Barrass",
      "url": "http://localhost:4000/Mozzi",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/Mozzi/feed.xml" type="application/atom+xml" rel="alternate" title="Mozzi Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/Mozzi/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/Mozzi/">Mozzi</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/Mozzi/download/" >download</a>
            </li><li class="masthead__menu-item">
              <a href="/Mozzi/gallery/" >gallery</a>
            </li><li class="masthead__menu-item">
              <a href="/Mozzi/examples/" >examples</a>
            </li><li class="masthead__menu-item">
              <a href="/Mozzi/learn/" >learn</a>
            </li><li class="masthead__menu-item">
              <a href="https://groups.google.com/forum/?utm_medium=email&utm_source=footer#!forum/mozzi-users" >forum</a>
            </li><li class="masthead__menu-item">
              <a href="/Mozzi/blog/" >blog</a>
            </li><li class="masthead__menu-item">
              <a href="/Mozzi/doc/html/" >api</a>
            </li><li class="masthead__menu-item">
              <a href="https://github.com/sensorium/Mozzi" >github</a>
            </li><li class="masthead__menu-item">
              <a href="/Mozzi/shop/" >shop</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  











<div class="page__hero--overlay"
  style=" background-image: url('/Mozzi/assets/images/mozzi-square.png');"
>
  
    <div class="wrapper">
      <h1 class="page__title" itemprop="headline">
        
          <!--Audio and Control ADC together
-->
          Mozzi

        
      </h1>
      <!-- 
        <p class="page__lead">Version 2013-07-29-18:09 enables audio and control rate analog inputs to work at the same time.
Audio input is on analog pin A0.  Each time an audio sample is output, the audio input is sampled.
For each audio input sample, one control input is also converted, by changing the input channel and
triggering two conversions in a row using the ADC interrupt, keeping the second reading because the first
is unreliable, then switching the channel back to 0 again for audio input and starting another audio conversion, which
is also discarded.  Then the cycle goes again with the next audio output triggering a second, usable, audio input sample.
Each time, one control input is stored, until the list of analog channels waiting to be sampled is empty.
The audio samples continue alone until the next control interrupt, when a sketch has adcReadAllChannels() in updateControl().

</p>
       -->
      
        <p class="page__lead">audio synthesis library for Arduino
</p>
      
      
      
    </div>
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Tim Barrass</h3>
    
    
      <p class="author__bio" itemprop="description">
        
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name"></span>
        </li>
      

      

      

      
        <li>
          <a href="mailto:faveflave@gmail.com">
            <meta itemprop="email" content="faveflave@gmail.com" />
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Audio and Control ADC together">
    <meta itemprop="description" content="Version 2013-07-29-18:09 enables audio and control rate analog inputs to work at the same time.Audio input is on analog pin A0.  Each time an audio sample is output, the audio input is sampled.For each audio input sample, one control input is also converted, by changing the input channel andtriggering two conversions in a row using the ADC interrupt, keeping the second reading because the firstis unreliable, then switching the channel back to 0 again for audio input and starting another audio conversion, whichis also discarded.  Then the cycle goes again with the next audio output triggering a second, usable, audio input sample.Each time, one control input is stored, until the list of analog channels waiting to be sampled is empty.The audio samples continue alone until the next control interrupt, when a sketch has adcReadAllChannels() in updateControl().">
    <meta itemprop="datePublished" content="July 29, 2013">
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        
        <p>Version 2013-07-29-18:09 enables audio and control rate analog inputs to work at the same time.
Audio input is on analog pin A0.  Each time an audio sample is output, the audio input is sampled.
For each audio input sample, one control input is also converted, by changing the input channel and
triggering two conversions in a row using the ADC interrupt, keeping the second reading because the first
is unreliable, then switching the channel back to 0 again for audio input and starting another audio conversion, which
is also discarded.  Then the cycle goes again with the next audio output triggering a second, usable, audio input sample.
Each time, one control input is stored, until the list of analog channels waiting to be sampled is empty.
The audio samples continue alone until the next control interrupt, when a sketch has adcReadAllChannels() in updateControl().</p>

<p>You can test it with examples/04.Analog_Input/Audio_and_Control_Input and examples/04.Analog_Input/Audio_Input_with_Knob_Filter.</p>

<p>Also, now the Mozzi library downloads as Mozzi.zip and unzips as Mozzi, instead of sensorium-Mozzi-r4783rth43t or whatever.</p>

<p>The NEWS.txt entry for this release is:</p>

<ul>
  <li>IMPORTANT: renamed RecentAverage.h to RollingAverage.h.  Update sketches accordingly.</li>
  <li>mozzi_analog.h
    <ul>
      <li>added the ability to sample audio and control rate analog inputs at the same time</li>
      <li>added options for setupFastAnalogRead(), default is FAST (adc clock div main clock by 16, same as previously),
  and setupFastAnalogRead(FASTER) and FASTEST for divide by 8 and divide by 4.  These faster rates risk being less accurate 
  (see docs for setupFastAnalogRead), but FASTER (or FASTEST) is required for audio input with control inputs at the same time.</li>
    </ul>
  </li>
  <li>added examples/04.Analog_Input/Audio_and_Control_Input</li>
  <li>added examples/04.Analog_Input/Audio_Input_with_Knob_Filter</li>
  <li>removed examples/04.Analog_Input/Audio_Input_with_Filter_Control</li>
  <li>RollingAverage.h - change unsigned char index to unsigned int and same for num_readings_as_rshift, so more than 255 items can be averaged</li>
  <li>added audioTicks(), returns how many audio samples have been played since the program started - this will overflow less often than mozziMicros().</li>
  <li>mozziMicros() was wrong, audioticks/us-per-tick… fixed, now audioticks*us-per-tick</li>
  <li>added Stack.h, a simple stack class used internally for reading analog control inputs via adcReadAllChannels().</li>
  <li>added RollingStat.h, which calculates an approximation of the variance and standard deviation for a window of recent inputs, 
  for doing things with sensor inputs.</li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/Mozzi/categories/#adc" class="page__taxonomy-item" rel="tag">adc</a><span class="sep">, </span>
    
      
      
      <a href="/Mozzi/categories/#updates" class="page__taxonomy-item" rel="tag">updates</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2013-07-29T18:24:00+10:00">July 29, 2013</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Audio+and+Control+ADC+together%20http%3A%2F%2Flocalhost%3A4000%2FMozzi%2Fupdates%2Fadc%2Faudio-and-control-adc-together%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2FMozzi%2Fupdates%2Fadc%2Faudio-and-control-adc-together%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http%3A%2F%2Flocalhost%3A4000%2FMozzi%2Fupdates%2Fadc%2Faudio-and-control-adc-together%2F" class="btn btn--google-plus" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Google Plus"><i class="fab fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2FMozzi%2Fupdates%2Fadc%2Faudio-and-control-adc-together%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/Mozzi/workshops/icad2013-workshop-announcement/" class="pagination--pager" title="ICAD2013 workshop announcement
">Previous</a>
    
    
      <a href="/Mozzi/conference/talk/upcoming-mozzi-talk-at-icmc2013-in-perth/" class="pagination--pager" title="Upcoming Mozzi talk at ICMC2013 in Perth
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/Mozzi"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/Mozzi/mozzibyte-workshop-at-audiomostly/" rel="permalink">MozziByte workshop at AudioMostly in Wales
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">The 2018 Conference Programme from 12-14 September at Wrexham Glyndŵr University in Wales, UK includes a MozziByte Workshop for attendees…
</p>
  </article>
</div>
        
          
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/Mozzi"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/Mozzi/mozzibyte-synth-shield-kickstarter-launched/" rel="permalink">MozziByte synth shield kickstarter launched
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">MozziByte, a shield for the Arduino Pro Mini.  On kickstarter.

</p>
  </article>
</div>
        
          
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/Mozzi"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/Mozzi/v1-dot-0-3rc6-hifi-works/" rel="permalink">v1.0.3rc6 HIFI works
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">HIFI actually works this time… ie. it’s unbroken
</p>
  </article>
</div>
        
          
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src=
          
            "/Mozzi"
          
          alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/Mozzi/releases,/bugfix/v1-dot-0-3rc5-hifi-compile-fix/" rel="permalink">v1.0.3rc5 HIFI compile fix
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read
</p>
    
    <p class="archive__item-excerpt" itemprop="description">HIFI sketches compile again. The problems were due to more errors around changes in Mozzi’s modified FrequencyTimer2 library usage which were not tested prop...</p>
  </article>
</div>
        
      </div>
    </div>
  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    

    <li><a href="/Mozzi/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2018 Tim Barrass. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/Mozzi/assets/js/main.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>








  </body>
</html>
