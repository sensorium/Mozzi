
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Audio and Control ADC together - MOZZI</title>
  <meta name="author" content="Tim Barrass">
  
  
  <meta name="description" content="Mozzi is a sound synthesis software library for Arduino." />

  
  <meta name="keywords" content="Applications : sound, music, audio, synthesis, synthesiser, synthesizer, sound art, electronic music, computer music, generative music, sonification, media art, performance, installation, electronic art, creative art, interactive art, Software: library, arduino, open source, extendable, free, Audience: artists, scientists, teachers, learners, students, hobby, do it yourself, diy, makers, creators, musicians, engineers, collaborators" />

  <!-- https://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sensorium.github.io/Mozzi//blog/2013/07/29/audio-and-control-adc-together">
  <link href="/Mozzi/favicon.png" rel="icon">
  <link href="/Mozzi/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/Mozzi/atom.xml" rel="alternate" title="MOZZI" type="application/atom+xml">
  <script src="/Mozzi/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/Mozzi/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at https://google.com/webfonts -->

<link href='https://fonts.googleapis.com/css?family=Londrina+Solid&text=MOZZI' rel='stylesheet' type='text/css'>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32577259-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'https://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner">
<div id="header_wrap">
	
	<hgroup>
		<h1 id="banner_main_title"><a href="/Mozzi/">MOZZI</a></h1>
		
		
			<h2>sound synthesis library for Arduino</h2>
		
	</hgroup>
	
	<img src="/Mozzi/images/mozzi-circle.gif" id="mozzi_logo"/> 
	<img src="/Mozzi/images/lee.gif" id="lee"/>

	<section id="header_links_section">
		<p>
			<a  class="header_link" href="https://github.com/sensorium/Mozzi"> 
				<span id="header_small_label">View on <i class="icon-github icon-2x"></i> GitHub</span>
			</a>
		</p>
		<p>
			<!-- <a class="header_link" href="https://github.com/sensorium/Mozzi/zipball/master"> -->
			<!-- <a class="header_link" href="https://tinyurl.com/mozzilib/Mozzi.zip"> -->
			<a class="header_link" href="/Mozzi/download/">
				download<br>
				<i class="icon-download icon-4x"></i><br>
				<span id="header_small_label">version 2014-08-09-14:15</span>
			</a>
		</p>
	</section> 

</div>



</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/Mozzi/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <!-- <input type="hidden" name="q" value="site:sensorium.github.io/Mozzi/" /> -->
    <input type="hidden" name="q" value="https://sensorium.github.io/Mozzi/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/Mozzi/">Home</a></li>
  <li><a href="/Mozzi/examples/">Examples</a></li>
  <li><a href="/Mozzi/learn/">Learn</a></li>
  <li><a href="/Mozzi/gallery/">Gallery</a></li>
  <li><a href="/Mozzi/faq/">FAQ</a></li>
  <li><a href="https://groups.google.com/forum/#!forum/mozzi-users/">Forum</a></li>
  <li><a href="https://sensorium.github.com/Mozzi/doc/html/index.html">API</a></li>
  <!-- <li><a href="https://mozzi.sharetribe.com/">Market</a></li> -->
  <!-- <li><a href="/Mozzi/download/">Download</a></li> -->
  <!-- <li><a href="/Mozzi/blog/">Blog</a></li> -->
  <!-- <li><a href="/Mozzi/resources/">Resources</a></li>   -->
  <!-- <li><a href="/Mozzi/blog/archives/">Archives</a></li>
  <li><a href="/Mozzi/about/">About</a></li> -->
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Audio and Control ADC Together</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-29T18:24:00+10:00" pubdate data-updated="true">Jul 29<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Version 2013-07-29-18:09 enables audio and control rate analog inputs to work at the same time.
Audio input is on analog pin A0.  Each time an audio sample is output, the audio input is sampled.
For each audio input sample, one control input is also converted, by changing the input channel and
triggering two conversions in a row using the ADC interrupt, keeping the second reading because the first
is unreliable, then switching the channel back to 0 again for audio input and starting another audio conversion, which
is also discarded.  Then the cycle goes again with the next audio output triggering a second, usable, audio input sample.
Each time, one control input is stored, until the list of analog channels waiting to be sampled is empty.
The audio samples continue alone until the next control interrupt, when a sketch has adcReadAllChannels() in updateControl().</p>

<p>You can test it with examples/04.Analog_Input/Audio_and_Control_Input and examples/04.Analog_Input/Audio_Input_with_Knob_Filter.</p>

<p>Also, now the Mozzi library downloads as Mozzi.zip and unzips as Mozzi, instead of sensorium-Mozzi-r4783rth43t or whatever.</p>

<p>The NEWS.txt entry for this release is:</p>

<ul>
<li>IMPORTANT: renamed RecentAverage.h to RollingAverage.h.  Update sketches accordingly.</li>
<li>mozzi_analog.h

<ul>
<li>added the ability to sample audio and control rate analog inputs at the same time</li>
<li>added options for setupFastAnalogRead(), default is FAST (adc clock div main clock by 16, same as previously),
  and setupFastAnalogRead(FASTER) and FASTEST for divide by 8 and divide by 4.  These faster rates risk being less accurate
(see docs for setupFastAnalogRead), but FASTER (or FASTEST) is required for audio input with control inputs at the same time.</li>
</ul>
</li>
<li>added examples/04.Analog_Input/Audio_and_Control_Input</li>
<li>added examples/04.Analog_Input/Audio_Input_with_Knob_Filter</li>
<li>removed examples/04.Analog_Input/Audio_Input_with_Filter_Control</li>
<li>RollingAverage.h - change unsigned char index to unsigned int and same for num_readings_as_rshift, so more than 255 items can be averaged</li>
<li>added audioTicks(), returns how many audio samples have been played since the program started - this will overflow less often than mozziMicros().</li>
<li>mozziMicros() was wrong, audioticks/us-per-tick&#8230; fixed, now audioticks*us-per-tick</li>
<li>added Stack.h, a simple stack class used internally for reading analog control inputs via adcReadAllChannels().</li>
<li>added RollingStat.h, which calculates an approximation of the variance and standard deviation for a window of recent inputs,
  for doing things with sensor inputs.</li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Tim Barrass</span></span>

      








  


<time datetime="2013-07-29T18:24:00+10:00" pubdate data-updated="true">Jul 29<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/Mozzi/blog/categories/adc/'>adc</a>, <a class='category' href='/Mozzi/blog/categories/updates/'>updates</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="/Mozzi//twitter.com/share" class="twitter-share-button" data-url="http://sensorium.github.io/Mozzi//blog/2013/07/29/audio-and-control-adc-together/" data-via="nothingperson" data-counturl="http://sensorium.github.io/Mozzi//blog/2013/07/29/audio-and-control-adc-together/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/Mozzi/blog/2013/05/14/icad2013-workshop-announcement/" title="Previous Post: ICAD2013 workshop announcement">&laquo; ICAD2013 workshop announcement</a>
      
      
        <a class="basic-alignment right" href="/Mozzi/blog/2013/08/06/upcoming-mozzi-talk-at-icmc2013-in-perth/" title="Next Post: Upcoming Mozzi talk at ICMC2013 in Perth">Upcoming Mozzi talk at ICMC2013 in Perth &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/Mozzi/blog/2014/08/09/teensy-3-dot-0-slash-3-dot-1-test-release-version-2014-08-09-14-15/">Teensy 3.0/3.1 Test Release</a>
      </li>
    
      <li class="post">
        <a href="/Mozzi/blog/2014/06/20/teensy-3-dot-0-3-dot-1-port-progress/">Teensy 3.0-3.1 Port Progress</a>
      </li>
    
      <li class="post">
        <a href="/Mozzi/blog/2014/04/20/standard-plus-performance-improves/">STANDARD_PLUS Performance Improves</a>
      </li>
    
      <li class="post">
        <a href="/Mozzi/blog/2014/03/13/update-to-version-2014-03-13-14-09/">New STANDARD_PLUS Audio Mode Removes 16kHz Whine</a>
      </li>
    
      <li class="post">
        <a href="/Mozzi/blog/2014/03/06/making-things-purr/">Making Things Purr, Growl and Sing - Mozzi Workshop in Melbourne</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="https://purl.org/dc/terms/" property="dct:title">Mozzi</span> by <a xmlns:cc="https://creativecommons.org/ns#" href="https://github.com/sensorium/Mozzi" property="cc:attributionName" rel="cc:attributionURL">Tim Barrass</a> is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
</br>
  <!-- Copyright &copy; 2014 - Tim Barrass - -->
  <span class="credit">Powered by <a href="https://octopress.org">Octopress</a></span>
  <span class="credit">Published with <a href="https://pages.github.com">GitHub Pages</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
