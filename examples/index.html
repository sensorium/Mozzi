
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Examples - MOZZI</title>
  <meta name="author" content="Tim Barrass">
  
  
  <meta name="description" content="Mozzi is a sound synthesis software library for Arduino." />

  
  <meta name="keywords" content="Applications : sound, music, audio, synthesis, synthesiser, synthesizer, sound art, electronic music, computer music, generative music, sonification, media art, performance, installation, electronic art, creative art, interactive art, Software: library, arduino, open source, extendable, free, Audience: artists, scientists, teachers, learners, students, hobby, do it yourself, diy, makers, creators, musicians, engineers, collaborators" />

  <!-- https://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sensorium.github.io/Mozzi//examples">
  <link href="/Mozzi/favicon.png" rel="icon">
  <link href="/Mozzi/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/Mozzi/atom.xml" rel="alternate" title="MOZZI" type="application/atom+xml">
  <script src="/Mozzi/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/Mozzi/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at https://google.com/webfonts -->

<link href='https://fonts.googleapis.com/css?family=Londrina+Solid&text=MOZZI' rel='stylesheet' type='text/css'>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32577259-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'https://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner">
<div id="header_wrap">
	
	<hgroup>
		<h1 id="banner_main_title"><a href="/Mozzi/">MOZZI</a></h1>
		
		
			<h2>sound synthesis library for Arduino</h2>
		
	</hgroup>
	
	<img src="/Mozzi/images/mozzi-circle.gif" id="mozzi_logo"/> 
	<img src="/Mozzi/images/lee.gif" id="lee"/>

	<section id="header_links_section">
		<p>
			<a  class="header_link" href="https://github.com/sensorium/Mozzi"> 
				<span id="header_small_label">View on <i class="icon-github icon-2x"></i> GitHub</span>
			</a>
		</p>
		<p>
		
			<a class="header_link" href="/Mozzi/donate">
			<!-- <a class="header_link" href="https://github.com/sensorium/Mozzi/releases">  -->
			<!-- <a class="header_link" href="https://tinyurl.com/mozzilib/Mozzi.zip" >  --> <!--download="Mozzi.zip" > stops download working in chrome -->
			<!-- <a class="header_link" href="/Mozzi/download/">  -->
				download<br>
				<i class="icon-download icon-4x"></i><br>
				<span id="header_small_label">version v1.0.3rc5</span>
			</a>
		</p>
	</section> 

</div>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/Mozzi/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <!-- <input type="hidden" name="q" value="site:sensorium.github.io/Mozzi/" /> -->
    <input type="hidden" name="q" value="https://sensorium.github.io/Mozzi/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/Mozzi/">Home</a></li>
  <li><a href="/Mozzi/examples/">Examples</a></li>
  <li><a href="/Mozzi/learn/">Learn</a></li>
  <li><a href="/Mozzi/gallery/">Gallery</a></li>
  <li><a href="/Mozzi/faq/">FAQ</a></li>
  <li><a href="https://groups.google.com/forum/#!forum/mozzi-users/">Forum</a></li>
  <li><a href="/Mozzi/doc/html/index.html">API</a></li>
  <!-- <li><a href="/Mozzi/consulting/">Consulting</a></li> -->
  <!-- <li><a href="https://mozzi.sharetribe.com/">Market</a></li> -->
  <!-- <li><a href="/Mozzi/download/">Download</a></li> -->
  <!-- <li><a href="/Mozzi/blog/">Blog</a></li> -->
  <!-- <li><a href="/Mozzi/resources/">Resources</a></li>   -->
  <!-- <li><a href="/Mozzi/blog/archives/">Archives</a></li>
  <li><a href="/Mozzi/about/">About</a></li> -->
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Examples</h1>
    
  </header>
  
  <p><a name = "top"> </a>These are the example sketches that come with Mozzi, and the sounds they make.
They&#8217;re intended to be instructive, rather than musically interesting&#8230;</p>

<p><a href="#01.Basics">01.Basics</a> : how to make a sound and simple modifications like gain.<br/>
<a href="#02.Control">02.Control</a> : changing sound parameters, scheduling, pausing.<br/>
<a href="#03.Sensors">03.Sensors</a> : using various sensors to change sounds.<br/>
<a href="#04.Audio_Input">04.Audio Input</a> : sample incoming sound at audio rate.<br/>
<a href="#05.Control_Filters">05.Control Filters</a> : smoothing and other processing for sensor inputs.<br/>
<a href="#06.Synthesis">06.Synthesis</a> : for more versatile and detailed sounds.<br/>
<a href="#07.Envelopes">07.Envelopes</a> : give sounds changing dynamics.<br/>
<a href="#08.Samples">08.Samples</a> : play recorded sounds in various ways.<br/>
<a href="#09.Delays">09.Delays</a> : for effects like flanging or reverb.<br/>
<a href="#10.Audio_Filters">10.Audio Filters</a> : modify audio frequencies.<br/>
<a href="#11.Communication">11.Communication</a> : non-blocking communication with external devices.<br/>
<a href="#12.Misc">12.Misc</a> : other useful things.</p>

<h2 class=target_without_link><a id='01.Basics'>
01.Basics</a></h2>


<hr />

<p>Control_Gain <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Control_Gain/Control_Gain.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Control_Gain/Control_Gain.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Control_Gainexpand' onclick='javascript:toggleDisplay(Control_Gain, Control_Gainexpand, Control_Gaincollapse)'>show sketch</button>
<button id='Control_Gaincollapse' style='display:none' onclick='javascript:toggleDisplay(Control_Gain, Control_Gainexpand, Control_Gaincollapse)'>hide sketch</button></p>

<div id='Control_Gain' style='display:none'>
<figure class='code'><figcaption><span> (Control_Gain.ino)</span> <a href='/Mozzi/downloads/code/examples/01.Basics/Control_Gain/Control_Gain.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example changing the gain of a sinewave,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates the use of a control variable to influence an</span>
</span><span class='line'><span class="cm">    audio signal.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// control variable, use the smallest data size you can for anything used in audio</span>
</span><span class='line'><span class="n">byte</span> <span class="n">gain</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// start with default control rate of 64</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">3320</span><span class="p">);</span> <span class="c1">// set the frequency</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// as byte, this will automatically roll around to 255 when it passes 0</span>
</span><span class='line'>  <span class="n">gain</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">-</span> <span class="mi">3</span> <span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span> <span class="n">gain</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// shift back to STANDARD audio range, like /256 but faster</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Sinewave <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Sinewave/Sinewave.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Sinewave/Sinewave.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Sinewaveexpand' onclick='javascript:toggleDisplay(Sinewave, Sinewaveexpand, Sinewavecollapse)'>show sketch</button>
<button id='Sinewavecollapse' style='display:none' onclick='javascript:toggleDisplay(Sinewave, Sinewaveexpand, Sinewavecollapse)'>hide sketch</button></p>

<div id='Sinewave' style='display:none'>
<figure class='code'><figcaption><span> (Sinewave.ino)</span> <a href='/Mozzi/downloads/code/examples/01.Basics/Sinewave/Sinewave.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example playing a sinewave at a set frequency,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates the use of Oscil to play a wavetable.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use #define for CONTROL_RATE, not a constant</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// set a control rate of 64 (powers of 2 please)</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span> <span class="c1">// set the frequency</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// put changing controls in here</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// return an int signal centred around 0</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Sinewave_HIFI <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Sinewave_HIFI/Sinewave_HIFI.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Sinewave_HIFI/Sinewave_HIFI.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Sinewave_HIFIexpand' onclick='javascript:toggleDisplay(Sinewave_HIFI, Sinewave_HIFIexpand, Sinewave_HIFIcollapse)'>show sketch</button>
<button id='Sinewave_HIFIcollapse' style='display:none' onclick='javascript:toggleDisplay(Sinewave_HIFI, Sinewave_HIFIexpand, Sinewave_HIFIcollapse)'>hide sketch</button></p>

<div id='Sinewave_HIFI' style='display:none'>
<figure class='code'><figcaption><span> (Sinewave_HIFI.ino)</span> <a href='/Mozzi/downloads/code/examples/01.Basics/Sinewave_HIFI/Sinewave_HIFI.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example playing a sinewave at a set frequency,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates the use of Oscil to play a wavetable.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    This sketch using HIFI mode is not for Teensy 3.1.</span>
</span><span class='line'><span class="cm">        </span>
</span><span class='line'><span class="cm">    IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be</span>
</span><span class='line'><span class="cm">    be changed from STANDARD mode to HIFI.</span>
</span><span class='line'><span class="cm">    In Mozz/mozzi_config.h, change</span>
</span><span class='line'><span class="cm">    #define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm">    to</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm">    #define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),</span>
</span><span class='line'><span class="cm">    Check the Mozzi core module documentation for others and more detail</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">                     3.9k </span>
</span><span class='line'><span class="cm">     pin 9  ---WWWW-----|-----output</span>
</span><span class='line'><span class="cm">                    499k           |</span>
</span><span class='line'><span class="cm">     pin 10 ---WWWW---- |</span>
</span><span class='line'><span class="cm">                                       |</span>
</span><span class='line'><span class="cm">                             4.7n  ==</span>
</span><span class='line'><span class="cm">                                       |</span>
</span><span class='line'><span class="cm">                                   ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Resistors are Â±0.5%  Measure and choose the most precise </span>
</span><span class='line'><span class="cm">    from a batch of whatever you can get.  Use two 1M resistors</span>
</span><span class='line'><span class="cm">    in parallel if you can&#39;t find 499k.</span>
</span><span class='line'><span class="cm">    Alternatively using 39 ohm, 4.99k and 470nF components will </span>
</span><span class='line'><span class="cm">    work directly with headphones.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012-13, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// uses the default control rate of 64, defined in mozzi_config.h</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span> <span class="c1">// set the frequency</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// this would make more sense with a higher resolution signal</span>
</span><span class='line'>  <span class="c1">// but still benefits from using HIFI to avoid the 16kHz pwm noise</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="c1">// 8 bits scaled up to 14 bits</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Skeleton <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='Skeletonexpand' onclick='javascript:toggleDisplay(Skeleton, Skeletonexpand, Skeletoncollapse)'>show sketch</button>
<button id='Skeletoncollapse' style='display:none' onclick='javascript:toggleDisplay(Skeleton, Skeletonexpand, Skeletoncollapse)'>hide sketch</button></p>

<div id='Skeleton' style='display:none'>
<figure class='code'><figcaption><span> (Skeleton.ino)</span> <a href='/Mozzi/downloads/code/examples/01.Basics/Skeleton/Skeleton.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;        </span><span class="c1">// at the top of your sketch</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64   </span><span class="c1">// or some other power of 2</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// your control code</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// your audio code which returns an int between -244 and 243</span>
</span><span class='line'>  <span class="c1">// actually, a char is fine</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// fills the audio buffer</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Table_Resolution <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Table_Resolution/Table_Resolution.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Table_Resolution/Table_Resolution.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Table_Resolutionexpand' onclick='javascript:toggleDisplay(Table_Resolution, Table_Resolutionexpand, Table_Resolutioncollapse)'>show sketch</button>
<button id='Table_Resolutioncollapse' style='display:none' onclick='javascript:toggleDisplay(Table_Resolution, Table_Resolutionexpand, Table_Resolutioncollapse)'>hide sketch</button></p>

<div id='Table_Resolution' style='display:none'>
<figure class='code'><figcaption><span> (Table_Resolution.ino)</span> <a href='/Mozzi/downloads/code/examples/01.Basics/Table_Resolution/Table_Resolution.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/* Example playing sine tables of different sizes</span>
</span><span class='line'><span class="cm">  with Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Demonstrates the audible quality of different length tables</span>
</span><span class='line'><span class="cm">  played with Oscil and scheduling with EventDelay.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">  DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//#include &lt;ADC.h&gt;  // Teensy 3.1 uncomment this line and install</span>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin256_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin512_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin1024_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin4096_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin8192_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt; </span><span class="c1">// for scheduling events</span>
</span><span class='line'><span class="cp">#include &lt;Line.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN256_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin0</span><span class="p">(</span><span class="n">SIN256_DATA</span><span class="p">);</span> <span class="c1">// can hear significant aliasing noise</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin1</span><span class="p">(</span><span class="n">SIN512_DATA</span><span class="p">);</span> <span class="c1">// noise still there but less noticeable</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN1024_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin2</span><span class="p">(</span><span class="n">SIN1024_DATA</span><span class="p">);</span> <span class="c1">// borderline, hardly there if at all</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin3</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// no audible improvement from here on</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN4096_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin4</span><span class="p">(</span><span class="n">SIN4096_DATA</span><span class="p">);</span> <span class="c1">// for 45 year old loud sound damaged ears</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin5</span><span class="p">(</span><span class="n">SIN8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">kWhoseTurnDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="n">byte</span> <span class="n">NUM_OSCILS</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
</span><span class='line'><span class="n">byte</span> <span class="n">whose_turn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// which oscil to listen to</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Line to sweep frequency at control rate</span>
</span><span class='line'><span class="n">Line</span> <span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">kSweep</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">MILLIS_PER_SWEEP</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">MILLIS_PER_CONTROL</span> <span class="o">=</span> <span class="mi">1000u</span> <span class="o">/</span> <span class="n">CONTROL_RATE</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">CONTROL_STEPS_PER_SWEEP</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">MILLIS_PER_SWEEP</span> <span class="o">/</span> <span class="n">MILLIS_PER_CONTROL</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kWhoseTurnDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">MILLIS_PER_SWEEP</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kSweep</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mf">0.f</span><span class="p">,</span> <span class="mf">8192.f</span><span class="p">,</span> <span class="n">CONTROL_STEPS_PER_SWEEP</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kWhoseTurnDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">whose_turn</span> <span class="o">&gt;=</span> <span class="n">NUM_OSCILS</span><span class="p">)</span> <span class="n">whose_turn</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">kWhoseTurnDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="n">kSweep</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0UL</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">float</span> <span class="n">f</span> <span class="o">=</span> <span class="n">kSweep</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">switch</span> <span class="p">(</span><span class="n">whose_turn</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>    <span class="n">aSin0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>    <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>    <span class="n">aSin2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>    <span class="n">aSin3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span><span class='line'>    <span class="n">aSin4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
</span><span class='line'>    <span class="n">aSin5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'>  <span class="k">switch</span> <span class="p">(</span><span class="n">whose_turn</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>    <span class="n">asig</span> <span class="o">=</span> <span class="n">aSin0</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>    <span class="n">asig</span> <span class="o">=</span> <span class="n">aSin1</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>    <span class="n">asig</span> <span class="o">=</span> <span class="n">aSin2</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>    <span class="n">asig</span> <span class="o">=</span> <span class="n">aSin3</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span><span class='line'>    <span class="n">asig</span> <span class="o">=</span> <span class="n">aSin4</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
</span><span class='line'>    <span class="n">asig</span> <span class="o">=</span> <span class="n">aSin5</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Vibrato <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Vibrato/Vibrato.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/01.Basics/Vibrato/Vibrato.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Vibratoexpand' onclick='javascript:toggleDisplay(Vibrato, Vibratoexpand, Vibratocollapse)'>show sketch</button>
<button id='Vibratocollapse' style='display:none' onclick='javascript:toggleDisplay(Vibrato, Vibratoexpand, Vibratocollapse)'>hide sketch</button></p>

<div id='Vibrato' style='display:none'>
<figure class='code'><figcaption><span> (Vibrato.ino)</span> <a href='/Mozzi/downloads/code/examples/01.Basics/Vibrato/Vibrato.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example playing a sinewave with vibrato,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates simple FM using phase modulation.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// table for Oscils to play</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt; </span><span class="c1">// for mtof</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aVibrato</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="n">byte</span> <span class="n">intensity</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">84.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aVibrato</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">15.f</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>    <span class="n">Q15n16</span> <span class="n">vibrato</span> <span class="o">=</span> <span class="p">(</span><span class="n">Q15n16</span><span class="p">)</span> <span class="n">intensity</span> <span class="o">*</span> <span class="n">aVibrato</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">aCos</span><span class="p">.</span><span class="n">phMod</span><span class="p">(</span><span class="n">vibrato</span><span class="p">);</span> <span class="c1">// phase modulation to modulate frequency</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='02.Control'>
02.Control</a></h2>


<hr />

<p>Control_Echo_Theremin <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Echo_Theremin/Control_Echo_Theremin.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Echo_Theremin/Control_Echo_Theremin.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Control_Echo_Thereminexpand' onclick='javascript:toggleDisplay(Control_Echo_Theremin, Control_Echo_Thereminexpand, Control_Echo_Theremincollapse)'>show sketch</button>
<button id='Control_Echo_Theremincollapse' style='display:none' onclick='javascript:toggleDisplay(Control_Echo_Theremin, Control_Echo_Thereminexpand, Control_Echo_Theremincollapse)'>hide sketch</button></p>

<div id='Control_Echo_Theremin' style='display:none'>
<figure class='code'><figcaption><span> (Control_Echo_Theremin.ino)</span> <a href='/Mozzi/downloads/code/examples/02.Control/Control_Echo_Theremin/Control_Echo_Theremin.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a simple light-sensing theremin-like</span>
</span><span class='line'><span class="cm">     instrument with long echoes,</span>
</span><span class='line'><span class="cm">     using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">     Demonstrates ControlDelay() for echoing control values,</span>
</span><span class='line'><span class="cm">     and smoothing an analog input from a sensor</span>
</span><span class='line'><span class="cm">     signal with RollingAverage().</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">     The circuit: </span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">          Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">         DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">          check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">     Light dependent resistor (LDR) and 5.1k resistor on analog pin 1:</span>
</span><span class='line'><span class="cm">          LDR from analog pin to +5V (3.3V on Teensy 3.1)</span>
</span><span class='line'><span class="cm">          5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm">     </span>
</span><span class='line'><span class="cm">     Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">     https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">     Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;RollingAverage.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;ControlDelay.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define INPUT_PIN 0 </span><span class="c1">// analog control input</span>
</span><span class='line'>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">echo_cells_1</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">echo_cells_2</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">echo_cells_3</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'><span class="n">ControlDelay</span> <span class="o">&lt;</span><span class="mi">128</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">kDelay</span><span class="p">;</span> <span class="c1">// 2seconds</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// oscils to compare bumpy to averaged control input</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin0</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin1</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin2</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin3</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: RollingAverage &lt;number_type, how_many_to_average&gt; myThing</span>
</span><span class='line'><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverage</span><span class="p">;</span> <span class="c1">// how_many_to_average has to be power of 2</span>
</span><span class='line'><span class="kt">int</span> <span class="n">averaged</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">kDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">echo_cells_1</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">bumpy_input</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">INPUT_PIN</span><span class="p">);</span>
</span><span class='line'>  <span class="n">averaged</span> <span class="o">=</span> <span class="n">kAverage</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">bumpy_input</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSin0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">averaged</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">kDelay</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">averaged</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aSin2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">kDelay</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">echo_cells_2</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aSin3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">kDelay</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">echo_cells_3</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">3</span><span class="o">*</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aSin0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span><span class="n">aSin1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span><span class="p">(</span><span class="n">aSin2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="o">+</span><span class="p">(</span><span class="n">aSin3</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">))</span> <span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Control_Oscil_Wash <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Oscil_Wash/Control_Oscil_Wash.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Oscil_Wash/Control_Oscil_Wash.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Control_Oscil_Washexpand' onclick='javascript:toggleDisplay(Control_Oscil_Wash, Control_Oscil_Washexpand, Control_Oscil_Washcollapse)'>show sketch</button>
<button id='Control_Oscil_Washcollapse' style='display:none' onclick='javascript:toggleDisplay(Control_Oscil_Wash, Control_Oscil_Washexpand, Control_Oscil_Washcollapse)'>hide sketch</button></p>

<div id='Control_Oscil_Wash' style='display:none'>
<figure class='code'><figcaption><span> (Control_Oscil_Wash.ino)</span> <a href='/Mozzi/downloads/code/examples/02.Control/Control_Oscil_Wash/Control_Oscil_Wash.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Plays a fluctuating ambient wash,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates audio and control rate updates.</span>
</span><span class='line'><span class="cm">    There are 8 oscillators updated at control rate to set</span>
</span><span class='line'><span class="cm">    the volume of 8 audio oscillators.  Updating the volume</span>
</span><span class='line'><span class="cm">    at control rate saves processor time, incrementing the</span>
</span><span class='line'><span class="cm">    Oscils only 128 times per second rather than at the</span>
</span><span class='line'><span class="cm">    audio rate of 16384 Hz.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos8192_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// harmonics</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos3</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos4</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos5</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos6</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos7</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos8</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// volume controls</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol3</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol4</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol5</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol6</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol7</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol8</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio volumes updated each control interrupt and reused in audio till next control</span>
</span><span class='line'><span class="kt">char</span> <span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="n">v5</span><span class="p">,</span><span class="n">v6</span><span class="p">,</span><span class="n">v7</span><span class="p">,</span><span class="n">v8</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set harmonic frequencies</span>
</span><span class='line'>  <span class="n">aCos1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mi">60</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aCos2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mi">74</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aCos3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mi">64</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aCos4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mi">77</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aCos5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mi">67</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aCos6</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mi">81</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aCos7</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mi">60</span><span class="p">));</span>
</span><span class='line'>  <span class="n">aCos8</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mi">84</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// set volume change frequencies</span>
</span><span class='line'>  <span class="n">kVol1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">4.43f</span><span class="p">);</span> <span class="c1">// more of a pulse</span>
</span><span class='line'>  <span class="n">kVol2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.0245f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kVol3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.019f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kVol4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.07f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kVol5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.047f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kVol6</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.031f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kVol7</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.0717f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kVol8</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.041f</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">v1</span><span class="o">=</span><span class="n">v2</span><span class="o">=</span><span class="n">v3</span><span class="o">=</span><span class="n">v4</span><span class="o">=</span><span class="n">v5</span><span class="o">=</span><span class="n">v6</span><span class="o">=</span><span class="n">v7</span><span class="o">=</span><span class="n">v8</span><span class="o">=</span><span class="mi">127</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>   <span class="n">v1</span> <span class="o">=</span> <span class="n">kVol1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// going at a higher freq, this creates zipper noise, so reduce the gain</span>
</span><span class='line'>   <span class="n">v2</span> <span class="o">=</span> <span class="n">kVol2</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>   <span class="n">v3</span> <span class="o">=</span> <span class="n">kVol3</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>   <span class="n">v4</span> <span class="o">=</span> <span class="n">kVol4</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>   <span class="n">v5</span> <span class="o">=</span> <span class="n">kVol5</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>   <span class="n">v6</span> <span class="o">=</span> <span class="n">kVol6</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>   <span class="n">v7</span> <span class="o">=</span> <span class="n">kVol7</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>   <span class="n">v8</span> <span class="o">=</span> <span class="n">kVol8</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">long</span> <span class="n">asig</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span>
</span><span class='line'>    <span class="n">aCos1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v1</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v2</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos3</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v3</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos4</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v4</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos5</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v5</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos6</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v6</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos7</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v7</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos8</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v8</span><span class="p">;</span>
</span><span class='line'>  <span class="n">asig</span> <span class="o">&gt;&gt;=</span> <span class="mi">9</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Control_Tremelo <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Tremelo/Control_Tremelo.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Control_Tremelo/Control_Tremelo.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Control_Tremeloexpand' onclick='javascript:toggleDisplay(Control_Tremelo, Control_Tremeloexpand, Control_Tremelocollapse)'>show sketch</button>
<button id='Control_Tremelocollapse' style='display:none' onclick='javascript:toggleDisplay(Control_Tremelo, Control_Tremeloexpand, Control_Tremelocollapse)'>hide sketch</button></p>

<div id='Control_Tremelo' style='display:none'>
<figure class='code'><figcaption><span> (Control_Tremelo.ino)</span> <a href='/Mozzi/downloads/code/examples/02.Control/Control_Tremelo/Control_Tremelo.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of amplitude modulation (as tremelo),</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates audio and control rate updates.</span>
</span><span class='line'><span class="cm">    The tremelo oscillator is updated at control rate,</span>
</span><span class='line'><span class="cm">    and a Line is used to interpolate the control updates</span>
</span><span class='line'><span class="cm">    at audio rate, to remove zipper noise.</span>
</span><span class='line'><span class="cm">    A bit contrived and probably less efficient than just </span>
</span><span class='line'><span class="cm">    using an audio-rate tremelo oscillator, but hey it&#39;s a demo!</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle_valve_2048_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Line.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio oscillator</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_VALVE_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSig</span><span class="p">(</span><span class="n">TRIANGLE_VALVE_2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="c1">// control oscillator for tremelo</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kTremelo</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="c1">// a line to interpolate control tremolo at audio rate</span>
</span><span class='line'><span class="n">Line</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">aGain</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aSig</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">65.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">kTremelo</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">5.5f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// gain shifted up to give enough range for line&#39;s internal steps</span>
</span><span class='line'>   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gain</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128u</span><span class="o">+</span><span class="n">kTremelo</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'>   <span class="n">aGain</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">gain</span><span class="p">,</span> <span class="n">AUDIO_RATE</span> <span class="o">/</span> <span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// divide of literals should get optimised away</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// cast to long before multiply to give room for intermediate result, </span>
</span><span class='line'>  <span class="c1">// and also before shift,</span>
</span><span class='line'>  <span class="c1">// to give consistent results for both 8 and 32 bit processors.</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((</span><span class="kt">long</span><span class="p">)((</span><span class="kt">long</span><span class="p">)</span> <span class="n">aSig</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aGain</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">);</span> <span class="c1">// shifted back to audio range after multiply</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>EventDelay <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/EventDelay/EventDelay.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/EventDelay/EventDelay.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='EventDelayexpand' onclick='javascript:toggleDisplay(EventDelay, EventDelayexpand, EventDelaycollapse)'>show sketch</button>
<button id='EventDelaycollapse' style='display:none' onclick='javascript:toggleDisplay(EventDelay, EventDelayexpand, EventDelaycollapse)'>hide sketch</button></p>

<div id='EventDelay' style='display:none'>
<figure class='code'><figcaption><span> (EventDelay.ino)</span> <a href='/Mozzi/downloads/code/examples/02.Control/EventDelay/EventDelay.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a sound being toggled on an off,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates scheduling with EventDelay.</span>
</span><span class='line'><span class="cm">    EventDelay is a way to make non-blocking</span>
</span><span class='line'><span class="cm">    time delays for events.  Use this instead of</span>
</span><span class='line'><span class="cm">    the Arduino delay() function, which doesn&#39;t</span>
</span><span class='line'><span class="cm">    work with Mozzi.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin8192_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling audio gain changes</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">kGainChangeDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">char</span> <span class="n">gain</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">330</span><span class="p">);</span> <span class="c1">// set the frequency</span>
</span><span class='line'>  <span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// 1 second countdown, within resolution of CONTROL_RATE</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="n">gain</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">gain</span><span class="p">;</span> <span class="c1">// flip 0/1</span>
</span><span class='line'>    <span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gain</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Line_Gliss <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Line_Gliss/Line_Gliss.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Line_Gliss/Line_Gliss.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Line_Glissexpand' onclick='javascript:toggleDisplay(Line_Gliss, Line_Glissexpand, Line_Glisscollapse)'>show sketch</button>
<button id='Line_Glisscollapse' style='display:none' onclick='javascript:toggleDisplay(Line_Gliss, Line_Glissexpand, Line_Glisscollapse)'>hide sketch</button></p>

<div id='Line_Gliss' style='display:none'>
<figure class='code'><figcaption><span> (Line_Gliss.ino)</span> <a href='/Mozzi/downloads/code/examples/02.Control/Line_Gliss/Line_Gliss.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of sliding smoothly</span>
</span><span class='line'><span class="cm">    between oscillator frequencies,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates using a Line to efficiently change the</span>
</span><span class='line'><span class="cm">    frequency of an oscillator at audio rate.   Calculating</span>
</span><span class='line'><span class="cm">    a new frequency for every step of a slide is a lot to</span>
</span><span class='line'><span class="cm">    do for every single sample, so instead this sketch works out the </span>
</span><span class='line'><span class="cm">    start and end frequencies for each control period and</span>
</span><span class='line'><span class="cm">    the phase increments (size of the steps through the sound table)</span>
</span><span class='line'><span class="cm">    required for the audio oscillator to generate those frequencies.</span>
</span><span class='line'><span class="cm">    Then, a computationally cheap Line() is used to slide between the</span>
</span><span class='line'><span class="cm">    different phase increments smoothly at audio rate.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Line.h&gt; </span><span class="c1">// for smooth transitions</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle_warm8192_int8.h&gt; </span><span class="c1">// triangle table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">TRIANGLE_WARM8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle</span><span class="p">(</span><span class="n">TRIANGLE_WARM8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Line &lt;type&gt; lineName</span>
</span><span class='line'><span class="n">Line</span> <span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">aGliss</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">byte</span> <span class="n">lo_note</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span> <span class="c1">// midi note numbers</span>
</span><span class='line'><span class="n">byte</span> <span class="n">hi_note</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">long</span> <span class="n">audio_steps_per_gliss</span> <span class="o">=</span> <span class="n">AUDIO_RATE</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// ie. 4 glisses per second</span>
</span><span class='line'><span class="kt">long</span> <span class="n">control_steps_per_gliss</span> <span class="o">=</span> <span class="n">CONTROL_RATE</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// stuff for changing starting positions, probably just confusing really</span>
</span><span class='line'><span class="kt">int</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">byte</span> <span class="n">gliss_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">byte</span> <span class="n">gliss_offset_step</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="n">byte</span>  <span class="n">gliss_offset_max</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">counter</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// start at a new note</span>
</span><span class='line'>    <span class="n">gliss_offset</span> <span class="o">+=</span> <span class="n">gliss_offset_step</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">gliss_offset</span> <span class="o">&gt;=</span> <span class="n">gliss_offset_max</span><span class="p">)</span> <span class="n">gliss_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// only need to calculate frequencies once each control update</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">start_freq</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="n">lo_note</span><span class="o">+</span><span class="n">gliss_offset</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">end_freq</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="n">hi_note</span><span class="o">+</span><span class="n">gliss_offset</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// find the phase increments (step sizes) through the audio table for those freqs</span>
</span><span class='line'>    <span class="c1">// they are big ugly numbers which the oscillator understands but you don&#39;t really want to know</span>
</span><span class='line'>    <span class="kt">long</span> <span class="n">gliss_start</span> <span class="o">=</span> <span class="n">aTriangle</span><span class="p">.</span><span class="n">phaseIncFromFreq</span><span class="p">(</span><span class="n">start_freq</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">long</span> <span class="n">gliss_end</span> <span class="o">=</span> <span class="n">aTriangle</span><span class="p">.</span><span class="n">phaseIncFromFreq</span><span class="p">(</span><span class="n">end_freq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// set the audio rate line to transition between the different step sizes</span>
</span><span class='line'>    <span class="n">aGliss</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">gliss_start</span><span class="p">,</span> <span class="n">gliss_end</span><span class="p">,</span> <span class="n">audio_steps_per_gliss</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">counter</span> <span class="o">=</span> <span class="n">control_steps_per_gliss</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aTriangle</span><span class="p">.</span><span class="n">setPhaseInc</span><span class="p">(</span><span class="n">aGliss</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aTriangle</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Line_Gliss_Double_32k_HIFI <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Line_Gliss_Double_32k_HIFI/Line_Gliss_Double_32k_HIFI.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Line_Gliss_Double_32k_HIFI/Line_Gliss_Double_32k_HIFI.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Line_Gliss_Double_32k_HIFIexpand' onclick='javascript:toggleDisplay(Line_Gliss_Double_32k_HIFI, Line_Gliss_Double_32k_HIFIexpand, Line_Gliss_Double_32k_HIFIcollapse)'>show sketch</button>
<button id='Line_Gliss_Double_32k_HIFIcollapse' style='display:none' onclick='javascript:toggleDisplay(Line_Gliss_Double_32k_HIFI, Line_Gliss_Double_32k_HIFIexpand, Line_Gliss_Double_32k_HIFIcollapse)'>hide sketch</button></p>

<div id='Line_Gliss_Double_32k_HIFI' style='display:none'>
<figure class='code'><figcaption><span> (Line_Gliss_Double_32k_HIFI.ino)</span> <a href='/Mozzi/downloads/code/examples/02.Control/Line_Gliss_Double_32k_HIFI/Line_Gliss_Double_32k_HIFI.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a pair of detuned oscillators </span>
</span><span class='line'><span class="cm">    sliding smoothly between frequencies,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates using Lines to efficiently change the</span>
</span><span class='line'><span class="cm">    frequency of each oscillator at audio rate.   Calculating</span>
</span><span class='line'><span class="cm">    a new frequency for every step of a slide is a lot to</span>
</span><span class='line'><span class="cm">    do for every single sample, so instead this sketch works out the </span>
</span><span class='line'><span class="cm">    start and end frequencies for each control period and</span>
</span><span class='line'><span class="cm">    the phase increments (size of the steps through the sound table)</span>
</span><span class='line'><span class="cm">    required for the audio oscillators to generate those frequencies.</span>
</span><span class='line'><span class="cm">    Then, computationally cheap Lines are used to slide between the</span>
</span><span class='line'><span class="cm">    different phase increments smoothly at audio rate.</span>
</span><span class='line'><span class="cm">    Also shows how to use random offsets between the oscillators&#39;</span>
</span><span class='line'><span class="cm">    frequencies to produce a chorusing/doubling effect.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    This sketch using HIFI mode is not for Teensy 3.1.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be</span>
</span><span class='line'><span class="cm">    be changed from STANDARD mode to HIFI.</span>
</span><span class='line'><span class="cm">    In Mozz/mozzi_config.h, change</span>
</span><span class='line'><span class="cm">    #define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE STANDARD_PLUS</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm">    to</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE STANDARD_PLUS</span>
</span><span class='line'><span class="cm">    #define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Also, AUDIO_RATE can be changed from 16384 to 32768 in mozzi_config.h,</span>
</span><span class='line'><span class="cm">    to try out the higher sample rate.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),</span>
</span><span class='line'><span class="cm">    Check the Mozzi core module documentation for others and more detail</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">                     3.9k </span>
</span><span class='line'><span class="cm">     pin 9  ---WWWW-----|-----output</span>
</span><span class='line'><span class="cm">                    499k           |</span>
</span><span class='line'><span class="cm">     pin 10 ---WWWW---- |</span>
</span><span class='line'><span class="cm">                                       |</span>
</span><span class='line'><span class="cm">                             4.7n  ==</span>
</span><span class='line'><span class="cm">                                       |</span>
</span><span class='line'><span class="cm">                                   ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Resistors are Â±0.5%  Measure and choose the most precise </span>
</span><span class='line'><span class="cm">    from a batch of whatever you can get.  Use two 1M resistors</span>
</span><span class='line'><span class="cm">    in parallel if you can&#39;t find 499k.</span>
</span><span class='line'><span class="cm">    Alternatively using 39 ohm, 4.99k and 470nF components will </span>
</span><span class='line'><span class="cm">    work directly with headphones.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Line.h&gt; </span><span class="c1">// for smooth transitions</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/saw8192_int8.h&gt; </span><span class="c1">// saw table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SAW8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSaw1</span><span class="p">(</span><span class="n">SAW8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SAW8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSaw2</span><span class="p">(</span><span class="n">SAW8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Line &lt;type&gt; lineName</span>
</span><span class='line'><span class="n">Line</span> <span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">aGliss1</span><span class="p">;</span>
</span><span class='line'><span class="n">Line</span> <span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">aGliss2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">byte</span> <span class="n">lo_note</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span> <span class="c1">// midi note numbers</span>
</span><span class='line'><span class="n">byte</span> <span class="n">hi_note</span> <span class="o">=</span> <span class="mi">46</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">long</span> <span class="n">audio_steps_per_gliss</span> <span class="o">=</span> <span class="n">AUDIO_RATE</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span> <span class="c1">// ie. 4 glisses per second</span>
</span><span class='line'><span class="kt">long</span> <span class="n">control_steps_per_gliss</span> <span class="o">=</span> <span class="n">CONTROL_RATE</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// stuff for changing starting positions, probably just confusing really</span>
</span><span class='line'><span class="kt">int</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">byte</span> <span class="n">gliss_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">byte</span> <span class="n">gliss_offset_step</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="n">byte</span>  <span class="n">gliss_offset_max</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//randSeed();</span>
</span><span class='line'>  <span class="c1">//pinMode(0,OUTPUT); // without this, updateControl() gets interrupted ........??</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// uses default 64 control rate</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// variation between oscillator&#39;s phase increments</span>
</span><span class='line'><span class="c1">// looks like a big number, but they are high precision </span>
</span><span class='line'><span class="c1">// and this is just a fractional part</span>
</span><span class='line'><span class="kt">long</span> <span class="n">variation</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">rand</span><span class="p">(</span><span class="mi">16383</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span> <span class="c1">// 900 us floats vs 160 fixed</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">counter</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// start at a new note</span>
</span><span class='line'>    <span class="n">gliss_offset</span> <span class="o">+=</span> <span class="n">gliss_offset_step</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">gliss_offset</span> <span class="o">&gt;=</span> <span class="n">gliss_offset_max</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">gliss_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// this is just confusing, you should ignore it!</span>
</span><span class='line'>      <span class="c1">// alternate between 2 and 3 steps per start note each time a new &quot;run&quot; starts</span>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="n">gliss_offset_step</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">){</span>
</span><span class='line'>        <span class="n">gliss_offset_step</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span><span class="p">{</span>
</span><span class='line'>        <span class="n">gliss_offset_step</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// only need to calculate frequencies once each control update</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">start_freq</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="n">lo_note</span><span class="o">+</span><span class="n">gliss_offset</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">end_freq</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="n">hi_note</span><span class="o">+</span><span class="n">gliss_offset</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// find the phase increments (step sizes) through the audio table for those freqs</span>
</span><span class='line'>    <span class="c1">// they are big ugly numbers which the oscillator understands but you don&#39;t really want to know</span>
</span><span class='line'>    <span class="kt">long</span> <span class="n">gliss_start</span> <span class="o">=</span> <span class="n">aSaw1</span><span class="p">.</span><span class="n">phaseIncFromFreq</span><span class="p">(</span><span class="n">start_freq</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">long</span> <span class="n">gliss_end</span> <span class="o">=</span> <span class="n">aSaw1</span><span class="p">.</span><span class="n">phaseIncFromFreq</span><span class="p">(</span><span class="n">end_freq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">aGliss1</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">gliss_start</span><span class="p">,</span> <span class="n">gliss_end</span><span class="p">,</span> <span class="n">audio_steps_per_gliss</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">// aGliss2 is an octave up and detuned</span>
</span><span class='line'>    <span class="n">aGliss2</span><span class="p">.</span><span class="n">set</span><span class="p">((</span><span class="n">gliss_start</span><span class="o">+</span><span class="p">(</span><span class="n">variation</span><span class="p">()</span><span class="o">*</span><span class="n">gliss_offset</span><span class="p">))</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">gliss_end</span><span class="o">+</span><span class="p">(</span><span class="n">variation</span><span class="p">()</span><span class="o">*</span><span class="n">gliss_offset</span><span class="p">))</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">audio_steps_per_gliss</span><span class="p">);</span>
</span><span class='line'>    <span class="n">counter</span> <span class="o">=</span> <span class="n">control_steps_per_gliss</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aSaw1</span><span class="p">.</span><span class="n">setPhaseInc</span><span class="p">(</span><span class="n">aGliss1</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'>  <span class="n">aSaw2</span><span class="p">.</span><span class="n">setPhaseInc</span><span class="p">(</span><span class="n">aGliss2</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aSaw1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span><span class="n">aSaw2</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Metronome_SampleHuffman <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Metronome_SampleHuffman/Metronome_SampleHuffman.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Metronome_SampleHuffman/Metronome_SampleHuffman.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Metronome_SampleHuffmanexpand' onclick='javascript:toggleDisplay(Metronome_SampleHuffman, Metronome_SampleHuffmanexpand, Metronome_SampleHuffmancollapse)'>show sketch</button>
<button id='Metronome_SampleHuffmancollapse' style='display:none' onclick='javascript:toggleDisplay(Metronome_SampleHuffman, Metronome_SampleHuffmanexpand, Metronome_SampleHuffmancollapse)'>hide sketch</button></p>

<div id='Metronome_SampleHuffman' style='display:none'>
<figure class='code'><figcaption><span> (Metronome_SampleHuffman.ino)</span> <a href='/Mozzi/downloads/code/examples/02.Control/Metronome_SampleHuffman/Metronome_SampleHuffman.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example using Metronome to playing samples encoded with Huffman compression.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">     Demonstrates Metronome start, stop and ready, and the the SampleHuffman class.</span>
</span><span class='line'><span class="cm">     </span>
</span><span class='line'><span class="cm">     Circuit:</span>
</span><span class='line'><span class="cm">     Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">     DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">     </span>
</span><span class='line'><span class="cm">     Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">     https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">     </span>
</span><span class='line'><span class="cm">     Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Metronome.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;SampleHuffman.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;samples/thumbpiano_huffman/thumbpiano0.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;samples/thumbpiano_huffman/thumbpiano1.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;samples/thumbpiano_huffman/thumbpiano2.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;samples/thumbpiano_huffman/thumbpiano3.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;samples/thumbpiano_huffman/thumbpiano4.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">SampleHuffman</span> <span class="n">thumb0</span><span class="p">(</span><span class="n">THUMB0_SOUNDDATA</span><span class="p">,</span><span class="n">THUMB0_HUFFMAN</span><span class="p">,</span><span class="n">THUMB0_SOUNDDATA_BITS</span><span class="p">);</span>
</span><span class='line'><span class="n">SampleHuffman</span>  <span class="n">thumb1</span><span class="p">(</span><span class="n">THUMB1_SOUNDDATA</span><span class="p">,</span><span class="n">THUMB1_HUFFMAN</span><span class="p">,</span><span class="n">THUMB1_SOUNDDATA_BITS</span><span class="p">);</span>
</span><span class='line'><span class="n">SampleHuffman</span> <span class="n">thumb2</span><span class="p">(</span><span class="n">THUMB2_SOUNDDATA</span><span class="p">,</span><span class="n">THUMB2_HUFFMAN</span><span class="p">,</span><span class="n">THUMB2_SOUNDDATA_BITS</span><span class="p">);</span>
</span><span class='line'><span class="n">SampleHuffman</span> <span class="n">thumb3</span><span class="p">(</span><span class="n">THUMB3_SOUNDDATA</span><span class="p">,</span><span class="n">THUMB3_HUFFMAN</span><span class="p">,</span><span class="n">THUMB3_SOUNDDATA_BITS</span><span class="p">);</span>
</span><span class='line'><span class="n">SampleHuffman</span> <span class="n">thumb4</span><span class="p">(</span><span class="n">THUMB4_SOUNDDATA</span><span class="p">,</span><span class="n">THUMB4_HUFFMAN</span><span class="p">,</span><span class="n">THUMB4_SOUNDDATA_BITS</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">char</span> <span class="n">NUM_SAMPLES</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Metronome</span> <span class="n">kMetro</span><span class="p">(</span><span class="mi">800</span><span class="p">);</span> <span class="c1">// enough delay so samples don&#39;t overlap, because the load would be too much</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">counter</span><span class="p">;</span>
</span><span class='line'>  <span class="n">counter</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">counter</span><span class="o">==</span><span class="mi">177</span><span class="p">)</span><span class="n">kMetro</span><span class="p">.</span><span class="n">stop</span><span class="p">();</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">counter</span><span class="o">==</span><span class="mi">203</span><span class="p">){</span><span class="n">kMetro</span><span class="p">.</span><span class="n">start</span><span class="p">();</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;}</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kMetro</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">switch</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="n">NUM_SAMPLES</span><span class="p">)){</span>
</span><span class='line'>      <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>      <span class="n">thumb0</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>      <span class="n">thumb1</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>      <span class="n">thumb2</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>      <span class="n">thumb3</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span><span class='line'>      <span class="n">thumb4</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span>
</span><span class='line'>  <span class="n">thumb0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>  <span class="n">thumb1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>  <span class="n">thumb2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>  <span class="n">thumb3</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>  <span class="n">thumb4</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Pause <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Pause/Pause.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/02.Control/Pause/Pause.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Pauseexpand' onclick='javascript:toggleDisplay(Pause, Pauseexpand, Pausecollapse)'>show sketch</button>
<button id='Pausecollapse' style='display:none' onclick='javascript:toggleDisplay(Pause, Pauseexpand, Pausecollapse)'>hide sketch</button></p>

<div id='Pause' style='display:none'>
<figure class='code'><figcaption><span> (Pause.ino)</span> <a href='/Mozzi/downloads/code/examples/02.Control/Pause/Pause.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example pausing Mozzi, restoring timers to previous states,</span>
</span><span class='line'><span class="cm">    during which Arduino delay() works, then resuming Mozzi again.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    This may be useful when using sensors or other libraries which need to use</span>
</span><span class='line'><span class="cm">    the same timers as Mozzi.  (Atmel Timer 0, Timer 1, and in HIFI mode, Timer 2).</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit:</span>
</span><span class='line'><span class="cm">    Pushbutton on digital pin D4</span>
</span><span class='line'><span class="cm">       button from the digital pin to +5V (3.3V on Teensy 3.1)</span>
</span><span class='line'><span class="cm">       10K resistor from the digital pin to ground</span>
</span><span class='line'><span class="cm">    Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/brownnoise8192_int8.h&gt; </span><span class="c1">// recorded audio wavetable</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">BROWNNOISE8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aNoise</span><span class="p">(</span><span class="n">BROWNNOISE8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define STOP_PIN 4</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="n">STOP_PIN</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">static</span> <span class="kt">int</span> <span class="n">previous</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">current</span> <span class="o">=</span> <span class="n">digitalRead</span><span class="p">(</span><span class="n">STOP_PIN</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">previous</span><span class="o">==</span><span class="n">LOW</span> <span class="o">&amp;&amp;</span> <span class="n">current</span><span class="o">==</span><span class="n">HIGH</span><span class="p">){</span>
</span><span class='line'>    <span class="n">pauseMozzi</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">previous</span><span class="o">==</span><span class="n">HIGH</span> <span class="o">&amp;&amp;</span> <span class="n">current</span><span class="o">==</span><span class="n">LOW</span><span class="p">){</span>
</span><span class='line'>    <span class="n">unPauseMozzi</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">previous</span><span class="o">=</span><span class="n">current</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// jump to a new spot in the noise table to stop it sounding like it repeats</span>
</span><span class='line'>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setPhase</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="n">BROWNNOISE8192_NUM_CELLS</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aNoise</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='03.Sensors'>
03.Sensors</a></h2>


<hr />

<p>Knob_LDR_x2_WavePacket <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LDR_x2_WavePacket/Knob_LDR_x2_WavePacket.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LDR_x2_WavePacket/Knob_LDR_x2_WavePacket.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Knob_LDR_x2_WavePacketexpand' onclick='javascript:toggleDisplay(Knob_LDR_x2_WavePacket, Knob_LDR_x2_WavePacketexpand, Knob_LDR_x2_WavePacketcollapse)'>show sketch</button>
<button id='Knob_LDR_x2_WavePacketcollapse' style='display:none' onclick='javascript:toggleDisplay(Knob_LDR_x2_WavePacket, Knob_LDR_x2_WavePacketexpand, Knob_LDR_x2_WavePacketcollapse)'>hide sketch</button></p>

<div id='Knob_LDR_x2_WavePacket' style='display:none'>
<figure class='code'><figcaption><span> (Knob_LDR_x2_WavePacket.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Knob_LDR_x2_WavePacket/Knob_LDR_x2_WavePacket.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  </span>
</span><span class='line'><span class="cm">  Example of Wavepacket synthesis, using analog</span>
</span><span class='line'><span class="cm">  inputs to change the fundamental frequency, </span>
</span><span class='line'><span class="cm">  bandwidth and centre frequency,</span>
</span><span class='line'><span class="cm">  using Mozzi sonification library.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Demonstrates WavePacket, mozziAnalogRead(), and smoothing</span>
</span><span class='line'><span class="cm">  control signals with RollingAverage.</span>
</span><span class='line'><span class="cm">  Also demonstrates AutoMap, which maps unpredictable inputs to a set range.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">  http://sensorium.github.io/Mozzi/learn/introductory-tutorial/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  The circuit:</span>
</span><span class='line'><span class="cm">     Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'>
</span><span class='line'><span class="cm">     Potentiometer connected to analog pin 0.</span>
</span><span class='line'><span class="cm">       Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">       Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">     Light dependent resistor (LDR) and 5.1k resistor on analog pin 1:</span>
</span><span class='line'><span class="cm">       LDR from analog pin to +5V (3.3V on Teensy 3.1)</span>
</span><span class='line'><span class="cm">       5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm">     </span>
</span><span class='line'><span class="cm">     Light dependent resistor (LDR) and 5.1k resistor on analog pin 2:</span>
</span><span class='line'><span class="cm">       LDR from analog pin to +5V (3.3V on Teensy 3.1)</span>
</span><span class='line'><span class="cm">       5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;WavePacket.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;RollingAverage.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;AutoMap.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">KNOB_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// set the input for the knob to analog pin 0</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">LDR1_PIN</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// set the analog input for fm_intensity to pin 1</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">LDR2_PIN</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span> <span class="c1">// set the analog input for mod rate to pin 2</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// min and max values of synth parameters to map AutoRanged analog inputs to</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_F</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_F</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_BW</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_BW</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_CF</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_CF</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// for smoothing the control signals</span>
</span><span class='line'><span class="c1">// use: RollingAverage &lt;number_type, how_many_to_average&gt; myThing</span>
</span><span class='line'><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">16</span><span class="o">&gt;</span> <span class="n">kAverageF</span><span class="p">;</span>
</span><span class='line'><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">16</span><span class="o">&gt;</span> <span class="n">kAverageBw</span><span class="p">;</span>
</span><span class='line'><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">16</span><span class="o">&gt;</span> <span class="n">kAverageCf</span><span class="p">;</span>
</span><span class='line'><span class="n">AutoMap</span> <span class="n">kMapF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_F</span><span class="p">,</span><span class="n">MAX_F</span><span class="p">);</span>
</span><span class='line'><span class="n">AutoMap</span> <span class="n">kMapBw</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_BW</span><span class="p">,</span><span class="n">MAX_BW</span><span class="p">);</span>
</span><span class='line'><span class="n">AutoMap</span> <span class="n">kMapCf</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_CF</span><span class="p">,</span><span class="n">MAX_CF</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">WavePacket</span> <span class="o">&lt;</span><span class="n">DOUBLE</span><span class="o">&gt;</span> <span class="n">wavey</span><span class="p">;</span> <span class="c1">// DOUBLE selects 2 overlapping streams</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// wait before starting Mozzi to receive analog reads, so AutoRange will not get 0</span>
</span><span class='line'>  <span class="n">delay</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">fundamental</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">fundamental</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;  &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">fundamental</span> <span class="o">=</span> <span class="n">kMapF</span><span class="p">(</span><span class="n">fundamental</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">fundamental</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">LDR1_PIN</span><span class="p">);</span>
</span><span class='line'>  <span class="n">bandwidth</span> <span class="o">=</span> <span class="n">kMapBw</span><span class="p">(</span><span class="n">bandwidth</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">centre_freq</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">LDR2_PIN</span><span class="p">);</span>
</span><span class='line'>  <span class="n">centre_freq</span> <span class="o">=</span> <span class="n">kMapCf</span><span class="p">(</span><span class="n">centre_freq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="n">wavey</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">fundamental</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">,</span> <span class="n">centre_freq</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">wavey</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// &gt;&gt;8 for AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Knob_LightLevel_FMsynth <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LightLevel_FMsynth/Knob_LightLevel_FMsynth.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LightLevel_FMsynth/Knob_LightLevel_FMsynth.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Knob_LightLevel_FMsynthexpand' onclick='javascript:toggleDisplay(Knob_LightLevel_FMsynth, Knob_LightLevel_FMsynthexpand, Knob_LightLevel_FMsynthcollapse)'>show sketch</button>
<button id='Knob_LightLevel_FMsynthcollapse' style='display:none' onclick='javascript:toggleDisplay(Knob_LightLevel_FMsynth, Knob_LightLevel_FMsynthexpand, Knob_LightLevel_FMsynthcollapse)'>hide sketch</button></p>

<div id='Knob_LightLevel_FMsynth' style='display:none'>
<figure class='code'><figcaption><span> (Knob_LightLevel_FMsynth.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Knob_LightLevel_FMsynth/Knob_LightLevel_FMsynth.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/* </span>
</span><span class='line'><span class="cm">  Example using a light dependent resistor (LDR) to change </span>
</span><span class='line'><span class="cm">  an FM synthesis parameter, and a knob for fundamental frequency,</span>
</span><span class='line'><span class="cm">  using Mozzi sonification library.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Demonstrates analog input, audio oscillators, and phase modulation.</span>
</span><span class='line'><span class="cm">  Also demonstrates AutoMap, which maps unpredictable inputs to a set range.</span>
</span><span class='line'><span class="cm">  There might be clicks in the audio from rapid control changes, which</span>
</span><span class='line'><span class="cm">  could be smoothed with Line or Smooth objects.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">  This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">  http://sensorium.github.io/Mozzi/learn/introductory-tutorial/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  The circuit:</span>
</span><span class='line'><span class="cm">     Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'>
</span><span class='line'><span class="cm">     Potentiometer connected to analog pin 0.</span>
</span><span class='line'><span class="cm">       Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">       Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">     Light dependent resistor (LDR) and 5.1k resistor on analog pin 1:</span>
</span><span class='line'><span class="cm">       LDR from analog pin to +5V (3.3V on Teensy 3.1)</span>
</span><span class='line'><span class="cm">       5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator </span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// table for Oscils to play</span>
</span><span class='line'><span class="cp">#include &lt;AutoMap.h&gt; </span><span class="c1">// maps unpredictable inputs to a range</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// desired carrier frequency max and min, for AutoMap</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_CARRIER_FREQ</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_CARRIER_FREQ</span> <span class="o">=</span> <span class="mi">440</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// desired intensity max and min, for AutoMap, note they&#39;re inverted for reverse dynamics</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_INTENSITY</span> <span class="o">=</span> <span class="mi">700</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_INTENSITY</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">AutoMap</span> <span class="n">kMapCarrierFreq</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_CARRIER_FREQ</span><span class="p">,</span><span class="n">MAX_CARRIER_FREQ</span><span class="p">);</span>
</span><span class='line'><span class="n">AutoMap</span> <span class="n">kMapIntensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_INTENSITY</span><span class="p">,</span><span class="n">MAX_INTENSITY</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">KNOB_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// set the input for the knob to analog pin 0</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">LDR_PIN</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// set the input for the LDR to analog pin 1</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">mod_ratio</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// harmonics</span>
</span><span class='line'><span class="kt">long</span> <span class="n">fm_intensity</span><span class="p">;</span> <span class="c1">// carries control info from updateControl() to updateAudio()</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values // set up the Serial output for debugging</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the knob</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">knob_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// map the knob to carrier frequency</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">kMapCarrierFreq</span><span class="p">(</span><span class="n">knob_value</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//calculate the modulation frequency to stay in ratio</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">mod_freq</span> <span class="o">=</span> <span class="n">carrier_freq</span> <span class="o">*</span> <span class="n">mod_ratio</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set the FM oscillator frequencies to the calculated values</span>
</span><span class='line'>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// read the light dependent resistor on the Analog input pin</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">light_level</span><span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">LDR_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;light_level = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">light_level</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// prints a tab</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">fm_intensity</span> <span class="o">=</span> <span class="n">kMapIntensity</span><span class="p">(</span><span class="n">light_level</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;fm_intensity = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">fm_intensity</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// print a carraige return for the next line of debugging info</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">long</span> <span class="n">modulation</span> <span class="o">=</span> <span class="n">fm_intensity</span> <span class="o">*</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">(</span><span class="n">modulation</span><span class="p">);</span> <span class="c1">// phMod does the FM</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Knob_LightLevel_x2_FMsynth <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LightLevel_x2_FMsynth/Knob_LightLevel_x2_FMsynth.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Knob_LightLevel_x2_FMsynth/Knob_LightLevel_x2_FMsynth.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Knob_LightLevel_x2_FMsynthexpand' onclick='javascript:toggleDisplay(Knob_LightLevel_x2_FMsynth, Knob_LightLevel_x2_FMsynthexpand, Knob_LightLevel_x2_FMsynthcollapse)'>show sketch</button>
<button id='Knob_LightLevel_x2_FMsynthcollapse' style='display:none' onclick='javascript:toggleDisplay(Knob_LightLevel_x2_FMsynth, Knob_LightLevel_x2_FMsynthexpand, Knob_LightLevel_x2_FMsynthcollapse)'>hide sketch</button></p>

<div id='Knob_LightLevel_x2_FMsynth' style='display:none'>
<figure class='code'><figcaption><span> (Knob_LightLevel_x2_FMsynth.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Knob_LightLevel_x2_FMsynth/Knob_LightLevel_x2_FMsynth.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/* </span>
</span><span class='line'><span class="cm">  Example using 2 light dependent resistors (LDRs) to change </span>
</span><span class='line'><span class="cm">  FM synthesis parameters, and a knob for fundamental frequency,</span>
</span><span class='line'><span class="cm">  using Mozzi sonification library.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Demonstrates analog input, audio and control oscillators, phase modulation</span>
</span><span class='line'><span class="cm">  and smoothing a control signal at audio rate to avoid clicks.</span>
</span><span class='line'><span class="cm">  Also demonstrates AutoMap, which maps unpredictable inputs to a set range.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">  http://sensorium.github.io/Mozzi/learn/introductory-tutorial/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  The circuit:</span>
</span><span class='line'><span class="cm">     Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'>
</span><span class='line'><span class="cm">     Potentiometer connected to analog pin 0.</span>
</span><span class='line'><span class="cm">       Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">       Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">     Light dependent resistor (LDR) and 5.1k resistor on analog pin 1:</span>
</span><span class='line'><span class="cm">       LDR from analog pin to +5V (3.3V on Teensy 3.1)</span>
</span><span class='line'><span class="cm">       5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm">     </span>
</span><span class='line'><span class="cm">     Light dependent resistor (LDR) and 5.1k resistor on analog pin 2:</span>
</span><span class='line'><span class="cm">       LDR from analog pin to +5V (3.3V on Teensy 3.1)</span>
</span><span class='line'><span class="cm">       5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator </span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// table for Oscils to play</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;AutoMap.h&gt; </span><span class="c1">// maps unpredictable inputs to a range</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// desired carrier frequency max and min, for AutoMap</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_CARRIER_FREQ</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_CARRIER_FREQ</span> <span class="o">=</span> <span class="mi">440</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// desired intensity max and min, for AutoMap, note they&#39;re inverted for reverse dynamics</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_INTENSITY</span> <span class="o">=</span> <span class="mi">700</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_INTENSITY</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// desired mod speed max and min, for AutoMap, note they&#39;re inverted for reverse dynamics</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MIN_MOD_SPEED</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">MAX_MOD_SPEED</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">AutoMap</span> <span class="n">kMapCarrierFreq</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_CARRIER_FREQ</span><span class="p">,</span><span class="n">MAX_CARRIER_FREQ</span><span class="p">);</span>
</span><span class='line'><span class="n">AutoMap</span> <span class="n">kMapIntensity</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_INTENSITY</span><span class="p">,</span><span class="n">MAX_INTENSITY</span><span class="p">);</span>
</span><span class='line'><span class="n">AutoMap</span> <span class="n">kMapModSpeed</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1023</span><span class="p">,</span><span class="n">MIN_MOD_SPEED</span><span class="p">,</span><span class="n">MAX_MOD_SPEED</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">KNOB_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// set the input for the knob to analog pin 0</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">LDR1_PIN</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// set the analog input for fm_intensity to pin 1</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">LDR2_PIN</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span> <span class="c1">// set the analog input for mod rate to pin 2</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kIntensityMod</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">mod_ratio</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// brightness (harmonics)</span>
</span><span class='line'><span class="kt">long</span> <span class="n">fm_intensity</span><span class="p">;</span> <span class="c1">// carries control info from updateControl to updateAudio</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// smoothing for intensity to remove clicks on transitions</span>
</span><span class='line'><span class="kt">float</span> <span class="n">smoothness</span> <span class="o">=</span> <span class="mf">0.95f</span><span class="p">;</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">aSmoothIntensity</span><span class="p">(</span><span class="n">smoothness</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values // set up the Serial output so we can look at the light level</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the knob</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">knob_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// map the knob to carrier frequency</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">kMapCarrierFreq</span><span class="p">(</span><span class="n">knob_value</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//calculate the modulation frequency to stay in ratio</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">mod_freq</span> <span class="o">=</span> <span class="n">carrier_freq</span> <span class="o">*</span> <span class="n">mod_ratio</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set the FM oscillator frequencies</span>
</span><span class='line'>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// read the light dependent resistor on the width Analog input pin</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">LDR1_value</span><span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">LDR1_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;LDR1 = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">LDR1_value</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// prints a tab</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">LDR1_calibrated</span> <span class="o">=</span> <span class="n">kMapIntensity</span><span class="p">(</span><span class="n">LDR1_value</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;LDR1_calibrated = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">LDR1_calibrated</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// prints a tab</span>
</span><span class='line'>
</span><span class='line'> <span class="c1">// calculate the fm_intensity</span>
</span><span class='line'>  <span class="n">fm_intensity</span> <span class="o">=</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">LDR1_calibrated</span> <span class="o">*</span> <span class="p">(</span><span class="n">kIntensityMod</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span><span class="mi">128</span><span class="p">))</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// shift back to range after 8 bit multiply</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;fm_intensity = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">fm_intensity</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// prints a tab</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// read the light dependent resistor on the speed Analog input pin</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">LDR2_value</span><span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">LDR2_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;LDR2 = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">LDR2_value</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// prints a tab</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// use a float here for low frequencies</span>
</span><span class='line'>  <span class="kt">float</span> <span class="n">mod_speed</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">kMapModSpeed</span><span class="p">(</span><span class="n">LDR2_value</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">;</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;   mod_speed = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">mod_speed</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kIntensityMod</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mod_speed</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// finally, print a carraige return for the next line of debugging info</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">long</span> <span class="n">modulation</span> <span class="o">=</span> <span class="n">aSmoothIntensity</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">fm_intensity</span><span class="p">)</span> <span class="o">*</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">(</span><span class="n">modulation</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Light_Temperature_Detuned <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Light_Temperature_Detuned/Light_Temperature_Detuned.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Light_Temperature_Detuned/Light_Temperature_Detuned.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Light_Temperature_Detunedexpand' onclick='javascript:toggleDisplay(Light_Temperature_Detuned, Light_Temperature_Detunedexpand, Light_Temperature_Detunedcollapse)'>show sketch</button>
<button id='Light_Temperature_Detunedcollapse' style='display:none' onclick='javascript:toggleDisplay(Light_Temperature_Detuned, Light_Temperature_Detunedexpand, Light_Temperature_Detunedcollapse)'>hide sketch</button></p>

<div id='Light_Temperature_Detuned' style='display:none'>
<figure class='code'><figcaption><span> (Light_Temperature_Detuned.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Light_Temperature_Detuned/Light_Temperature_Detuned.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  </span>
</span><span class='line'><span class="cm">  Plays a fluctuating ambient wash in response to light and temperature sensors.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Pairs of audio oscillators are detuned in response to light on an LDR and</span>
</span><span class='line'><span class="cm">  the base frequencies are offset depending on the temperature.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  It&#39;s a pretty dumb sonification, but at this stage </span>
</span><span class='line'><span class="cm">  it&#39;s just to demonstrate the possibility of reading sensors while</span>
</span><span class='line'><span class="cm">  lots of audio oscillators are running.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Circuit:</span>
</span><span class='line'><span class="cm">    Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Temperature dependent resistor (Thermistor) and 5.1k resistor on analog pin 1:</span>
</span><span class='line'><span class="cm">      Thermistor from analog pin to +5V (3.3V on Teensy 3.1)</span>
</span><span class='line'><span class="cm">      5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Light dependent resistor (LDR) and 5.1k resistor on analog pin 2:</span>
</span><span class='line'><span class="cm">      LDR from analog pin to +5V (3.3V on Teensy 3.1)</span>
</span><span class='line'><span class="cm">      5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm">      </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos8192_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define THERMISTOR_PIN 1</span>
</span><span class='line'><span class="cp">#define LDR_PIN 2</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// harmonics</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos3</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos4</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos5</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos6</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos0</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// duplicates but slightly off frequency for adding to originals</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos1b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos2b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos3b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos4b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos5b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos6b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos0b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// base pitch frequencies</span>
</span><span class='line'><span class="kt">float</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">f3</span><span class="p">,</span><span class="n">f4</span><span class="p">,</span><span class="n">f5</span><span class="p">,</span><span class="n">f6</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// to map light input to frequency divergence of the b oscillators</span>
</span><span class='line'><span class="k">const</span> <span class="kt">float</span> <span class="n">DIVERGENCE_SCALE</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span> <span class="c1">// 0.01*1023 = 10.23 Hz max divergence</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// to map temperature to base freq drift</span>
</span><span class='line'><span class="k">const</span> <span class="kt">float</span> <span class="n">OFFSET_SCALE</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="c1">// 0.1*1023 = 102.3 Hz max drift</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// select base frequencies using mtof</span>
</span><span class='line'>  <span class="c1">// C Fâ¯ Bâ­ E A D the &quot;Promethean chord&quot;</span>
</span><span class='line'>  <span class="n">f0</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">36.f</span><span class="p">);</span> <span class="c1">// a spare C !</span>
</span><span class='line'>  <span class="n">f1</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">48.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">f2</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">54.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">f3</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">58.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">f4</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">64.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">f5</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">69.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">f6</span> <span class="o">=</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">74.f</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set Oscils with chosen frequencies</span>
</span><span class='line'>  <span class="n">aCos0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f0</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f1</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f2</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f3</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f4</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f5</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos6</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f6</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set frequencies of duplicate oscillators</span>
</span><span class='line'>  <span class="n">aCos6b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f6</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos0b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f0</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos1b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f1</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos2b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f2</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos3b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f3</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos4b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f4</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos5b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">f5</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read analog inputs</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">temperature</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">THERMISTOR_PIN</span><span class="p">);</span> <span class="c1">// not calibrated to degrees!</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">light_input</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">LDR_PIN</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">float</span> <span class="n">base_freq_offset</span> <span class="o">=</span> <span class="n">OFFSET_SCALE</span><span class="o">*</span><span class="n">temperature</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">float</span> <span class="n">divergence</span> <span class="o">=</span> <span class="n">DIVERGENCE_SCALE</span><span class="o">*</span><span class="n">light_input</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">float</span> <span class="n">freq</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// change frequencies of the oscillators, randomly choosing one pair each time to change</span>
</span><span class='line'>  <span class="k">switch</span> <span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">7</span><span class="p">)){</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>      <span class="n">freq</span> <span class="o">=</span> <span class="n">f0</span><span class="o">+</span><span class="n">base_freq_offset</span><span class="p">;</span>
</span><span class='line'>      <span class="n">aCos0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
</span><span class='line'>      <span class="n">aCos0b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="n">divergence</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>      <span class="n">freq</span> <span class="o">=</span> <span class="n">f1</span><span class="o">+</span><span class="n">base_freq_offset</span><span class="p">;</span>
</span><span class='line'>      <span class="n">aCos1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
</span><span class='line'>      <span class="n">aCos1b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="n">divergence</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>      <span class="n">freq</span> <span class="o">=</span> <span class="n">f2</span><span class="o">+</span><span class="n">base_freq_offset</span><span class="p">;</span>
</span><span class='line'>      <span class="n">aCos2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
</span><span class='line'>      <span class="n">aCos2b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="n">divergence</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>      <span class="n">freq</span> <span class="o">=</span> <span class="n">f3</span><span class="o">+</span><span class="n">base_freq_offset</span><span class="p">;</span>
</span><span class='line'>      <span class="n">aCos3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
</span><span class='line'>      <span class="n">aCos3b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="n">divergence</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span><span class='line'>      <span class="n">freq</span> <span class="o">=</span> <span class="n">f4</span><span class="o">+</span><span class="n">base_freq_offset</span><span class="p">;</span>
</span><span class='line'>      <span class="n">aCos4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
</span><span class='line'>      <span class="n">aCos4b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="n">divergence</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
</span><span class='line'>      <span class="n">freq</span> <span class="o">=</span> <span class="n">f5</span><span class="o">+</span><span class="n">base_freq_offset</span><span class="p">;</span>
</span><span class='line'>      <span class="n">aCos5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
</span><span class='line'>      <span class="n">aCos5b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="n">divergence</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">6</span><span class="o">:</span>
</span><span class='line'>      <span class="n">freq</span> <span class="o">=</span> <span class="n">f6</span><span class="o">+</span><span class="n">base_freq_offset</span><span class="p">;</span>
</span><span class='line'>      <span class="n">aCos6</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
</span><span class='line'>      <span class="n">aCos6b</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="n">divergence</span><span class="p">);</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">aCos0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos0b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos1b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos2b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos3</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos3b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos4</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos4b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos5</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos5b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos6</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos6b</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">asig</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Light_Temperature_Multi_Oscil <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Light_Temperature_Multi_Oscil/Light_Temperature_Multi_Oscil.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Light_Temperature_Multi_Oscil/Light_Temperature_Multi_Oscil.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Light_Temperature_Multi_Oscilexpand' onclick='javascript:toggleDisplay(Light_Temperature_Multi_Oscil, Light_Temperature_Multi_Oscilexpand, Light_Temperature_Multi_Oscilcollapse)'>show sketch</button>
<button id='Light_Temperature_Multi_Oscilcollapse' style='display:none' onclick='javascript:toggleDisplay(Light_Temperature_Multi_Oscil, Light_Temperature_Multi_Oscilexpand, Light_Temperature_Multi_Oscilcollapse)'>hide sketch</button></p>

<div id='Light_Temperature_Multi_Oscil' style='display:none'>
<figure class='code'><figcaption><span> (Light_Temperature_Multi_Oscil.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Light_Temperature_Multi_Oscil/Light_Temperature_Multi_Oscil.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  </span>
</span><span class='line'><span class="cm">  Plays a fluctuating ambient wash in response to light and temperature sensors,</span>
</span><span class='line'><span class="cm">  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  8 control rate oscillators are used to set the volume of 8 audio oscillators.</span>
</span><span class='line'><span class="cm">  Temperature readings from a thermistor are used to set the notes</span>
</span><span class='line'><span class="cm">  being played, and light readings from a light dependent resistor are</span>
</span><span class='line'><span class="cm">  mapped to the pulse rates of the volume control oscillators.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Circuit:</span>
</span><span class='line'><span class="cm">    Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Temperature dependent resistor (Thermistor) and 5.1k resistor on analog pin 1:</span>
</span><span class='line'><span class="cm">      Thermistor from analog pin to +5V (3.3V on Teensy 3.1)</span>
</span><span class='line'><span class="cm">      5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Light dependent resistor (LDR) and 5.1k resistor on analog pin 2:</span>
</span><span class='line'><span class="cm">      LDR from analog pin to +5V (3.3V on Teensy 3.1)</span>
</span><span class='line'><span class="cm">      5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos8192_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 256</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define THERMISTOR_PIN 1</span>
</span><span class='line'><span class="cp">#define LDR_PIN 2</span>
</span><span class='line'><span class="cp">#define NUM_VOICES 8</span>
</span><span class='line'><span class="cp">#define THRESHOLD 10</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// harmonics</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos3</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos4</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos5</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos6</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos7</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos0</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// volume controls</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol3</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol4</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol5</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol6</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol7</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kVol0</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio volumes updated each control interrupt and reused in audio till next control</span>
</span><span class='line'><span class="kt">char</span> <span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">,</span><span class="n">v3</span><span class="p">,</span><span class="n">v4</span><span class="p">,</span><span class="n">v5</span><span class="p">,</span><span class="n">v6</span><span class="p">,</span><span class="n">v7</span><span class="p">,</span><span class="n">v0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// notes to play depending on whether temperature reading increases or decreases</span>
</span><span class='line'><span class="kt">float</span> <span class="n">upnotes</span><span class="p">[</span><span class="n">NUM_VOICES</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">mtof</span><span class="p">(</span><span class="mf">62.f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">64.f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">70.f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">72.f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">79.f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">81.f</span><span class="p">),</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">86.f</span><span class="p">),</span> <span class="n">mtof</span><span class="p">(</span><span class="mf">88.f</span><span class="p">)};</span>
</span><span class='line'>
</span><span class='line'><span class="kt">float</span> <span class="n">downnotes</span><span class="p">[</span><span class="n">NUM_VOICES</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">mtof</span><span class="p">(</span><span class="mf">64.f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">65.f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">88.f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">72.f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">79.f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">84.f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">86.f</span><span class="p">),</span><span class="n">mtof</span><span class="p">(</span><span class="mf">89.f</span><span class="p">)};</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// returns freq</span>
</span><span class='line'><span class="kt">int</span> <span class="n">temperatureToFreq</span><span class="p">(</span><span class="kt">char</span> <span class="n">oscil_num</span><span class="p">,</span> <span class="kt">int</span> <span class="n">temperature</span><span class="p">){</span>
</span><span class='line'>  <span class="k">static</span> <span class="kt">int</span> <span class="n">previous_temperature</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">freq</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">temperature</span><span class="o">&gt;</span><span class="n">previous_temperature</span><span class="p">){</span>
</span><span class='line'>    <span class="n">freq</span> <span class="o">=</span> <span class="n">upnotes</span><span class="p">[</span><span class="n">oscil_num</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>     <span class="n">freq</span> <span class="o">=</span> <span class="n">downnotes</span><span class="p">[</span><span class="n">oscil_num</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">previous_temperature</span> <span class="o">=</span> <span class="n">temperature</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">freq</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">static</span> <span class="kt">float</span> <span class="n">previous_pulse_freq</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// read analog inputs</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">temperature</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">THERMISTOR_PIN</span><span class="p">);</span> <span class="c1">// not calibrated to degrees!</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">light</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">LDR_PIN</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// map light reading to volume pulse frequency</span>
</span><span class='line'>  <span class="kt">float</span> <span class="n">pulse_freq</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">light</span><span class="o">/</span><span class="mi">256</span><span class="p">;</span>
</span><span class='line'>  <span class="n">previous_pulse_freq</span> <span class="o">=</span> <span class="n">pulse_freq</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">v0</span> <span class="o">=</span> <span class="n">kVol0</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="n">v1</span> <span class="o">=</span> <span class="n">kVol1</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="n">v2</span> <span class="o">=</span> <span class="n">kVol2</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="n">v3</span> <span class="o">=</span> <span class="n">kVol3</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="n">v4</span> <span class="o">=</span> <span class="n">kVol4</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="n">v5</span> <span class="o">=</span> <span class="n">kVol5</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="n">v6</span> <span class="o">=</span> <span class="n">kVol6</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="n">v7</span> <span class="o">=</span> <span class="n">kVol7</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set one note oscillator frequency each time (if it&#39;s volume is close to 0)</span>
</span><span class='line'>  <span class="k">static</span> <span class="kt">char</span> <span class="n">whoseTurn</span><span class="p">;</span>
</span><span class='line'>  <span class="k">switch</span><span class="p">(</span><span class="n">whoseTurn</span><span class="p">){</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>    <span class="n">kVol0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pulse_freq</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span><span class="o">&lt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">aCos0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">temperatureToFreq</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">temperature</span><span class="p">));</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>    <span class="n">kVol1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pulse_freq</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span><span class="o">&lt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">aCos1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">temperatureToFreq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">temperature</span><span class="p">));</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>    <span class="n">kVol2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pulse_freq</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span><span class="o">&lt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">aCos2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">temperatureToFreq</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">temperature</span><span class="p">));</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>    <span class="n">kVol3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pulse_freq</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v3</span><span class="p">)</span><span class="o">&lt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">aCos3</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">temperatureToFreq</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">temperature</span><span class="p">));</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span><span class='line'>    <span class="n">kVol4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pulse_freq</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v4</span><span class="p">)</span><span class="o">&lt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">aCos4</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">temperatureToFreq</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">temperature</span><span class="p">));</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
</span><span class='line'>    <span class="n">kVol5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pulse_freq</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v5</span><span class="p">)</span><span class="o">&lt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">aCos5</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">temperatureToFreq</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="n">temperature</span><span class="p">));</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">case</span> <span class="mi">6</span><span class="o">:</span>
</span><span class='line'>    <span class="n">kVol6</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pulse_freq</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v6</span><span class="p">)</span><span class="o">&lt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">aCos6</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">temperatureToFreq</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="n">temperature</span><span class="p">));</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">case</span> <span class="mi">7</span><span class="o">:</span>
</span><span class='line'>    <span class="n">kVol7</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pulse_freq</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">v7</span><span class="p">)</span><span class="o">&lt;</span><span class="n">THRESHOLD</span><span class="p">)</span> <span class="n">aCos7</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">temperatureToFreq</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="n">temperature</span><span class="p">));</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="o">++</span><span class="n">whoseTurn</span><span class="o">&gt;=</span><span class="n">NUM_VOICES</span><span class="p">)</span> <span class="n">whoseTurn</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">long</span> <span class="n">asig</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span>
</span><span class='line'>    <span class="n">aCos0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v0</span> <span class="o">+</span>
</span><span class='line'>      <span class="n">aCos1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v1</span> <span class="o">+</span>
</span><span class='line'>      <span class="n">aCos2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v2</span> <span class="o">+</span>
</span><span class='line'>      <span class="n">aCos3</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v3</span> <span class="o">+</span>
</span><span class='line'>      <span class="n">aCos4</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v4</span> <span class="o">+</span>
</span><span class='line'>      <span class="n">aCos5</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v5</span> <span class="o">+</span>
</span><span class='line'>      <span class="n">aCos6</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v6</span> <span class="o">+</span>
</span><span class='line'>      <span class="n">aCos7</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">v7</span><span class="p">;</span>
</span><span class='line'>  <span class="n">asig</span> <span class="o">&gt;&gt;=</span> <span class="mi">9</span><span class="p">;</span> <span class="c1">// shift back to audio output range</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Piezo_Frequency <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_Frequency/Piezo_Frequency.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_Frequency/Piezo_Frequency.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Piezo_Frequencyexpand' onclick='javascript:toggleDisplay(Piezo_Frequency, Piezo_Frequencyexpand, Piezo_Frequencycollapse)'>show sketch</button>
<button id='Piezo_Frequencycollapse' style='display:none' onclick='javascript:toggleDisplay(Piezo_Frequency, Piezo_Frequencyexpand, Piezo_Frequencycollapse)'>hide sketch</button></p>

<div id='Piezo_Frequency' style='display:none'>
<figure class='code'><figcaption><span> (Piezo_Frequency.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Piezo_Frequency/Piezo_Frequency.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">   Example using a piezo to change the frequency of a sinewave</span>
</span><span class='line'><span class="cm">   with Mozzi sonification library.</span>
</span><span class='line'><span class="cm">   </span>
</span><span class='line'><span class="cm">   Demonstrates the use of Oscil to play a wavetable, and analog input for control.</span>
</span><span class='line'><span class="cm">   </span>
</span><span class='line'><span class="cm">   This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">   http://sensorium.github.io/Mozzi/learn/introductory-tutorial/</span>
</span><span class='line'><span class="cm">   </span>
</span><span class='line'><span class="cm">   The circuit:</span>
</span><span class='line'><span class="cm">     Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">   </span>
</span><span class='line'><span class="cm">     Piezo on analog pin 3:</span>
</span><span class='line'><span class="cm">       + connection of the piezo attached to the analog pin</span>
</span><span class='line'><span class="cm">       - connection of the piezo attached to ground</span>
</span><span class='line'><span class="cm">       1-megohm resistor between the analog pin and ground</span>
</span><span class='line'><span class="cm">   </span>
</span><span class='line'><span class="cm">   Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">   https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">   </span>
</span><span class='line'><span class="cm">   Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator </span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// table for Oscils to play</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// increase the rate of updateControl from the default of 64, to catch the piezo&#39;s rapid transients</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">PIEZO_PIN</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">// set the analog input pin for the piezo </span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values // set up the Serial output so we can look at the piezo values</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// :)) use the control rate defined above</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the piezo</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">piezo_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">PIEZO_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;piezo_value = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">piezo_value</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s"> </span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// prints 2 tabs</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">frequency</span> <span class="o">=</span> <span class="n">piezo_value</span><span class="o">*</span><span class="mi">3</span><span class="p">;</span> <span class="c1">// calibrate</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the frequency to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;frequency = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">frequency</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set the frequency</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">frequency</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// next line</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Piezo_SampleScrubber <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_SampleScrubber/Piezo_SampleScrubber.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_SampleScrubber/Piezo_SampleScrubber.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Piezo_SampleScrubberexpand' onclick='javascript:toggleDisplay(Piezo_SampleScrubber, Piezo_SampleScrubberexpand, Piezo_SampleScrubbercollapse)'>show sketch</button>
<button id='Piezo_SampleScrubbercollapse' style='display:none' onclick='javascript:toggleDisplay(Piezo_SampleScrubber, Piezo_SampleScrubberexpand, Piezo_SampleScrubbercollapse)'>hide sketch</button></p>

<div id='Piezo_SampleScrubber' style='display:none'>
<figure class='code'><figcaption><span> (Piezo_SampleScrubber.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Piezo_SampleScrubber/Piezo_SampleScrubber.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">  Example of simple &quot;scrubbing&quot; through a sampled sound with a knob</span>
</span><span class='line'><span class="cm">  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  Demonstrates getting audio samples from a table using a Line to</span>
</span><span class='line'><span class="cm">  slide between different indexes.</span>
</span><span class='line'><span class="cm">  Also demonstrates mozziAnalogRead(pin), a non-blocking replacement for mozziAnalogRead</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">  http://sensorium.github.io/Mozzi/learn/introductory-tutorial/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  The circuit:</span>
</span><span class='line'><span class="cm">    Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  Piezo on analog pin A3:</span>
</span><span class='line'><span class="cm">    + connection of the piezo attached to the analog pin</span>
</span><span class='line'><span class="cm">    - connection of the piezo attached to ground</span>
</span><span class='line'><span class="cm">    1-megOhm resistor attached from the analog pin to ground</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Sample.h&gt; </span><span class="c1">// Sample template</span>
</span><span class='line'><span class="cp">#include &quot;blahblah4b_int8.h&quot;</span>
</span><span class='line'><span class="cp">#include &lt;Line.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// use this smooth out the wandering/jumping rate of scrubbing, gives more convincing reverses</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothOffset</span><span class="p">(</span><span class="mf">0.85f</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Sample &lt;table_size, update_rate, interpolation &gt; SampleName (wavetable)</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BLAHBLAH4B_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="p">,</span> <span class="n">INTERP_LINEAR</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">BLAHBLAH4B_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//Line to scrub through sample at audio rate, Line target is set at control rate</span>
</span><span class='line'><span class="n">Line</span> <span class="o">&lt;</span><span class="n">Q16n16</span><span class="o">&gt;</span> <span class="n">scrub</span><span class="p">;</span> <span class="c1">// Q16n16 fixed point for high precision</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// the number of audio steps the line has to take to reach the next offset</span>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">AUDIO_STEPS_PER_CONTROL</span> <span class="o">=</span> <span class="n">AUDIO_RATE</span> <span class="o">/</span> <span class="n">CONTROL_RATE</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#define INPUT_PIN 3 </span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setLoopingOn</span><span class="p">();</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// read the pot</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">sensor_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">INPUT_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// map it to an 8 bit range for efficient calculations in updateAudio</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">target</span> <span class="o">=</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span> <span class="n">sensor_value</span> <span class="o">*</span> <span class="n">BLAHBLAH4B_NUM_CELLS</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// &gt;&gt; 10 is / 1024</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">smooth_offset</span> <span class="o">=</span> <span class="n">kSmoothOffset</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set new target for interpolating line to scrub to</span>
</span><span class='line'>  <span class="n">scrub</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="n">smooth_offset</span><span class="p">),</span> <span class="n">AUDIO_STEPS_PER_CONTROL</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSample</span><span class="p">.</span><span class="n">atIndex</span><span class="p">(</span><span class="n">Q16n16_to_Q16n0</span><span class="p">(</span><span class="n">scrub</span><span class="p">.</span><span class="n">next</span><span class="p">()));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Piezo_SampleTrigger <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_SampleTrigger/Piezo_SampleTrigger.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_SampleTrigger/Piezo_SampleTrigger.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Piezo_SampleTriggerexpand' onclick='javascript:toggleDisplay(Piezo_SampleTrigger, Piezo_SampleTriggerexpand, Piezo_SampleTriggercollapse)'>show sketch</button>
<button id='Piezo_SampleTriggercollapse' style='display:none' onclick='javascript:toggleDisplay(Piezo_SampleTrigger, Piezo_SampleTriggerexpand, Piezo_SampleTriggercollapse)'>hide sketch</button></p>

<div id='Piezo_SampleTrigger' style='display:none'>
<figure class='code'><figcaption><span> (Piezo_SampleTrigger.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Piezo_SampleTrigger/Piezo_SampleTrigger.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">   Example using a piezo to trigger an audio sample to play,</span>
</span><span class='line'><span class="cm">   and a knob to set the playback pitch,</span>
</span><span class='line'><span class="cm">   with Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">   Demonstrates one-shot samples and analog input for control.</span>
</span><span class='line'><span class="cm">   </span>
</span><span class='line'><span class="cm">   This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">   http://sensorium.github.io/Mozzi/learn/introductory-tutorial/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">   The circuit:</span>
</span><span class='line'><span class="cm">     Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'>
</span><span class='line'><span class="cm">     Potentiometer connected to analog pin 0.</span>
</span><span class='line'><span class="cm">       Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">       Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">     Piezo on analog pin 3:</span>
</span><span class='line'><span class="cm">       + connection of the piezo attached to the analog pin</span>
</span><span class='line'><span class="cm">       - connection of the piezo attached to ground</span>
</span><span class='line'><span class="cm">       1-megohm resistor between the analog pin and ground</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">   Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">   https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">   Tim Barrass 2013.</span>
</span><span class='line'><span class="cm">   CC by-nc-sa</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Sample.h&gt; </span><span class="c1">// Sample template</span>
</span><span class='line'><span class="cp">#include &lt;samples/burroughs1_18649_int8.h&gt; </span><span class="c1">// a converted audio sample included in the Mozzi download</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">char</span> <span class="n">KNOB_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">// set the analog input pin for the knob</span>
</span><span class='line'><span class="k">const</span> <span class="kt">char</span> <span class="n">PIEZO_PIN</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">// set the analog input pin for the piezo </span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>  <span class="c1">// threshold value to decide when the detected signal is a knock or not</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">BURROUGHS1_18649_DATA</span><span class="p">);</span>
</span><span class='line'><span class="kt">float</span> <span class="n">recorded_pitch</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">boolean</span> <span class="n">triggered</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values // set up the Serial output so we can look at the piezo values</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the knob</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">knob_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// map it to values between 0.1 and about double the recorded pitch</span>
</span><span class='line'>  <span class="kt">float</span> <span class="n">pitch</span> <span class="o">=</span> <span class="p">(</span><span class="n">recorded_pitch</span> <span class="o">*</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">knob_value</span> <span class="o">/</span> <span class="mf">512.f</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1f</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set the sample playback frequency</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pitch</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// read the piezo</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">piezo_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">PIEZO_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;piezo value = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">piezo_value</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// only trigger once each time the piezo goes over the threshold</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">piezo_value</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">triggered</span><span class="p">){</span>
</span><span class='line'>      <span class="n">aSample</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>      <span class="n">triggered</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>    <span class="n">triggered</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// next line</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSample</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Piezo_Switch_Pitch <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_Switch_Pitch/Piezo_Switch_Pitch.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Piezo_Switch_Pitch/Piezo_Switch_Pitch.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Piezo_Switch_Pitchexpand' onclick='javascript:toggleDisplay(Piezo_Switch_Pitch, Piezo_Switch_Pitchexpand, Piezo_Switch_Pitchcollapse)'>show sketch</button>
<button id='Piezo_Switch_Pitchcollapse' style='display:none' onclick='javascript:toggleDisplay(Piezo_Switch_Pitch, Piezo_Switch_Pitchexpand, Piezo_Switch_Pitchcollapse)'>hide sketch</button></p>

<div id='Piezo_Switch_Pitch' style='display:none'>
<figure class='code'><figcaption><span> (Piezo_Switch_Pitch.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Piezo_Switch_Pitch/Piezo_Switch_Pitch.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">  Example using a piezo to trigger an audio sample </span>
</span><span class='line'><span class="cm">  and a switch to change the playback pitch.</span>
</span><span class='line'><span class="cm">  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Demonstrates one-shot samples, analog input for triggering,</span>
</span><span class='line'><span class="cm">  and digital input for switching.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">  http://sensorium.github.io/Mozzi/learn/introductory-tutorial/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  The circuit:</span>
</span><span class='line'><span class="cm">    Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Piezo on analog pin A3:</span>
</span><span class='line'><span class="cm">      + connection of the piezo attached to the analog pin</span>
</span><span class='line'><span class="cm">      - connection of the piezo attached to ground</span>
</span><span class='line'><span class="cm">      1-megOhm resistor attached from the analog pin to ground</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Pushbutton on digital pin D4</span>
</span><span class='line'><span class="cm">      button between the digital pin and +5V</span>
</span><span class='line'><span class="cm">      10K resistor from the digital pin to ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Sample.h&gt; </span><span class="c1">// Sample template</span>
</span><span class='line'><span class="cp">#include &lt;samples/burroughs1_18649_int8.h&gt; </span><span class="c1">// a converted audio sample included in the Mozzi download</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">PIEZO_PIN</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">// set the analog input pin for the piezo </span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>  <span class="c1">// threshold value to decide when the detected signal is a knock or not</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">BUTTON_PIN</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="c1">// set the digital input pin for the button</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">BURROUGHS1_18649_DATA</span><span class="p">);</span>
</span><span class='line'><span class="kt">float</span> <span class="n">recorded_pitch</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">char</span> <span class="n">button_state</span><span class="p">,</span> <span class="n">previous_button_state</span><span class="p">;</span> <span class="c1">// variable for reading the pushbutton status       </span>
</span><span class='line'><span class="kt">char</span> <span class="n">latest_button_change</span><span class="p">;</span>
</span><span class='line'><span class="n">boolean</span> <span class="n">triggered</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'><span class="kt">float</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">pitch_change</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values // set up the Serial output so we can look at the piezo values</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">buttonChangePitch</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the state of the pushbutton value:</span>
</span><span class='line'>  <span class="n">button_state</span> <span class="o">=</span> <span class="n">digitalRead</span><span class="p">(</span><span class="n">BUTTON_PIN</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// has the button state changed?</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">button_state</span> <span class="o">!=</span> <span class="n">previous_button_state</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// if the latest change was a press, pitch up, else pitch down</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">button_state</span> <span class="o">==</span> <span class="n">HIGH</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">pitch</span> <span class="o">=</span> <span class="mf">2.f</span> <span class="o">*</span> <span class="n">recorded_pitch</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">pitch</span> <span class="o">=</span> <span class="mf">0.5f</span> <span class="o">*</span> <span class="n">recorded_pitch</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">previous_button_state</span> <span class="o">=</span> <span class="n">button_state</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the piezo</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">piezo_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">PIEZO_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;piezo value = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">piezo_value</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// only trigger once each time the piezo goes over the threshold</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">piezo_value</span><span class="o">&gt;</span><span class="n">threshold</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">triggered</span><span class="p">){</span>
</span><span class='line'>      <span class="n">pitch</span> <span class="o">=</span> <span class="n">recorded_pitch</span><span class="p">;</span>
</span><span class='line'>      <span class="n">aSample</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>      <span class="n">triggered</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span><span class="p">{</span>
</span><span class='line'>    <span class="n">triggered</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">buttonChangePitch</span><span class="p">();</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">pitch</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// next line</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSample</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>RCpoll <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/RCpoll/RCpoll.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/RCpoll/RCpoll.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='RCpollexpand' onclick='javascript:toggleDisplay(RCpoll, RCpollexpand, RCpollcollapse)'>show sketch</button>
<button id='RCpollcollapse' style='display:none' onclick='javascript:toggleDisplay(RCpoll, RCpollexpand, RCpollcollapse)'>hide sketch</button></p>

<div id='RCpoll' style='display:none'>
<figure class='code'><figcaption><span> (RCpoll.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/RCpoll/RCpoll.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Sets the frequency of an oscillator with a resistive sensor on a digital pin,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Demonstrates RCpoll to read a resistive sensor on a digital pin,</span>
</span><span class='line'><span class="cm"> *  without blocking audio output. </span>
</span><span class='line'><span class="cm"> *  </span>
</span><span class='line'><span class="cm"> *  Control circuit: http://arduino.cc/en/Tutorial/RCtime</span>
</span><span class='line'><span class="cm"> *  Values for components which work with this sketch are:</span>
</span><span class='line'><span class="cm"> *  Sensing Capacitor .1uf (104)</span>
</span><span class='line'><span class="cm"> *  Variable resistor 1 MegaOhm</span>
</span><span class='line'><span class="cm"> *  Input resistor 470 Ohms</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm">                           +5V</span>
</span><span class='line'><span class="cm">                            |</span>
</span><span class='line'><span class="cm">                            |</span>
</span><span class='line'><span class="cm">                           ___</span>
</span><span class='line'><span class="cm">                           ___    Sensing Cap</span>
</span><span class='line'><span class="cm">                            |      .1 uf</span>
</span><span class='line'><span class="cm">                            |</span>
</span><span class='line'><span class="cm">sPin ---\/\/\/-----.</span>
</span><span class='line'><span class="cm">       220 - 1K       |</span>
</span><span class='line'><span class="cm">                            |</span>
</span><span class='line'><span class="cm">                            \   </span>
</span><span class='line'><span class="cm">                            /     Variable Resistive Sensor</span>
</span><span class='line'><span class="cm">                            \     Photocell, phototransistor, FSR etc.</span>
</span><span class='line'><span class="cm">                            /</span>
</span><span class='line'><span class="cm">                            |</span>
</span><span class='line'><span class="cm">                            |</span>
</span><span class='line'><span class="cm">                          _____ </span>
</span><span class='line'><span class="cm">                           ___</span>
</span><span class='line'><span class="cm">                            _</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;RCpoll.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'><span class="cp">#define SENSOR_PIN 4            </span><span class="c1">// digital pin for sensor input</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">RCpoll</span> <span class="o">&lt;</span><span class="n">SENSOR_PIN</span><span class="o">&gt;</span> <span class="n">sensor</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">freq</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="n">sensor</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// sensor ranges about 0 to 13</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Sinewave_Pinchange_Interrupt <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Sinewave_Pinchange_Interrupt/Sinewave_Pinchange_Interrupt.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Sinewave_Pinchange_Interrupt/Sinewave_Pinchange_Interrupt.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Sinewave_Pinchange_Interruptexpand' onclick='javascript:toggleDisplay(Sinewave_Pinchange_Interrupt, Sinewave_Pinchange_Interruptexpand, Sinewave_Pinchange_Interruptcollapse)'>show sketch</button>
<button id='Sinewave_Pinchange_Interruptcollapse' style='display:none' onclick='javascript:toggleDisplay(Sinewave_Pinchange_Interrupt, Sinewave_Pinchange_Interruptexpand, Sinewave_Pinchange_Interruptcollapse)'>hide sketch</button></p>

<div id='Sinewave_Pinchange_Interrupt' style='display:none'>
<figure class='code'><figcaption><span> (Sinewave_Pinchange_Interrupt.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Sinewave_Pinchange_Interrupt/Sinewave_Pinchange_Interrupt.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  </span>
</span><span class='line'><span class="cm">  Example of changing a sound in response to pin changes detected </span>
</span><span class='line'><span class="cm">  in the background with an interrupt, using PinChangeInt library</span>
</span><span class='line'><span class="cm">  with Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Demonstrates using Mozzi with PinChangeInt library from:</span>
</span><span class='line'><span class="cm">  http://code.google.com/p/arduino-pinchangeint/</span>
</span><span class='line'><span class="cm">  (Not for Teensy 3.1)</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Circuit:</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Audio output on digital pin 9 on a Uno or similar, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Pushbutton on digital pin D4</span>
</span><span class='line'><span class="cm">      button from the digital pin to +5V</span>
</span><span class='line'><span class="cm">      10K resistor from the digital pin to ground</span>
</span><span class='line'><span class="cm">      6.8nf capacitor from the digital pin to ground</span>
</span><span class='line'><span class="cm">     </span>
</span><span class='line'><span class="cm">     </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;PinChangeInt.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define PIN 4  </span><span class="c1">// the pin we are interested in</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="n">PIN</span><span class="p">,</span> <span class="n">INPUT</span><span class="p">);</span>     <span class="c1">//set the pin to input</span>
</span><span class='line'>  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">PIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span> <span class="c1">//use the internal pullup resistor</span>
</span><span class='line'>  <span class="n">PCintPort</span><span class="o">::</span><span class="n">attachInterrupt</span><span class="p">(</span><span class="n">PIN</span><span class="p">,</span> <span class="n">changeFreq</span><span class="p">,</span><span class="n">RISING</span><span class="p">);</span> <span class="c1">// attach a PinChange Interrupt to our pin on the rising edge</span>
</span><span class='line'>  <span class="c1">// (RISING, FALLING and CHANGE all work with this library)</span>
</span><span class='line'>  <span class="c1">// and execute the function changeFreq when that pin changes</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// everything is done by the pinchange interrupt</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">changeFreq</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">static</span> <span class="kt">int</span> <span class="n">freq</span> <span class="o">=</span> <span class="mi">220</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">freq</span><span class="o">==</span><span class="mi">220</span><span class="p">){</span>
</span><span class='line'>    <span class="n">freq</span><span class="o">=</span><span class="mi">330</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span><span class="p">{</span>
</span><span class='line'>    <span class="n">freq</span><span class="o">=</span><span class="mi">220</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span> <span class="c1">// set the frequency</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// return an int signal centred around 0</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Volume_Knob <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Volume_Knob/Volume_Knob.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Volume_Knob/Volume_Knob.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Volume_Knobexpand' onclick='javascript:toggleDisplay(Volume_Knob, Volume_Knobexpand, Volume_Knobcollapse)'>show sketch</button>
<button id='Volume_Knobcollapse' style='display:none' onclick='javascript:toggleDisplay(Volume_Knob, Volume_Knobexpand, Volume_Knobcollapse)'>hide sketch</button></p>

<div id='Volume_Knob' style='display:none'>
<figure class='code'><figcaption><span> (Volume_Knob.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Volume_Knob/Volume_Knob.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  </span>
</span><span class='line'><span class="cm">  Example using a potentiometer to control the amplitude of a sinewave</span>
</span><span class='line'><span class="cm">  with Mozzi sonification library.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Demonstrates the use of Oscil to play a wavetable, and analog input for control.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">  http://sensorium.github.io/Mozzi/learn/introductory-tutorial/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  The circuit:</span>
</span><span class='line'><span class="cm">    Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Potentiometer connected to analog pin 0:</span>
</span><span class='line'><span class="cm">     Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">     Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> +5V ---|</span>
</span><span class='line'><span class="cm">              /    </span>
</span><span class='line'><span class="cm">  A0 ----\  potentiometer </span>
</span><span class='line'><span class="cm">              /    </span>
</span><span class='line'><span class="cm"> GND ---|</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">char</span> <span class="n">INPUT_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// set the input for the knob to analog pin 0</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// to convey the volume level from updateControl() to updateAudio()</span>
</span><span class='line'><span class="n">byte</span> <span class="n">volume</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values // set up the Serial output so we can look at the input values</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the variable resistor for volume</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">sensor_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">INPUT_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// map it to an 8 bit range for efficient calculations in updateAudio</span>
</span><span class='line'>  <span class="n">volume</span> <span class="o">=</span> <span class="n">map</span><span class="p">(</span><span class="n">sensor_value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1023</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;volume = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">volume</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">volume</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// shift back into range after multiplying by 8 bit value</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Volume_Knob_LightLevel_Frequency <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Volume_Knob_LightLevel_Frequency/Volume_Knob_LightLevel_Frequency.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/03.Sensors/Volume_Knob_LightLevel_Frequency/Volume_Knob_LightLevel_Frequency.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Volume_Knob_LightLevel_Frequencyexpand' onclick='javascript:toggleDisplay(Volume_Knob_LightLevel_Frequency, Volume_Knob_LightLevel_Frequencyexpand, Volume_Knob_LightLevel_Frequencycollapse)'>show sketch</button>
<button id='Volume_Knob_LightLevel_Frequencycollapse' style='display:none' onclick='javascript:toggleDisplay(Volume_Knob_LightLevel_Frequency, Volume_Knob_LightLevel_Frequencyexpand, Volume_Knob_LightLevel_Frequencycollapse)'>hide sketch</button></p>

<div id='Volume_Knob_LightLevel_Frequency' style='display:none'>
<figure class='code'><figcaption><span> (Volume_Knob_LightLevel_Frequency.ino)</span> <a href='/Mozzi/downloads/code/examples/03.Sensors/Volume_Knob_LightLevel_Frequency/Volume_Knob_LightLevel_Frequency.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  </span>
</span><span class='line'><span class="cm">  Example using a potentiometer to change the amplitude of a sinewave</span>
</span><span class='line'><span class="cm">  and a light dependent resister (LDR) to change the frequency.</span>
</span><span class='line'><span class="cm">  with Mozzi sonification library.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Demonstrates the use of Oscil to play a wavetable, and analog input for control.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  This example goes with a tutorial on the Mozzi site:</span>
</span><span class='line'><span class="cm">  http://sensorium.github.io/Mozzi/learn/introductory-tutorial/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  The circuit:</span>
</span><span class='line'><span class="cm">     Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Potentiometer connected to analog pin 0:</span>
</span><span class='line'><span class="cm">     Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">     Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> +5V ---|</span>
</span><span class='line'><span class="cm">              /    </span>
</span><span class='line'><span class="cm">  A0 ----\  potentiometer </span>
</span><span class='line'><span class="cm">              /    </span>
</span><span class='line'><span class="cm"> GND ---|</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  Light dependent resistor (LDR) and 5.1k resistor on analog pin 1:</span>
</span><span class='line'><span class="cm">    LDR from analog pin to +5V (3.3V on Teensy 3.1)</span>
</span><span class='line'><span class="cm">    5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">char</span> <span class="n">KNOB_PIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// set the input for the knob to analog pin 0</span>
</span><span class='line'><span class="k">const</span> <span class="kt">char</span> <span class="n">LDR_PIN</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// set the input for the LDR to analog pin 1</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">byte</span> <span class="n">volume</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span> <span class="c1">// set up the Serial output so we can look at the piezo values // set up the Serial output so we can look at the analog levels</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// :))</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the potentiometer</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">knob_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// map it to an 8 bit volume range for efficient calculations in updateAudio</span>
</span><span class='line'>  <span class="n">volume</span> <span class="o">=</span> <span class="n">knob_value</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span>  <span class="c1">// 10 bits (0-&gt;1023) shifted right by 2 bits to give 8 bits (0-&gt;255)</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;volume = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">volume</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// prints a tab</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// read the light dependent resistor</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">light_level</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">LDR_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// print the value to the Serial monitor for debugging</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;light level = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">light_level</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// prints a tab</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set the frequency</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">light_level</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span> <span class="c1">// next line</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// cast char output from aSin.next() to int to make room for multiplication</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">volume</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span> <span class="c1">// shift back into range after multiplying by 8 bit value</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='04.Audio_Input'>
04.Audio_Input</a></h2>


<hr />

<p>Audio_Input <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='Audio_Inputexpand' onclick='javascript:toggleDisplay(Audio_Input, Audio_Inputexpand, Audio_Inputcollapse)'>show sketch</button>
<button id='Audio_Inputcollapse' style='display:none' onclick='javascript:toggleDisplay(Audio_Input, Audio_Inputexpand, Audio_Inputcollapse)'>hide sketch</button></p>

<div id='Audio_Input' style='display:none'>
<figure class='code'><figcaption><span> (Audio_Input.ino)</span> <a href='/Mozzi/downloads/code/examples/04.Audio_Input/Audio_Input/Audio_Input.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Test of audio input using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> An audio input using the range between 0 to 5V on analog pin A0</span>
</span><span class='line'><span class="cm"> is sampled and output on digital pin 9.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  Configuration: requires these lines in the Mozzi/mozzi_config.h file:</span>
</span><span class='line'><span class="cm">  #define USE_AUDIO_INPUT true</span>
</span><span class='line'><span class="cm">  #define AUDIO_INPUT_PIN 0</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Circuit: </span>
</span><span class='line'><span class="cm"> Audio cable centre wire on pin A0, outer shielding to Arduino Ground.</span>
</span><span class='line'><span class="cm"> Audio output on DAC/A14 on Teensy 3.0, 3.1, or digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm"> check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">getAudioInput</span><span class="p">();</span> <span class="c1">// range 0-1023</span>
</span><span class='line'>  <span class="n">asig</span> <span class="o">=</span> <span class="n">asig</span> <span class="o">-</span> <span class="mi">512</span><span class="p">;</span> <span class="c1">// now range is -512 to 511</span>
</span><span class='line'>  <span class="c1">// output range in STANDARD mode is -244 to 243, </span>
</span><span class='line'>  <span class="c1">// so you might need to adjust your signal to suit</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Audio_Input_with_Knob_Filter <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/04.Audio_Input/Audio_Input_with_Knob_Filter/Audio_Input_with_Knob_Filter.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/04.Audio_Input/Audio_Input_with_Knob_Filter/Audio_Input_with_Knob_Filter.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Audio_Input_with_Knob_Filterexpand' onclick='javascript:toggleDisplay(Audio_Input_with_Knob_Filter, Audio_Input_with_Knob_Filterexpand, Audio_Input_with_Knob_Filtercollapse)'>show sketch</button>
<button id='Audio_Input_with_Knob_Filtercollapse' style='display:none' onclick='javascript:toggleDisplay(Audio_Input_with_Knob_Filter, Audio_Input_with_Knob_Filterexpand, Audio_Input_with_Knob_Filtercollapse)'>hide sketch</button></p>

<div id='Audio_Input_with_Knob_Filter' style='display:none'>
<figure class='code'><figcaption><span> (Audio_Input_with_Knob_Filter.ino)</span> <a href='/Mozzi/downloads/code/examples/04.Audio_Input/Audio_Input_with_Knob_Filter/Audio_Input_with_Knob_Filter.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  </span>
</span><span class='line'><span class="cm">  Test of audio input and processing with control input,</span>
</span><span class='line'><span class="cm">  using Mozzi sonification library.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Configuration: requires these lines in the Mozzi/mozzi_config.h file:</span>
</span><span class='line'><span class="cm">  #define USE_AUDIO_INPUT true</span>
</span><span class='line'><span class="cm">  #define AUDIO_INPUT_PIN 0</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Circuit: </span>
</span><span class='line'><span class="cm">    Audio input on pin analog 0</span>
</span><span class='line'><span class="cm">    Output on DAC/A14 on Teensy 3.0, 3.1, or digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'>
</span><span class='line'><span class="cm">     Potentiometer connected to analog pin A1.</span>
</span><span class='line'><span class="cm">     Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">     Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;LowPassFilter.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define KNOB_PIN 1</span>
</span><span class='line'>
</span><span class='line'><span class="n">LowPassFilter</span> <span class="n">lpf</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">lpf</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">220</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">knob</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">KNOB_PIN</span><span class="p">);</span>
</span><span class='line'>  <span class="n">byte</span> <span class="n">cutoff_freq</span> <span class="o">=</span> <span class="n">knob</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">;</span> <span class="c1">// range 0-255</span>
</span><span class='line'>  <span class="n">lpf</span><span class="p">.</span><span class="n">setCutoffFreq</span><span class="p">(</span><span class="n">cutoff_freq</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// subtracting 512 moves the unsigned audio data into 0-centred, </span>
</span><span class='line'>  <span class="c1">// signed range required by all Mozzi units</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">getAudioInput</span><span class="p">()</span><span class="o">-</span><span class="mi">512</span><span class="p">;</span>
</span><span class='line'>  <span class="n">asig</span> <span class="o">=</span> <span class="n">lpf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Audio_and_Control_Input <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='Audio_and_Control_Inputexpand' onclick='javascript:toggleDisplay(Audio_and_Control_Input, Audio_and_Control_Inputexpand, Audio_and_Control_Inputcollapse)'>show sketch</button>
<button id='Audio_and_Control_Inputcollapse' style='display:none' onclick='javascript:toggleDisplay(Audio_and_Control_Input, Audio_and_Control_Inputexpand, Audio_and_Control_Inputcollapse)'>hide sketch</button></p>

<div id='Audio_and_Control_Input' style='display:none'>
<figure class='code'><figcaption><span> (Audio_and_Control_Input.ino)</span> <a href='/Mozzi/downloads/code/examples/04.Audio_Input/Audio_and_Control_Input/Audio_and_Control_Input.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Test of audio and control rate analog input using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  An audio input using the range between 0 to 5V on analog pin A0</span>
</span><span class='line'><span class="cm">  is sampled and output on digital pin 9.  </span>
</span><span class='line'><span class="cm">  All the other analog channels are sampled at control rate and printed to Serial.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Demonstrates mozziAnalogRead(pin), which reads analog inputs in the background,</span>
</span><span class='line'><span class="cm">  and getAudioInput(), which samples audio on AUDIO_INPUT_PIN, configured in mozzi_config.h.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Configuration: requires these lines in the Mozzi/mozzi_config.h file:</span>
</span><span class='line'><span class="cm">  #define USE_AUDIO_INPUT true</span>
</span><span class='line'><span class="cm">  #define AUDIO_INPUT_PIN 0</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  Circuit: </span>
</span><span class='line'><span class="cm">  Audio cable centre wire on pin A0, outer shielding to Arduino Ground.</span>
</span><span class='line'><span class="cm">  Audio output on DAC/A14 on Teensy 3.0, 3.1, or digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  Analog sensor inputs on any other analog input pins.</span>
</span><span class='line'><span class="cm">  The serial printing might cause glitches, so try commenting </span>
</span><span class='line'><span class="cm">  them out to test if this is a problem.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;num_analog_inputs = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">NUM_ANALOG_INPUTS</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_ANALOG_INPUTS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// analog 0 is configured for audio</span>
</span><span class='line'>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">i</span><span class="p">));</span> <span class="c1">// mozziAnalogRead is better than mozziAnalogRead</span>
</span><span class='line'>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="c1">// tab</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">getAudioInput</span><span class="p">();</span> <span class="c1">// range 0-1023</span>
</span><span class='line'>  <span class="n">asig</span> <span class="o">=</span> <span class="n">asig</span> <span class="o">-</span> <span class="mi">512</span><span class="p">;</span> <span class="c1">// now range is -512 to 511</span>
</span><span class='line'>  <span class="n">asig</span> <span class="o">&gt;&gt;=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// now it&#39;s -128 to 127, within audio output range</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='05.Control_Filters'>
05.Control_Filters</a></h2>


<hr />

<p>DCfilter <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='DCfilterexpand' onclick='javascript:toggleDisplay(DCfilter, DCfilterexpand, DCfiltercollapse)'>show sketch</button>
<button id='DCfiltercollapse' style='display:none' onclick='javascript:toggleDisplay(DCfilter, DCfilterexpand, DCfiltercollapse)'>hide sketch</button></p>

<div id='DCfilter' style='display:none'>
<figure class='code'><figcaption><span> (DCfilter.ino)</span> <a href='/Mozzi/downloads/code/examples/05.Control_Filters/DCfilter/DCfilter.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/* Example of filtering an analog input to remove DC bias,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Demonstrates DCfilter(), DC-blocking filter useful for </span>
</span><span class='line'><span class="cm">    highlighting changes in control signals.</span>
</span><span class='line'><span class="cm">    The output of the filter settles to 0 if the incoming signal stays constant.</span>
</span><span class='line'><span class="cm">    If the input changes, the filter output swings to track the change and </span>
</span><span class='line'><span class="cm">    eventually settles back to 0.</span>
</span><span class='line'><span class="cm">     </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">     </span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;DCfilter.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">sensorPin</span> <span class="o">=</span> <span class="n">A0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">DCfilter</span> <span class="n">dcFiltered</span><span class="p">(</span><span class="mf">0.9</span><span class="p">);</span> <span class="c1">// parameter sets how long the filter takes to settle</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// read the value from the sensor:</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">sensorValue</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">sensorPin</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">sensorValue</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;  Filtered = &quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">dcFiltered</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">sensorValue</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Line_vs_Smooth <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Line_vs_Smooth/Line_vs_Smooth.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Line_vs_Smooth/Line_vs_Smooth.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Line_vs_Smoothexpand' onclick='javascript:toggleDisplay(Line_vs_Smooth, Line_vs_Smoothexpand, Line_vs_Smoothcollapse)'>show sketch</button>
<button id='Line_vs_Smoothcollapse' style='display:none' onclick='javascript:toggleDisplay(Line_vs_Smooth, Line_vs_Smoothexpand, Line_vs_Smoothcollapse)'>hide sketch</button></p>

<div id='Line_vs_Smooth' style='display:none'>
<figure class='code'><figcaption><span> (Line_vs_Smooth.ino)</span> <a href='/Mozzi/downloads/code/examples/05.Control_Filters/Line_vs_Smooth/Line_vs_Smooth.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of 2 different ways to smooth analog inputs,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.  The inputs are used </span>
</span><span class='line'><span class="cm">    to control the frequencies of two oscillators.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates how to read analog inputs asynchronously, so values are</span>
</span><span class='line'><span class="cm">    updated in the background while audio generation continues,</span>
</span><span class='line'><span class="cm">    and the most recent readings can be read anytime from an array.</span>
</span><span class='line'><span class="cm">    Also demonstrates linear interpolation with Line(),</span>
</span><span class='line'><span class="cm">    filtering with Smooth(), and fixed point numbers.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 </span>
</span><span class='line'><span class="cm">    (for standard output on a Uno or similar), or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">    Your choice of analog sesnsors, or</span>
</span><span class='line'><span class="cm">    2 10k Potentiometers with wipers (middle terminals) </span>
</span><span class='line'><span class="cm">    connected to analog pins 0, 1 and 2, and</span>
</span><span class='line'><span class="cm">    outside leads to ground and +5V.  </span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Line.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// 2 oscillators to compare linear interpolated vs smoothed control</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin0</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin1</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// Line to interpolate frequency for aSin0.</span>
</span><span class='line'><span class="c1">// Q16n16 is basically (yourNumber &lt;&lt; 16)</span>
</span><span class='line'><span class="c1">// Line needs the small analog input integer values of 0-1023 </span>
</span><span class='line'><span class="c1">// to be scaled up if the time (the number of steps) is big </span>
</span><span class='line'><span class="c1">// enough that distance/time gives a step-size of 0.  </span>
</span><span class='line'><span class="c1">// Then you need floats (which are sometimes too slow and create glitches), </span>
</span><span class='line'><span class="c1">// or fixed point.  Q16n16: ugly but good.</span>
</span><span class='line'><span class="n">Line</span> <span class="o">&lt;</span><span class="n">Q16n16</span><span class="o">&gt;</span> <span class="n">aInterpolate</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// the number of audio steps the line has to take to reach the next control value</span>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">AUDIO_STEPS_PER_CONTROL</span> <span class="o">=</span> <span class="n">AUDIO_RATE</span> <span class="o">/</span> <span class="n">CONTROL_RATE</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Smoothing unit for aSin1</span>
</span><span class='line'><span class="c1">// This might be better with Q24n8 numbers for more precision, </span>
</span><span class='line'><span class="c1">// but we&#39;ll keep it simpler for the demo.</span>
</span><span class='line'><span class="kt">float</span> <span class="n">smoothness</span> <span class="o">=</span> <span class="mf">0.995f</span><span class="p">;</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">aSmooth</span><span class="p">(</span><span class="n">smoothness</span><span class="p">);</span> <span class="c1">// to smooth frequency for aSin1</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aSin0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">660.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">220.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">freq1</span><span class="p">;</span>  <span class="c1">// global so it can be used in updateAudio, volatile to stop it getting changed while being used</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Q16n16</span> <span class="n">freq0</span> <span class="o">=</span> <span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span> <span class="c1">// 0 to 1023, scaled up to Q16n16 format</span>
</span><span class='line'>  <span class="n">freq1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 0 to 1023</span>
</span><span class='line'>   <span class="n">aInterpolate</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">freq0</span><span class="p">,</span> <span class="n">AUDIO_STEPS_PER_CONTROL</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Q16n16</span> <span class="n">interpolatedFreq</span> <span class="o">=</span> <span class="n">aInterpolate</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// get the next linear interpolated freq</span>
</span><span class='line'>  <span class="n">aSin0</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">interpolatedFreq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">smoothedFreq</span> <span class="o">=</span> <span class="n">aSmooth</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">freq1</span><span class="p">);</span> <span class="c1">// get the next filtered frequency</span>
</span><span class='line'>  <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">smoothedFreq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">aSin0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aSin1</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// &gt;&gt;1 is like /2 but faster (the compiler doesn&#39;t seem to optimise it automatically)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>MIDI_portamento <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/MIDI_portamento/MIDI_portamento.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/MIDI_portamento/MIDI_portamento.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='MIDI_portamentoexpand' onclick='javascript:toggleDisplay(MIDI_portamento, MIDI_portamentoexpand, MIDI_portamentocollapse)'>show sketch</button>
<button id='MIDI_portamentocollapse' style='display:none' onclick='javascript:toggleDisplay(MIDI_portamento, MIDI_portamentoexpand, MIDI_portamentocollapse)'>hide sketch</button></p>

<div id='MIDI_portamento' style='display:none'>
<figure class='code'><figcaption><span> (MIDI_portamento.ino)</span> <a href='/Mozzi/downloads/code/examples/05.Control_Filters/MIDI_portamento/MIDI_portamento.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a sound being triggered by MIDI input, with portamento.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates playing notes with Mozzi in response to MIDI input.</span>
</span><span class='line'><span class="cm">    Also demonstrates Portamento(), a traditional portamento with a </span>
</span><span class='line'><span class="cm">    duration which can be set.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Uses Arduino MIDI library v4.2 </span>
</span><span class='line'><span class="cm">    (https://github.com/FortySevenEffects/arduino_midi_library/releases/tag/4.2)</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Circuit: </span>
</span><span class='line'><span class="cm">      MIDI input circuit as per http://arduino.cc/en/Tutorial/Midi</span>
</span><span class='line'><span class="cm">      (midi has to be disconnected from rx for sketch to upload)</span>
</span><span class='line'><span class="cm">      Audio output on digital pin 9 on a Uno or similar.</span>
</span><span class='line'><span class="cm">      </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MIDI.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;Line.h&gt; </span><span class="c1">// for envelope</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;ADSR.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Portamento.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">MIDI_CREATE_DEFAULT_INSTANCE</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use #define for CONTROL_RATE, not a constant</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio sinewave oscillator</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// envelope generator</span>
</span><span class='line'><span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">envelope</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Portamento</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="o">&gt;</span><span class="n">aPortamento</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define LED 13</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">HandleNoteOn</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">note</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">aPortamento</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">note</span><span class="p">);</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>
</span><span class='line'>  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span><span class="n">HIGH</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">HandleNoteOff</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">note</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">noteOff</span><span class="p">();</span>
</span><span class='line'>  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Initiate MIDI communications, listen to all channels</span>
</span><span class='line'>  <span class="n">MIDI</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">MIDI_CHANNEL_OMNI</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Connect the HandleNoteOn function to the library, so it is called upon reception of a NoteOn.</span>
</span><span class='line'>  <span class="n">MIDI</span><span class="p">.</span><span class="n">setHandleNoteOn</span><span class="p">(</span><span class="n">HandleNoteOn</span><span class="p">);</span>  <span class="c1">// Put only the name of the function</span>
</span><span class='line'>  <span class="n">MIDI</span><span class="p">.</span><span class="n">setHandleNoteOff</span><span class="p">(</span><span class="n">HandleNoteOff</span><span class="p">);</span>  <span class="c1">// Put only the name of the function</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">64</span><span class="p">);</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">300</span><span class="p">);</span> <span class="c1">// 10000 is so the note will sustain 10 seconds unless a noteOff comes</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">aPortamento</span><span class="p">.</span><span class="n">setTime</span><span class="p">(</span><span class="mi">300u</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">MIDI</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">aPortamento</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">envelope</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>RollingAverage <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/RollingAverage/RollingAverage.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/RollingAverage/RollingAverage.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='RollingAverageexpand' onclick='javascript:toggleDisplay(RollingAverage, RollingAverageexpand, RollingAveragecollapse)'>show sketch</button>
<button id='RollingAveragecollapse' style='display:none' onclick='javascript:toggleDisplay(RollingAverage, RollingAverageexpand, RollingAveragecollapse)'>hide sketch</button></p>

<div id='RollingAverage' style='display:none'>
<figure class='code'><figcaption><span> (RollingAverage.ino)</span> <a href='/Mozzi/downloads/code/examples/05.Control_Filters/RollingAverage/RollingAverage.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example changing the frequency of 2 sinewaves with 1 analog input,</span>
</span><span class='line'><span class="cm">    using RollingAverage() to filter one of the control signals </span>
</span><span class='line'><span class="cm">    and the other one unfiltered,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates the difference between a raw control</span>
</span><span class='line'><span class="cm">    signal and one smoothed with RollingAverage().</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;RollingAverage.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define INPUT_PIN 0 </span><span class="c1">// analog control input</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// oscils to compare bumpy to averaged control input</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin0</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin1</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: RollingAverage &lt;number_type, how_many_to_average&gt; myThing</span>
</span><span class='line'><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverage</span><span class="p">;</span> <span class="c1">// how_many_to_average has to be power of 2</span>
</span><span class='line'><span class="kt">int</span> <span class="n">averaged</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">bumpy_input</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">INPUT_PIN</span><span class="p">);</span>
</span><span class='line'>  <span class="n">averaged</span> <span class="o">=</span> <span class="n">kAverage</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">bumpy_input</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;bumpy </span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">bumpy_input</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s"> averaged </span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">averaged</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">aSin0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">bumpy_input</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">averaged</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">aSin0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span><span class="n">aSin1</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Smooth <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Smooth/Smooth.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Smooth/Smooth.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Smoothexpand' onclick='javascript:toggleDisplay(Smooth, Smoothexpand, Smoothcollapse)'>show sketch</button>
<button id='Smoothcollapse' style='display:none' onclick='javascript:toggleDisplay(Smooth, Smoothexpand, Smoothcollapse)'>hide sketch</button></p>

<div id='Smooth' style='display:none'>
<figure class='code'><figcaption><span> (Smooth.ino)</span> <a href='/Mozzi/downloads/code/examples/05.Control_Filters/Smooth/Smooth.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a sound changing volume with and without</span>
</span><span class='line'><span class="cm">    smoothing of the control signal to remove obvious clicks,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates using Smooth to filter a control signal at audio rate,</span>
</span><span class='line'><span class="cm">    EventDelay to schedule changes and rand() to choose random volumes.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    your board check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling audio gain changes</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">kGainChangeDelay</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gainChangeMsec</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//  for scheduling turning smoothing on and off</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">kSmoothOnOff</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">smoothOnOffMsec</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">float</span> <span class="n">smoothness</span> <span class="o">=</span> <span class="mf">0.9975f</span><span class="p">;</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">aSmoothGain</span><span class="p">(</span><span class="n">smoothness</span><span class="p">);</span>
</span><span class='line'><span class="n">boolean</span> <span class="n">smoothIsOn</span><span class="o">=</span><span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="kt">long</span> <span class="n">target_gain</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">330</span><span class="p">);</span> <span class="c1">// set the frequency</span>
</span><span class='line'>  <span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">gainChangeMsec</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kSmoothOnOff</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">smoothOnOffMsec</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// switch smoothing on and off to show the difference</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kSmoothOnOff</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">smoothIsOn</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">aSmoothGain</span><span class="p">.</span><span class="n">setSmoothness</span><span class="p">(</span><span class="mf">0.f</span><span class="p">);</span>
</span><span class='line'>      <span class="n">smoothIsOn</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="n">aSmoothGain</span><span class="p">.</span><span class="n">setSmoothness</span><span class="p">(</span><span class="n">smoothness</span><span class="p">);</span>
</span><span class='line'>      <span class="n">smoothIsOn</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">kSmoothOnOff</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// random volume changes</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="n">target_gain</span> <span class="o">=</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span> <span class="mi">255</span><span class="p">);</span>
</span><span class='line'>    <span class="n">kGainChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="n">aSmoothGain</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target_gain</span><span class="p">)</span> <span class="o">*</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span> <span class="c1">// shift back to char precision after multiply</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Smooth_Frequency <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Smooth_Frequency/Smooth_Frequency.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Smooth_Frequency/Smooth_Frequency.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Smooth_Frequencyexpand' onclick='javascript:toggleDisplay(Smooth_Frequency, Smooth_Frequencyexpand, Smooth_Frequencycollapse)'>show sketch</button>
<button id='Smooth_Frequencycollapse' style='display:none' onclick='javascript:toggleDisplay(Smooth_Frequency, Smooth_Frequencyexpand, Smooth_Frequencycollapse)'>hide sketch</button></p>

<div id='Smooth_Frequency' style='display:none'>
<figure class='code'><figcaption><span> (Smooth_Frequency.ino)</span> <a href='/Mozzi/downloads/code/examples/05.Control_Filters/Smooth_Frequency/Smooth_Frequency.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example sliding between frequencies,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates using Smooth to filter a control signal.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// this is a high value to avoid zipper noise</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 1024 </span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling freq changes</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">kFreqChangeDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothFreq</span><span class="p">(</span><span class="mf">0.975f</span><span class="p">);</span>
</span><span class='line'><span class="kt">int</span> <span class="n">target_freq</span><span class="p">,</span> <span class="n">target_freq1</span><span class="p">,</span> <span class="n">target_freq2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">target_freq1</span> <span class="o">=</span> <span class="mi">441</span><span class="p">;</span>
</span><span class='line'>  <span class="n">target_freq2</span> <span class="o">=</span> <span class="mi">330</span><span class="p">;</span>
</span><span class='line'>  <span class="n">kFreqChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// 1000ms countdown, within resolution of CONTROL_RATE</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kFreqChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">target_freq</span> <span class="o">==</span> <span class="n">target_freq1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">target_freq</span> <span class="o">=</span> <span class="n">target_freq2</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="n">target_freq</span> <span class="o">=</span> <span class="n">target_freq1</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">kFreqChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">smoothed_freq</span> <span class="o">=</span> <span class="n">kSmoothFreq</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target_freq</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">smoothed_freq</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Thermistor_OverSample <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Thermistor_OverSample/Thermistor_OverSample.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/05.Control_Filters/Thermistor_OverSample/Thermistor_OverSample.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Thermistor_OverSampleexpand' onclick='javascript:toggleDisplay(Thermistor_OverSample, Thermistor_OverSampleexpand, Thermistor_OverSamplecollapse)'>show sketch</button>
<button id='Thermistor_OverSamplecollapse' style='display:none' onclick='javascript:toggleDisplay(Thermistor_OverSample, Thermistor_OverSampleexpand, Thermistor_OverSamplecollapse)'>hide sketch</button></p>

<div id='Thermistor_OverSample' style='display:none'>
<figure class='code'><figcaption><span> (Thermistor_OverSample.ino)</span> <a href='/Mozzi/downloads/code/examples/05.Control_Filters/Thermistor_OverSample/Thermistor_OverSample.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*    </span>
</span><span class='line'><span class="cm">  Example of oversampling analog input from a thermistor</span>
</span><span class='line'><span class="cm">  for increased resolution.  It&#39;s a basic attempt at a biofeedback</span>
</span><span class='line'><span class="cm">  device used as an ineffective treatment for migraines.  The idea</span>
</span><span class='line'><span class="cm">  is that if you can focus on making your hands warm, increased blood</span>
</span><span class='line'><span class="cm">  flow to the extremities is associated with a reduced stress response.</span>
</span><span class='line'><span class="cm">  Anyway, the bleeps sweep up if the temperature increases, down for decrease,</span>
</span><span class='line'><span class="cm">  and level for no change.  The tremelo rate increases with the temperature.</span>
</span><span class='line'><span class="cm">  Using Mozzi sonification library.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Demonstrates OverSample object.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  The circuit:</span>
</span><span class='line'><span class="cm">     Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Temperature dependent resistor (Thermistor) and 5.1k resistor on analog pin 1:</span>
</span><span class='line'><span class="cm">    Thermistor from analog pin to +5V (3.3V on Teensy 3.1)</span>
</span><span class='line'><span class="cm">    5.1k resistor from analog pin to ground</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'>
</span><span class='line'><span class="cm">  Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;Line.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// SINe table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;OverSample.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;ControlDelay.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">//#define CONTROL_RATE 256 </span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTremelo</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aEnvelope</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">Line</span> <span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">freqLine</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">OverSample</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="mi">3</span><span class="o">&gt;</span> <span class="n">overSampler</span><span class="p">;</span> <span class="c1">// will give 10+3=13 bits resolution, 0-&gt;8191, using 128 bytes</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="n">byte</span> <span class="n">INPUT_PIN</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">float</span> <span class="n">ENVELOPE_DURATION</span> <span class="o">=</span> <span class="mf">1.f</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="n">byte</span> <span class="n">LINE_LENGTH</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte</span><span class="p">)((</span><span class="kt">float</span><span class="p">)</span><span class="n">CONTROL_RATE</span><span class="o">*</span><span class="n">ENVELOPE_DURATION</span><span class="o">*</span><span class="mf">0.5</span><span class="p">);</span> <span class="c1">// 0.5 seconds per line</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// adjustments to get tremelo in useful range from oversampled temperature input</span>
</span><span class='line'><span class="k">const</span> <span class="kt">int</span> <span class="n">TREMOLO_OFFSET</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="kt">float</span> <span class="n">TREMOLO_SCALE</span> <span class="o">=</span> <span class="mf">0.002</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="n">INPUT_PIN</span><span class="p">,</span><span class="n">INPUT</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aEnvelope</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">ENVELOPE_DURATION</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">float</span> <span class="n">start_freq</span><span class="p">,</span> <span class="n">end_freq</span><span class="p">;</span>
</span><span class='line'>  <span class="k">static</span> <span class="kt">int</span> <span class="n">counter</span><span class="p">,</span> <span class="n">old_oversampled</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// read the variable resistor</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">sensor_value</span> <span class="o">=</span> <span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">INPUT_PIN</span><span class="p">);</span> <span class="c1">// value is 0-1023</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// get the next oversampled sensor value</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">oversampled</span> <span class="o">=</span> <span class="n">overSampler</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">sensor_value</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// modulate the amplitude of the sound in proportion to the magnitude of the oversampled sensor</span>
</span><span class='line'>  <span class="kt">float</span> <span class="n">tremeloRate</span> <span class="o">=</span> <span class="n">TREMOLO_SCALE</span><span class="o">*</span><span class="p">(</span><span class="n">oversampled</span><span class="o">-</span><span class="n">TREMOLO_OFFSET</span><span class="p">);</span>
</span><span class='line'>  <span class="n">tremeloRate</span> <span class="o">=</span> <span class="n">tremeloRate</span><span class="o">*</span><span class="n">tremeloRate</span><span class="o">*</span><span class="n">tremeloRate</span><span class="o">*</span><span class="n">tremeloRate</span><span class="o">*</span><span class="n">tremeloRate</span><span class="p">;</span>
</span><span class='line'>  <span class="n">aTremelo</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">tremeloRate</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// every half second</span>
</span><span class='line'>   <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">counter</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">oversampled</span><span class="o">&gt;</span><span class="n">old_oversampled</span><span class="p">){</span> <span class="c1">// high tweet up if temp rose</span>
</span><span class='line'>      <span class="n">start_freq</span> <span class="o">=</span> <span class="mf">550.f</span><span class="p">;</span>
</span><span class='line'>      <span class="n">end_freq</span> <span class="o">=</span> <span class="mf">660.f</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">oversampled</span><span class="o">&lt;</span><span class="n">old_oversampled</span><span class="p">){</span> <span class="c1">// low tweet down if temp fell</span>
</span><span class='line'>      <span class="n">start_freq</span> <span class="o">=</span> <span class="mf">330.f</span><span class="p">;</span>
</span><span class='line'>      <span class="n">end_freq</span> <span class="o">=</span> <span class="mf">220.f</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// flat beep if no change</span>
</span><span class='line'>      <span class="n">start_freq</span> <span class="o">=</span> <span class="mf">440.f</span><span class="p">;</span>
</span><span class='line'>      <span class="n">end_freq</span> <span class="o">=</span> <span class="mf">440.f</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">old_oversampled</span> <span class="o">=</span> <span class="n">oversampled</span><span class="p">;</span>
</span><span class='line'>    <span class="n">counter</span> <span class="o">=</span> <span class="n">LINE_LENGTH</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// reset counter</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// set the line to change the main frequency</span>
</span><span class='line'>    <span class="n">freqLine</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">start_freq</span><span class="p">,</span><span class="n">end_freq</span><span class="p">,</span><span class="n">LINE_LENGTH</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// print out for debugging</span>
</span><span class='line'>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">oversampled</span><span class="p">);</span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">start_freq</span><span class="p">);</span><span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span><span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">end_freq</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// update the main frequency of the sound</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freqLine</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">((((</span><span class="kt">int</span><span class="p">)</span><span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mi">128</span><span class="o">+</span><span class="n">aTremelo</span><span class="p">.</span><span class="n">next</span><span class="p">()))</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span><span class="o">*</span><span class="n">aEnvelope</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='06.Synthesis'>
06.Synthesis</a></h2>


<hr />

<p>AMsynth <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/AMsynth/AMsynth.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/AMsynth/AMsynth.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='AMsynthexpand' onclick='javascript:toggleDisplay(AMsynth, AMsynthexpand, AMsynthcollapse)'>show sketch</button>
<button id='AMsynthcollapse' style='display:none' onclick='javascript:toggleDisplay(AMsynth, AMsynthexpand, AMsynthcollapse)'>hide sketch</button></p>

<div id='AMsynth' style='display:none'>
<figure class='code'><figcaption><span> (AMsynth.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/AMsynth/AMsynth.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of Amplitude Modulation synthesis</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates modulating the gain of one oscillator</span>
</span><span class='line'><span class="cm">    by the instantaneous amplitude of another,</span>
</span><span class='line'><span class="cm">    shows the use of fixed-point numbers to express fractional</span>
</span><span class='line'><span class="cm">    values, random numbers with rand(), and EventDelay()</span>
</span><span class='line'><span class="cm">    for scheduling.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// table for Oscils to play</span>
</span><span class='line'><span class="c1">//#include &lt;mozzi_utils.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio oscils</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModDepth</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling note changes in updateControl()</span>
</span><span class='line'><span class="n">EventDelay</span>  <span class="n">kNoteChangeDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// synthesis parameters in fixed point formats</span>
</span><span class='line'><span class="n">Q8n8</span> <span class="n">ratio</span><span class="p">;</span> <span class="c1">// unsigned int with 8 integer bits and 8 fractional bits</span>
</span><span class='line'><span class="n">Q24n8</span> <span class="n">carrier_freq</span><span class="p">;</span> <span class="c1">// unsigned long with 24 integer bits and 8 fractional bits</span>
</span><span class='line'><span class="n">Q24n8</span> <span class="n">mod_freq</span><span class="p">;</span> <span class="c1">// unsigned long with 24 integer bits and 8 fractional bits</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for random notes</span>
</span><span class='line'><span class="n">Q8n0</span> <span class="n">octave_start_note</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">ratio</span> <span class="o">=</span> <span class="n">float_to_Q8n8</span><span class="p">(</span><span class="mf">3.0f</span><span class="p">);</span>   <span class="c1">// define modulation ratio in float and convert to fixed-point</span>
</span><span class='line'>  <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span> <span class="c1">// note duration ms, within resolution of CONTROL_RATE</span>
</span><span class='line'>  <span class="n">aModDepth</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">13.f</span><span class="p">);</span>     <span class="c1">// vary mod depth to highlight am effects</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// reseed the random generator for different results each time the sketch runs</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">Q16n16</span> <span class="n">last_note</span> <span class="o">=</span> <span class="n">octave_start_note</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change octave now and then</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">last_note</span> <span class="o">=</span> <span class="mi">36</span><span class="o">+</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change step up or down a semitone occasionally</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">13</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">last_note</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">-</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change modulation ratio now and then</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">ratio</span> <span class="o">=</span> <span class="p">((</span><span class="n">Q8n8</span><span class="p">)</span> <span class="mi">1</span><span class="o">+</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">))</span> <span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// sometimes add a fractionto the ratio</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">ratio</span> <span class="o">+=</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">255</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// step up or down 3 semitones (or 0)</span>
</span><span class='line'>    <span class="n">last_note</span> <span class="o">+=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">3</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// convert midi to frequency</span>
</span><span class='line'>    <span class="n">Q16n16</span> <span class="n">midi_note</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="n">last_note</span><span class="p">);</span>
</span><span class='line'>    <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">Q16n16_to_Q24n8</span><span class="p">(</span><span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// calculate modulation frequency to stay in ratio with carrier</span>
</span><span class='line'>    <span class="n">mod_freq</span> <span class="o">=</span> <span class="p">(</span><span class="n">carrier_freq</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// (Q24n8   Q8n8) &gt;&gt; 8 = Q24n8</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// set frequencies of the oscillators</span>
</span><span class='line'>    <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq_Q24n8</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span>
</span><span class='line'>    <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq_Q24n8</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// reset the note scheduler</span>
</span><span class='line'>    <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">long</span> <span class="n">mod</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128u</span><span class="o">+</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="o">*</span> <span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span> <span class="n">aModDepth</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">mod</span> <span class="o">*</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>AMsynth_HIFI <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/AMsynth_HIFI/AMsynth_HIFI.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/AMsynth_HIFI/AMsynth_HIFI.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='AMsynth_HIFIexpand' onclick='javascript:toggleDisplay(AMsynth_HIFI, AMsynth_HIFIexpand, AMsynth_HIFIcollapse)'>show sketch</button>
<button id='AMsynth_HIFIcollapse' style='display:none' onclick='javascript:toggleDisplay(AMsynth_HIFI, AMsynth_HIFIexpand, AMsynth_HIFIcollapse)'>hide sketch</button></p>

<div id='AMsynth_HIFI' style='display:none'>
<figure class='code'><figcaption><span> (AMsynth_HIFI.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/AMsynth_HIFI/AMsynth_HIFI.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of Amplitude Modulation synthesis</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates modulating the gain of one oscillator</span>
</span><span class='line'><span class="cm">    by the instantaneous amplitude of another,</span>
</span><span class='line'><span class="cm">    shows the use of fixed-point numbers to express fractional</span>
</span><span class='line'><span class="cm">    values, random numbers with rand(), and EventDelay()</span>
</span><span class='line'><span class="cm">    for scheduling.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    This sketch using HIFI mode is not for Teensy 3.1.</span>
</span><span class='line'><span class="cm">        </span>
</span><span class='line'><span class="cm">    IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be</span>
</span><span class='line'><span class="cm">    be changed from STANDARD mode to HIFI.</span>
</span><span class='line'><span class="cm">    In Mozz/mozzi_config.h, change</span>
</span><span class='line'><span class="cm">    #define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm">    to</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm">    #define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),</span>
</span><span class='line'><span class="cm">    Check the Mozzi core module documentation for others and more detail</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">                     3.9k </span>
</span><span class='line'><span class="cm">     pin 9  ---WWWW-----|-----output</span>
</span><span class='line'><span class="cm">                    499k           |</span>
</span><span class='line'><span class="cm">     pin 10 ---WWWW---- |</span>
</span><span class='line'><span class="cm">                                       |</span>
</span><span class='line'><span class="cm">                             4.7n  ==</span>
</span><span class='line'><span class="cm">                                       |</span>
</span><span class='line'><span class="cm">                                   ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Resistors are Â±0.5%  Measure and choose the most precise </span>
</span><span class='line'><span class="cm">    from a batch of whatever you can get.  Use two 1M resistors</span>
</span><span class='line'><span class="cm">    in parallel if you can&#39;t find 499k.</span>
</span><span class='line'><span class="cm">    Alternatively using 39 ohm, 4.99k and 470nF components will </span>
</span><span class='line'><span class="cm">    work directly with headphones.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012-13, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// table for Oscils to play</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio oscils</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModDepth</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling note changes in updateControl()</span>
</span><span class='line'><span class="n">EventDelay</span>  <span class="n">kNoteChangeDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// synthesis parameters in fixed point formats</span>
</span><span class='line'><span class="n">Q8n8</span> <span class="n">ratio</span><span class="p">;</span> <span class="c1">// unsigned int with 8 integer bits and 8 fractional bits</span>
</span><span class='line'><span class="n">Q24n8</span> <span class="n">carrier_freq</span><span class="p">;</span> <span class="c1">// unsigned long with 24 integer bits and 8 fractional bits</span>
</span><span class='line'><span class="n">Q24n8</span> <span class="n">mod_freq</span><span class="p">;</span> <span class="c1">// unsigned long with 24 integer bits and 8 fractional bits</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for random notes</span>
</span><span class='line'><span class="n">Q8n0</span> <span class="n">octave_start_note</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">ratio</span> <span class="o">=</span> <span class="n">float_to_Q8n8</span><span class="p">(</span><span class="mf">3.0f</span><span class="p">);</span>   <span class="c1">// define modulation ratio in float and convert to fixed-point</span>
</span><span class='line'>  <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span> <span class="c1">// note duration ms, within resolution of CONTROL_RATE</span>
</span><span class='line'>  <span class="n">aModDepth</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">13.f</span><span class="p">);</span>     <span class="c1">// vary mod depth to highlight am effects</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// reseed the random generator for different results each time the sketch runs</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// use default CONTROL_RATE 64</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">Q16n16</span> <span class="n">last_note</span> <span class="o">=</span> <span class="n">octave_start_note</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change octave now and then</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">last_note</span> <span class="o">=</span> <span class="mi">36</span><span class="o">+</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change step up or down a semitone occasionally</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">13</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">last_note</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">-</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change modulation ratio now and then</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">ratio</span> <span class="o">=</span> <span class="p">((</span><span class="n">Q8n8</span><span class="p">)</span> <span class="mi">1</span><span class="o">+</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">))</span> <span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// sometimes add a fraction to the ratio</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">ratio</span> <span class="o">+=</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">255</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// step up or down 3 semitones (or 0)</span>
</span><span class='line'>    <span class="n">last_note</span> <span class="o">+=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">3</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// convert midi to frequency</span>
</span><span class='line'>    <span class="n">Q16n16</span> <span class="n">midi_note</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="n">last_note</span><span class="p">);</span>
</span><span class='line'>    <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">Q16n16_to_Q24n8</span><span class="p">(</span><span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// calculate modulation frequency to stay in ratio with carrier</span>
</span><span class='line'>    <span class="n">mod_freq</span> <span class="o">=</span> <span class="p">(</span><span class="n">carrier_freq</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// (Q24n8   Q8n8) &gt;&gt; 8 = Q24n8</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// set frequencies of the oscillators</span>
</span><span class='line'>    <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq_Q24n8</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span>
</span><span class='line'>    <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq_Q24n8</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// reset the note scheduler</span>
</span><span class='line'>    <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mod</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128u</span><span class="o">+</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="o">*</span> <span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span> <span class="n">aModDepth</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">out</span> <span class="o">=</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">mod</span> <span class="o">*</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">10</span><span class="p">;</span> <span class="c1">// 16 bit   8 bit = 24 bit, then &gt;&gt;10 = 14 bit</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Detuned_Beats_Wash <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Detuned_Beats_Wash/Detuned_Beats_Wash.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Detuned_Beats_Wash/Detuned_Beats_Wash.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Detuned_Beats_Washexpand' onclick='javascript:toggleDisplay(Detuned_Beats_Wash, Detuned_Beats_Washexpand, Detuned_Beats_Washcollapse)'>show sketch</button>
<button id='Detuned_Beats_Washcollapse' style='display:none' onclick='javascript:toggleDisplay(Detuned_Beats_Wash, Detuned_Beats_Washexpand, Detuned_Beats_Washcollapse)'>hide sketch</button></p>

<div id='Detuned_Beats_Wash' style='display:none'>
<figure class='code'><figcaption><span> (Detuned_Beats_Wash.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/Detuned_Beats_Wash/Detuned_Beats_Wash.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Plays a fluctuating ambient wash using pairs</span>
</span><span class='line'><span class="cm">    of slightly detuned oscillators, following an example</span>
</span><span class='line'><span class="cm">    from Miller Puckette&#39;s Pure Data manual.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    The detune frequencies are modified by chance in</span>
</span><span class='line'><span class="cm">    updateControl(), and the outputs of 14 audio</span>
</span><span class='line'><span class="cm">    oscillators are summed in updateAudio().</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates the use of fixed-point Q16n16</span>
</span><span class='line'><span class="cm">    format numbers, mtof() for converting midi note</span>
</span><span class='line'><span class="cm">    values to frequency, and xorshift96() for random numbers.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    For this sketch to run smoothly on 16MHz Ateml boards, you need to edit</span>
</span><span class='line'><span class="cm">    platform.txt (on OSX you can find it by searching in /Users/your_name/Library/Arduino15).</span>
</span><span class='line'><span class="cm">    Search and replace -Os with -O2.  Save.  </span>
</span><span class='line'><span class="cm">    This tells the compiler to optimise for speed, instead of size.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos8192_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt; </span><span class="c1">// for Q16n16 fixed-point fractional number type</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// harmonics</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos3</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos4</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos5</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos6</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos7</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// duplicates but slightly off frequency for adding to originals</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos1b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos2b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos3b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos4b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos5b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos6b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCos7b</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// base pitch frequencies in 24n8 fixed int format (for speed later)</span>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">f3</span><span class="p">,</span><span class="n">f4</span><span class="p">,</span><span class="n">f5</span><span class="p">,</span><span class="n">f6</span><span class="p">,</span><span class="n">f7</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">variation</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// 32 random bits &amp; with 524287 (b111 1111 1111 1111 1111)</span>
</span><span class='line'>  <span class="c1">// gives between 0-8 in Q16n16 format</span>
</span><span class='line'>  <span class="k">return</span>  <span class="p">(</span><span class="n">Q16n16</span><span class="p">)</span> <span class="p">(</span><span class="n">xorshift96</span><span class="p">()</span> <span class="o">&amp;</span> <span class="mi">524287UL</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="mi">64</span><span class="p">);</span> <span class="c1">// a literal control rate here</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// select base frequencies using mtof (midi to freq) and fixed-point numbers</span>
</span><span class='line'>  <span class="n">f1</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">48</span><span class="p">));</span>
</span><span class='line'>  <span class="n">f2</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">74</span><span class="p">));</span>
</span><span class='line'>  <span class="n">f3</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">64</span><span class="p">));</span>
</span><span class='line'>  <span class="n">f4</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">77</span><span class="p">));</span>
</span><span class='line'>  <span class="n">f5</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">67</span><span class="p">));</span>
</span><span class='line'>  <span class="n">f6</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">57</span><span class="p">));</span>
</span><span class='line'>  <span class="n">f7</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="mi">60</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set Oscils with chosen frequencies</span>
</span><span class='line'>  <span class="n">aCos1</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f1</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos2</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f2</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos3</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f3</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos4</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f4</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos5</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f5</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos6</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f6</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCos7</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f7</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set frequencies of duplicate oscillators</span>
</span><span class='line'>  <span class="n">aCos1b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f1</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>  <span class="n">aCos2b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f2</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>  <span class="n">aCos3b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f3</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>  <span class="n">aCos4b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f4</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>  <span class="n">aCos5b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f5</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>  <span class="n">aCos6b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f6</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>  <span class="n">aCos7b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f7</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// todo: choose a nice scale or progression and make a table for it</span>
</span><span class='line'>  <span class="c1">// or add a very slow gliss for f1-f7, like shephard tones</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// change frequencies of the b oscillators</span>
</span><span class='line'>  <span class="k">switch</span> <span class="p">(</span><span class="n">lowByte</span><span class="p">(</span><span class="n">xorshift96</span><span class="p">())</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">){</span> <span class="c1">// 7 is 0111</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>      <span class="n">aCos1b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f1</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>       <span class="n">aCos2b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f2</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>       <span class="n">aCos3b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f3</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>       <span class="n">aCos4b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f4</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span><span class='line'>       <span class="n">aCos5b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f5</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">5</span><span class="o">:</span>
</span><span class='line'>       <span class="n">aCos6b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f6</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">6</span><span class="o">:</span>
</span><span class='line'>       <span class="n">aCos7b</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">f7</span><span class="o">+</span><span class="n">variation</span><span class="p">());</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">aCos1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos1b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos2b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos3</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos3b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos4</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos4b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos5</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos5b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos6</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos6b</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span>
</span><span class='line'>    <span class="n">aCos7</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">aCos7b</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">asig</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>FMsynth <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/FMsynth/FMsynth.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/FMsynth/FMsynth.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='FMsynthexpand' onclick='javascript:toggleDisplay(FMsynth, FMsynthexpand, FMsynthcollapse)'>show sketch</button>
<button id='FMsynthcollapse' style='display:none' onclick='javascript:toggleDisplay(FMsynth, FMsynthexpand, FMsynthcollapse)'>hide sketch</button></p>

<div id='FMsynth' style='display:none'>
<figure class='code'><figcaption><span> (FMsynth.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/FMsynth/FMsynth.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of simple FM with the phase modulation technique,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates Oscil::phMod() for phase modulation, </span>
</span><span class='line'><span class="cm">    Smooth() for smoothing control signals, </span>
</span><span class='line'><span class="cm">    and Mozzi&#39;s fixed point number types for fractional frequencies.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Also shows the limitations of Mozzi&#39;s 16384Hz Sample rate,</span>
</span><span class='line'><span class="cm">    as aliasing audibly intrudes as the sound gets brighter around </span>
</span><span class='line'><span class="cm">    midi note 48.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// table for Oscils to play</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 256 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModIndex</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// The ratio of deviation to modulation frequency is called the &quot;index of modulation&quot;. ( I = d / Fm )</span>
</span><span class='line'><span class="c1">// It will vary according to the frequency that is modulating the carrier and the amount of deviation.</span>
</span><span class='line'><span class="c1">// so deviation d = I   Fm</span>
</span><span class='line'><span class="c1">// haven&#39;t quite worked this out properly yet...</span>
</span><span class='line'>
</span><span class='line'><span class="n">Q8n8</span> <span class="n">mod_index</span><span class="p">;</span><span class="c1">// = float_to_Q8n8(2.0f); // constant version</span>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">deviation</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">carrier_freq</span><span class="p">,</span> <span class="n">mod_freq</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// FM ratio between oscillator frequencies, stays the same through note range</span>
</span><span class='line'><span class="n">Q8n8</span> <span class="n">mod_to_carrier_ratio</span> <span class="o">=</span> <span class="n">float_to_Q8n8</span><span class="p">(</span><span class="mf">3.f</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">kNoteChangeDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for note changes</span>
</span><span class='line'><span class="n">Q7n8</span> <span class="n">target_note</span><span class="p">,</span> <span class="n">note0</span><span class="p">,</span> <span class="n">note1</span><span class="p">,</span> <span class="n">note_upper_limit</span><span class="p">,</span> <span class="n">note_lower_limit</span><span class="p">,</span> <span class="n">note_change_step</span><span class="p">,</span> <span class="n">smoothed_note</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// using Smooth on midi notes rather than frequency, </span>
</span><span class='line'><span class="c1">// because fractional frequencies need larger types than Smooth can handle</span>
</span><span class='line'><span class="c1">// Inefficient, but...until there is a better Smooth....</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothNote</span><span class="p">(</span><span class="mf">0.95f</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">768</span><span class="p">);</span> <span class="c1">// ms countdown, taylored to resolution of CONTROL_RATE</span>
</span><span class='line'>  <span class="n">kModIndex</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.768f</span><span class="p">);</span> <span class="c1">// sync with kNoteChangeDelay</span>
</span><span class='line'>  <span class="n">target_note</span> <span class="o">=</span> <span class="n">note0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>  <span class="n">note_upper_limit</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</span><span class='line'>  <span class="n">note_lower_limit</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
</span><span class='line'>  <span class="n">note0</span> <span class="o">=</span> <span class="n">note_lower_limit</span><span class="p">;</span>
</span><span class='line'>  <span class="n">note1</span> <span class="o">=</span> <span class="n">note_lower_limit</span> <span class="o">+</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setFreqs</span><span class="p">(</span><span class="n">Q8n8</span> <span class="n">midi_note</span><span class="p">){</span>
</span><span class='line'>  <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q8n8_to_Q16n16</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span> <span class="c1">// convert midi note to fractional frequency</span>
</span><span class='line'>  <span class="n">mod_freq</span> <span class="o">=</span> <span class="p">((</span><span class="n">carrier_freq</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="n">mod_to_carrier_ratio</span><span class="p">)</span>  <span class="p">;</span> <span class="c1">// (Q16n16&gt;&gt;8)   Q8n8 = Q16n16, beware of overflow</span>
</span><span class='line'>  <span class="n">deviation</span> <span class="o">=</span> <span class="p">((</span><span class="n">mod_freq</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">*</span> <span class="n">mod_index</span><span class="p">);</span> <span class="c1">// (Q16n16&gt;&gt;16)   Q8n8 = Q24n8, beware of overflow</span>
</span><span class='line'>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// change note</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">target_note</span><span class="o">==</span><span class="n">note0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">note1</span> <span class="o">+=</span> <span class="n">note_change_step</span><span class="p">;</span>
</span><span class='line'>      <span class="n">target_note</span><span class="o">=</span><span class="n">note1</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="n">note0</span> <span class="o">+=</span> <span class="n">note_change_step</span><span class="p">;</span>
</span><span class='line'>      <span class="n">target_note</span><span class="o">=</span><span class="n">note0</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change direction</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">note0</span><span class="o">&gt;</span><span class="n">note_upper_limit</span><span class="p">)</span> <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">note0</span><span class="o">&lt;</span><span class="n">note_lower_limit</span><span class="p">)</span> <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// reset eventdelay</span>
</span><span class='line'>    <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// vary the modulation index</span>
</span><span class='line'>  <span class="n">mod_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">Q8n8</span><span class="p">)</span><span class="mi">350</span><span class="o">+</span><span class="n">kModIndex</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// here&#39;s where the smoothing happens</span>
</span><span class='line'>  <span class="n">smoothed_note</span> <span class="o">=</span> <span class="n">kSmoothNote</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target_note</span><span class="p">);</span>
</span><span class='line'>  <span class="n">setFreqs</span><span class="p">(</span><span class="n">smoothed_note</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Q15n16</span> <span class="n">modulation</span> <span class="o">=</span> <span class="n">deviation</span> <span class="o">*</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">(</span><span class="n">modulation</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>FMsynth_32k_HIFI <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/FMsynth_32k_HIFI/FMsynth_32k_HIFI.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/FMsynth_32k_HIFI/FMsynth_32k_HIFI.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='FMsynth_32k_HIFIexpand' onclick='javascript:toggleDisplay(FMsynth_32k_HIFI, FMsynth_32k_HIFIexpand, FMsynth_32k_HIFIcollapse)'>show sketch</button>
<button id='FMsynth_32k_HIFIcollapse' style='display:none' onclick='javascript:toggleDisplay(FMsynth_32k_HIFI, FMsynth_32k_HIFIexpand, FMsynth_32k_HIFIcollapse)'>hide sketch</button></p>

<div id='FMsynth_32k_HIFI' style='display:none'>
<figure class='code'><figcaption><span> (FMsynth_32k_HIFI.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/FMsynth_32k_HIFI/FMsynth_32k_HIFI.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of simple FM with the phase modulation technique,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates Oscil::phMod() for phase modulation, </span>
</span><span class='line'><span class="cm">    Smooth() for smoothing control signals, </span>
</span><span class='line'><span class="cm">    and Mozzi&#39;s fixed point number types for fractional frequencies.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    This sketch using HIFI mode is not for Teensy 3.1.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be</span>
</span><span class='line'><span class="cm">    be changed from STANDARD mode to HIFI.</span>
</span><span class='line'><span class="cm">    In Mozz/mozzi_config.h, change</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm">    #define AUDIO_MODE STANDARD_PLUS</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm">    to</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE STANDARD_PLUS</span>
</span><span class='line'><span class="cm">    #define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  The sketch also sounds better with a faster sample rate, for less aliasing</span>
</span><span class='line'><span class="cm">  #define AUDIO_RATE 32768</span>
</span><span class='line'><span class="cm">  in mozzi_config.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),</span>
</span><span class='line'><span class="cm">    Check the Mozzi core module documentation for others and more detail</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">                     3.9k </span>
</span><span class='line'><span class="cm">     pin 9  ---WWWW-----|-----output</span>
</span><span class='line'><span class="cm">                    499k           |</span>
</span><span class='line'><span class="cm">     pin 10 ---WWWW---- |</span>
</span><span class='line'><span class="cm">                                       |</span>
</span><span class='line'><span class="cm">                             4.7n  ==</span>
</span><span class='line'><span class="cm">                                       |</span>
</span><span class='line'><span class="cm">                                   ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Resistors are Â±0.5%  Measure and choose the most precise </span>
</span><span class='line'><span class="cm">    from a batch of whatever you can get.  Use two 1M resistors</span>
</span><span class='line'><span class="cm">    in parallel if you can&#39;t find 499k.</span>
</span><span class='line'><span class="cm">    Alternatively using 39 ohm, 4.99k and 470nF components will </span>
</span><span class='line'><span class="cm">    work directly with headphones.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012-13, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// table for Oscils to play</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_fixmath.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 256 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModIndex</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// The ratio of deviation to modulation frequency is called the &quot;index of modulation&quot;. ( I = d / Fm )</span>
</span><span class='line'><span class="c1">// It will vary according to the frequency that is modulating the carrier and the amount of deviation.</span>
</span><span class='line'><span class="c1">// so deviation d = I   Fm</span>
</span><span class='line'><span class="c1">// haven&#39;t quite worked this out properly yet...</span>
</span><span class='line'>
</span><span class='line'><span class="n">Q8n8</span> <span class="n">mod_index</span><span class="p">;</span><span class="c1">// = float_to_Q8n8(2.0f); // constant version</span>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">deviation</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">carrier_freq</span><span class="p">,</span> <span class="n">mod_freq</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// FM ratio between oscillator frequencies, stays the same through note range</span>
</span><span class='line'><span class="n">Q8n8</span> <span class="n">mod_to_carrier_ratio</span> <span class="o">=</span> <span class="n">float_to_Q8n8</span><span class="p">(</span><span class="mf">3.f</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">kNoteChangeDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for note changes</span>
</span><span class='line'><span class="n">Q7n8</span> <span class="n">target_note</span><span class="p">,</span> <span class="n">note0</span><span class="p">,</span> <span class="n">note1</span><span class="p">,</span> <span class="n">note_upper_limit</span><span class="p">,</span> <span class="n">note_lower_limit</span><span class="p">,</span> <span class="n">note_change_step</span><span class="p">,</span> <span class="n">smoothed_note</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// using Smooth on midi notes rather than frequency, </span>
</span><span class='line'><span class="c1">// because fractional frequencies need larger types than Smooth can handle</span>
</span><span class='line'><span class="c1">// Inefficient, but...until there is a better Smooth....</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothNote</span><span class="p">(</span><span class="mf">0.95f</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">768</span><span class="p">);</span> <span class="c1">// ms countdown, taylored to resolution of CONTROL_RATE</span>
</span><span class='line'>  <span class="n">kModIndex</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.768f</span><span class="p">);</span> <span class="c1">// sync with kNoteChangeDelay</span>
</span><span class='line'>  <span class="n">target_note</span> <span class="o">=</span> <span class="n">note0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>  <span class="n">note_upper_limit</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</span><span class='line'>  <span class="n">note_lower_limit</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
</span><span class='line'>  <span class="n">note0</span> <span class="o">=</span> <span class="n">note_lower_limit</span><span class="p">;</span>
</span><span class='line'>  <span class="n">note1</span> <span class="o">=</span> <span class="n">note_lower_limit</span> <span class="o">+</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setFreqs</span><span class="p">(</span><span class="n">Q8n8</span> <span class="n">midi_note</span><span class="p">){</span>
</span><span class='line'>  <span class="n">carrier_freq</span> <span class="o">=</span> <span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q8n8_to_Q16n16</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span> <span class="c1">// convert midi note to fractional frequency</span>
</span><span class='line'>  <span class="n">mod_freq</span> <span class="o">=</span> <span class="p">((</span><span class="n">carrier_freq</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="n">mod_to_carrier_ratio</span><span class="p">)</span>  <span class="p">;</span> <span class="c1">// (Q16n16&gt;&gt;8)   Q8n8 = Q16n16, beware of overflow</span>
</span><span class='line'>  <span class="n">deviation</span> <span class="o">=</span> <span class="p">((</span><span class="n">mod_freq</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">*</span> <span class="n">mod_index</span><span class="p">);</span> <span class="c1">// (Q16n16&gt;&gt;16)   Q8n8 = Q24n8, beware of overflow</span>
</span><span class='line'>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">carrier_freq</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">mod_freq</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// change note</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">target_note</span><span class="o">==</span><span class="n">note0</span><span class="p">){</span>
</span><span class='line'>      <span class="n">note1</span> <span class="o">+=</span> <span class="n">note_change_step</span><span class="p">;</span>
</span><span class='line'>      <span class="n">target_note</span><span class="o">=</span><span class="n">note1</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="n">note0</span> <span class="o">+=</span> <span class="n">note_change_step</span><span class="p">;</span>
</span><span class='line'>      <span class="n">target_note</span><span class="o">=</span><span class="n">note0</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change direction</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">note0</span><span class="o">&gt;</span><span class="n">note_upper_limit</span><span class="p">)</span> <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">note0</span><span class="o">&lt;</span><span class="n">note_lower_limit</span><span class="p">)</span> <span class="n">note_change_step</span> <span class="o">=</span> <span class="n">Q7n0_to_Q7n8</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// reset eventdelay</span>
</span><span class='line'>    <span class="n">kNoteChangeDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// vary the modulation index</span>
</span><span class='line'>  <span class="n">mod_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">Q8n8</span><span class="p">)</span><span class="mi">350</span><span class="o">+</span><span class="n">kModIndex</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// here&#39;s where the smoothing happens</span>
</span><span class='line'>  <span class="n">smoothed_note</span> <span class="o">=</span> <span class="n">kSmoothNote</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target_note</span><span class="p">);</span>
</span><span class='line'>  <span class="n">setFreqs</span><span class="p">(</span><span class="n">smoothed_note</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">Q15n16</span> <span class="n">modulation</span> <span class="o">=</span> <span class="n">deviation</span> <span class="o">*</span> <span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">(</span><span class="n">modulation</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="c1">// aCarrier is still only an 8 bit wave so shift up to 14 bits</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>PDresonant <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/PDresonant/PDresonant.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/PDresonant/PDresonant.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='PDresonantexpand' onclick='javascript:toggleDisplay(PDresonant, PDresonantexpand, PDresonantcollapse)'>show sketch</button>
<button id='PDresonantcollapse' style='display:none' onclick='javascript:toggleDisplay(PDresonant, PDresonantexpand, PDresonantcollapse)'>hide sketch</button></p>

<div id='PDresonant' style='display:none'>
<figure class='code'><figcaption><span> (PDresonant.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/PDresonant/PDresonant.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/* Phase distortion used to simulate resonant filter, based on</span>
</span><span class='line'><span class="cm">    https://en.wikipedia.org/wiki/Phase_distortion_synthesis</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Demonstrates PDResonant, a class which can be used as a</span>
</span><span class='line'><span class="cm">    simple midi instrument.  The class shows how the Mozzi Phasor class</span>
</span><span class='line'><span class="cm">    can be used to generate an index into a wavetable, and an ADSR</span>
</span><span class='line'><span class="cm">    is used to modulate the effect by modifying the Phasor frequency and sync.</span>
</span><span class='line'><span class="cm">    More complex phase distortion effects could be developed by using</span>
</span><span class='line'><span class="cm">    precalculated tables, or calcuating tables on the fly using a double buffer,</span>
</span><span class='line'><span class="cm">    or a line-breakpoint model, a sort of hybridPhasor-Line object.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    This version can only play a single voice at a time, it might </span>
</span><span class='line'><span class="cm">    be possible to optimise it enough for more simultaneous voices.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Circuit: </span>
</span><span class='line'><span class="cm">      MIDI input circuit as per http://arduino.cc/en/Tutorial/Midi</span>
</span><span class='line'><span class="cm">      (midi has to be disconnected from rx for sketch to upload)</span>
</span><span class='line'><span class="cm">      Audio output on digital pin 9 on a Uno or similar.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2013-14, CC by-nc-sa.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MIDI.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for fake midi</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;IntMap.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &quot;PDResonant.h&quot;</span>
</span><span class='line'><span class="c1">// wavetable for oscillator:</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// MIDI_CREATE_DEFAULT_INSTANCE(); // if really using midi</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// analog joystick for controlling speed of modulation: assigned to attack, decay times and sustain level</span>
</span><span class='line'><span class="cp">#define X A0</span>
</span><span class='line'><span class="cp">#define Y A1</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x_axis</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span> <span class="c1">// give a static value for test without midi</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">y_axis</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="n">IntMap</span> <span class="n">kmapX</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1023</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span> <span class="c1">// A</span>
</span><span class='line'><span class="k">const</span> <span class="n">IntMap</span> <span class="n">kmapY</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1023</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3000</span><span class="p">);</span> <span class="c1">//D</span>
</span><span class='line'>
</span><span class='line'><span class="n">PDResonant</span> <span class="n">voice</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for fake midi</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">startNote</span><span class="p">;</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">endNote</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// fresh random for fake midi</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span> <span class="c1">// for midi feedback</span>
</span><span class='line'>  <span class="c1">// initialize midi channel:</span>
</span><span class='line'>  <span class="c1">//MIDI.begin(MIDI_CHANNEL_OMNI);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//MIDI.setHandleNoteOn(HandleNoteOn);</span>
</span><span class='line'>  <span class="c1">//MIDI.setHandleNoteOff(HandleNoteOff);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// open MOZZI (: </span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">HandleNoteOn</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">){</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">velocity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">voice</span><span class="p">.</span><span class="n">noteOn</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">velocity</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">attack</span> <span class="o">=</span> <span class="n">kmapX</span><span class="p">(</span><span class="n">x_axis</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">decay</span> <span class="o">=</span> <span class="n">kmapY</span><span class="p">(</span><span class="n">y_axis</span><span class="p">);</span>
</span><span class='line'>    <span class="n">voice</span><span class="p">.</span><span class="n">setPDEnv</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span><span class="n">decay</span><span class="p">);</span>
</span><span class='line'>    <span class="n">digitalWrite</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="n">HIGH</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span><span class="p">{</span>
</span><span class='line'>    <span class="n">stopNote</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span>  <span class="n">pitch</span><span class="p">,</span>  <span class="n">velocity</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">HandleNoteOff</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">){</span>
</span><span class='line'>  <span class="n">stopNote</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span>  <span class="n">pitch</span><span class="p">,</span>  <span class="n">velocity</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">stopNote</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">){</span>
</span><span class='line'>  <span class="n">voice</span><span class="p">.</span><span class="n">noteOff</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">velocity</span><span class="p">);</span>
</span><span class='line'>  <span class="n">digitalWrite</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">fakeMidiRead</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">static</span> <span class="kt">char</span> <span class="n">curr_note</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">startNote</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="n">curr_note</span> <span class="o">=</span> <span class="mi">20</span><span class="o">+</span><span class="n">rand</span><span class="p">(</span><span class="mi">40</span><span class="p">);</span>
</span><span class='line'>    <span class="n">HandleNoteOn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">curr_note</span><span class="p">,</span><span class="mi">127</span><span class="p">);</span>
</span><span class='line'>    <span class="n">startNote</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
</span><span class='line'>    <span class="n">startNote</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="n">endNote</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span><span class='line'>    <span class="n">endNote</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">endNote</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="n">HandleNoteOff</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">curr_note</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// check MIDI : </span>
</span><span class='line'>  <span class="c1">//MIDI.read();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// analog joystick for controlling speed of modulation: assigned to attack, decay times and sustain level</span>
</span><span class='line'>  <span class="c1">//x_axis = mozziAnalogRead(X);</span>
</span><span class='line'>  <span class="c1">//y_axis = mozziAnalogRead(Y);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// for testing/demo without external input</span>
</span><span class='line'>  <span class="n">fakeMidiRead</span><span class="p">();</span>
</span><span class='line'>  <span class="n">x_axis</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span> <span class="c1">//mozziAnalogRead(X);</span>
</span><span class='line'>  <span class="n">y_axis</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span> <span class="c1">// mozziAnalogRead(Y);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">voice</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">voice</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>PWM_Phasing <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/PWM_Phasing/PWM_Phasing.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/PWM_Phasing/PWM_Phasing.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='PWM_Phasingexpand' onclick='javascript:toggleDisplay(PWM_Phasing, PWM_Phasingexpand, PWM_Phasingcollapse)'>show sketch</button>
<button id='PWM_Phasingcollapse' style='display:none' onclick='javascript:toggleDisplay(PWM_Phasing, PWM_Phasingexpand, PWM_Phasingcollapse)'>hide sketch</button></p>

<div id='PWM_Phasing' style='display:none'>
<figure class='code'><figcaption><span> (PWM_Phasing.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/PWM_Phasing/PWM_Phasing.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of pulse width modulation,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">     </span>
</span><span class='line'><span class="cm">    Based Miller Puckette&#39;s j03.pulse.width.mod example </span>
</span><span class='line'><span class="cm">    in the Pure Data documentation, subtracting 2 sawtooth </span>
</span><span class='line'><span class="cm">    waves with slightly different tunings to produce a </span>
</span><span class='line'><span class="cm">    varying phase difference.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates Phasor().</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Phasor.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Phasor</span> <span class="o">&lt;</span><span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aPhasor1</span><span class="p">;</span>
</span><span class='line'><span class="n">Phasor</span> <span class="o">&lt;</span><span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aPhasor2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">float</span> <span class="n">freq</span> <span class="o">=</span> <span class="mf">55.f</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aPhasor1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aPhasor2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">+</span><span class="mf">0.2f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// set a control rate of 64 (powers of 2 please)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)(</span><span class="n">aPhasor1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">24</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)(</span><span class="n">aPhasor2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">24</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">asig1</span><span class="o">-</span><span class="n">asig2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>WavePacket_Double <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Double/WavePacket_Double.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Double/WavePacket_Double.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='WavePacket_Doubleexpand' onclick='javascript:toggleDisplay(WavePacket_Double, WavePacket_Doubleexpand, WavePacket_Doublecollapse)'>show sketch</button>
<button id='WavePacket_Doublecollapse' style='display:none' onclick='javascript:toggleDisplay(WavePacket_Double, WavePacket_Doubleexpand, WavePacket_Doublecollapse)'>hide sketch</button></p>

<div id='WavePacket_Double' style='display:none'>
<figure class='code'><figcaption><span> (WavePacket_Double.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/WavePacket_Double/WavePacket_Double.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of Wavepacket synthesis, using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">    This sketch draws on Miller Puckette&#39;s </span>
</span><span class='line'><span class="cm">    Pure Data example, F14.wave.packet.pd, with</span>
</span><span class='line'><span class="cm">    two overlapping streams of wave packets.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit:</span>
</span><span class='line'><span class="cm">     Audio output on DAC/A14 on Teensy 3.0, 3.1, </span>
</span><span class='line'><span class="cm">     or digital pin 9 on a Uno or similar, or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">     </span>
</span><span class='line'><span class="cm">     Potentiometer connected to analog pin 0.</span>
</span><span class='line'><span class="cm">      Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">      Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'>
</span><span class='line'><span class="cm">      Potentiometer connected to analog pin 1.</span>
</span><span class='line'><span class="cm">      Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">      Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'>
</span><span class='line'><span class="cm">      Potentiometer connected to analog pin 2.</span>
</span><span class='line'><span class="cm">      Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">      Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'><span class="cm">      </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;WavePacket.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;RollingAverage.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define FUNDAMENTAL_PIN 0</span>
</span><span class='line'><span class="cp">#define BANDWIDTH_PIN 1</span>
</span><span class='line'><span class="cp">#define CENTREFREQ_PIN 2</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for smoothing the control signals</span>
</span><span class='line'><span class="c1">// use: RollingAverage &lt;number_type, how_many_to_average&gt; myThing</span>
</span><span class='line'><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageF</span><span class="p">;</span>
</span><span class='line'><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageBw</span><span class="p">;</span>
</span><span class='line'><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageCf</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">WavePacket</span> <span class="o">&lt;</span><span class="n">DOUBLE</span><span class="o">&gt;</span> <span class="n">wavey</span><span class="p">;</span> <span class="c1">// DOUBLE selects 2 overlapping streams</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">wavey</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">kAverageF</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">FUNDAMENTAL_PIN</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="n">kAverageBw</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">BANDWIDTH_PIN</span><span class="p">)),</span>
</span><span class='line'>    <span class="n">kAverageCf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">CENTREFREQ_PIN</span><span class="p">)));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">wavey</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// &gt;&gt;8 for AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>WavePacket_Sample <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Sample/WavePacket_Sample.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Sample/WavePacket_Sample.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='WavePacket_Sampleexpand' onclick='javascript:toggleDisplay(WavePacket_Sample, WavePacket_Sampleexpand, WavePacket_Samplecollapse)'>show sketch</button>
<button id='WavePacket_Samplecollapse' style='display:none' onclick='javascript:toggleDisplay(WavePacket_Sample, WavePacket_Sampleexpand, WavePacket_Samplecollapse)'>hide sketch</button></p>

<div id='WavePacket_Sample' style='display:none'>
<figure class='code'><figcaption><span> (WavePacket_Sample.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/WavePacket_Sample/WavePacket_Sample.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of Wavepacket synthesis, using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">    This sketch draws on Miller Puckette&#39;s </span>
</span><span class='line'><span class="cm">    Pure Data example, F14.wave.packet.pd, with</span>
</span><span class='line'><span class="cm">    two overlapping streams of wave packets.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Demonstrates the WavePacketSample object, which enables a</span>
</span><span class='line'><span class="cm">    custom sound table to be used as the audio source for wavepackets.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit:</span>
</span><span class='line'><span class="cm">     Audio output on DAC/A14 on Teensy 3.0, 3.1, </span>
</span><span class='line'><span class="cm">     or digital pin 9 on a Uno or similar, or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">     </span>
</span><span class='line'><span class="cm">     Potentiometer connected to analog pin 0.</span>
</span><span class='line'><span class="cm">      Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">      Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'>
</span><span class='line'><span class="cm">      Potentiometer connected to analog pin 1.</span>
</span><span class='line'><span class="cm">      Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">      Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'>
</span><span class='line'><span class="cm">      Potentiometer connected to analog pin 2.</span>
</span><span class='line'><span class="cm">      Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">      Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'><span class="cm">      </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;WavePacketSample.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;RollingAverage.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;samples/raven_arh_int8.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define FUNDAMENTAL_PIN 0</span>
</span><span class='line'><span class="cp">#define BANDWIDTH_PIN 1</span>
</span><span class='line'><span class="cp">#define CENTREFREQ_PIN 2</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for smoothing the control signals</span>
</span><span class='line'><span class="c1">// use: RollingAverage &lt;number_type, how_many_to_average&gt; myThing</span>
</span><span class='line'><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageF</span><span class="p">;</span>
</span><span class='line'><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageBw</span><span class="p">;</span>
</span><span class='line'><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageCf</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">WavePacketSample</span> <span class="o">&lt;</span><span class="n">DOUBLE</span><span class="o">&gt;</span> <span class="n">wavey</span><span class="p">;</span> <span class="c1">// DOUBLE selects 2 overlapping streams</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">wavey</span><span class="p">.</span><span class="n">setTable</span><span class="p">(</span><span class="n">RAVEN_ARH_DATA</span><span class="p">);</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
</span><span class='line'>  <span class="n">digitalWrite</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="n">kAverageF</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">FUNDAMENTAL_PIN</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">kAverageBw</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">BANDWIDTH_PIN</span><span class="p">));</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">cf</span> <span class="o">=</span> <span class="n">kAverageCf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">CENTREFREQ_PIN</span><span class="p">));</span>
</span><span class='line'>  <span class="n">wavey</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">cf</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">wavey</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// &gt;&gt;8 for AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>WavePacket_Single <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Single/WavePacket_Single.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/WavePacket_Single/WavePacket_Single.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='WavePacket_Singleexpand' onclick='javascript:toggleDisplay(WavePacket_Single, WavePacket_Singleexpand, WavePacket_Singlecollapse)'>show sketch</button>
<button id='WavePacket_Singlecollapse' style='display:none' onclick='javascript:toggleDisplay(WavePacket_Single, WavePacket_Singleexpand, WavePacket_Singlecollapse)'>hide sketch</button></p>

<div id='WavePacket_Single' style='display:none'>
<figure class='code'><figcaption><span> (WavePacket_Single.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/WavePacket_Single/WavePacket_Single.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of Wavepacket synthesis, using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">    This sketch draws on Miller Puckette&#39;s </span>
</span><span class='line'><span class="cm">    Pure Data example, F14.wave.packet.pd, with</span>
</span><span class='line'><span class="cm">    one non-overlapping stream of wave packets.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit:</span>
</span><span class='line'><span class="cm">     Audio output on DAC/A14 on Teensy 3.0, 3.1, </span>
</span><span class='line'><span class="cm">     or digital pin 9 on a Uno or similar, or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">     </span>
</span><span class='line'><span class="cm">     Potentiometer connected to analog pin 0.</span>
</span><span class='line'><span class="cm">      Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">      Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'>
</span><span class='line'><span class="cm">      Potentiometer connected to analog pin 1.</span>
</span><span class='line'><span class="cm">      Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">      Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'>
</span><span class='line'><span class="cm">      Potentiometer connected to analog pin 2.</span>
</span><span class='line'><span class="cm">      Center pin of the potentiometer goes to the analog pin.</span>
</span><span class='line'><span class="cm">      Side pins of the potentiometer go to +5V and ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;mozzi_analog.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;WavePacket.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;RollingAverage.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define FUNDAMENTAL_PIN 0</span>
</span><span class='line'><span class="cp">#define BANDWIDTH_PIN 1</span>
</span><span class='line'><span class="cp">#define CENTREFREQ_PIN 2</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for smoothing the control signals</span>
</span><span class='line'><span class="c1">// use: RollingAverage &lt;number_type, how_many_to_average&gt; myThing</span>
</span><span class='line'><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageF</span><span class="p">;</span>
</span><span class='line'><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageBw</span><span class="p">;</span>
</span><span class='line'><span class="n">RollingAverage</span> <span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="mi">32</span><span class="o">&gt;</span> <span class="n">kAverageCf</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">WavePacket</span> <span class="o">&lt;</span><span class="n">SINGLE</span><span class="o">&gt;</span> <span class="n">wavey</span><span class="p">;</span> <span class="c1">// SINGLE selects 1 non-overlapping stream</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">wavey</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">kAverageF</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">FUNDAMENTAL_PIN</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
</span><span class='line'>    <span class="n">kAverageBw</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">BANDWIDTH_PIN</span><span class="p">)),</span>
</span><span class='line'>    <span class="n">kAverageCf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mozziAnalogRead</span><span class="p">(</span><span class="n">CENTREFREQ_PIN</span><span class="p">)));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">wavey</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span> <span class="c1">// &gt;&gt;8 for AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Waveshaper <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Waveshaper/Waveshaper.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Waveshaper/Waveshaper.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Waveshaperexpand' onclick='javascript:toggleDisplay(Waveshaper, Waveshaperexpand, Waveshapercollapse)'>show sketch</button>
<button id='Waveshapercollapse' style='display:none' onclick='javascript:toggleDisplay(Waveshaper, Waveshaperexpand, Waveshapercollapse)'>hide sketch</button></p>

<div id='Waveshaper' style='display:none'>
<figure class='code'><figcaption><span> (Waveshaper.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/Waveshaper/Waveshaper.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example using waveshaping to modify the spectrum of an audio signal</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates the use of WaveShaper(), EventDelay(), Smooth(),</span>
</span><span class='line'><span class="cm">    rand(), and fixed-point numbers.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;WaveShaper.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/waveshape_chebyshev_3rd_256_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/waveshape_chebyshev_6th_256_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/waveshape_compress_512_to_488_int16.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// use #define for CONTROL_RATE, not a constant</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// sine wave sound source</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aGain1</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// to fade sine wave in and out before waveshaping</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aGain2</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// to fade sine wave in and out before waveshaping</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Chebyshev polynomial curves, The nth curve produces the n+2th harmonic component.</span>
</span><span class='line'><span class="n">WaveShaper</span> <span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">aCheby3rd</span><span class="p">(</span><span class="n">CHEBYSHEV_3RD_256_DATA</span><span class="p">);</span> <span class="c1">// 5th harmonic</span>
</span><span class='line'><span class="n">WaveShaper</span> <span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">aCheby6th</span><span class="p">(</span><span class="n">CHEBYSHEV_6TH_256_DATA</span><span class="p">);</span> <span class="c1">// 8th harmonic</span>
</span><span class='line'><span class="n">WaveShaper</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">aCompress</span><span class="p">(</span><span class="n">WAVESHAPE_COMPRESS_512_TO_488_DATA</span><span class="p">);</span> <span class="c1">// to compress instead of dividing by 2 after adding signals</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling note changes</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">kChangeNoteDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for random notes</span>
</span><span class='line'><span class="n">Q8n0</span> <span class="n">octave_start_note</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span><span class='line'><span class="n">Q24n8</span> <span class="n">carrier_freq</span><span class="p">;</span> <span class="c1">// unsigned long with 24 integer bits and 8 fractional bits</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// smooth transitions between notes</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothFreq</span><span class="p">(</span><span class="mf">0.85f</span><span class="p">);</span>
</span><span class='line'><span class="kt">int</span> <span class="n">target_freq</span><span class="p">,</span> <span class="n">smoothed_freq</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// set a control rate of 64 (powers of 2 please)</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// reseed the random generator for different results each time the sketch runs</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">110</span><span class="p">);</span> <span class="c1">// set the frequency</span>
</span><span class='line'>  <span class="n">aGain1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.f</span><span class="p">);</span> <span class="c1">// use a float for low frequencies, in setup it doesn&#39;t need to be fast</span>
</span><span class='line'>  <span class="n">aGain2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.4f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">4000</span><span class="p">);</span> <span class="c1">// note duration ms, within resolution of CONTROL_RATE</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">byte</span> <span class="n">rndPentatonic</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">byte</span> <span class="n">note</span> <span class="o">=</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">);</span>
</span><span class='line'>  <span class="k">switch</span><span class="p">(</span><span class="n">note</span><span class="p">){</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>    <span class="n">note</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>    <span class="n">note</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>    <span class="n">note</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>    <span class="n">note</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>
</span><span class='line'>    <span class="n">note</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">note</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">){</span> <span class="c1">// about 1 in 5 or so</span>
</span><span class='line'>      <span class="c1">// change octave to midi 24 or any of 3 octaves above</span>
</span><span class='line'>      <span class="n">octave_start_note</span> <span class="o">=</span> <span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">12</span><span class="p">)</span><span class="o">+</span><span class="mi">36</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">Q16n16</span> <span class="n">midi_note</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="n">octave_start_note</span><span class="o">+</span><span class="n">rndPentatonic</span><span class="p">());</span>
</span><span class='line'>    <span class="n">target_freq</span> <span class="o">=</span> <span class="n">Q16n16_to_Q16n0</span><span class="p">(</span><span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span> <span class="c1">// has to be 16 bits for Smooth</span>
</span><span class='line'>    <span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">smoothed_freq</span> <span class="o">=</span> <span class="n">kSmoothFreq</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">target_freq</span><span class="o">*</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// temporarily scale up target_freq to get better int smoothing at low values</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">smoothed_freq</span><span class="o">/</span><span class="mi">4</span><span class="p">);</span> <span class="c1">// then scale it back down after it&#39;s smoothed</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig0</span> <span class="o">=</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// sine wave source</span>
</span><span class='line'>  <span class="c1">// make 2 signals fading in and out to show effect of amplitude when waveshaping with Chebyshev polynomial curves</span>
</span><span class='line'>  <span class="c1">// offset the signals by 128 to fit in the 0-255 range for the waveshaping table lookups</span>
</span><span class='line'>  <span class="n">byte</span> <span class="n">asig1</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span><span class="p">((</span><span class="n">asig0</span><span class="o">*</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span><span class="n">aGain1</span><span class="p">.</span><span class="n">next</span><span class="p">()))</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">);</span>
</span><span class='line'>  <span class="n">byte</span> <span class="n">asig2</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span><span class="p">((</span><span class="n">asig0</span><span class="o">*</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">128</span><span class="o">+</span><span class="n">aGain2</span><span class="p">.</span><span class="n">next</span><span class="p">()))</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// get the waveshaped signals</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">awaveshaped1</span> <span class="o">=</span> <span class="n">aCheby3rd</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig1</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">awaveshaped2</span> <span class="o">=</span> <span class="n">aCheby6th</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig2</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// use a waveshaping table to squeeze 2 summed 8 bit signals into the range -244 to 243</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">awaveshaped3</span> <span class="o">=</span> <span class="n">aCompress</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="mi">256u</span> <span class="o">+</span> <span class="n">awaveshaped1</span> <span class="o">+</span> <span class="n">awaveshaped2</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">awaveshaped3</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Waveshaper_Difference_Tone <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Waveshaper_Difference_Tone/Waveshaper_Difference_Tone.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/06.Synthesis/Waveshaper_Difference_Tone/Waveshaper_Difference_Tone.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Waveshaper_Difference_Toneexpand' onclick='javascript:toggleDisplay(Waveshaper_Difference_Tone, Waveshaper_Difference_Toneexpand, Waveshaper_Difference_Tonecollapse)'>show sketch</button>
<button id='Waveshaper_Difference_Tonecollapse' style='display:none' onclick='javascript:toggleDisplay(Waveshaper_Difference_Tone, Waveshaper_Difference_Toneexpand, Waveshaper_Difference_Tonecollapse)'>hide sketch</button></p>

<div id='Waveshaper_Difference_Tone' style='display:none'>
<figure class='code'><figcaption><span> (Waveshaper_Difference_Tone.ino)</span> <a href='/Mozzi/downloads/code/examples/06.Synthesis/Waveshaper_Difference_Tone/Waveshaper_Difference_Tone.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example using waveshaping to modify the spectrum of an audio signal</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates the use of WaveShaper(), EventDelay(), Smooth(),</span>
</span><span class='line'><span class="cm">    rand(), and fixed-point numbers.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;WaveShaper.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// use #define for CONTROL_RATE, not a constant</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin1</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// sine wave sound source</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin2</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// sine wave sound source</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aGain</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span> <span class="c1">// to fade audio signal in and out before waveshaping</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling note changes</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">kChangeNoteDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio frequency as Q16n16 fractional number</span>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">freq1</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// smooth transitions between notes</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothFreq</span><span class="p">(</span><span class="mf">0.85f</span><span class="p">);</span>
</span><span class='line'><span class="kt">int</span> <span class="n">target_freq</span><span class="p">,</span> <span class="n">smoothed_freq</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// set a control rate of 64 (powers of 2 please)</span>
</span><span class='line'>  <span class="n">aSin1</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">freq1</span><span class="p">);</span> <span class="c1">// set the frequency with a Q16n16 fractional number</span>
</span><span class='line'>  <span class="n">aGain</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.2f</span><span class="p">);</span> <span class="c1">// use a float for low frequencies, in setup it doesn&#39;t need to be fast</span>
</span><span class='line'>  <span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span> <span class="c1">// note duration ms, within resolution of CONTROL_RATE</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="c1">// change proportional frequency of second tone</span>
</span><span class='line'>    <span class="n">byte</span> <span class="n">harmonic</span> <span class="o">=</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">12</span><span class="p">);</span>
</span><span class='line'>    <span class="n">byte</span> <span class="n">shimmer</span> <span class="o">=</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">255</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Q16n16</span> <span class="n">harmonic_step</span> <span class="o">=</span> <span class="n">freq1</span><span class="o">/</span><span class="mi">12</span><span class="p">;</span>
</span><span class='line'>    <span class="n">Q16n16</span> <span class="n">freq2difference</span> <span class="o">=</span> <span class="n">harmonic</span><span class="o">*</span><span class="n">harmonic_step</span><span class="p">;</span>
</span><span class='line'>    <span class="n">freq2difference</span> <span class="o">+=</span> <span class="p">(</span><span class="n">harmonic_step</span><span class="o">*</span><span class="n">shimmer</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">11</span><span class="p">;</span>
</span><span class='line'>    <span class="n">Q16n16</span> <span class="n">freq2</span> <span class="o">=</span> <span class="n">freq1</span><span class="o">-</span><span class="n">freq2difference</span><span class="p">;</span>
</span><span class='line'>    <span class="n">aSin2</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">freq2</span><span class="p">);</span> <span class="c1">// set the frequency with a Q16n16 fractional number</span>
</span><span class='line'>    <span class="n">kChangeNoteDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((((</span><span class="n">uint32_t</span><span class="p">)</span><span class="n">aSin1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">+</span> <span class="n">aSin2</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">*</span><span class="p">(</span><span class="mi">200u</span><span class="o">+</span><span class="n">aGain</span><span class="p">.</span><span class="n">next</span><span class="p">()))</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">clipped</span> <span class="o">=</span> <span class="n">constrain</span><span class="p">(</span><span class="n">asig</span><span class="p">,</span><span class="o">-</span><span class="mi">244</span><span class="p">,</span><span class="mi">243</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">clipped</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='07.Envelopes'>
07.Envelopes</a></h2>


<hr />

<p>ADSR_Audio_Rate_Envelope <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/ADSR_Audio_Rate_Envelope/ADSR_Audio_Rate_Envelope.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/ADSR_Audio_Rate_Envelope/ADSR_Audio_Rate_Envelope.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='ADSR_Audio_Rate_Envelopeexpand' onclick='javascript:toggleDisplay(ADSR_Audio_Rate_Envelope, ADSR_Audio_Rate_Envelopeexpand, ADSR_Audio_Rate_Envelopecollapse)'>show sketch</button>
<button id='ADSR_Audio_Rate_Envelopecollapse' style='display:none' onclick='javascript:toggleDisplay(ADSR_Audio_Rate_Envelope, ADSR_Audio_Rate_Envelopeexpand, ADSR_Audio_Rate_Envelopecollapse)'>hide sketch</button></p>

<div id='ADSR_Audio_Rate_Envelope' style='display:none'>
<figure class='code'><figcaption><span> (ADSR_Audio_Rate_Envelope.ino)</span> <a href='/Mozzi/downloads/code/examples/07.Envelopes/ADSR_Audio_Rate_Envelope/ADSR_Audio_Rate_Envelope.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example applying an ADSR envelope to an audio signal</span>
</span><span class='line'><span class="cm">    with Mozzi sonification library.  This shows </span>
</span><span class='line'><span class="cm">    internal updates at CONTROL_RATE, using update() in updateControl(),</span>
</span><span class='line'><span class="cm">    with interpolation and output using next() at AUDIO_RATE in updateAudio().</span>
</span><span class='line'><span class="cm">    This is the &quot;ordinary&quot; way to use ADSR for smooth amplitude transitions while</span>
</span><span class='line'><span class="cm">    maintaining reasonable efficiency by updating internal states in updateControl().</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Demonstrates a simple ADSR object being controlled with</span>
</span><span class='line'><span class="cm">    noteOn() and noteOff() instructions.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;ADSR.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin8192_int8.h&gt; </span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="mi">8192</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aOscil</span><span class="p">(</span><span class="n">SIN8192_DATA</span><span class="p">);;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for triggering the envelope</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">noteDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">envelope</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">boolean</span> <span class="n">note_is_on</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// fresh random</span>
</span><span class='line'>  <span class="n">noteDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span> <span class="c1">// 2 second countdown</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">duration</span><span class="p">,</span> <span class="n">attack</span><span class="p">,</span> <span class="n">decay</span><span class="p">,</span> <span class="n">sustain</span><span class="p">,</span> <span class="n">release_ms</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">noteDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// choose envelope levels</span>
</span><span class='line'>      <span class="n">byte</span> <span class="n">attack_level</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="o">+</span><span class="mi">127</span><span class="p">;</span>
</span><span class='line'>      <span class="n">byte</span> <span class="n">decay_level</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
</span><span class='line'>      <span class="n">envelope</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="n">attack_level</span><span class="p">,</span><span class="n">decay_level</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// generate a random new adsr time parameter value in milliseconds</span>
</span><span class='line'>     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">new_value</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span> <span class="o">+</span><span class="mi">100</span><span class="p">;</span>
</span><span class='line'>     <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">new_value</span><span class="p">);</span>
</span><span class='line'>     <span class="c1">// randomly choose one of the adsr parameters and set the new value</span>
</span><span class='line'>     <span class="k">switch</span> <span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">)){</span>
</span><span class='line'>       <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>       <span class="n">attack</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
</span><span class='line'>       <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>       <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>       <span class="n">decay</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
</span><span class='line'>       <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>       <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>       <span class="n">sustain</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
</span><span class='line'>       <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>       <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>       <span class="n">release_ms</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
</span><span class='line'>       <span class="k">break</span><span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>     <span class="n">envelope</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span><span class="n">decay</span><span class="p">,</span><span class="n">sustain</span><span class="p">,</span><span class="n">release_ms</span><span class="p">);</span>
</span><span class='line'>     <span class="n">envelope</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>     <span class="n">byte</span> <span class="n">midi_note</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">107</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">;</span>
</span><span class='line'>     <span class="n">aOscil</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">mtof</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">     // print to screen</span>
</span><span class='line'><span class="cm">     Serial.print(&quot;midi_note\t&quot;); Serial.println(midi_note);</span>
</span><span class='line'><span class="cm">     Serial.print(&quot;attack_level\t&quot;); Serial.println(attack_level);</span>
</span><span class='line'><span class="cm">     Serial.print(&quot;decay_level\t&quot;); Serial.println(decay_level);</span>
</span><span class='line'><span class="cm">     Serial.print(&quot;attack\t\t&quot;); Serial.println(attack);</span>
</span><span class='line'><span class="cm">     Serial.print(&quot;decay\t\t&quot;); Serial.println(decay);</span>
</span><span class='line'><span class="cm">     Serial.print(&quot;sustain\t\t&quot;); Serial.println(sustain);</span>
</span><span class='line'><span class="cm">     Serial.print(&quot;release\t\t&quot;); Serial.println(release_ms);</span>
</span><span class='line'><span class="cm">     Serial.println();</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>     <span class="n">noteDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">attack</span><span class="o">+</span><span class="n">decay</span><span class="o">+</span><span class="n">sustain</span><span class="o">+</span><span class="n">release_ms</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">envelope</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aOscil</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>ADSR_Audio_Rate_Envelope_x2 <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/ADSR_Audio_Rate_Envelope_x2/ADSR_Audio_Rate_Envelope_x2.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/ADSR_Audio_Rate_Envelope_x2/ADSR_Audio_Rate_Envelope_x2.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='ADSR_Audio_Rate_Envelope_x2expand' onclick='javascript:toggleDisplay(ADSR_Audio_Rate_Envelope_x2, ADSR_Audio_Rate_Envelope_x2expand, ADSR_Audio_Rate_Envelope_x2collapse)'>show sketch</button>
<button id='ADSR_Audio_Rate_Envelope_x2collapse' style='display:none' onclick='javascript:toggleDisplay(ADSR_Audio_Rate_Envelope_x2, ADSR_Audio_Rate_Envelope_x2expand, ADSR_Audio_Rate_Envelope_x2collapse)'>hide sketch</button></p>

<div id='ADSR_Audio_Rate_Envelope_x2' style='display:none'>
<figure class='code'><figcaption><span> (ADSR_Audio_Rate_Envelope_x2.ino)</span> <a href='/Mozzi/downloads/code/examples/07.Envelopes/ADSR_Audio_Rate_Envelope_x2/ADSR_Audio_Rate_Envelope_x2.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example applying ADSR envelopes to 2 audio oscillators</span>
</span><span class='line'><span class="cm">     with Mozzi sonification library.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">     Demonstrates ADSR, EventDelay and rand().</span>
</span><span class='line'>
</span><span class='line'><span class="cm">     Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;ADSR.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin8192_int8.h&gt; </span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="mi">8192</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aOscil0</span><span class="p">(</span><span class="n">SIN8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="mi">8192</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aOscil1</span><span class="p">(</span><span class="n">SIN8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for triggering the envelope</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">noteDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ADSR update_rate, interpolation_rte</span>
</span><span class='line'><span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="p">,</span><span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">envelope0</span><span class="p">;</span>
</span><span class='line'><span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="p">,</span><span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">envelope1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">boolean</span> <span class="n">note_is_on</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="c1">//Serial.begin(115200);</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// fresh random</span>
</span><span class='line'>  <span class="n">envelope0</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span><span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span><span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span><span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">));</span>
</span><span class='line'>  <span class="n">envelope1</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span><span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span><span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span><span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">));</span>
</span><span class='line'>  <span class="n">noteDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span> <span class="c1">// 2 second countdown</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">attack0</span><span class="p">,</span> <span class="n">decay0</span><span class="p">,</span> <span class="n">sustain0</span><span class="p">,</span> <span class="n">release_ms0</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">attack1</span><span class="p">,</span> <span class="n">decay1</span><span class="p">,</span> <span class="n">sustain1</span><span class="p">,</span> <span class="n">release_ms1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">noteDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change adsr 0</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// choose envelope levels</span>
</span><span class='line'>    <span class="n">byte</span> <span class="n">attack0_level</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="o">+</span><span class="mi">127</span><span class="p">;</span>
</span><span class='line'>    <span class="n">byte</span> <span class="n">decay0_level</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
</span><span class='line'>    <span class="n">envelope0</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="n">attack0_level</span><span class="p">,</span><span class="n">decay0_level</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// generate a random new adsr time parameter value in milliseconds</span>
</span><span class='line'>     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">new_value</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span> <span class="o">+</span><span class="mi">100</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// randomly choose one of the adsr parameters and set the new value</span>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">)){</span>
</span><span class='line'>    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>      <span class="n">attack0</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>      <span class="n">decay0</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>      <span class="n">sustain0</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>      <span class="n">release_ms0</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">envelope0</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="n">attack0</span><span class="p">,</span><span class="n">decay0</span><span class="p">,</span><span class="n">sustain0</span><span class="p">,</span><span class="n">release_ms0</span><span class="p">);</span>
</span><span class='line'>    <span class="n">envelope0</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change adsr 1 </span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// choose envelope levels</span>
</span><span class='line'>    <span class="n">byte</span> <span class="n">attack1_level</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="o">+</span><span class="mi">127</span><span class="p">;</span>
</span><span class='line'>    <span class="n">byte</span> <span class="n">decay1_level</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
</span><span class='line'>    <span class="n">envelope1</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="n">attack1_level</span><span class="p">,</span><span class="n">decay1_level</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// generate a random new adsr time parameter value in milliseconds</span>
</span><span class='line'>     <span class="n">new_value</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span> <span class="o">+</span><span class="mi">100</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// randomly choose one of the adsr parameters and set the new value</span>
</span><span class='line'>    <span class="k">switch</span> <span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">)){</span>
</span><span class='line'>    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>      <span class="n">attack1</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>      <span class="n">decay1</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>      <span class="n">sustain1</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>      <span class="n">release_ms1</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">envelope1</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="n">attack1</span><span class="p">,</span><span class="n">decay1</span><span class="p">,</span><span class="n">sustain1</span><span class="p">,</span><span class="n">release_ms1</span><span class="p">);</span>
</span><span class='line'>    <span class="n">envelope1</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// change the pitch</span>
</span><span class='line'>    <span class="n">byte</span> <span class="n">midi_note</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">107</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">freq</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">mtof</span><span class="p">(</span><span class="n">midi_note</span><span class="p">);</span>
</span><span class='line'>    <span class="n">aOscil0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="p">);</span>
</span><span class='line'>    <span class="n">aOscil1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">freq</span><span class="o">*</span><span class="mi">2</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">    // print to screen</span>
</span><span class='line'><span class="cm">    Serial.print(&quot;midi_note\t&quot;); </span>
</span><span class='line'><span class="cm">    Serial.println(midi_note);</span>
</span><span class='line'><span class="cm">    Serial.print(&quot;attack0_level\t&quot;); </span>
</span><span class='line'><span class="cm">    Serial.print(attack0_level);</span>
</span><span class='line'><span class="cm">    Serial.print(&quot;\t attack1_level\t&quot;); </span>
</span><span class='line'><span class="cm">    Serial.println(attack1_level);</span>
</span><span class='line'><span class="cm">    Serial.print(&quot;decay0_level\t&quot;); </span>
</span><span class='line'><span class="cm">    Serial.print(decay0_level);</span>
</span><span class='line'><span class="cm">    Serial.print(&quot;\t decay1_level\t&quot;); </span>
</span><span class='line'><span class="cm">    Serial.println(decay1_level);</span>
</span><span class='line'><span class="cm">    Serial.print(&quot;attack0\t\t&quot;); </span>
</span><span class='line'><span class="cm">    Serial.print(attack0);</span>
</span><span class='line'><span class="cm">    Serial.print(&quot;\t attack1\t&quot;); </span>
</span><span class='line'><span class="cm">    Serial.println(attack1);</span>
</span><span class='line'><span class="cm">    Serial.print(&quot;decay0\t\t&quot;); </span>
</span><span class='line'><span class="cm">    Serial.print(decay0);</span>
</span><span class='line'><span class="cm">    Serial.print(&quot;\t decay1\t\t&quot;); </span>
</span><span class='line'><span class="cm">    Serial.println(decay1);</span>
</span><span class='line'><span class="cm">    Serial.print(&quot;sustain0\t&quot;); </span>
</span><span class='line'><span class="cm">    Serial.print(sustain0);</span>
</span><span class='line'><span class="cm">    Serial.print(&quot;\t sustain1\t&quot;); </span>
</span><span class='line'><span class="cm">    Serial.println(sustain1);</span>
</span><span class='line'><span class="cm">    Serial.print(&quot;release0\t&quot;); </span>
</span><span class='line'><span class="cm">    Serial.print(release_ms0);</span>
</span><span class='line'><span class="cm">    Serial.print(&quot;\t release1\t&quot;); </span>
</span><span class='line'><span class="cm">    Serial.println(release_ms1);</span>
</span><span class='line'><span class="cm">    Serial.println();</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// set duration to longest adsr of the 2</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">dur0</span> <span class="o">=</span> <span class="n">attack0</span><span class="o">+</span><span class="n">decay0</span><span class="o">+</span><span class="n">sustain0</span><span class="o">+</span><span class="n">release_ms0</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">dur1</span> <span class="o">=</span> <span class="n">attack1</span><span class="o">+</span><span class="n">decay1</span><span class="o">+</span><span class="n">sustain1</span><span class="o">+</span><span class="n">release_ms1</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">dur0</span><span class="o">&gt;</span><span class="n">dur1</span><span class="p">){</span>
</span><span class='line'>      <span class="n">noteDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">dur0</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span><span class="p">{</span>
</span><span class='line'>      <span class="n">noteDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">dur1</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">envelope0</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
</span><span class='line'>  <span class="n">envelope1</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">envelope0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aOscil0</span><span class="p">.</span><span class="n">next</span><span class="p">())</span> <span class="o">+</span>
</span><span class='line'>    <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">envelope1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aOscil1</span><span class="p">.</span><span class="n">next</span><span class="p">())</span>
</span><span class='line'>    <span class="o">&gt;&gt;</span><span class="mi">9</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>ADSR_Control_Rate_Envelope <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/ADSR_Control_Rate_Envelope/ADSR_Control_Rate_Envelope.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/ADSR_Control_Rate_Envelope/ADSR_Control_Rate_Envelope.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='ADSR_Control_Rate_Envelopeexpand' onclick='javascript:toggleDisplay(ADSR_Control_Rate_Envelope, ADSR_Control_Rate_Envelopeexpand, ADSR_Control_Rate_Envelopecollapse)'>show sketch</button>
<button id='ADSR_Control_Rate_Envelopecollapse' style='display:none' onclick='javascript:toggleDisplay(ADSR_Control_Rate_Envelope, ADSR_Control_Rate_Envelopeexpand, ADSR_Control_Rate_Envelopecollapse)'>hide sketch</button></p>

<div id='ADSR_Control_Rate_Envelope' style='display:none'>
<figure class='code'><figcaption><span> (ADSR_Control_Rate_Envelope.ino)</span> <a href='/Mozzi/downloads/code/examples/07.Envelopes/ADSR_Control_Rate_Envelope/ADSR_Control_Rate_Envelope.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example applying an ADSR envelope to an audio signal</span>
</span><span class='line'><span class="cm">    with Mozzi sonification library.  This shows </span>
</span><span class='line'><span class="cm">    internal updates as well as interpolation at CONTROL_RATE, using both</span>
</span><span class='line'><span class="cm">    update() and next()  in updateControl().</span>
</span><span class='line'><span class="cm">    This is less computationally intensive than doing interpolation with</span>
</span><span class='line'><span class="cm">    next() in updateAudio(), but can be less smooth, especially with fast envelopes.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Demonstrates a simple ADSR object being controlled with</span>
</span><span class='line'><span class="cm">    noteOn() and noteOff() instructions.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2013-14, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;ADSR.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin8192_int8.h&gt; </span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// faster than usual to help smooth CONTROL_RATE adsr interpolation (next())</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="mi">8192</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aOscil</span><span class="p">(</span><span class="n">SIN8192_DATA</span><span class="p">);;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for triggering the envelope</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">noteDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">envelope</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">boolean</span> <span class="n">note_is_on</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'><span class="n">byte</span> <span class="n">gain</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// fresh random</span>
</span><span class='line'>  <span class="n">noteDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span> <span class="c1">// 2 second countdown</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">duration</span><span class="p">,</span> <span class="n">attack</span><span class="p">,</span> <span class="n">decay</span><span class="p">,</span> <span class="n">sustain</span><span class="p">,</span> <span class="n">release_ms</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">noteDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// choose envelope levels</span>
</span><span class='line'>      <span class="n">byte</span> <span class="n">attack_level</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="o">+</span><span class="mi">127</span><span class="p">;</span>
</span><span class='line'>      <span class="n">byte</span> <span class="n">decay_level</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
</span><span class='line'>      <span class="n">envelope</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="n">attack_level</span><span class="p">,</span><span class="n">decay_level</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// generate a random new adsr parameter value in milliseconds</span>
</span><span class='line'>      <span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span><span class="o">-</span><span class="n">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span><span class='line'>      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">new_value</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>     <span class="c1">// randomly choose one of the adsr parameters and set the new value</span>
</span><span class='line'>     <span class="k">switch</span> <span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">)){</span>
</span><span class='line'>       <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>       <span class="n">attack</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
</span><span class='line'>       <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>       <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>       <span class="n">decay</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
</span><span class='line'>       <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>       <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>       <span class="n">sustain</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
</span><span class='line'>       <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>       <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>       <span class="n">release_ms</span> <span class="o">=</span> <span class="n">new_value</span><span class="p">;</span>
</span><span class='line'>       <span class="k">break</span><span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>     <span class="n">envelope</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span><span class="n">decay</span><span class="p">,</span><span class="n">sustain</span><span class="p">,</span><span class="n">release_ms</span><span class="p">);</span>
</span><span class='line'>     <span class="n">envelope</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>     <span class="n">byte</span> <span class="n">midi_note</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">107</span><span class="p">)</span><span class="o">+</span><span class="mi">20</span><span class="p">;</span>
</span><span class='line'>     <span class="n">aOscil</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">mtof</span><span class="p">(</span><span class="n">midi_note</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>     <span class="c1">// print to screen</span>
</span><span class='line'>     <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;midi_note</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">midi_note</span><span class="p">);</span>
</span><span class='line'>     <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;attack_level</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">attack_level</span><span class="p">);</span>
</span><span class='line'>     <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;decay_level</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">decay_level</span><span class="p">);</span>
</span><span class='line'>     <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;attack</span><span class="se">\t\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">attack</span><span class="p">);</span>
</span><span class='line'>     <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;decay</span><span class="se">\t\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">decay</span><span class="p">);</span>
</span><span class='line'>     <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;sustain</span><span class="se">\t\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">sustain</span><span class="p">);</span>
</span><span class='line'>     <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;release</span><span class="se">\t\t</span><span class="s">&quot;</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">release_ms</span><span class="p">);</span>
</span><span class='line'>     <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>     <span class="n">noteDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">attack</span><span class="o">+</span><span class="n">decay</span><span class="o">+</span><span class="n">sustain</span><span class="o">+</span><span class="n">release_ms</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
</span><span class='line'>  <span class="n">gain</span> <span class="o">=</span> <span class="n">envelope</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// this is where it&#39;s different to an audio rate envelope</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">gain</span> <span class="o">*</span> <span class="n">aOscil</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Ead_Envelope <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/Ead_Envelope/Ead_Envelope.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/Ead_Envelope/Ead_Envelope.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Ead_Envelopeexpand' onclick='javascript:toggleDisplay(Ead_Envelope, Ead_Envelopeexpand, Ead_Envelopecollapse)'>show sketch</button>
<button id='Ead_Envelopecollapse' style='display:none' onclick='javascript:toggleDisplay(Ead_Envelope, Ead_Envelopeexpand, Ead_Envelopecollapse)'>hide sketch</button></p>

<div id='Ead_Envelope' style='display:none'>
<figure class='code'><figcaption><span> (Ead_Envelope.ino)</span> <a href='/Mozzi/downloads/code/examples/07.Envelopes/Ead_Envelope/Ead_Envelope.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example playing an enveloped noise source</span>
</span><span class='line'><span class="cm">     using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">     Demonstrates Ead (exponential attack decay).</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">     Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">     DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">     check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">     Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">     https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">     Tim Barrass 2012, CC by-nc-sa</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/brownnoise8192_int8.h&gt; </span><span class="c1">// recorded audio wavetable</span>
</span><span class='line'><span class="cp">#include &lt;Ead.h&gt; </span><span class="c1">// exponential attack decay</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 256 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">BROWNNOISE8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aNoise</span><span class="p">(</span><span class="n">BROWNNOISE8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">kDelay</span><span class="p">;</span> <span class="c1">// for triggering envelope start</span>
</span><span class='line'><span class="n">Ead</span> <span class="n">kEnvelope</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// resolution will be CONTROL_RATE</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">gain</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// use float to set freq because it will be small and fractional</span>
</span><span class='line'>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">AUDIO_RATE</span><span class="o">/</span><span class="n">BROWNNOISE8192_SAMPLERATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// fresh random, MUST be called before startMozzi - wierd bug</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// jump around in audio noise table to disrupt obvious looping</span>
</span><span class='line'>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setPhase</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">BROWNNOISE8192_NUM_CELLS</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="c1">// set random parameters</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">500u</span><span class="p">)</span><span class="o">+</span><span class="mi">200</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">attack</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">75</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">;</span> <span class="c1">// +5 so the internal step size is more likely to be &gt;0</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">decay</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">-</span> <span class="n">attack</span><span class="p">;</span>
</span><span class='line'>    <span class="n">kEnvelope</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span><span class="n">decay</span><span class="p">);</span>
</span><span class='line'>    <span class="n">kDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">duration</span><span class="o">+</span><span class="mi">500</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">gain</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">kEnvelope</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="n">gain</span><span class="o">*</span><span class="n">aNoise</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Phasemod_Envelope <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/Phasemod_Envelope/Phasemod_Envelope.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/07.Envelopes/Phasemod_Envelope/Phasemod_Envelope.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Phasemod_Envelopeexpand' onclick='javascript:toggleDisplay(Phasemod_Envelope, Phasemod_Envelopeexpand, Phasemod_Envelopecollapse)'>show sketch</button>
<button id='Phasemod_Envelopecollapse' style='display:none' onclick='javascript:toggleDisplay(Phasemod_Envelope, Phasemod_Envelopeexpand, Phasemod_Envelopecollapse)'>hide sketch</button></p>

<div id='Phasemod_Envelope' style='display:none'>
<figure class='code'><figcaption><span> (Phasemod_Envelope.ino)</span> <a href='/Mozzi/downloads/code/examples/07.Envelopes/Phasemod_Envelope/Phasemod_Envelope.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a modulating timbre with a rhythmic</span>
</span><span class='line'><span class="cm">    volume envelope, using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates phase modulation and modifying</span>
</span><span class='line'><span class="cm">    the volume of a sound with an envelope setd in a table.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos8192_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/envelop2048_uint8.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 512 </span><span class="c1">// quite fast, keeps modulation smooth</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModWidth</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModFreq1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModFreq2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">ENVELOP2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aEnvelop</span><span class="p">(</span><span class="n">ENVELOP2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">220</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kModFreq1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.78f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kModFreq2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.1757f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aModWidth</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.1434f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aEnvelop</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">9.0f</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">277.0f</span> <span class="o">+</span> <span class="mf">0.4313f</span><span class="o">*</span><span class="n">kModFreq1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">kModFreq2</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mi">260u</span><span class="o">+</span><span class="n">aModWidth</span><span class="p">.</span><span class="n">next</span><span class="p">()));</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="n">asig</span><span class="o">*</span><span class="p">(</span><span class="n">byte</span><span class="p">)</span><span class="n">aEnvelop</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='08.Samples'>
08.Samples</a></h2>


<hr />

<p>Sample <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample/Sample.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample/Sample.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Sampleexpand' onclick='javascript:toggleDisplay(Sample, Sampleexpand, Samplecollapse)'>show sketch</button>
<button id='Samplecollapse' style='display:none' onclick='javascript:toggleDisplay(Sample, Sampleexpand, Samplecollapse)'>hide sketch</button></p>

<div id='Sample' style='display:none'>
<figure class='code'><figcaption><span> (Sample.ino)</span> <a href='/Mozzi/downloads/code/examples/08.Samples/Sample/Sample.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of playing a sampled sound,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates one-shot samples scheduled</span>
</span><span class='line'><span class="cm">    with EventDelay.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Sample.h&gt; </span><span class="c1">// Sample template</span>
</span><span class='line'><span class="cp">#include &lt;samples/burroughs1_18649_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">BURROUGHS1_18649_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling sample start</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">kTriggerDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">);</span> <span class="c1">// play at the speed it was recorded</span>
</span><span class='line'>  <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1500</span><span class="p">);</span> <span class="c1">// 1500 msec countdown, within resolution of CONTROL_RATE</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="n">aSample</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">aSample</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>SampleHuffman_Umpah <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/SampleHuffman_Umpah/SampleHuffman_Umpah.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/SampleHuffman_Umpah/SampleHuffman_Umpah.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='SampleHuffman_Umpahexpand' onclick='javascript:toggleDisplay(SampleHuffman_Umpah, SampleHuffman_Umpahexpand, SampleHuffman_Umpahcollapse)'>show sketch</button>
<button id='SampleHuffman_Umpahcollapse' style='display:none' onclick='javascript:toggleDisplay(SampleHuffman_Umpah, SampleHuffman_Umpahexpand, SampleHuffman_Umpahcollapse)'>hide sketch</button></p>

<div id='SampleHuffman_Umpah' style='display:none'>
<figure class='code'><figcaption><span> (SampleHuffman_Umpah.ino)</span> <a href='/Mozzi/downloads/code/examples/08.Samples/SampleHuffman_Umpah/SampleHuffman_Umpah.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> Example playing samples encoded with Huffman compression.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Demonstrates the SampleHuffman class.</span>
</span><span class='line'><span class="cm"> SampleHuffman, most of this explanation, and the audio2huff.py script are adapted from &quot;audioout&quot;,</span>
</span><span class='line'><span class="cm"> an Arduino sketch by Thomas Grill, 2011 http//grrrr.org.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Huffman decoding is used on sample differentials,</span>
</span><span class='line'><span class="cm"> saving 50-70% of space for 8 bit data, depending on the sample rate.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> This implementation just plays back one sample each time next() is called, with no</span>
</span><span class='line'><span class="cm"> speed or other adjustments.  It&#39;s slow, so it&#39;s likely you will only be able to play one sound at a time.</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> Audio data, Huffman decoder table, sample rate and bit depth are defined</span>
</span><span class='line'><span class="cm"> in a sounddata.h header file.  This file can be generated for a sound file with the </span>
</span><span class='line'><span class="cm"> accompanying Python script audio2huff.py, in Mozzi/extras/python/</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> Invoke with:</span>
</span><span class='line'><span class="cm"> python audio2huff.py --sndfile=arduinosnd.wav --hdrfile=sounddata.h --bits=8 --name=soundtablename</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> You can resample and dither your audio file with SOX, </span>
</span><span class='line'><span class="cm"> e.g. to 8 bits depth @ Mozzi&#39;s 16384 Hz  sample rate:</span>
</span><span class='line'><span class="cm"> sox fullglory.wav -b 8 -r 16384 arduinosnd.wav</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> Alternatively you can export a sound from Audacity, which seems to have less noticeable or no dithering, </span>
</span><span class='line'><span class="cm"> using Project Rate 16384 Hz and these output options:</span>
</span><span class='line'><span class="cm"> Other uncompressed files, Header: WAV(Microsoft), Encoding: Unsigned 8 bit PCM</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> The header file contains two lengthy arrays:</span>
</span><span class='line'><span class="cm"> One is &quot;SOUNDDATA&quot; which must fit into Flash RAM (available in total: 32k for ATMega328)</span>
</span><span class='line'><span class="cm"> The other is &quot;HUFFMAN&quot; which must also fit into Flash RAM</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> Circuit:</span>
</span><span class='line'><span class="cm">  Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">  DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">  check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'>
</span><span class='line'><span class="cm"> Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;SampleHuffman.h&gt;</span>
</span><span class='line'><span class="cp">#include &quot;umpah_huff.h&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">SampleHuffman</span> <span class="n">umpah</span><span class="p">(</span><span class="n">UMPAH_SOUNDDATA</span><span class="p">,</span><span class="n">UMPAH_HUFFMAN</span><span class="p">,</span><span class="n">UMPAH_SOUNDDATA_BITS</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">umpah</span><span class="p">.</span><span class="n">setLoopingOn</span><span class="p">();</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">umpah</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Sample_Loop_Points <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample_Loop_Points/Sample_Loop_Points.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample_Loop_Points/Sample_Loop_Points.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Sample_Loop_Pointsexpand' onclick='javascript:toggleDisplay(Sample_Loop_Points, Sample_Loop_Pointsexpand, Sample_Loop_Pointscollapse)'>show sketch</button>
<button id='Sample_Loop_Pointscollapse' style='display:none' onclick='javascript:toggleDisplay(Sample_Loop_Points, Sample_Loop_Pointsexpand, Sample_Loop_Pointscollapse)'>hide sketch</button></p>

<div id='Sample_Loop_Points' style='display:none'>
<figure class='code'><figcaption><span> (Sample_Loop_Points.ino)</span> <a href='/Mozzi/downloads/code/examples/08.Samples/Sample_Loop_Points/Sample_Loop_Points.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example playing a looped sampled sound while </span>
</span><span class='line'><span class="cm">    changing the start end end loop points, </span>
</span><span class='line'><span class="cm">    and sliding the frequency around,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates Sample(), looping with random </span>
</span><span class='line'><span class="cm">    changes to loop and frequency parameters</span>
</span><span class='line'><span class="cm">    scheduled with EventDelay.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Sample.h&gt; </span><span class="c1">// Sample template</span>
</span><span class='line'><span class="cp">#include &lt;samples/abomb16384_int8.h&gt; </span><span class="c1">// table for Sample</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">ABOMB_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">ABOMB_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling changes</span>
</span><span class='line'><span class="n">EventDelay</span>  <span class="n">kTriggerDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">float</span> <span class="n">playspeed</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">;</span>
</span><span class='line'><span class="kt">float</span> <span class="n">playspeedmod</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="kt">float</span> <span class="n">speedchange</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">full</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="mf">1000.f</span><span class="o">/</span><span class="n">playspeed</span><span class="p">)</span> <span class="o">-</span> <span class="mi">23</span><span class="p">;</span> <span class="c1">// adjustment approx for CONTROL_RATE difference</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// reseed the random generator for different results each time the sketch runs</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">playspeed</span><span class="o">*</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">ABOMB_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">ABOMB_NUM_CELLS</span><span class="p">));</span>
</span><span class='line'>  <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">full</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setLoopingOn</span><span class="p">();</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">chooseStart</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">ABOMB_NUM_CELLS</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">chooseEnd</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">startpos</span><span class="p">){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">rand</span><span class="p">(</span><span class="n">startpos</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">ABOMB_NUM_CELLS</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">chooseSpeedMod</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
</span><span class='line'>    <span class="n">speedchange</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">rand</span><span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="o">-</span><span class="mi">100</span><span class="p">,(</span><span class="kt">char</span><span class="p">)</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="mi">8000</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">float</span> <span class="n">startspeed</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">rand</span><span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="o">-</span><span class="mi">100</span><span class="p">,(</span><span class="kt">char</span><span class="p">)</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="p">;</span>
</span><span class='line'>    <span class="n">playspeedmod</span> <span class="o">=</span> <span class="n">playspeed</span> <span class="o">+</span> <span class="n">startspeed</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span><span class="p">{</span>
</span><span class='line'>    <span class="n">speedchange</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">playspeedmod</span> <span class="o">=</span> <span class="n">playspeed</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">chooseStartEnd</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">s</span><span class="p">,</span><span class="n">e</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
</span><span class='line'>    <span class="n">s</span> <span class="o">=</span> <span class="n">chooseStart</span><span class="p">();</span>
</span><span class='line'>    <span class="n">e</span> <span class="o">=</span> <span class="n">chooseEnd</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">else</span><span class="p">{</span>
</span><span class='line'>    <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">e</span> <span class="o">=</span> <span class="n">ABOMB_NUM_CELLS</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setStart</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setEnd</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="n">chooseStartEnd</span><span class="p">();</span>
</span><span class='line'>    <span class="n">chooseSpeedMod</span><span class="p">();</span>
</span><span class='line'>    <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">playspeedmod</span> <span class="o">+=</span> <span class="n">speedchange</span><span class="p">;</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">playspeedmod</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">aSample</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Sample_Scrub <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample_Scrub/Sample_Scrub.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Sample_Scrub/Sample_Scrub.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Sample_Scrubexpand' onclick='javascript:toggleDisplay(Sample_Scrub, Sample_Scrubexpand, Sample_Scrubcollapse)'>show sketch</button>
<button id='Sample_Scrubcollapse' style='display:none' onclick='javascript:toggleDisplay(Sample_Scrub, Sample_Scrubexpand, Sample_Scrubcollapse)'>hide sketch</button></p>

<div id='Sample_Scrub' style='display:none'>
<figure class='code'><figcaption><span> (Sample_Scrub.ino)</span> <a href='/Mozzi/downloads/code/examples/08.Samples/Sample_Scrub/Sample_Scrub.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of simple &quot;scrubbing&quot; through a sampled sound</span>
</span><span class='line'><span class="cm">     using Mozzi sonification library.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">    Demonstrates getting audio samples from a table using a Line to</span>
</span><span class='line'><span class="cm">    slide between different offsets.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">   Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">   check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">   Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">   https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'>
</span><span class='line'><span class="cm">   Tim Barrass 2012-13.</span>
</span><span class='line'><span class="cm">   CC by-nc-sa</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Sample.h&gt; </span><span class="c1">// Sample template</span>
</span><span class='line'><span class="cp">#include &lt;samples/burroughs1_18649_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Line.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Smooth.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Sample &lt;table_size, update_rate, interpolation &gt; SampleName (wavetable)</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="p">,</span> <span class="n">INTERP_LINEAR</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">(</span><span class="n">BURROUGHS1_18649_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//Line to scrub through sample at audio rate, Line target is set at control rate</span>
</span><span class='line'><span class="n">Line</span> <span class="o">&lt;</span><span class="n">Q16n16</span><span class="o">&gt;</span> <span class="n">scrub</span><span class="p">;</span> <span class="c1">// Q16n16 fixed point for high precision</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// the number of audio steps the line has to take to reach the next offset</span>
</span><span class='line'><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">AUDIO_STEPS_PER_CONTROL</span> <span class="o">=</span> <span class="n">AUDIO_RATE</span> <span class="o">/</span> <span class="n">CONTROL_RATE</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">offset_advance</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span> <span class="c1">// just a guess</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use this smooth out the wandering/jumping rate of scrubbing, gives more convincing reverses</span>
</span><span class='line'><span class="kt">float</span> <span class="n">smoothness</span> <span class="o">=</span> <span class="mf">0.9f</span><span class="p">;</span>
</span><span class='line'><span class="n">Smooth</span> <span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">kSmoothOffsetAdvance</span><span class="p">(</span><span class="n">smoothness</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// fresh randomness</span>
</span><span class='line'>  <span class="n">aSample</span><span class="p">.</span><span class="n">setLoopingOn</span><span class="p">();</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// wandering advance rate</span>
</span><span class='line'>  <span class="n">offset_advance</span> <span class="o">+=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">rand</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">-</span><span class="n">rand</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rand</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">))</span> <span class="n">offset_advance</span> <span class="o">=</span> <span class="o">-</span><span class="n">offset_advance</span><span class="p">;</span> <span class="c1">// reverse sometimes</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rand</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">))</span> <span class="n">offset_advance</span> <span class="o">=</span> <span class="mi">500</span><span class="o">-</span><span class="n">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// jump speed sometimes</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">smooth_offset_advance</span> <span class="o">=</span> <span class="n">kSmoothOffsetAdvance</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">offset_advance</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">offset</span> <span class="o">+=</span> <span class="n">smooth_offset_advance</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// keep offset in range</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&gt;=</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">)</span> <span class="n">offset</span> <span class="o">-=</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">offset</span> <span class="o">+=</span> <span class="n">BURROUGHS1_18649_NUM_CELLS</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set new target for interpolating line to scrub to</span>
</span><span class='line'>  <span class="n">scrub</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">Q16n0_to_Q16n16</span><span class="p">(</span><span class="n">offset</span><span class="p">),</span> <span class="n">AUDIO_STEPS_PER_CONTROL</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">Q16n16_to_Q16n0</span><span class="p">(</span><span class="n">scrub</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSample</span><span class="p">.</span><span class="n">atIndex</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Samples <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Samples/Samples.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Samples/Samples.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Samplesexpand' onclick='javascript:toggleDisplay(Samples, Samplesexpand, Samplescollapse)'>show sketch</button>
<button id='Samplescollapse' style='display:none' onclick='javascript:toggleDisplay(Samples, Samplesexpand, Samplescollapse)'>hide sketch</button></p>

<div id='Samples' style='display:none'>
<figure class='code'><figcaption><span> (Samples.ino)</span> <a href='/Mozzi/downloads/code/examples/08.Samples/Samples/Samples.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of playing sampled sounds,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates one-shot samples scheduled</span>
</span><span class='line'><span class="cm">    with EventDelay(), and fast random numbers with </span>
</span><span class='line'><span class="cm">    xorshift96() and rand(), a more friendly wrapper for xorshift96().</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Sample.h&gt; </span><span class="c1">// Sample template</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_00_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_01_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_02_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Sample &lt;table_size, update_rate&gt; SampleName (wavetable)</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_00_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span><span class="n">aBamboo0</span><span class="p">(</span><span class="n">BAMBOO_00_2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_01_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span><span class="n">aBamboo1</span><span class="p">(</span><span class="n">BAMBOO_01_2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_02_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span><span class="n">aBamboo2</span><span class="p">(</span><span class="n">BAMBOO_02_2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling audio gain changes</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">kTriggerDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aBamboo0</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_00_2048_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_00_2048_NUM_CELLS</span><span class="p">);</span> <span class="c1">// play at the speed it was recorded at</span>
</span><span class='line'>  <span class="n">aBamboo1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_01_2048_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_01_2048_NUM_CELLS</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aBamboo2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_02_2048_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_02_2048_NUM_CELLS</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">111</span><span class="p">);</span> <span class="c1">// countdown ms, within resolution of CONTROL_RATE</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">byte</span> <span class="n">randomGain</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//return lowByte(xorshift96())&lt;&lt;1;</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">rand</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="o">+</span> <span class="mi">55</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// referencing members from a struct is meant to be a bit faster than seperately</span>
</span><span class='line'><span class="c1">// ....haven&#39;t actually tested it here...</span>
</span><span class='line'><span class="k">struct</span> <span class="n">gainstruct</span><span class="p">{</span>
</span><span class='line'>  <span class="n">byte</span> <span class="n">gain0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">byte</span> <span class="n">gain1</span><span class="p">;</span>
</span><span class='line'>  <span class="n">byte</span> <span class="n">gain2</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="n">gains</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="k">switch</span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span>
</span><span class='line'>      <span class="n">gains</span><span class="p">.</span><span class="n">gain0</span> <span class="o">=</span> <span class="n">randomGain</span><span class="p">();</span>
</span><span class='line'>      <span class="n">aBamboo0</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>      <span class="n">gains</span><span class="p">.</span><span class="n">gain1</span> <span class="o">=</span> <span class="n">randomGain</span><span class="p">();</span>
</span><span class='line'>      <span class="n">aBamboo1</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>      <span class="n">gains</span><span class="p">.</span><span class="n">gain2</span> <span class="o">=</span> <span class="n">randomGain</span><span class="p">();</span>
</span><span class='line'>      <span class="n">aBamboo2</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span><span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span>
</span><span class='line'>    <span class="p">((</span><span class="kt">long</span><span class="p">)</span> <span class="n">aBamboo0</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gains</span><span class="p">.</span><span class="n">gain0</span> <span class="o">+</span>
</span><span class='line'>      <span class="n">aBamboo1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gains</span><span class="p">.</span><span class="n">gain1</span> <span class="o">+</span>
</span><span class='line'>      <span class="n">aBamboo2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gains</span><span class="p">.</span><span class="n">gain2</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">//clip to keep audio loud but still in range</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">asig</span> <span class="o">&gt;</span> <span class="mi">243</span><span class="p">)</span> <span class="n">asig</span> <span class="o">=</span> <span class="mi">243</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">asig</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">244</span><span class="p">)</span> <span class="n">asig</span> <span class="o">=</span> <span class="o">-</span><span class="mi">244</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Samples_Tables_Arrays <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Samples_Tables_Arrays/Samples_Tables_Arrays.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Samples_Tables_Arrays/Samples_Tables_Arrays.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Samples_Tables_Arraysexpand' onclick='javascript:toggleDisplay(Samples_Tables_Arrays, Samples_Tables_Arraysexpand, Samples_Tables_Arrayscollapse)'>show sketch</button>
<button id='Samples_Tables_Arrayscollapse' style='display:none' onclick='javascript:toggleDisplay(Samples_Tables_Arrays, Samples_Tables_Arraysexpand, Samples_Tables_Arrayscollapse)'>hide sketch</button></p>

<div id='Samples_Tables_Arrays' style='display:none'>
<figure class='code'><figcaption><span> (Samples_Tables_Arrays.ino)</span> <a href='/Mozzi/downloads/code/examples/08.Samples/Samples_Tables_Arrays/Samples_Tables_Arrays.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a polyphonic sketch in which </span>
</span><span class='line'><span class="cm">    11 sound tables are shared between 3 voices,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates use of Sample() objects as players, </span>
</span><span class='line'><span class="cm">    using setTable() to share many sound tables between </span>
</span><span class='line'><span class="cm">    a few players, to minimise processing in updateAudio().</span>
</span><span class='line'><span class="cm">    Shows how to use Samples and sound tables in arrays,</span>
</span><span class='line'><span class="cm">    EventDelay() for scheduling, and rand() to select </span>
</span><span class='line'><span class="cm">    sound tables and vary the gain of each player.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Sample.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt; </span><span class="c1">// for rand()</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_00_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_01_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_02_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_03_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_04_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_05_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_06_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_07_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_08_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_09_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'><span class="cp">#include &lt;samples/bamboo/bamboo_10_2048_int8.h&gt; </span><span class="c1">// wavetable data</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling samples to play</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">kTriggerDelay</span><span class="p">;</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">kTriggerSlowDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">byte</span> <span class="n">ms_per_note</span> <span class="o">=</span> <span class="mi">111</span><span class="p">;</span> <span class="c1">// subject to CONTROL_RATE</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="n">byte</span> <span class="n">NUM_PLAYERS</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// 3 seems to be enough</span>
</span><span class='line'><span class="k">const</span> <span class="n">byte</span> <span class="n">NUM_TABLES</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_00_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSample</span><span class="p">[</span><span class="n">NUM_PLAYERS</span><span class="p">]</span> <span class="o">=</span><span class="p">{</span>
</span><span class='line'>  <span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_00_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">BAMBOO_00_2048_DATA</span><span class="p">),</span>
</span><span class='line'>  <span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_01_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">BAMBOO_01_2048_DATA</span><span class="p">),</span>
</span><span class='line'>  <span class="n">Sample</span> <span class="o">&lt;</span><span class="n">BAMBOO_02_2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">BAMBOO_02_2048_DATA</span><span class="p">),</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// watch out - tables are const (but you can choose which ones you reference)</span>
</span><span class='line'><span class="k">const</span> <span class="n">int8_t</span> <span class="o">*</span> <span class="n">tables</span><span class="p">[</span><span class="n">NUM_TABLES</span><span class="p">]</span> <span class="o">=</span><span class="p">{</span>
</span><span class='line'>  <span class="n">BAMBOO_00_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_01_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_02_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_03_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_04_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_05_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_06_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_07_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_08_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_09_2048_DATA</span><span class="p">,</span>
</span><span class='line'>  <span class="n">BAMBOO_10_2048_DATA</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// gains for each sample player</span>
</span><span class='line'><span class="n">byte</span> <span class="n">gain</span><span class="p">[</span><span class="n">NUM_PLAYERS</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_PLAYERS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>  <span class="c1">// play at the speed they&#39;re sampled at</span>
</span><span class='line'>    <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_00_2048_SAMPLERATE</span> <span class="o">/</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span> <span class="n">BAMBOO_00_2048_NUM_CELLS</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">ms_per_note</span><span class="p">);</span> <span class="c1">// countdown ms, within resolution of CONTROL_RATE</span>
</span><span class='line'>  <span class="n">kTriggerSlowDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">ms_per_note</span><span class="o">*</span><span class="mi">6</span><span class="p">);</span> <span class="c1">// resolution-dependent inaccuracy leads to polyrhythm :)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">byte</span> <span class="n">randomGain</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">rand</span><span class="p">((</span><span class="n">byte</span><span class="p">)</span><span class="mi">80</span><span class="p">,(</span><span class="n">byte</span><span class="p">)</span><span class="mi">255</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">byte</span> <span class="n">player</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="n">gain</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="o">=</span> <span class="n">randomGain</span><span class="p">();</span>
</span><span class='line'>    <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">player</span><span class="p">]).</span><span class="n">setTable</span><span class="p">(</span><span class="n">tables</span><span class="p">[</span><span class="n">rand</span><span class="p">(</span><span class="n">NUM_TABLES</span><span class="p">)]);</span>
</span><span class='line'>    <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">player</span><span class="p">]).</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="n">player</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">player</span><span class="o">==</span><span class="n">NUM_PLAYERS</span><span class="p">)</span> <span class="n">player</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">kTriggerDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kTriggerSlowDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="n">gain</span><span class="p">[</span><span class="n">player</span><span class="p">]</span> <span class="o">=</span> <span class="n">randomGain</span><span class="p">();</span>
</span><span class='line'>    <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">player</span><span class="p">]).</span><span class="n">setTable</span><span class="p">(</span><span class="n">tables</span><span class="p">[</span><span class="n">rand</span><span class="p">(</span><span class="n">NUM_TABLES</span><span class="p">)]);</span>
</span><span class='line'>    <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">player</span><span class="p">]).</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="n">player</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">player</span><span class="o">==</span><span class="n">NUM_PLAYERS</span><span class="p">)</span> <span class="n">player</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>    <span class="n">kTriggerSlowDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">long</span> <span class="n">asig</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">for</span> <span class="p">(</span><span class="n">byte</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">NUM_PLAYERS</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>    <span class="n">asig</span> <span class="o">+=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">aSample</span><span class="p">[</span><span class="n">i</span><span class="p">]).</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">gain</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">asig</span> <span class="o">&gt;&gt;=</span> <span class="mi">6</span><span class="p">;</span> <span class="c1">// shift into usable range</span>
</span><span class='line'>  <span class="c1">//clip any stray peaks to max output range</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">constrain</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">asig</span><span class="p">,</span><span class="o">-</span><span class="mi">244</span><span class="p">,</span><span class="mi">243</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Wavetable_Swap <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Wavetable_Swap/Wavetable_Swap.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/08.Samples/Wavetable_Swap/Wavetable_Swap.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Wavetable_Swapexpand' onclick='javascript:toggleDisplay(Wavetable_Swap, Wavetable_Swapexpand, Wavetable_Swapcollapse)'>show sketch</button>
<button id='Wavetable_Swapcollapse' style='display:none' onclick='javascript:toggleDisplay(Wavetable_Swap, Wavetable_Swapexpand, Wavetable_Swapcollapse)'>hide sketch</button></p>

<div id='Wavetable_Swap' style='display:none'>
<figure class='code'><figcaption><span> (Wavetable_Swap.ino)</span> <a href='/Mozzi/downloads/code/examples/08.Samples/Wavetable_Swap/Wavetable_Swap.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example swapping between sounds played by a single Oscil</span>
</span><span class='line'><span class="cm">    with Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates declaring an Oscil without a table,</span>
</span><span class='line'><span class="cm">    and Oscil::setTable() method.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// tables need to be the same size</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin512_int8.h&gt; </span>
</span><span class='line'><span class="cp">#include &lt;tables/saw_analogue512_int8.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// declare with or without a wavetable, and use setTable() later</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="mi">512</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aOscil</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// for scheduling table swaps</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">kSwapTablesDelay</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">boolean</span> <span class="n">using_sin</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kSwapTablesDelay</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span> <span class="c1">// 1 second countdown, within resolution of CONTROL_RATE</span>
</span><span class='line'>  <span class="n">aOscil</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">440.f</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">kSwapTablesDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">using_sin</span><span class="p">){</span>
</span><span class='line'>        <span class="n">aOscil</span><span class="p">.</span><span class="n">setTable</span><span class="p">(</span><span class="n">SAW_ANALOGUE512_DATA</span><span class="p">);</span>
</span><span class='line'>        <span class="n">using_sin</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
</span><span class='line'>         <span class="n">aOscil</span><span class="p">.</span><span class="n">setTable</span><span class="p">(</span><span class="n">SIN512_DATA</span><span class="p">);</span>
</span><span class='line'>         <span class="n">using_sin</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="n">kSwapTablesDelay</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aOscil</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='09.Delays'>
09.Delays</a></h2>


<hr />

<p>AudioDelay <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelay/AudioDelay.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelay/AudioDelay.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='AudioDelayexpand' onclick='javascript:toggleDisplay(AudioDelay, AudioDelayexpand, AudioDelaycollapse)'>show sketch</button>
<button id='AudioDelaycollapse' style='display:none' onclick='javascript:toggleDisplay(AudioDelay, AudioDelayexpand, AudioDelaycollapse)'>hide sketch</button></p>

<div id='AudioDelay' style='display:none'>
<figure class='code'><figcaption><span> (AudioDelay.ino)</span> <a href='/Mozzi/downloads/code/examples/09.Delays/AudioDelay/AudioDelay.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of modulating a signal by using a variable delay,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates AudioDelay.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle_analogue512_int8.h&gt; </span><span class="c1">// wavetable</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// wavetable</span>
</span><span class='line'><span class="cp">#include &lt;AudioDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt; </span><span class="c1">// for mtof</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 256 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_ANALOGUE512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle</span><span class="p">(</span><span class="n">TRIANGLE_ANALOGUE512_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFreq</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">AudioDelay</span> <span class="o">&lt;</span><span class="mi">256</span><span class="o">&gt;</span> <span class="n">aDel</span><span class="p">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">del_samps</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aTriangle</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">60.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">kFreq</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.63f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">del_samps</span> <span class="o">=</span> <span class="mi">128</span><span class="o">+</span><span class="n">kFreq</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">aDel</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aTriangle</span><span class="p">.</span><span class="n">next</span><span class="p">(),</span> <span class="n">del_samps</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>AudioDelayFeedback <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedback/AudioDelayFeedback.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedback/AudioDelayFeedback.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='AudioDelayFeedbackexpand' onclick='javascript:toggleDisplay(AudioDelayFeedback, AudioDelayFeedbackexpand, AudioDelayFeedbackcollapse)'>show sketch</button>
<button id='AudioDelayFeedbackcollapse' style='display:none' onclick='javascript:toggleDisplay(AudioDelayFeedback, AudioDelayFeedbackexpand, AudioDelayFeedbackcollapse)'>hide sketch</button></p>

<div id='AudioDelayFeedback' style='display:none'>
<figure class='code'><figcaption><span> (AudioDelayFeedback.ino)</span> <a href='/Mozzi/downloads/code/examples/09.Delays/AudioDelayFeedback/AudioDelayFeedback.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of flanging,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates AudioDelayFeedback.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012-13, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle_analogue512_int8.h&gt; </span><span class="c1">// wavetable</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle512_int8.h&gt; </span><span class="c1">// wavetable</span>
</span><span class='line'><span class="cp">#include &lt;AudioDelayFeedback.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt; </span><span class="c1">// for mtof</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_ANALOGUE512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle</span><span class="p">(</span><span class="n">TRIANGLE_ANALOGUE512_DATA</span><span class="p">);</span> <span class="c1">// audio oscillator</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kDelSamps</span><span class="p">(</span><span class="n">TRIANGLE512_DATA</span><span class="p">);</span> <span class="c1">// for modulating delay time, measured in audio samples</span>
</span><span class='line'>
</span><span class='line'><span class="n">AudioDelayFeedback</span> <span class="o">&lt;</span><span class="mi">128</span><span class="o">&gt;</span> <span class="n">aDel</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// the delay time, measured in samples, updated in updateControl, and used in updateAudio </span>
</span><span class='line'><span class="n">byte</span> <span class="n">del_samps</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aTriangle</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">48.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">kDelSamps</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.163f</span><span class="p">);</span> <span class="c1">// set the delay time modulation frequency (ie. the sweep frequency)</span>
</span><span class='line'>  <span class="n">aDel</span><span class="p">.</span><span class="n">setFeedbackLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">111</span><span class="p">);</span> <span class="c1">// can be -128 to 127</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">deltime</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// delay time range from 0 to 127 samples, @ 16384 samps per sec = 0 to 7 milliseconds</span>
</span><span class='line'>  <span class="c1">//del_samps = 64+kDelSamps.next();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// delay time range from 1 to 33 samples, @ 16384 samps per sec = 0 to 2 milliseconds</span>
</span><span class='line'>  <span class="c1">//del_samps = 17+kDelSamps.next()/8;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">deltime</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">kDelSamps</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">12</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">aTriangle</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// get this so it can be used twice without calling next() again</span>
</span><span class='line'>  <span class="c1">//return asig/8 + aDel.next(asig, del_samps); // mix some straight signal with the delayed signal</span>
</span><span class='line'>  <span class="c1">//return aDel.next(aTriangle.next(), del_samps); // instead of the previous 2 lines for only the delayed signal</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">asig</span><span class="o">/</span><span class="mi">8</span> <span class="o">+</span> <span class="n">aDel</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig</span><span class="p">,</span> <span class="n">deltime</span><span class="p">);</span> <span class="c1">// mix some straight signal with the delayed signal</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>AudioDelayFeedbackAllpass <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedbackAllpass/AudioDelayFeedbackAllpass.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedbackAllpass/AudioDelayFeedbackAllpass.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='AudioDelayFeedbackAllpassexpand' onclick='javascript:toggleDisplay(AudioDelayFeedbackAllpass, AudioDelayFeedbackAllpassexpand, AudioDelayFeedbackAllpasscollapse)'>show sketch</button>
<button id='AudioDelayFeedbackAllpasscollapse' style='display:none' onclick='javascript:toggleDisplay(AudioDelayFeedbackAllpass, AudioDelayFeedbackAllpassexpand, AudioDelayFeedbackAllpasscollapse)'>hide sketch</button></p>

<div id='AudioDelayFeedbackAllpass' style='display:none'>
<figure class='code'><figcaption><span> (AudioDelayFeedbackAllpass.ino)</span> <a href='/Mozzi/downloads/code/examples/09.Delays/AudioDelayFeedbackAllpass/AudioDelayFeedbackAllpass.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of allpass interpolation for fractional delays,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates AudioDelayFeedback with allpass interpolation,</span>
</span><span class='line'><span class="cm">    random delaytimes and feedback levels on a </span>
</span><span class='line'><span class="cm">    (random) percussive adsr whitenoise sound.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012-13, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;AudioDelayFeedback.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Ead.h&gt; </span><span class="c1">// exponential attack decay</span>
</span><span class='line'><span class="cp">#include &lt;EventDelay.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/whitenoise8192_int8.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">WHITENOISE8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aNoise</span><span class="p">(</span><span class="n">WHITENOISE8192_DATA</span><span class="p">);</span> <span class="c1">// audio noise</span>
</span><span class='line'><span class="n">EventDelay</span> <span class="n">kDelay</span><span class="p">;</span> <span class="c1">// for triggering envelope start</span>
</span><span class='line'><span class="n">Ead</span> <span class="n">kEnvelope</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// resolution will be CONTROL_RATE</span>
</span><span class='line'>
</span><span class='line'><span class="n">AudioDelayFeedback</span> <span class="o">&lt;</span><span class="mi">256</span><span class="p">,</span> <span class="n">ALLPASS</span><span class="o">&gt;</span> <span class="n">aDel</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">gain</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">randSeed</span><span class="p">();</span> <span class="c1">// reseed the random generator for different results each time the sketch runs</span>
</span><span class='line'>  <span class="c1">// use float to set freq because it will be small and fractional</span>
</span><span class='line'>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">AUDIO_RATE</span><span class="o">/</span><span class="n">WHITENOISE8192_SAMPLERATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// jump around in audio noise table to disrupt obvious looping</span>
</span><span class='line'>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setPhase</span><span class="p">(</span><span class="n">rand</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">WHITENOISE8192_NUM_CELLS</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="n">kDelay</span><span class="p">.</span><span class="n">ready</span><span class="p">()){</span>
</span><span class='line'>    <span class="c1">// set random adsr parameters</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">500u</span><span class="p">)</span><span class="o">+</span><span class="mi">200</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">attack</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="mi">75</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">decay</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">-</span> <span class="n">attack</span><span class="p">;</span>
</span><span class='line'>    <span class="n">kEnvelope</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span><span class="n">decay</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// set random delay parameters</span>
</span><span class='line'>    <span class="kt">float</span> <span class="n">del_cells</span> <span class="o">=</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">rand</span><span class="p">(</span><span class="mi">65535u</span><span class="p">)</span><span class="o">/</span><span class="mi">256</span><span class="p">;</span>
</span><span class='line'>    <span class="n">aDel</span><span class="p">.</span><span class="n">setDelayTimeCells</span><span class="p">(</span><span class="n">del_cells</span><span class="p">);</span> <span class="c1">// Allpass interpolation for fractional delay time</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">fb</span> <span class="o">=</span> <span class="n">rand</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">);</span>
</span><span class='line'>    <span class="n">aDel</span><span class="p">.</span><span class="n">setFeedbackLevel</span><span class="p">(</span><span class="n">fb</span><span class="p">);</span>
</span><span class='line'>    <span class="n">kDelay</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">duration</span><span class="o">+</span><span class="mi">500</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">gain</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">kEnvelope</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aDel</span><span class="p">.</span><span class="n">next</span><span class="p">((</span><span class="n">gain</span><span class="o">*</span><span class="n">aNoise</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>AudioDelayFeedbackX2 <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedbackX2/AudioDelayFeedbackX2.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedbackX2/AudioDelayFeedbackX2.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='AudioDelayFeedbackX2expand' onclick='javascript:toggleDisplay(AudioDelayFeedbackX2, AudioDelayFeedbackX2expand, AudioDelayFeedbackX2collapse)'>show sketch</button>
<button id='AudioDelayFeedbackX2collapse' style='display:none' onclick='javascript:toggleDisplay(AudioDelayFeedbackX2, AudioDelayFeedbackX2expand, AudioDelayFeedbackX2collapse)'>hide sketch</button></p>

<div id='AudioDelayFeedbackX2' style='display:none'>
<figure class='code'><figcaption><span> (AudioDelayFeedbackX2.ino)</span> <a href='/Mozzi/downloads/code/examples/09.Delays/AudioDelayFeedbackX2/AudioDelayFeedbackX2.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of flanging,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates 2 oscillators going through 2 AudioDelayFeedback units,</span>
</span><span class='line'><span class="cm">    with straight signal mixed in.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012-13, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle_analogue512_int8.h&gt; </span><span class="c1">// wavetable for audio</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle512_int8.h&gt; </span><span class="c1">// wavetable for delay sweep</span>
</span><span class='line'><span class="cp">#include &lt;AudioDelayFeedback.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt; </span><span class="c1">// for mtof</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_ANALOGUE512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle1</span><span class="p">(</span><span class="n">TRIANGLE_ANALOGUE512_DATA</span><span class="p">);</span> <span class="c1">// audio oscillator</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_ANALOGUE512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle2</span><span class="p">(</span><span class="n">TRIANGLE_ANALOGUE512_DATA</span><span class="p">);</span> <span class="c1">// audio oscillator</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kDelSamps1</span><span class="p">(</span><span class="n">TRIANGLE512_DATA</span><span class="p">);</span> <span class="c1">// for modulating delay time, measured in audio samples</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kDelSamps2</span><span class="p">(</span><span class="n">TRIANGLE512_DATA</span><span class="p">);</span> <span class="c1">// for modulating delay time, measured in audio samples</span>
</span><span class='line'>
</span><span class='line'><span class="n">AudioDelayFeedback</span> <span class="o">&lt;</span><span class="mi">128</span><span class="o">&gt;</span> <span class="n">aDel1</span><span class="p">;</span>
</span><span class='line'><span class="n">AudioDelayFeedback</span> <span class="o">&lt;</span><span class="mi">128</span><span class="o">&gt;</span> <span class="n">aDel2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// the delay time, measured in samples, updated in updateControl, and used in updateAudio </span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">del_samps1</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">del_samps2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aTriangle1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">48.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">kDelSamps1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.163f</span><span class="p">);</span> <span class="c1">// set the delay time modulation frequency (ie. the sweep frequency)</span>
</span><span class='line'>  <span class="n">aDel1</span><span class="p">.</span><span class="n">setFeedbackLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">111</span><span class="p">);</span> <span class="c1">// can be -128 to 127</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">aTriangle2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">52.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">kDelSamps2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.43f</span><span class="p">);</span> <span class="c1">// set the delay time modulation frequency (ie. the sweep frequency)</span>
</span><span class='line'>  <span class="n">aDel2</span><span class="p">.</span><span class="n">setFeedbackLevel</span><span class="p">(</span><span class="mi">109</span><span class="p">);</span> <span class="c1">// can be -128 to 127</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// delay time range from 0 to 127 samples, @ 16384 samps per sec = 0 to 7 milliseconds</span>
</span><span class='line'>  <span class="n">del_samps1</span> <span class="o">=</span> <span class="mi">64</span><span class="o">+</span><span class="n">kDelSamps1</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// delay time range from 1 to 33 samples, @ 16384 samps per sec = 0 to 2 milliseconds</span>
</span><span class='line'>  <span class="n">del_samps2</span> <span class="o">=</span> <span class="mi">17</span><span class="o">+</span><span class="n">kDelSamps2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">/</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig1</span> <span class="o">=</span> <span class="n">aTriangle1</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// get this so it can be used twice without calling next() again</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">aflange1</span> <span class="o">=</span> <span class="p">(</span><span class="n">asig1</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">aDel1</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig1</span><span class="p">,</span> <span class="n">del_samps1</span><span class="p">);</span> <span class="c1">// mix some straignt signal with the delayed signal</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig2</span> <span class="o">=</span> <span class="n">aTriangle2</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// get this so it can be used twice without calling next() again</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">aflange2</span> <span class="o">=</span> <span class="p">(</span><span class="n">asig2</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">aDel2</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig2</span><span class="p">,</span> <span class="n">del_samps2</span><span class="p">);</span> <span class="c1">// mix some straignt signal with the delayed signal</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="n">aflange1</span> <span class="o">+</span> <span class="n">aflange2</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>AudioDelayFeedback_HIFI <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedback_HIFI/AudioDelayFeedback_HIFI.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/AudioDelayFeedback_HIFI/AudioDelayFeedback_HIFI.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='AudioDelayFeedback_HIFIexpand' onclick='javascript:toggleDisplay(AudioDelayFeedback_HIFI, AudioDelayFeedback_HIFIexpand, AudioDelayFeedback_HIFIcollapse)'>show sketch</button>
<button id='AudioDelayFeedback_HIFIcollapse' style='display:none' onclick='javascript:toggleDisplay(AudioDelayFeedback_HIFI, AudioDelayFeedback_HIFIexpand, AudioDelayFeedback_HIFIcollapse)'>hide sketch</button></p>

<div id='AudioDelayFeedback_HIFI' style='display:none'>
<figure class='code'><figcaption><span> (AudioDelayFeedback_HIFI.ino)</span> <a href='/Mozzi/downloads/code/examples/09.Delays/AudioDelayFeedback_HIFI/AudioDelayFeedback_HIFI.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of flanging,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates AudioDelayFeedback.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    This sketch using HIFI mode is not for Teensy 3.1.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be</span>
</span><span class='line'><span class="cm">    be changed from STANDARD mode to HIFI.</span>
</span><span class='line'><span class="cm">    In Mozz/mozzi_config.h, change</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm">    #define AUDIO_MODE STANDARD_PLUS</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm">    to</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE STANDARD_PLUS</span>
</span><span class='line'><span class="cm">    #define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  The sketch also sounds better with a faster sample rate, for less aliasing</span>
</span><span class='line'><span class="cm">  #define AUDIO_RATE 32768</span>
</span><span class='line'><span class="cm">  in mozzi_config.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),</span>
</span><span class='line'><span class="cm">    Check the Mozzi core module documentation for others and more detail</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">                     3.9k </span>
</span><span class='line'><span class="cm">     pin 9  ---WWWW-----|-----output</span>
</span><span class='line'><span class="cm">                    499k           |</span>
</span><span class='line'><span class="cm">     pin 10 ---WWWW---- |</span>
</span><span class='line'><span class="cm">                                       |</span>
</span><span class='line'><span class="cm">                             4.7n  ==</span>
</span><span class='line'><span class="cm">                                       |</span>
</span><span class='line'><span class="cm">                                   ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Resistors are Â±0.5%  Measure and choose the most precise </span>
</span><span class='line'><span class="cm">    from a batch of whatever you can get.  Use two 1M resistors</span>
</span><span class='line'><span class="cm">    in parallel if you can&#39;t find 499k.</span>
</span><span class='line'><span class="cm">    Alternatively using 39 ohm, 4.99k and 470nF components will </span>
</span><span class='line'><span class="cm">    work directly with headphones.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012-13, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle_analogue512_int8.h&gt; </span><span class="c1">// wavetable</span>
</span><span class='line'><span class="cp">#include &lt;tables/triangle512_int8.h&gt; </span><span class="c1">// wavetable</span>
</span><span class='line'><span class="cp">#include &lt;AudioDelayFeedback.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt; </span><span class="c1">// for mtof</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE_ANALOGUE512_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aTriangle</span><span class="p">(</span><span class="n">TRIANGLE_ANALOGUE512_DATA</span><span class="p">);</span> <span class="c1">// audio oscillator</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">TRIANGLE512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kDelSamps</span><span class="p">(</span><span class="n">TRIANGLE512_DATA</span><span class="p">);</span> <span class="c1">// for modulating delay time, measured in audio samples</span>
</span><span class='line'>
</span><span class='line'><span class="n">AudioDelayFeedback</span> <span class="o">&lt;</span><span class="mi">128</span><span class="o">&gt;</span> <span class="n">aDel</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// the delay time, measured in samples, updated in updateControl, and used in updateAudio </span>
</span><span class='line'><span class="n">byte</span> <span class="n">del_samps</span><span class="p">;</span>
</span><span class='line'><span class="n">Q16n16</span> <span class="n">del_samps_fractional</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aTriangle</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="mf">48.f</span><span class="p">));</span>
</span><span class='line'>  <span class="n">kDelSamps</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">.163f</span><span class="p">);</span> <span class="c1">// set the delay time modulation frequency (ie. the sweep frequency)</span>
</span><span class='line'>  <span class="n">aDel</span><span class="p">.</span><span class="n">setFeedbackLevel</span><span class="p">(</span><span class="o">-</span><span class="mi">111</span><span class="p">);</span> <span class="c1">// can be -128 to 127</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// delay time range from 0 to 127 samples, @ 16384 samps per sec = 0 to 7 milliseconds</span>
</span><span class='line'>  <span class="c1">//del_samps = 64+kDelSamps.next();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// delay time range from 1 to 33 samples, @ 16384 samps per sec = 0 to 2 milliseconds</span>
</span><span class='line'>  <span class="c1">//del_samps = 17+kDelSamps.next()/8;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">del_samps_fractional</span> <span class="o">=</span> <span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">kDelSamps</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">12</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">aTriangle</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// get this so it can be used twice without calling next() again</span>
</span><span class='line'>  <span class="c1">//return asig/8 + aDel.next(asig, del_samps); // mix some straight signal with the delayed signal</span>
</span><span class='line'>  <span class="c1">//return aDel.next(aTriangle.next(), del_samps); // instead of the previous 2 lines for only the delayed signal</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="n">asig</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">aDel</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">asig</span><span class="p">,</span> <span class="n">del_samps_fractional</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">);</span> <span class="c1">// mix some straight signal with the delayed signal</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>ReverbTank_STANDARD <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/ReverbTank_STANDARD/ReverbTank_STANDARD.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/09.Delays/ReverbTank_STANDARD/ReverbTank_STANDARD.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='ReverbTank_STANDARDexpand' onclick='javascript:toggleDisplay(ReverbTank_STANDARD, ReverbTank_STANDARDexpand, ReverbTank_STANDARDcollapse)'>show sketch</button>
<button id='ReverbTank_STANDARDcollapse' style='display:none' onclick='javascript:toggleDisplay(ReverbTank_STANDARD, ReverbTank_STANDARDexpand, ReverbTank_STANDARDcollapse)'>hide sketch</button></p>

<div id='ReverbTank_STANDARD' style='display:none'>
<figure class='code'><figcaption><span> (ReverbTank_STANDARD.ino)</span> <a href='/Mozzi/downloads/code/examples/09.Delays/ReverbTank_STANDARD/ReverbTank_STANDARD.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of reverb on a synthesised sound</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates ReverbTank, a reverb small enough to fit on</span>
</span><span class='line'><span class="cm">    the Arduino Nano, which for some reason wasn&#39;t able to fit a larger version</span>
</span><span class='line'><span class="cm">    which did fit on other 328 based boards.</span>
</span><span class='line'><span class="cm">    It&#39;s a pretty horrible reverb which sounds like the inside of a tin can.</span>
</span><span class='line'><span class="cm">    For simplicity, ReverbTank has hardcoded maximum delay sizes</span>
</span><span class='line'><span class="cm">    but also has default delay times which can be changed in the constructor</span>
</span><span class='line'><span class="cm">    or by setting during run time to allow live tweaking.</span>
</span><span class='line'><span class="cm">    The synthesised sound comes from the phasemod synth example.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 for STANDARD output on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    see the readme.md file for others.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;ReverbTank.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos8192_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/envelop2048_uint8.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">ReverbTank</span> <span class="n">reverb</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 512 </span><span class="c1">// quite fast, keeps modulation smooth</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Synth from PhaseMod_Envelope example</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCarrier</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModulator</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aModWidth</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModFreq1</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">COS8192_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kModFreq2</span><span class="p">(</span><span class="n">COS8192_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">ENVELOP2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aEnvelop</span><span class="p">(</span><span class="n">ENVELOP2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// synth params</span>
</span><span class='line'>  <span class="n">aCarrier</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">55</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kModFreq1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">3.98f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kModFreq2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">3.31757f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aModWidth</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.52434f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aEnvelop</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">9.0f</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// synth control</span>
</span><span class='line'>  <span class="n">aModulator</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">277.0f</span> <span class="o">+</span> <span class="mf">0.4313f</span><span class="o">*</span><span class="n">kModFreq1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">+</span> <span class="n">kModFreq2</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">synth</span> <span class="o">=</span> <span class="n">aCarrier</span><span class="p">.</span><span class="n">phMod</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">aModulator</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mi">150u</span><span class="o">+</span><span class="n">aModWidth</span><span class="p">.</span><span class="n">next</span><span class="p">()));</span>
</span><span class='line'>  <span class="n">synth</span> <span class="o">*=</span> <span class="p">(</span><span class="n">byte</span><span class="p">)</span><span class="n">aEnvelop</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="n">synth</span> <span class="o">&gt;&gt;=</span> <span class="mi">8</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// here&#39;s the reverb</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">arev</span> <span class="o">=</span> <span class="n">reverb</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">synth</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// add the dry and wet signals</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">synth</span> <span class="o">+</span> <span class="p">(</span><span class="n">arev</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='10.Audio_Filters'>
10.Audio_Filters</a></h2>


<hr />

<p>LowPassFilter <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/LowPassFilter/LowPassFilter.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/LowPassFilter/LowPassFilter.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='LowPassFilterexpand' onclick='javascript:toggleDisplay(LowPassFilter, LowPassFilterexpand, LowPassFiltercollapse)'>show sketch</button>
<button id='LowPassFiltercollapse' style='display:none' onclick='javascript:toggleDisplay(LowPassFilter, LowPassFilterexpand, LowPassFiltercollapse)'>hide sketch</button></p>

<div id='LowPassFilter' style='display:none'>
<figure class='code'><figcaption><span> (LowPassFilter.ino)</span> <a href='/Mozzi/downloads/code/examples/10.Audio_Filters/LowPassFilter/LowPassFilter.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of filtering a wave,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates LowPassFilter().</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/chum9_int8.h&gt; </span><span class="c1">// recorded audio wavetable</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// for filter modulation</span>
</span><span class='line'><span class="cp">#include &lt;LowPassFilter.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">CHUM9_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCrunchySound</span><span class="p">(</span><span class="n">CHUM9_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFilterMod</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">LowPassFilter</span> <span class="n">lpf</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCrunchySound</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kFilterMod</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.3f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">lpf</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span> <span class="c1">// about once every half second</span>
</span><span class='line'>    <span class="n">kFilterMod</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">rand</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="o">/</span><span class="mi">64</span><span class="p">);</span>  <span class="c1">// choose a new modulation frequency</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="c1">// map the modulation into the filter range (0-255)</span>
</span><span class='line'>  <span class="n">byte</span> <span class="n">cutoff_freq</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">kFilterMod</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
</span><span class='line'>  <span class="n">lpf</span><span class="p">.</span><span class="n">setCutoffFreq</span><span class="p">(</span><span class="n">cutoff_freq</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">lpf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aCrunchySound</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">asig</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>LowPassFilterX2 <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/LowPassFilterX2/LowPassFilterX2.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/LowPassFilterX2/LowPassFilterX2.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='LowPassFilterX2expand' onclick='javascript:toggleDisplay(LowPassFilterX2, LowPassFilterX2expand, LowPassFilterX2collapse)'>show sketch</button>
<button id='LowPassFilterX2collapse' style='display:none' onclick='javascript:toggleDisplay(LowPassFilterX2, LowPassFilterX2expand, LowPassFilterX2collapse)'>hide sketch</button></p>

<div id='LowPassFilterX2' style='display:none'>
<figure class='code'><figcaption><span> (LowPassFilterX2.ino)</span> <a href='/Mozzi/downloads/code/examples/10.Audio_Filters/LowPassFilterX2/LowPassFilterX2.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of filtering 2 waves with different filter settings,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates 2 Oscillators, each with a LowPassFilter().</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/chum9_int8.h&gt; </span><span class="c1">// recorded audio wavetable</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos512_int8.h&gt; </span><span class="c1">// for filter modulation</span>
</span><span class='line'><span class="cp">#include &lt;LowPassFilter.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt; </span><span class="c1">// for rand()</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">CHUM9_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCrunchySound1</span><span class="p">(</span><span class="n">CHUM9_DATA</span><span class="p">);</span> <span class="c1">//audio oscillator</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">CHUM9_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aCrunchySound2</span><span class="p">(</span><span class="n">CHUM9_DATA</span><span class="p">);</span> <span class="c1">//audio oscillator</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFilterMod1</span><span class="p">(</span><span class="n">COS512_DATA</span><span class="p">);</span> <span class="c1">// to modulate filter frequency</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS512_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFilterMod2</span><span class="p">(</span><span class="n">COS512_DATA</span><span class="p">);</span> <span class="c1">// to modulate filter frequency</span>
</span><span class='line'>
</span><span class='line'><span class="n">LowPassFilter</span> <span class="n">lpf1</span><span class="p">;</span>
</span><span class='line'><span class="n">LowPassFilter</span> <span class="n">lpf2</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCrunchySound1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aCrunchySound2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">6.f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kFilterMod1</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.3f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kFilterMod2</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.1f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">lpf1</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">180</span><span class="p">);</span>
</span><span class='line'>  <span class="n">lpf2</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">220</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// map the modulation depth into the filter range, 0-255 to represent 0-8192 Hz</span>
</span><span class='line'>  <span class="n">byte</span> <span class="n">cutoff_freq1</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">kFilterMod1</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="c1">// 100 Â± 63</span>
</span><span class='line'>  <span class="n">lpf1</span><span class="p">.</span><span class="n">setCutoffFreq</span><span class="p">(</span><span class="n">cutoff_freq1</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// also update lpf2 cutoff</span>
</span><span class='line'>  <span class="n">byte</span> <span class="n">cutoff_freq2</span> <span class="o">=</span> <span class="mi">70</span> <span class="o">+</span> <span class="n">kFilterMod2</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span> <span class="c1">// 70 Â± 31</span>
</span><span class='line'>  <span class="n">lpf2</span><span class="p">.</span><span class="n">setCutoffFreq</span><span class="p">(</span><span class="n">cutoff_freq2</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(((</span><span class="kt">char</span><span class="p">)</span><span class="n">lpf1</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aCrunchySound1</span><span class="p">.</span><span class="n">next</span><span class="p">()))</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">lpf2</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aCrunchySound2</span><span class="p">.</span><span class="n">next</span><span class="p">());</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>StateVariableFilter <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/StateVariableFilter/StateVariableFilter.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/StateVariableFilter/StateVariableFilter.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='StateVariableFilterexpand' onclick='javascript:toggleDisplay(StateVariableFilter, StateVariableFilterexpand, StateVariableFiltercollapse)'>show sketch</button>
<button id='StateVariableFiltercollapse' style='display:none' onclick='javascript:toggleDisplay(StateVariableFilter, StateVariableFilterexpand, StateVariableFiltercollapse)'>hide sketch</button></p>

<div id='StateVariableFilter' style='display:none'>
<figure class='code'><figcaption><span> (StateVariableFilter.ino)</span> <a href='/Mozzi/downloads/code/examples/10.Audio_Filters/StateVariableFilter/StateVariableFilter.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of filtering a wave,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates StateVariable().</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 on a Uno or similar, or</span>
</span><span class='line'><span class="cm">    DAC/A14 on Teensy 3.1, or </span>
</span><span class='line'><span class="cm">    check the README or http://sensorium.github.com/Mozzi/</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/whitenoise8192_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/cos2048_int8.h&gt; </span><span class="c1">// for filter modulation</span>
</span><span class='line'><span class="cp">#include &lt;StateVariable.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_rand.h&gt; </span><span class="c1">// for rand()</span>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">WHITENOISE8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aNoise</span><span class="p">(</span><span class="n">WHITENOISE8192_DATA</span><span class="p">);</span> <span class="c1">// audio noise</span>
</span><span class='line'><span class="n">Oscil</span><span class="o">&lt;</span><span class="n">COS2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kFilterMod</span><span class="p">(</span><span class="n">COS2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">StateVariable</span> <span class="o">&lt;</span><span class="n">NOTCH</span><span class="o">&gt;</span> <span class="n">svf</span><span class="p">;</span> <span class="c1">// can be LOWPASS, BANDPASS, HIGHPASS or NOTCH</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'>  <span class="c1">// cast to float because the resulting freq will be small and fractional</span>
</span><span class='line'>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">AUDIO_RATE</span><span class="o">/</span><span class="n">WHITENOISE8192_SAMPLERATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kFilterMod</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.3f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">svf</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span>
</span><span class='line'>  <span class="n">svf</span><span class="p">.</span><span class="n">setCentreFreq</span><span class="p">(</span><span class="mi">1200</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span> <span class="c1">// about once every half second</span>
</span><span class='line'>    <span class="n">kFilterMod</span><span class="p">.</span><span class="n">setFreq</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="n">rand</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="o">/</span><span class="mi">64</span><span class="p">);</span>  <span class="c1">// choose a new modulation frequency</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">cutoff_freq</span> <span class="o">=</span> <span class="mi">2200</span> <span class="o">+</span> <span class="n">kFilterMod</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="mi">12</span><span class="p">;</span>
</span><span class='line'>  <span class="n">svf</span><span class="p">.</span><span class="n">setCentreFreq</span><span class="p">(</span><span class="n">cutoff_freq</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// watch output levels, they can distort if too high</span>
</span><span class='line'>  <span class="c1">// also, at very resonant settings, the input signal may need attenuating</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">svf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">aNoise</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">3</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>StateVariableFilter_HIFI <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/StateVariableFilter_HIFI/StateVariableFilter_HIFI.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/10.Audio_Filters/StateVariableFilter_HIFI/StateVariableFilter_HIFI.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='StateVariableFilter_HIFIexpand' onclick='javascript:toggleDisplay(StateVariableFilter_HIFI, StateVariableFilter_HIFIexpand, StateVariableFilter_HIFIcollapse)'>show sketch</button>
<button id='StateVariableFilter_HIFIcollapse' style='display:none' onclick='javascript:toggleDisplay(StateVariableFilter_HIFI, StateVariableFilter_HIFIexpand, StateVariableFilter_HIFIcollapse)'>hide sketch</button></p>

<div id='StateVariableFilter_HIFI' style='display:none'>
<figure class='code'><figcaption><span> (StateVariableFilter_HIFI.ino)</span> <a href='/Mozzi/downloads/code/examples/10.Audio_Filters/StateVariableFilter_HIFI/StateVariableFilter_HIFI.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of filtering audio noise with a resonant filter,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates StateVariable() with acute resonance,</span>
</span><span class='line'><span class="cm">    which in this case requires the input signal level to be reduced </span>
</span><span class='line'><span class="cm">    to avoid distortion which can occur with sharp resonance settings.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    This sketch using HIFI mode is not for Teensy 3.1.</span>
</span><span class='line'><span class="cm">        </span>
</span><span class='line'><span class="cm">    IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be</span>
</span><span class='line'><span class="cm">    be changed from STANDARD mode to HIFI.</span>
</span><span class='line'><span class="cm">    In Mozz/mozzi_config.h, change</span>
</span><span class='line'><span class="cm">    #define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm">    to</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm">    #define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),</span>
</span><span class='line'><span class="cm">    Check the Mozzi core module documentation for others and more detail</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">                     3.9k </span>
</span><span class='line'><span class="cm">     pin 9  ---WWWW-----|-----output</span>
</span><span class='line'><span class="cm">                    499k           |</span>
</span><span class='line'><span class="cm">     pin 10 ---WWWW---- |</span>
</span><span class='line'><span class="cm">                                       |</span>
</span><span class='line'><span class="cm">                             4.7n  ==</span>
</span><span class='line'><span class="cm">                                       |</span>
</span><span class='line'><span class="cm">                                   ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Resistors are Â±0.5%  Measure and choose the most precise </span>
</span><span class='line'><span class="cm">    from a batch of whatever you can get.  Use two 1M resistors</span>
</span><span class='line'><span class="cm">    in parallel if you can&#39;t find 499k.</span>
</span><span class='line'><span class="cm">    Alternatively using 39 ohm, 4.99k and 470nF components will </span>
</span><span class='line'><span class="cm">    work directly with headphones.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;tables/whitenoise8192_int8.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;StateVariable.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">WHITENOISE8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aNoise</span><span class="p">(</span><span class="n">WHITENOISE8192_DATA</span><span class="p">);</span> <span class="c1">// audio noise</span>
</span><span class='line'><span class="n">StateVariable</span> <span class="o">&lt;</span><span class="n">BANDPASS</span><span class="o">&gt;</span> <span class="n">svf</span><span class="p">;</span> <span class="c1">// can be LOWPASS, BANDPASS, HIGHPASS or NOTCH</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span>
</span><span class='line'>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">1.27f</span><span class="o">*</span><span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="n">AUDIO_RATE</span><span class="o">/</span><span class="n">WHITENOISE8192_SAMPLERATE</span><span class="p">);</span>   <span class="c1">// * by an oddish number (1.27) to avoid exact repeating of noise oscil</span>
</span><span class='line'>  <span class="n">svf</span><span class="p">.</span><span class="n">setResonance</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 0 to 255, 0 is the &quot;sharp&quot; end</span>
</span><span class='line'>  <span class="n">svf</span><span class="p">.</span><span class="n">setCentreFreq</span><span class="p">(</span><span class="mi">3500</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">input</span> <span class="o">=</span> <span class="n">aNoise</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// shift down (ie. fast /) to avoid distortion with extreme resonant filter setting</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">output</span> <span class="o">=</span> <span class="n">svf</span><span class="p">.</span><span class="n">next</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">output</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">;</span> <span class="c1">// shift up for HIFI resolution</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='11.Communication'>
11.Communication</a></h2>


<hr />

<p>Mozzi_MIDI_Input <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='Mozzi_MIDI_Inputexpand' onclick='javascript:toggleDisplay(Mozzi_MIDI_Input, Mozzi_MIDI_Inputexpand, Mozzi_MIDI_Inputcollapse)'>show sketch</button>
<button id='Mozzi_MIDI_Inputcollapse' style='display:none' onclick='javascript:toggleDisplay(Mozzi_MIDI_Input, Mozzi_MIDI_Inputexpand, Mozzi_MIDI_Inputcollapse)'>hide sketch</button></p>

<div id='Mozzi_MIDI_Input' style='display:none'>
<figure class='code'><figcaption><span> (Mozzi_MIDI_Input.ino)</span> <a href='/Mozzi/downloads/code/examples/11.Communication/Mozzi_MIDI_Input/Mozzi_MIDI_Input.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a sound being triggered by MIDI input.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates playing notes with Mozzi in response to MIDI input,</span>
</span><span class='line'><span class="cm">    using  Arduino MIDI library v4.2 </span>
</span><span class='line'><span class="cm">    (https://github.com/FortySevenEffects/arduino_midi_library/releases/tag/4.2)</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: </span>
</span><span class='line'><span class="cm">      MIDI input circuit as per http://arduino.cc/en/Tutorial/Midi</span>
</span><span class='line'><span class="cm">      Note: midi input on rx pin, not tx as in the illustration on the above page.</span>
</span><span class='line'><span class="cm">      Midi has to be disconnected from rx for sketch to upload.</span>
</span><span class='line'><span class="cm">      Audio output on digital pin 9 on a Uno or similar.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2013-14, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MIDI.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;ADSR.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">MIDI_CREATE_DEFAULT_INSTANCE</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use #define for CONTROL_RATE, not a constant</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio sinewave oscillator</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// envelope generator</span>
</span><span class='line'><span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">envelope</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define LED 13 </span><span class="c1">// shows if MIDI is being recieved</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">HandleNoteOn</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">note</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">mtof</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">note</span><span class="p">)));</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>
</span><span class='line'>  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span><span class="n">HIGH</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">HandleNoteOff</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">note</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">noteOff</span><span class="p">();</span>
</span><span class='line'>  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Connect the HandleNoteOn function to the library, so it is called upon reception of a NoteOn.</span>
</span><span class='line'>  <span class="n">MIDI</span><span class="p">.</span><span class="n">setHandleNoteOn</span><span class="p">(</span><span class="n">HandleNoteOn</span><span class="p">);</span>  <span class="c1">// Put only the name of the function</span>
</span><span class='line'>  <span class="n">MIDI</span><span class="p">.</span><span class="n">setHandleNoteOff</span><span class="p">(</span><span class="n">HandleNoteOff</span><span class="p">);</span>  <span class="c1">// Put only the name of the function</span>
</span><span class='line'>  <span class="c1">// Initiate MIDI communications, listen to all channels (not needed with Teensy usbMIDI)</span>
</span><span class='line'>  <span class="n">MIDI</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">MIDI_CHANNEL_OMNI</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">64</span><span class="p">);</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span> <span class="c1">// 10000 is so the note will sustain 10 seconds unless a noteOff comes</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span> <span class="c1">// default frequency</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">MIDI</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">envelope</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Mozzi_Processing_Serial <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='Mozzi_Processing_Serialexpand' onclick='javascript:toggleDisplay(Mozzi_Processing_Serial, Mozzi_Processing_Serialexpand, Mozzi_Processing_Serialcollapse)'>show sketch</button>
<button id='Mozzi_Processing_Serialcollapse' style='display:none' onclick='javascript:toggleDisplay(Mozzi_Processing_Serial, Mozzi_Processing_Serialexpand, Mozzi_Processing_Serialcollapse)'>hide sketch</button></p>

<div id='Mozzi_Processing_Serial' style='display:none'>
<figure class='code'><figcaption><span> (Mozzi_Processing_Serial.ino)</span> <a href='/Mozzi/downloads/code/examples/11.Communication/Mozzi_Processing_Serial/Mozzi_Processing_Serial.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">  Modified from Arduino &gt; Examples &gt; Communication &gt; Dimmer</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Demonstrates the sending data from the computer to the Arduino board,</span>
</span><span class='line'><span class="cm"> in this case to control the frequency of an oscillator.  The data is sent</span>
</span><span class='line'><span class="cm"> in individual bytes, each of which ranges from 0 to 255.  Arduino</span>
</span><span class='line'><span class="cm"> reads these bytes and uses them to set the frequency of the oscillator.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Circuit: Audio output on digital pin 9. (STANDARD_PLUS mode in mozzi_config.h)</span>
</span><span class='line'><span class="cm"> Serial connection to Processing, Max/MSP, or another serial application</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> Dimmer example created 2006</span>
</span><span class='line'><span class="cm"> by David A. Mellis</span>
</span><span class='line'><span class="cm"> modified 30 Aug 2011</span>
</span><span class='line'><span class="cm"> by Tom Igoe and Scott Fitzgerald</span>
</span><span class='line'><span class="cm"> This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> http://www.arduino.cc/en/Tutorial/Dimmer</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// uses default control rate of 64</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// check if data has been sent from the computer:</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">Serial</span><span class="p">.</span><span class="n">available</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">// read the most recent byte (which will be from 0 to 255):</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="n">Serial</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
</span><span class='line'>    <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="n">val</span><span class="o">+</span><span class="mi">100</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">();</span> <span class="c1">// return an int signal centred around 0</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* Processing code for this example</span>
</span><span class='line'><span class="cm"> // Dimmer - sends bytes over a serial port</span>
</span><span class='line'><span class="cm"> // by David A. Mellis</span>
</span><span class='line'><span class="cm"> // This code is in the Public Domain.</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> import processing.serial.*;</span>
</span><span class='line'><span class="cm"> Serial port;</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> void setup() {</span>
</span><span class='line'><span class="cm"> size(256, 150);</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> println(&quot;Available serial ports:&quot;);</span>
</span><span class='line'><span class="cm"> println(Serial.list());</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> // Uses the first port in this list (number 0).  Change this to</span>
</span><span class='line'><span class="cm"> // select the port corresponding to your Arduino board.  The last</span>
</span><span class='line'><span class="cm"> // parameter (e.g. 9600) is the speed of the communication.  It</span>
</span><span class='line'><span class="cm"> // has to correspond to the value passed to Serial.begin() in your</span>
</span><span class='line'><span class="cm"> // Arduino sketch.</span>
</span><span class='line'><span class="cm"> port = new Serial(this, Serial.list()[0], 9600);  </span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> // If you know the name of the port used by the Arduino board, you</span>
</span><span class='line'><span class="cm"> // can specify it directly like this.</span>
</span><span class='line'><span class="cm"> //port = new Serial(this, &quot;COM1&quot;, 9600);</span>
</span><span class='line'><span class="cm"> }</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> void draw() {</span>
</span><span class='line'><span class="cm"> // draw a gradient from black to white</span>
</span><span class='line'><span class="cm"> for (int i = 0; i &lt; 256; i++) {</span>
</span><span class='line'><span class="cm"> stroke(i);</span>
</span><span class='line'><span class="cm"> line(i, 0, i, 150);</span>
</span><span class='line'><span class="cm"> }</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm"> // write the current X-position of the mouse to the serial port as</span>
</span><span class='line'><span class="cm"> // a single byte</span>
</span><span class='line'><span class="cm"> port.write(mouseX);</span>
</span><span class='line'><span class="cm"> }</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* Max/MSP v5 patch for this example</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">----------begin_max5_patcher----------</span>
</span><span class='line'><span class="cm">1008.3ocuXszaiaCD9r8uhA5rqAeHIa0aAMaAVf1S6hdoYQAsDiL6JQZHQ2M</span>
</span><span class='line'><span class="cm">YWr+2KeX4vjnjXKKkKhhiGQ9MeyCNz+X9rnMp63sQvuB+MLa1OlOalSjUvrC</span>
</span><span class='line'><span class="cm">ymEUytKuh05TKJWUWyk5nE9eSyuS6jesvHu4F4MxOuUzB6X57sPKWVzBLXiP</span>
</span><span class='line'><span class="cm">xZtGj6q2vafaaT0.BzJfjj.p8ZPukazsQvpfcpFs8mXR3plh8BoBxURIOWyK</span>
</span><span class='line'><span class="cm">rxspZ0YI.eTCEh5Vqp+wGtFXZMKe6CZc3yWZwTdCmYW.BBkdiby8v0r+ST.W</span>
</span><span class='line'><span class="cm">sD9SdUkn8FYspPbqvnBNFtZWiUyLmleJWo0vuKzeuj2vpJLaWA7YiE7wREui</span>
</span><span class='line'><span class="cm">FpDFDp1KcbAFcP5sJoVxp4NB5Jq40ougIDxJt1wo3GDZHiNocKhiIExx+owv</span>
</span><span class='line'><span class="cm">AdOEAksDs.RRrOoww1Arc.9RvN2J9tamwjkcqknvAE0l+8WnjHqreNet8whK</span>
</span><span class='line'><span class="cm">z6mukIK4d+Xknv3jstvJs8EirMMhxsZIusET25jXbX8xczIl5xPVxhPcTGFu</span>
</span><span class='line'><span class="cm">xNDu9rXtUCg37g9Q8Yc+EuofIYmg8QdkPCrOnXsaHwYs3rWx9PGsO+pqueG2</span>
</span><span class='line'><span class="cm">uNQBqWFh1X7qQG+3.VHcHrfO1nyR2TlqpTM9MDsLKNCQVz6KO.+Sfc5j1Ykj</span>
</span><span class='line'><span class="cm">jzkn2jwNDRP7LVb3d9LtoWBAOnvB92Le6yRmZ4UF7YpQhiFi7A5Ka8zXhKdA</span>
</span><span class='line'><span class="cm">4r9TRGG7V4COiSbAJKdXrWNhhF0hNUh7uBa4Mba0l7JUK+omjDMwkSn95Izr</span>
</span><span class='line'><span class="cm">TOwkdp7W.oPRmNRQsiKeu4j3CkfVgt.NYPEYqMGvvJ48vIlPiyzrIuZskWIS</span>
</span><span class='line'><span class="cm">xGJPcmPiWOfLodybH3wjPbMYwlbFIMNHPHFOtLBNaLSa9sGk1TxMzCX5KTa6</span>
</span><span class='line'><span class="cm">WIH2ocxSdngM0QPqFRxyPHFsprrhGc9Gy9xoBjz0NWdR2yW9DUa2F85jG2v9</span>
</span><span class='line'><span class="cm">FgTO4Q8qiC7fzzQNpmNpsY3BrYPVJBMJQ1uVmoItRhw9NrVGO3NMNzYZ+zS7</span>
</span><span class='line'><span class="cm">3WTvTOnUydG5kHMKLqAOjTe7fN2bGSxOZDkMrBrGQ9J1gONBEy0k4gVo8qHc</span>
</span><span class='line'><span class="cm">cxmfxVihWz6a3yqY9NazzUYkua9UnynadOtogW.JfsVGRVNEbWF8I+eHtcwJ</span>
</span><span class='line'><span class="cm">+wLXqZeSdWLo+FQF6731Tva0BISKTx.cLwmgJsUTTvkg1YsnXmxDge.CDR7x</span>
</span><span class='line'><span class="cm">D6YmX6fMznaF7kdczmJXwm.XSOOrdoHhNA7GMiZYLZZR.+4lconMaJP6JOZ8</span>
</span><span class='line'><span class="cm">ftCs1YWHZI3o.sIXezX5ihMSuXzZtk3ai1mXRSczoCS32hAydeyXNEu5SHyS</span>
</span><span class='line'><span class="cm">xqZqbd3ZLdera1iPqYxOm++v7SUSz</span>
</span><span class='line'><span class="cm">-----------end_max5_patcher-----------</span>
</span><span class='line'><span class="cm">*/</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Sinewave_PWM_leds_HIFI <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='Sinewave_PWM_leds_HIFIexpand' onclick='javascript:toggleDisplay(Sinewave_PWM_leds_HIFI, Sinewave_PWM_leds_HIFIexpand, Sinewave_PWM_leds_HIFIcollapse)'>show sketch</button>
<button id='Sinewave_PWM_leds_HIFIcollapse' style='display:none' onclick='javascript:toggleDisplay(Sinewave_PWM_leds_HIFI, Sinewave_PWM_leds_HIFIexpand, Sinewave_PWM_leds_HIFIcollapse)'>hide sketch</button></p>

<div id='Sinewave_PWM_leds_HIFI' style='display:none'>
<figure class='code'><figcaption><span> (Sinewave_PWM_leds_HIFI.ino)</span> <a href='/Mozzi/downloads/code/examples/11.Communication/Sinewave_PWM_leds_HIFI/Sinewave_PWM_leds_HIFI.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example playing a sinewave </span>
</span><span class='line'><span class="cm">    and changing the brightness of 3 leds</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates the use of Oscil for audio and control,</span>
</span><span class='line'><span class="cm">    and a way to do PWM on digital pins without disrupting audio.</span>
</span><span class='line'><span class="cm">    Control oscillators are used here to modulate the brightness of the leds</span>
</span><span class='line'><span class="cm">    between 0-255.</span>
</span><span class='line'><span class="cm">    The technique is explained here:</span>
</span><span class='line'><span class="cm">     http://playground.arduino.cc/Main/PWMallPins</span>
</span><span class='line'><span class="cm">    With AUDIO_RATE at 16384 Hz, this gives a 64 Hz pwm duty cycle for the LEDs.</span>
</span><span class='line'><span class="cm">    If there is visible flicker, the resolution of the pwm could be made lower,</span>
</span><span class='line'><span class="cm">    or the AUDIO_RATE could be increased to 32768 Hz, if the</span>
</span><span class='line'><span class="cm">    cpu isn&#39;t too busy.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    HIFI mode is not for Teensy 3.1, but the PWM led part should work.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    IMPORTANT: this sketch requires Mozzi/mozzi_config.h to be</span>
</span><span class='line'><span class="cm">    be changed from STANDARD mode to HIFI.</span>
</span><span class='line'><span class="cm">    In Mozz/mozzi_config.h, change</span>
</span><span class='line'><span class="cm">    #define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm">    to</span>
</span><span class='line'><span class="cm">    //#define AUDIO_MODE STANDARD</span>
</span><span class='line'><span class="cm">    #define AUDIO_MODE HIFI</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9 and 10 (on a Uno or similar),</span>
</span><span class='line'><span class="cm">    Check the Mozzi core module documentation for others and more detail</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">                     3.9k </span>
</span><span class='line'><span class="cm">     pin 9  ---WWWW-----|-----output</span>
</span><span class='line'><span class="cm">                    499k           |</span>
</span><span class='line'><span class="cm">     pin 10 ---WWWW---- |</span>
</span><span class='line'><span class="cm">                                       |</span>
</span><span class='line'><span class="cm">                             4.7n  ==</span>
</span><span class='line'><span class="cm">                                       |</span>
</span><span class='line'><span class="cm">                                   ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Resistors are Â±0.5%  Measure and choose the most precise </span>
</span><span class='line'><span class="cm">    from a batch of whatever you can get.  Use two 1M resistors</span>
</span><span class='line'><span class="cm">    in parallel if you can&#39;t find 499k.</span>
</span><span class='line'><span class="cm">    Alternatively using 39 ohm, 4.99k and 470nF components will </span>
</span><span class='line'><span class="cm">    work directly with headphones.</span>
</span><span class='line'>
</span><span class='line'><span class="cm">    LEDs:</span>
</span><span class='line'><span class="cm">    Red led from pin 3 through a 1.5k resistor to ground</span>
</span><span class='line'><span class="cm">    Green led from pin 4 through a 1.5k resistor to ground</span>
</span><span class='line'><span class="cm">    Blue led from pin 5 through a 1.5k resistor to ground</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2012-13, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// LED pins, use 0-7 for PORTD, otherwise change to PORTB in updateRGB</span>
</span><span class='line'><span class="k">const</span> <span class="n">byte</span> <span class="n">RED_PIN</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="n">byte</span> <span class="n">GREEN_PIN</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="n">byte</span> <span class="n">BLUE_PIN</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">byte</span> <span class="n">red_brightness</span><span class="p">,</span> <span class="n">green_brightness</span><span class="p">,</span> <span class="n">blue_brightness</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// control oscillators using sinewaves to modulate LED brightness</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kRed</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kGreen</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kBlue</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio oscillator</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateRGB</span><span class="p">(</span><span class="n">byte</span> <span class="n">r</span><span class="p">,</span> <span class="n">byte</span> <span class="n">g</span><span class="p">,</span> <span class="n">byte</span> <span class="n">b</span><span class="p">){</span>
</span><span class='line'>  <span class="c1">// stagger pwm counter starts to try to reduce combined flicker</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">byte</span> <span class="n">red_count</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">byte</span> <span class="n">green_count</span><span class="o">=</span><span class="mi">85</span><span class="p">;</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">byte</span> <span class="n">blue_count</span><span class="o">=</span><span class="mi">170</span><span class="p">;</span>
</span><span class='line'><span class="c1">// PORTD maps to Arduino digital pins 0 to 7</span>
</span><span class='line'><span class="c1">// http://playground.arduino.cc/Learning/PortManipulation</span>
</span><span class='line'>  <span class="p">(</span><span class="n">red_count</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="n">r</span><span class="p">)</span> <span class="o">?</span> <span class="n">PORTD</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">RED_PIN</span><span class="p">)</span> <span class="o">:</span> <span class="n">PORTD</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">RED_PIN</span><span class="p">);</span>
</span><span class='line'>  <span class="p">(</span><span class="n">green_count</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="n">g</span><span class="p">)</span> <span class="o">?</span> <span class="n">PORTD</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">GREEN_PIN</span><span class="p">)</span> <span class="o">:</span> <span class="n">PORTD</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">GREEN_PIN</span><span class="p">);</span>
</span><span class='line'>  <span class="p">(</span><span class="n">blue_count</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="n">b</span><span class="p">)</span> <span class="o">?</span> <span class="n">PORTD</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">BLUE_PIN</span><span class="p">)</span> <span class="o">:</span> <span class="n">PORTD</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">BLUE_PIN</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="n">RED_PIN</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="n">GREEN_PIN</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="n">BLUE_PIN</span><span class="p">,</span><span class="n">OUTPUT</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// set led brightness modulation frequencies</span>
</span><span class='line'>  <span class="n">kRed</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.21f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kGreen</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.3f</span><span class="p">);</span>
</span><span class='line'>  <span class="n">kBlue</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.27f</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// set audio oscil frequency</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">();</span> <span class="c1">// uses the default control rate of 64, defined in mozzi_config.h</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">red_brightness</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="n">kRed</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="n">green_brightness</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="n">kGreen</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="n">blue_brightness</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="n">kBlue</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">updateRGB</span><span class="p">(</span><span class="n">red_brightness</span><span class="p">,</span> <span class="n">green_brightness</span><span class="p">,</span> <span class="n">blue_brightness</span><span class="p">);</span>
</span><span class='line'>  <span class="c1">// this would make more sense with a higher resolution signal</span>
</span><span class='line'>  <span class="c1">// but still benefits from using HIFI to avoid the 16kHz pwm noise</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">&lt;&lt;</span><span class="mi">6</span><span class="p">;</span> <span class="c1">// 8 bits scaled up to 14 bits</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Teensy_USB_MIDI_Input <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/11.Communication/Teensy_USB_MIDI_Input/Teensy_USB_MIDI_Input.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/11.Communication/Teensy_USB_MIDI_Input/Teensy_USB_MIDI_Input.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Teensy_USB_MIDI_Inputexpand' onclick='javascript:toggleDisplay(Teensy_USB_MIDI_Input, Teensy_USB_MIDI_Inputexpand, Teensy_USB_MIDI_Inputcollapse)'>show sketch</button>
<button id='Teensy_USB_MIDI_Inputcollapse' style='display:none' onclick='javascript:toggleDisplay(Teensy_USB_MIDI_Input, Teensy_USB_MIDI_Inputexpand, Teensy_USB_MIDI_Inputcollapse)'>hide sketch</button></p>

<div id='Teensy_USB_MIDI_Input' style='display:none'>
<figure class='code'><figcaption><span> (Teensy_USB_MIDI_Input.ino)</span> <a href='/Mozzi/downloads/code/examples/11.Communication/Teensy_USB_MIDI_Input/Teensy_USB_MIDI_Input.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example of a sound being triggered by MIDI input.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates playing notes with Mozzi in response to MIDI input,</span>
</span><span class='line'><span class="cm">    using the version of the Arduino MIDI library which</span>
</span><span class='line'><span class="cm">    works with Teensy boards (http://www.pjrc.com/teensy/td_midi.html).  </span>
</span><span class='line'><span class="cm">    Tested on a Teensy2++, which can be used as a MIDI device </span>
</span><span class='line'><span class="cm">    without any extra parts.  </span>
</span><span class='line'><span class="cm">    The sketch would be almost the same with the mainstream</span>
</span><span class='line'><span class="cm">    MIDI library (using MIDI as a prefix to calls instead of usbMIDI).</span>
</span><span class='line'><span class="cm">    This sketch won&#39;t compile on the Teensy2++ if you also </span>
</span><span class='line'><span class="cm">    have the mainstream MIDI library installed.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Circuit: On the Teensy2++, audio output is on pin B5.  Midi input on usb.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Tim Barrass 2013, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;ADC.h&gt;  </span><span class="c1">// Teensy 3.1 uncomment this line and install http://github.com/pedvide/ADC</span>
</span><span class='line'><span class="cp">#include &lt;MIDI.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;mozzi_midi.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;ADSR.h&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// use #define for CONTROL_RATE, not a constant</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// audio sinewave oscillator</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// envelope generator</span>
</span><span class='line'><span class="n">ADSR</span> <span class="o">&lt;</span><span class="n">CONTROL_RATE</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">envelope</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define LED 6 </span><span class="c1">// 6 on Teensy++ 2.0, 11 on Teensy 2.0, to see if MIDI is being recieved</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">HandleNoteOn</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">note</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//aSin.setFreq(mtof(note)); // simple but less accurate frequency</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq_Q16n16</span><span class="p">(</span><span class="n">Q16n16_mtof</span><span class="p">(</span><span class="n">Q8n0_to_Q16n16</span><span class="p">(</span><span class="n">note</span><span class="p">)));</span> <span class="c1">// accurate frequency</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">noteOn</span><span class="p">();</span>
</span><span class='line'>  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span><span class="n">HIGH</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">HandleNoteOff</span><span class="p">(</span><span class="n">byte</span> <span class="n">channel</span><span class="p">,</span> <span class="n">byte</span> <span class="n">note</span><span class="p">,</span> <span class="n">byte</span> <span class="n">velocity</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">noteOff</span><span class="p">();</span>
</span><span class='line'>  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">pinMode</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Connect the HandleNoteOn function to the library, so it is called upon reception of a NoteOn.</span>
</span><span class='line'>  <span class="n">usbMIDI</span><span class="p">.</span><span class="n">setHandleNoteOn</span><span class="p">(</span><span class="n">HandleNoteOn</span><span class="p">);</span>  <span class="c1">// Put only the name of the function</span>
</span><span class='line'>  <span class="n">usbMIDI</span><span class="p">.</span><span class="n">setHandleNoteOff</span><span class="p">(</span><span class="n">HandleNoteOff</span><span class="p">);</span>  <span class="c1">// Put only the name of the function</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">setADLevels</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">64</span><span class="p">);</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">setTimes</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">200</span><span class="p">);</span> <span class="c1">// 10000 is so the note will sustain 10 seconds unless a noteOff comes</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">440</span><span class="p">);</span> <span class="c1">// default frequency</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">usbMIDI</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
</span><span class='line'>  <span class="n">envelope</span><span class="p">.</span><span class="n">update</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">envelope</span><span class="p">.</span><span class="n">next</span><span class="p">()</span> <span class="o">*</span> <span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>TwoWire_Read_ADXL345 <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='TwoWire_Read_ADXL345expand' onclick='javascript:toggleDisplay(TwoWire_Read_ADXL345, TwoWire_Read_ADXL345expand, TwoWire_Read_ADXL345collapse)'>show sketch</button>
<button id='TwoWire_Read_ADXL345collapse' style='display:none' onclick='javascript:toggleDisplay(TwoWire_Read_ADXL345, TwoWire_Read_ADXL345expand, TwoWire_Read_ADXL345collapse)'>hide sketch</button></p>

<div id='TwoWire_Read_ADXL345' style='display:none'>
<figure class='code'><figcaption><span> (TwoWire_Read_ADXL345.ino)</span> <a href='/Mozzi/downloads/code/examples/11.Communication/TwoWire_Read_ADXL345/TwoWire_Read_ADXL345.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example reading an ADXL345 accelerometer</span>
</span><span class='line'><span class="cm">    using I2C communication without blocking audio synthesis,</span>
</span><span class='line'><span class="cm">    using Mozzi sonification library.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Demonstrates use of twi_nonblock functions</span>
</span><span class='line'><span class="cm">    to replace processor-blocking Wire methods.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Note: The twi_nonblock code is not compatible with Teesy 3.1.</span>
</span><span class='line'><span class="cm">    </span>
</span><span class='line'><span class="cm">    Circuit: Audio output on digital pin 9.</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">    https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">    Marije Baalman 2012.</span>
</span><span class='line'><span class="cm">    Small modifications by TIm Barrass to retain Mozzi compatibility.</span>
</span><span class='line'><span class="cm">    This example code is in the public domain.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGuts.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscillator template</span>
</span><span class='line'><span class="cp">#include &lt;Ead.h&gt; </span><span class="c1">// exponential attack decay</span>
</span><span class='line'><span class="cp">#include &lt;tables/sin2048_int8.h&gt; </span><span class="c1">// sine table for oscillator</span>
</span><span class='line'><span class="cp">#include &lt;twi_nonblock.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define CONTROL_RATE 128 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable), look in .h file of table #included above</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">SIN2048_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aSin</span><span class="p">(</span><span class="n">SIN2048_DATA</span><span class="p">);</span>
</span><span class='line'><span class="n">Ead</span> <span class="n">kEnvelope</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// resolution will be CONTROL_RATE</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">gain</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">#define ADXL345_DEVICE (0x53)    </span><span class="c1">// ADXL345 device address</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define ADXL345_POWER_CTL 0x2d</span>
</span><span class='line'><span class="cp">#define ADXL345_DATA_FORMAT 0x31</span>
</span><span class='line'><span class="cp">#define ADXL345_DATAX0 0x32</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#define ADXL345_THRESH_INACT 0x25</span>
</span><span class='line'><span class="cp">#define ADXL345_TIME_INACT 0x26</span>
</span><span class='line'><span class="cp">#define ADXL345_ACT_INACT_CTL 0x27</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="k">volatile</span> <span class="n">byte</span> <span class="n">acc_status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="cp">#define ACC_IDLE 0</span>
</span><span class='line'><span class="cp">#define ACC_READING 1</span>
</span><span class='line'><span class="cp">#define ACC_WRITING 2</span>
</span><span class='line'>
</span><span class='line'><span class="n">byte</span> <span class="n">accbytedata</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup_accelero</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">initialize_twi_nonblock</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">acc_writeTo</span><span class="p">(</span><span class="n">ADXL345_POWER_CTL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>  <span class="c1">// all registers off</span>
</span><span class='line'>  <span class="n">acc_writeTo</span><span class="p">(</span><span class="n">ADXL345_POWER_CTL</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span> <span class="c1">// auto sleep on</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//   ADXL345_DATA_FORMAT : (self test)(spi)(int_invert)(0)(fullres)(justify)(range..)</span>
</span><span class='line'>  <span class="c1">//   11 //= B00001011</span>
</span><span class='line'>  <span class="n">acc_writeTo</span><span class="p">(</span> <span class="n">ADXL345_DATA_FORMAT</span><span class="p">,</span> <span class="mi">11</span> <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// set the threshold for inactivity</span>
</span><span class='line'>  <span class="c1">//   acc_writeTo( ADXL345_THRESH_INACT, inactivityThreshold );</span>
</span><span class='line'>  <span class="c1">//   acc_writeTo( ADXL345_TIME_INACT, inactivityTime );</span>
</span><span class='line'>  <span class="c1">// 0B10001111</span>
</span><span class='line'>  <span class="c1">//   acc_writeTo( ADXL345_ACT_INACT_CTL, B10001111 ); </span>
</span><span class='line'>  <span class="c1">//   acc_writeTo(ADXL345_POWER_CTL, B00111000); </span>
</span><span class='line'>
</span><span class='line'>  <span class="n">acc_writeTo</span><span class="p">(</span><span class="n">ADXL345_POWER_CTL</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>  <span class="c1">// auto sleep off, measure on</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">acc_status</span> <span class="o">=</span> <span class="n">ACC_IDLE</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="c1">/// ---------- non-blocking version ----------</span>
</span><span class='line'><span class="kt">void</span> <span class="n">initiate_read_accelero</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// Reads num bytes starting from address register on device in to _buff array</span>
</span><span class='line'>  <span class="c1">// indicate that we are transmitting</span>
</span><span class='line'>  <span class="c1">//   transmitting = 1;</span>
</span><span class='line'>  <span class="c1">// set address of targeted slave</span>
</span><span class='line'>  <span class="n">txAddress</span> <span class="o">=</span> <span class="n">ADXL345_DEVICE</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// reset tx buffer iterator vars</span>
</span><span class='line'>  <span class="n">txBufferIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">txBufferLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// put byte in tx buffer</span>
</span><span class='line'>  <span class="n">txBuffer</span><span class="p">[</span><span class="n">txBufferIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">ADXL345_DATAX0</span><span class="p">;</span>
</span><span class='line'>  <span class="o">++</span><span class="n">txBufferIndex</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// update amount in buffer   </span>
</span><span class='line'>  <span class="n">txBufferLength</span> <span class="o">=</span> <span class="n">txBufferIndex</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">twi_initiateWriteTo</span><span class="p">(</span><span class="n">txAddress</span><span class="p">,</span> <span class="n">txBuffer</span><span class="p">,</span> <span class="n">txBufferLength</span><span class="p">);</span>
</span><span class='line'>  <span class="n">acc_status</span> <span class="o">=</span> <span class="n">ACC_WRITING</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">initiate_request_accelero</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">// reset tx buffer iterator vars</span>
</span><span class='line'>  <span class="n">txBufferIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">txBufferLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="c1">// indicate that we are done transmitting</span>
</span><span class='line'>  <span class="c1">//   transmitting = 0;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">byte</span> <span class="n">read</span> <span class="o">=</span> <span class="n">twi_initiateReadFrom</span><span class="p">(</span><span class="n">ADXL345_DEVICE</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
</span><span class='line'>  <span class="n">acc_status</span> <span class="o">=</span> <span class="n">ACC_READING</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">finalise_request_accelero</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">byte</span> <span class="n">read</span> <span class="o">=</span> <span class="n">twi_readMasterBuffer</span><span class="p">(</span> <span class="n">rxBuffer</span><span class="p">,</span> <span class="mi">6</span> <span class="p">);</span>
</span><span class='line'>  <span class="c1">// set rx buffer iterator vars</span>
</span><span class='line'>  <span class="n">rxBufferIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">rxBufferLength</span> <span class="o">=</span> <span class="n">read</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">byte</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span> <span class="n">rxBufferLength</span> <span class="o">-</span> <span class="n">rxBufferIndex</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>         <span class="c1">// device may send less than requested (abnormal)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">accbytedata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rxBuffer</span><span class="p">[</span><span class="n">rxBufferIndex</span><span class="p">];</span>
</span><span class='line'>    <span class="o">++</span><span class="n">rxBufferIndex</span><span class="p">;</span>
</span><span class='line'>    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">acc_status</span> <span class="o">=</span> <span class="n">ACC_IDLE</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">/// ----end------ non-blocking version ----------</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Writes val to address register on device</span>
</span><span class='line'><span class="kt">void</span> <span class="n">acc_writeTo</span><span class="p">(</span><span class="n">byte</span> <span class="n">address</span><span class="p">,</span> <span class="n">byte</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">//   Wire.beginTransmission(ADXL345_DEVICE); // start transmission to device   </span>
</span><span class='line'>  <span class="n">twowire_beginTransmission</span><span class="p">(</span><span class="n">ADXL345_DEVICE</span><span class="p">);</span> <span class="c1">// start transmission to device   </span>
</span><span class='line'>  <span class="c1">//   Wire.send(address);             // send register address</span>
</span><span class='line'>  <span class="n">twowire_send</span><span class="p">(</span> <span class="n">address</span> <span class="p">);</span>
</span><span class='line'>  <span class="c1">//   Wire.send(val);                 // send value to write</span>
</span><span class='line'>  <span class="n">twowire_send</span><span class="p">(</span> <span class="n">val</span> <span class="p">);</span>
</span><span class='line'>  <span class="c1">//   Wire.endTransmission();         // end transmission</span>
</span><span class='line'>  <span class="n">twowire_endTransmission</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">setup_accelero</span><span class="p">();</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span>
</span><span class='line'>  <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mi">800</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">attack</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">decay</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>
</span><span class='line'>  <span class="n">kEnvelope</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">attack</span><span class="p">,</span><span class="n">decay</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">accx</span><span class="p">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">accy</span><span class="p">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">accz</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">envgain</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">envgain</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">kEnvelope</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span> <span class="n">envgain</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="p">){</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span> <span class="n">accx</span> <span class="o">&gt;</span> <span class="mi">512</span><span class="p">){</span>
</span><span class='line'>      <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span> <span class="mi">400</span> <span class="p">);</span>
</span><span class='line'>      <span class="n">kEnvelope</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">accy</span> <span class="o">&gt;</span> <span class="mi">512</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span> <span class="mi">800</span> <span class="p">);</span>
</span><span class='line'>      <span class="n">kEnvelope</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="n">accz</span> <span class="o">&gt;</span> <span class="mi">512</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">aSin</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span> <span class="mi">1200</span> <span class="p">);</span>
</span><span class='line'>      <span class="n">kEnvelope</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">switch</span><span class="p">(</span> <span class="n">acc_status</span> <span class="p">){</span>
</span><span class='line'>  <span class="k">case</span> <span class="nl">ACC_IDLE:</span>
</span><span class='line'>    <span class="n">accx</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">accbytedata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">256</span> <span class="o">+</span> <span class="n">accbytedata</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// accelerometer x reading</span>
</span><span class='line'>    <span class="n">accy</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">accbytedata</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="mi">256</span> <span class="o">+</span> <span class="n">accbytedata</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span> <span class="c1">// accelerometer y reading</span>
</span><span class='line'>    <span class="n">accz</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">accbytedata</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="mi">256</span> <span class="o">+</span> <span class="n">accbytedata</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span> <span class="c1">// accelerometer z reading</span>
</span><span class='line'>    <span class="n">initiate_read_accelero</span><span class="p">();</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="nl">ACC_WRITING:</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span> <span class="n">TWI_MTX</span> <span class="o">!=</span> <span class="n">twi_state</span> <span class="p">){</span>
</span><span class='line'>      <span class="n">initiate_request_accelero</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="nl">ACC_READING:</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span> <span class="n">TWI_MRX</span> <span class="o">!=</span> <span class="n">twi_state</span> <span class="p">){</span>
</span><span class='line'>      <span class="n">finalise_request_accelero</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="n">gain</span> <span class="o">=</span> <span class="n">envgain</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">updateAudio</span><span class="p">(){</span>
</span><span class='line'>  <span class="k">return</span> <span class="p">(</span><span class="n">aSin</span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="o">*</span><span class="n">gain</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<h2 class=target_without_link><a id='12.Misc'>
12.Misc</a></h2>


<hr />

<p>IntMap_test <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p>&#8230;(no recording of this one)</p>

<p><button type='button' id='IntMap_testexpand' onclick='javascript:toggleDisplay(IntMap_test, IntMap_testexpand, IntMap_testcollapse)'>show sketch</button>
<button id='IntMap_testcollapse' style='display:none' onclick='javascript:toggleDisplay(IntMap_test, IntMap_testexpand, IntMap_testcollapse)'>hide sketch</button></p>

<div id='IntMap_test' style='display:none'>
<figure class='code'><figcaption><span> (IntMap_test.ino)</span> <a href='/Mozzi/downloads/code/examples/12.Misc/IntMap_test/IntMap_test.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/* Maps a range of input numbers to an output range, comparing</span>
</span><span class='line'><span class="cm">  the results of Mozzi&#39;s IntMap object with Arduino map().</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  Demonstrates IntMap, a fast integer replacement for map().</span>
</span><span class='line'><span class="cm">  </span>
</span><span class='line'><span class="cm">  Circuit: not required</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm">  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> </span>
</span><span class='line'><span class="cm">  Tim Barrass 2014, CC by-nc-sa.</span>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;IntMap.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">const</span> <span class="n">IntMap</span> <span class="n">testIntMap</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1000</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="c1">//Serial.begin(9600); // for Teensy 3.1, beware printout can cause glitches</span>
</span><span class='line'>  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2000</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">5000</span><span class="p">){</span>
</span><span class='line'>    <span class="n">n</span> <span class="o">=</span> <span class="n">testIntMap</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;testIntMap: </span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">DEC</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">n</span> <span class="o">=</span> <span class="n">map</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1000</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s"> map: </span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">DEC</span><span class="p">);</span>
</span><span class='line'>    <span class="n">i</span> <span class="o">+=</span> <span class="mi">7</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<p>Stereo_Hack <a  href= "#top"><i class="icon-level-up right_up_level"></i></a></p>

<p><audio controls>
<source type='audio/ogg' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/12.Misc/Stereo_Hack/Stereo_Hack.ogg?raw=true' preload='auto'></source>
<source type='audio/mp3' src='https://github.com/sensorium/Mozzi/blob/gh-pages/examples/examples/12.Misc/Stereo_Hack/Stereo_Hack.mp3?raw=true' preload='auto'></source>
Your browser does not support the audio element.</audio></p>

<p><button type='button' id='Stereo_Hackexpand' onclick='javascript:toggleDisplay(Stereo_Hack, Stereo_Hackexpand, Stereo_Hackcollapse)'>show sketch</button>
<button id='Stereo_Hackcollapse' style='display:none' onclick='javascript:toggleDisplay(Stereo_Hack, Stereo_Hackexpand, Stereo_Hackcollapse)'>hide sketch</button></p>

<div id='Stereo_Hack' style='display:none'>
<figure class='code'><figcaption><span> (Stereo_Hack.ino)</span> <a href='/Mozzi/downloads/code/examples/12.Misc/Stereo_Hack/Stereo_Hack.ino'>download</a></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='c++'><span class='line'><span class="cm">/*  Example crudely panning noise to test stereo output hack,</span>
</span><span class='line'><span class="cm"> *  using Mozzi sonification library.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tests stereo output hack.  This requires #define STEREO_HACK true in mozzi_config.h</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Circuit: Audio outputs on digital pins 9 and 10.</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Mozzi help/discussion/announcements:</span>
</span><span class='line'><span class="cm"> *  https://groups.google.com/forum/#!forum/mozzi-users</span>
</span><span class='line'><span class="cm"> *</span>
</span><span class='line'><span class="cm"> *  Tim Barrass 2012.</span>
</span><span class='line'><span class="cm"> *  This example code is in the public domain.</span>
</span><span class='line'><span class="cm"> */</span>
</span><span class='line'>
</span><span class='line'><span class="cp">#include &lt;MozziGutsStereo.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;Phasor.h&gt; </span><span class="c1">// for controlling panning position</span>
</span><span class='line'><span class="cp">#include &lt;Oscil.h&gt; </span><span class="c1">// oscil for audio sig</span>
</span><span class='line'><span class="cp">#include &lt;tables/pinknoise8192_int8.h&gt; </span><span class="c1">// table for oscillator</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// use #define for CONTROL_RATE, not a constant</span>
</span><span class='line'><span class="cp">#define CONTROL_RATE 64 </span><span class="c1">// powers of 2 please</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// use: Oscil &lt;table_size, update_rate&gt; oscilName (wavetable)</span>
</span><span class='line'><span class="n">Oscil</span> <span class="o">&lt;</span><span class="n">PINKNOISE8192_NUM_CELLS</span><span class="p">,</span> <span class="n">AUDIO_RATE</span><span class="o">&gt;</span> <span class="n">aNoise</span><span class="p">(</span><span class="n">PINKNOISE8192_DATA</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//Phasor for panning</span>
</span><span class='line'><span class="n">Phasor</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="n">CONTROL_RATE</span><span class="o">&gt;</span> <span class="n">kPan</span><span class="p">;</span>
</span><span class='line'><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pan</span><span class="p">;</span> <span class="c1">// convey pan from updateControl() to updateAudioStereo();</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">setup</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">aNoise</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">2.111f</span><span class="p">);</span> <span class="c1">// set the frequency with an unsigned int or a float</span>
</span><span class='line'>  <span class="n">kPan</span><span class="p">.</span><span class="n">setFreq</span><span class="p">(</span><span class="mf">0.25f</span><span class="p">);</span> <span class="c1">// take 4 seconds to move left-right</span>
</span><span class='line'>  <span class="n">startMozzi</span><span class="p">(</span><span class="n">CONTROL_RATE</span><span class="p">);</span> <span class="c1">// set a control rate of 64 (powers of 2 please)</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateControl</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">pan</span> <span class="o">=</span> <span class="n">kPan</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">audio_signal_1</span><span class="p">,</span> <span class="n">audio_signal_2</span><span class="p">;</span> <span class="c1">// required for the stereo hack</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">updateAudioStereo</span><span class="p">(){</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">asig</span> <span class="o">=</span> <span class="n">aNoise</span><span class="p">.</span><span class="n">next</span><span class="p">();</span>
</span><span class='line'>  <span class="n">audio_signal_1</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(((</span><span class="kt">long</span><span class="p">)</span><span class="n">pan</span><span class="o">*</span><span class="n">asig</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">);</span>
</span><span class='line'>  <span class="n">audio_signal_2</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)((((</span><span class="kt">long</span><span class="p">)</span><span class="mi">65535</span><span class="o">-</span><span class="n">pan</span><span class="p">)</span><span class="o">*</span><span class="n">asig</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">loop</span><span class="p">(){</span>
</span><span class='line'>  <span class="n">audioHook</span><span class="p">();</span> <span class="c1">// required here</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<hr />

<script language="JavaScript">
   function toggleDisplay(stuffToToggle,elementThatExpandsStuff,elementThatCollapsesStuff) {
      if ( stuffToToggle.style.display == 'none' ) {
         stuffToToggle.style.display = '';
         elementThatExpandsStuff.style.display = 'none';
         elementThatCollapsesStuff.style.display = '';
      }
      else {
         stuffToToggle.style.display = 'none';
         elementThatExpandsStuff.style.display = '';
         elementThatCollapsesStuff.style.display = 'none';
      }
   }
</script>


  
    <footer>
      
      
        <div class="sharing">
  
  <a href="/Mozzi//twitter.com/share" class="twitter-share-button" data-url="http://sensorium.github.io/Mozzi//examples/index.html" data-via="nothingperson" data-counturl="http://sensorium.github.io/Mozzi//examples/index.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

      
    </footer>
  
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/Mozzi/blog/2017/03/12/v1-dot-0-3rc5-hifi-compile-fix/">v1.0.3rc5 HIFI Compile Fix</a>
      </li>
    
      <li class="post">
        <a href="/Mozzi/blog/2017/01/16/v1-dot-0-3rc4-fixes-compile/">v1.0.3rc4 Fixes Compile</a>
      </li>
    
      <li class="post">
        <a href="/Mozzi/blog/2016/12/11/v1-dot-0-3rc2-teensy-bugfix/">v1.0.3rc2 Teensy Bugfix</a>
      </li>
    
      <li class="post">
        <a href="/Mozzi/blog/2016/11/26/tweak-for-faster-code/">Tweak for Faster Code</a>
      </li>
    
      <li class="post">
        <a href="/Mozzi/blog/2016/11/26/update-1-dot-0-3rc1-available/">Update 1.0.3rc1 Available</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="https://purl.org/dc/terms/" property="dct:title">Mozzi</span> by <a xmlns:cc="https://creativecommons.org/ns#" href="https://github.com/sensorium/Mozzi" property="cc:attributionName" rel="cc:attributionURL">Tim Barrass</a> is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
</br>
  <!-- Copyright &copy; 2017 - Tim Barrass - -->
  <span class="credit">Powered by <a href="https://octopress.org">Octopress</a></span>
  <span class="credit">Published with <a href="https://pages.github.com">GitHub Pages</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
