
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>under the hood - MOZZI</title>
  <meta name="author" content="Tim Barrass">
  
  
  <meta name="description" content="Mozzi is a sound synthesis software library for Arduino." />

  
  <meta name="keywords" content="Applications : sound, music, audio, synthesis, synthesiser, synthesizer, sound art, electronic music, computer music, generative music, sonification, media art, performance, installation, electronic art, creative art, interactive art, Software: library, arduino, open source, extendable, free, Audience: artists, scientists, teachers, learners, students, hobby, do it yourself, diy, makers, creators, musicians, engineers, collaborators" />

  <!-- https://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sensorium.github.io/Mozzi//learn/under-the-hood">
  <link href="/Mozzi/favicon.png" rel="icon">
  <link href="/Mozzi/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/Mozzi/atom.xml" rel="alternate" title="MOZZI" type="application/atom+xml">
  <script src="/Mozzi/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/Mozzi/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at https://google.com/webfonts -->

<link href='https://fonts.googleapis.com/css?family=Londrina+Solid&text=MOZZI' rel='stylesheet' type='text/css'>


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32577259-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'https://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner">
<div id="header_wrap">
	
	<hgroup>
		<h1 id="banner_main_title"><a href="/Mozzi/">MOZZI</a></h1>
		
		
			<h2>sound synthesis library for Arduino</h2>
		
	</hgroup>
	
	<img src="/Mozzi/images/mozzi-circle.gif" id="mozzi_logo"/> 
	<img src="/Mozzi/images/lee.gif" id="lee"/>

	<section id="header_links_section">
		<p>
			<a  class="header_link" href="https://github.com/sensorium/Mozzi"> 
				<span id="header_small_label">View on <i class="icon-github icon-2x"></i> GitHub</span>
			</a>
		</p>
		<p>
		
			<!-- <a class="header_link" href="https://github.com/sensorium/Mozzi/zipball/master"> -->
			<a class="header_link" href="https://tinyurl.com/mozzilib/Mozzi.zip" > <!--download="Mozzi.zip" > stops download working in chrome -->
			<!-- <a class="header_link" href="/Mozzi/download/">  -->
				download<br>
				<i class="icon-download icon-4x"></i><br>
				<span id="header_small_label">version 2014-08-09-14:15</span>
			</a>
		</p>
	</section> 

</div>



</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/Mozzi/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <!-- <input type="hidden" name="q" value="site:sensorium.github.io/Mozzi/" /> -->
    <input type="hidden" name="q" value="https://sensorium.github.io/Mozzi/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/Mozzi/">Home</a></li>
  <li><a href="/Mozzi/examples/">Examples</a></li>
  <li><a href="/Mozzi/learn/">Learn</a></li>
  <li><a href="/Mozzi/gallery/">Gallery</a></li>
  <li><a href="/Mozzi/faq/">FAQ</a></li>
  <li><a href="https://groups.google.com/forum/#!forum/mozzi-users/">Forum</a></li>
  <li><a href="/Mozzi/doc/html/index.html">API</a></li>
  <li><a href="/Mozzi/consulting/">Consulting</a></li>
  <!-- <li><a href="https://mozzi.sharetribe.com/">Market</a></li> -->
  <!-- <li><a href="/Mozzi/download/">Download</a></li> -->
  <!-- <li><a href="/Mozzi/blog/">Blog</a></li> -->
  <!-- <li><a href="/Mozzi/resources/">Resources</a></li>   -->
  <!-- <li><a href="/Mozzi/blog/archives/">Archives</a></li>
  <li><a href="/Mozzi/about/">About</a></li> -->
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Under the Hood</h1>
    
  </header>
  
  <p>The interface between Mozzi and the Arduino environment consists of four main
functions. These are <code>startMozzi()</code>, <code>updateAudio()</code>, <code>updateControl()</code> and
<code>audioHook()</code>, visible in the “User space” section in the figure below. All four are
required for a Mozzi sketch to compile.</p>

<p><img src="images/Mozzi-system.jpg" title="Mozzi system architecture" ></p>

<p><code>startMozzi(control_rate)</code> goes in Arduino&#8217;s <code>setup()</code>. It starts the control and
audio output timers, given the requested control rate in Hz as a parameter,
or defaulting to 64 Hz without a parameter.</p>

<p><code>updateControl()</code> is where any analog or digital input sensing code should be placed and
relatively slow changes such as LFO&#8217;s or frequency changes can be performed.</p>

<p><code>updateAudio()</code> is where audio synthesis code should be placed. This runs on
average 16384 times per second, so code here needs to be lean. The only other
strict requirement is that it returns an integer between -244 and 243 inclusive
in STANDARD mode or -8192 to 8191 in HIFI mode.</p>

<p><code>audioHook()</code> goes in Arduino&#8217;s <code>loop()</code>. It wraps <code>updateAudio()</code> and takes care of
filling the output buffer, hiding the details of this from user space.</p>

<p>Mozzi uses hardware interrupts on the processor which automatically call
interrupt service routines (ISR) at regular intervals. <code>startMozzi()</code> sets
up two interrupts, one for audio output at a sample rate of 16384 Hz and a
control interrupt which can be set by the user at 64 Hz or more, in powers of
two.</p>

<p>In <code>STANDARD</code> mode, the internal timers used by Mozzi on the ATmega
processors are the 16 bit Timer 1 for audio and 8 bit Timer 0 for control.</p>

<p><code>HIFI</code> mode additionally employs Timer 2 with Timer 1 for audio.</p>

<p>Using Timer 0 disables Arduino time functions <code>millis()</code>, <code>micros()</code>, <code>delay()</code>
and <code>delayMicroseconds()</code>. This saves processor time which would be spent on the
interrupts and the blocking action of the <code>delay()</code> functions. Replacements for
these functions are listed on the Mozzi home page under Caveats and Workarounds.</p>

<p>The output buffer has 256 cells which equates to a maximum latency of about 15
milliseconds, to give leeway for control operations without interrupting audio
output. The buffer is emptied behind the scenes by the regular 16384 Hz audio
interrupt.</p>

  
    <footer>
      
      
        <div class="sharing">
  
  <a href="/Mozzi//twitter.com/share" class="twitter-share-button" data-url="http://sensorium.github.io/Mozzi//learn/under-the-hood/index.html" data-via="nothingperson" data-counturl="http://sensorium.github.io/Mozzi//learn/under-the-hood/index.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

      
    </footer>
  
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/Mozzi/blog/2015/04/08/use-arduino-1-dot-0-5/">Use Arduino 1.0.5</a>
      </li>
    
      <li class="post">
        <a href="/Mozzi/blog/2014/11/21/yes/">Yes, You Can Donate!</a>
      </li>
    
      <li class="post">
        <a href="/Mozzi/blog/2014/08/09/teensy-3-dot-0-slash-3-dot-1-test-release-version-2014-08-09-14-15/">Teensy 3.0/3.1 Test Release</a>
      </li>
    
      <li class="post">
        <a href="/Mozzi/blog/2014/06/20/teensy-3-dot-0-3-dot-1-port-progress/">Teensy 3.0-3.1 Port Progress</a>
      </li>
    
      <li class="post">
        <a href="/Mozzi/blog/2014/04/20/standard-plus-performance-improves/">STANDARD_PLUS Performance Improves</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="https://purl.org/dc/terms/" property="dct:title">Mozzi</span> by <a xmlns:cc="https://creativecommons.org/ns#" href="https://github.com/sensorium/Mozzi" property="cc:attributionName" rel="cc:attributionURL">Tim Barrass</a> is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
</br>
  <!-- Copyright &copy; 2015 - Tim Barrass - -->
  <span class="credit">Powered by <a href="https://octopress.org">Octopress</a></span>
  <span class="credit">Published with <a href="https://pages.github.com">GitHub Pages</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
